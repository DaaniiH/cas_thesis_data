<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="DaaniiH">
<meta name="dcterms.date" content="2025-06-01">

<title>cas_thesis_data_prep</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="cas_thesis_data_prep_files/libs/clipboard/clipboard.min.js"></script>
<script src="cas_thesis_data_prep_files/libs/quarto-html/quarto.js"></script>
<script src="cas_thesis_data_prep_files/libs/quarto-html/popper.min.js"></script>
<script src="cas_thesis_data_prep_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="cas_thesis_data_prep_files/libs/quarto-html/anchor.min.js"></script>
<link href="cas_thesis_data_prep_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="cas_thesis_data_prep_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="cas_thesis_data_prep_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="cas_thesis_data_prep_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="cas_thesis_data_prep_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="cas_thesis_data_prep_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="cas_thesis_data_prep_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="cas_thesis_data_prep_files/libs/plotly-binding-4.10.4/plotly.js"></script>

<script src="cas_thesis_data_prep_files/libs/typedarray-0.1/typedarray.min.js"></script>

<script src="cas_thesis_data_prep_files/libs/jquery-3.5.1/jquery.min.js"></script>

<link href="cas_thesis_data_prep_files/libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="cas_thesis_data_prep_files/libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<link href="cas_thesis_data_prep_files/libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">

<script src="cas_thesis_data_prep_files/libs/plotly-main-2.11.1/plotly-latest.min.js"></script>



</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#libraries" id="toc-libraries" class="nav-link active" data-scroll-target="#libraries"><span class="header-section-number">1</span> Libraries</a></li>
  <li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions"><span class="header-section-number">2</span> Functions</a></li>
  <li><a href="#etl-extract-transform-load" id="toc-etl-extract-transform-load" class="nav-link" data-scroll-target="#etl-extract-transform-load"><span class="header-section-number">3</span> <strong>ETL: Extract, Transform, Load</strong></a>
  <ul>
  <li><a href="#lookup-tabellen" id="toc-lookup-tabellen" class="nav-link" data-scroll-target="#lookup-tabellen"><span class="header-section-number">3.1</span> Lookup Tabellen</a>
  <ul>
  <li><a href="#kantone" id="toc-kantone" class="nav-link" data-scroll-target="#kantone"><span class="header-section-number">3.1.0.1</span> Kantone</a></li>
  <li><a href="#wahlberechtigte" id="toc-wahlberechtigte" class="nav-link" data-scroll-target="#wahlberechtigte"><span class="header-section-number">3.1.0.2</span> Wahlberechtigte</a></li>
  <li><a href="#parteien" id="toc-parteien" class="nav-link" data-scroll-target="#parteien"><span class="header-section-number">3.1.0.3</span> Parteien</a></li>
  <li><a href="#parteilandschaft---daten-laden" id="toc-parteilandschaft---daten-laden" class="nav-link" data-scroll-target="#parteilandschaft---daten-laden"><span class="header-section-number">3.1.1</span> Parteilandschaft - Daten laden</a></li>
  </ul></li>
  <li><a href="#wahlen---daten-laden-umformen" id="toc-wahlen---daten-laden-umformen" class="nav-link" data-scroll-target="#wahlen---daten-laden-umformen"><span class="header-section-number">3.2</span> Wahlen - Daten laden &amp; Umformen</a>
  <ul>
  <li><a href="#bundesebene" id="toc-bundesebene" class="nav-link" data-scroll-target="#bundesebene"><span class="header-section-number">3.2.1</span> Bundesebene</a>
  <ul class="collapse">
  <li><a href="#nationalrat" id="toc-nationalrat" class="nav-link" data-scroll-target="#nationalrat"><span class="header-section-number">3.2.1.1</span> Nationalrat</a></li>
  <li><a href="#ständerat" id="toc-ständerat" class="nav-link" data-scroll-target="#ständerat"><span class="header-section-number">3.2.1.2</span> Ständerat</a></li>
  <li><a href="#national--ständerat-kombinieren" id="toc-national--ständerat-kombinieren" class="nav-link" data-scroll-target="#national--ständerat-kombinieren"><span class="header-section-number">3.2.1.3</span> National- &amp; Ständerat kombinieren</a></li>
  <li><a href="#ergebnis-national-ständeratssitze" id="toc-ergebnis-national-ständeratssitze" class="nav-link" data-scroll-target="#ergebnis-national-ständeratssitze"><span class="header-section-number">3.2.1.4</span> Ergebnis National &amp; Ständeratssitze</a></li>
  <li><a href="#parteinamen-bund-für-lookup-tabelle" id="toc-parteinamen-bund-für-lookup-tabelle" class="nav-link" data-scroll-target="#parteinamen-bund-für-lookup-tabelle"><span class="header-section-number">3.2.1.5</span> Parteinamen Bund (für Lookup-Tabelle)</a></li>
  </ul></li>
  <li><a href="#kantonsebene---kantonale-regierung-exekutive" id="toc-kantonsebene---kantonale-regierung-exekutive" class="nav-link" data-scroll-target="#kantonsebene---kantonale-regierung-exekutive"><span class="header-section-number">3.2.2</span> Kantonsebene - Kantonale Regierung (Exekutive)</a>
  <ul class="collapse">
  <li><a href="#dateipfad-und-gewünschte-sheets-definieren" id="toc-dateipfad-und-gewünschte-sheets-definieren" class="nav-link" data-scroll-target="#dateipfad-und-gewünschte-sheets-definieren"><span class="header-section-number">3.2.2.1</span> Dateipfad und gewünschte Sheets definieren</a></li>
  <li><a href="#function-laden" id="toc-function-laden" class="nav-link" data-scroll-target="#function-laden"><span class="header-section-number">3.2.2.2</span> Function laden</a></li>
  <li><a href="#function-ausführen-konsolidation-aus-datenliste" id="toc-function-ausführen-konsolidation-aus-datenliste" class="nav-link" data-scroll-target="#function-ausführen-konsolidation-aus-datenliste"><span class="header-section-number">3.2.2.3</span> Function ausführen &amp; Konsolidation aus Datenliste</a></li>
  <li><a href="#ergebnis-kantonsregierung" id="toc-ergebnis-kantonsregierung" class="nav-link" data-scroll-target="#ergebnis-kantonsregierung"><span class="header-section-number">3.2.2.4</span> Ergebnis Kantonsregierung</a></li>
  <li><a href="#parteinamen-kanton-für-lookup-tabelle" id="toc-parteinamen-kanton-für-lookup-tabelle" class="nav-link" data-scroll-target="#parteinamen-kanton-für-lookup-tabelle"><span class="header-section-number">3.2.2.5</span> Parteinamen Kanton (für Lookup-Tabelle)</a></li>
  </ul></li>
  <li><a href="#gemeindeebene---exekutiven-der-statistischen-städte" id="toc-gemeindeebene---exekutiven-der-statistischen-städte" class="nav-link" data-scroll-target="#gemeindeebene---exekutiven-der-statistischen-städte"><span class="header-section-number">3.2.3</span> Gemeindeebene - Exekutiven der statistischen Städte</a>
  <ul class="collapse">
  <li><a href="#dateipfad-und-gewünschte-sheets-festlegen" id="toc-dateipfad-und-gewünschte-sheets-festlegen" class="nav-link" data-scroll-target="#dateipfad-und-gewünschte-sheets-festlegen"><span class="header-section-number">3.2.3.1</span> Dateipfad und gewünschte Sheets festlegen</a></li>
  <li><a href="#function-für-den-import-der-gemeindedaten" id="toc-function-für-den-import-der-gemeindedaten" class="nav-link" data-scroll-target="#function-für-den-import-der-gemeindedaten"><span class="header-section-number">3.2.3.2</span> Function für den Import der Gemeindedaten</a></li>
  <li><a href="#import-der-dateien-testen-optional" id="toc-import-der-dateien-testen-optional" class="nav-link" data-scroll-target="#import-der-dateien-testen-optional"><span class="header-section-number">3.2.3.3</span> Import der Dateien testen (optional)</a></li>
  <li><a href="#function-ausführen-konsolidation-aus-datenliste-1" id="toc-function-ausführen-konsolidation-aus-datenliste-1" class="nav-link" data-scroll-target="#function-ausführen-konsolidation-aus-datenliste-1"><span class="header-section-number">3.2.3.4</span> Function ausführen &amp; Konsolidation aus Datenliste</a></li>
  <li><a href="#ergebnis-gemeinde-bzw.-exekutiven-statistischer-städte" id="toc-ergebnis-gemeinde-bzw.-exekutiven-statistischer-städte" class="nav-link" data-scroll-target="#ergebnis-gemeinde-bzw.-exekutiven-statistischer-städte"><span class="header-section-number">3.2.3.5</span> Ergebnis Gemeinde bzw. Exekutiven statistischer Städte</a></li>
  <li><a href="#parteinamen-gemeinde-für-lookup-tabelle" id="toc-parteinamen-gemeinde-für-lookup-tabelle" class="nav-link" data-scroll-target="#parteinamen-gemeinde-für-lookup-tabelle"><span class="header-section-number">3.2.3.6</span> Parteinamen Gemeinde (für Lookup-Tabelle)</a></li>
  </ul></li>
  <li><a href="#listen-aller-staatsebenen-konsolidieren-einheitliche-parteinamen-joinen" id="toc-listen-aller-staatsebenen-konsolidieren-einheitliche-parteinamen-joinen" class="nav-link" data-scroll-target="#listen-aller-staatsebenen-konsolidieren-einheitliche-parteinamen-joinen"><span class="header-section-number">3.2.4</span> Listen aller Staatsebenen konsolidieren &amp; einheitliche Parteinamen joinen</a></li>
  <li><a href="#clean-up-election-obsolete-objekte-nach-konsolidierung-löschen" id="toc-clean-up-election-obsolete-objekte-nach-konsolidierung-löschen" class="nav-link" data-scroll-target="#clean-up-election-obsolete-objekte-nach-konsolidierung-löschen"><span class="header-section-number">3.2.5</span> Clean-up “Election”: Obsolete Objekte (nach Konsolidierung) löschen</a></li>
  <li><a href="#parteistärken-berechnen---sitze-aggregiert-auf-staatsebene" id="toc-parteistärken-berechnen---sitze-aggregiert-auf-staatsebene" class="nav-link" data-scroll-target="#parteistärken-berechnen---sitze-aggregiert-auf-staatsebene"><span class="header-section-number">3.2.6</span> Parteistärken berechnen - Sitze aggregiert auf Staatsebene</a>
  <ul class="collapse">
  <li><a href="#jahre-eingrenzen" id="toc-jahre-eingrenzen" class="nav-link" data-scroll-target="#jahre-eingrenzen"><span class="header-section-number">3.2.6.1</span> Jahre eingrenzen</a></li>
  <li><a href="#dataframes-vereinheitlichen-und-ggfs.-aggregieren" id="toc-dataframes-vereinheitlichen-und-ggfs.-aggregieren" class="nav-link" data-scroll-target="#dataframes-vereinheitlichen-und-ggfs.-aggregieren"><span class="header-section-number">3.2.6.2</span> Dataframes vereinheitlichen und ggfs. aggregieren</a>
  <ul class="collapse">
  <li><a href="#staatsebene-national--und-ständerat-as-is" id="toc-staatsebene-national--und-ständerat-as-is" class="nav-link" data-scroll-target="#staatsebene-national--und-ständerat-as-is"><span class="header-section-number">3.2.6.2.1</span> Staatsebene: National- und Ständerat “as is”</a></li>
  <li><a href="#kantonsebene-gewichtung-nach-stimmberechtigten-je-kanton-für-aggregation-auf-staatsebene" id="toc-kantonsebene-gewichtung-nach-stimmberechtigten-je-kanton-für-aggregation-auf-staatsebene" class="nav-link" data-scroll-target="#kantonsebene-gewichtung-nach-stimmberechtigten-je-kanton-für-aggregation-auf-staatsebene"><span class="header-section-number">3.2.6.2.2</span> Kantonsebene: Gewichtung nach Stimmberechtigten je Kanton für Aggregation auf Staatsebene</a></li>
  <li><a href="#gemeindeebene-gewichtung-nach-einwohner-je-statistische-stadt-aggregiert-auf-kanton--und-staatsebene" id="toc-gemeindeebene-gewichtung-nach-einwohner-je-statistische-stadt-aggregiert-auf-kanton--und-staatsebene" class="nav-link" data-scroll-target="#gemeindeebene-gewichtung-nach-einwohner-je-statistische-stadt-aggregiert-auf-kanton--und-staatsebene"><span class="header-section-number">3.2.6.2.3</span> Gemeindeebene: Gewichtung nach Einwohner je “statistische Stadt” aggregiert auf Kanton- und Staatsebene</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#übersicht-aller-elec_-dataframes" id="toc-übersicht-aller-elec_-dataframes" class="nav-link" data-scroll-target="#übersicht-aller-elec_-dataframes"><span class="header-section-number">3.2.7</span> Übersicht aller elec_ dataframes</a>
  <ul class="collapse">
  <li><a href="#function-für-df-übersicht" id="toc-function-für-df-übersicht" class="nav-link" data-scroll-target="#function-für-df-übersicht"><span class="header-section-number">3.2.7.1</span> Function für df() Übersicht</a></li>
  <li><a href="#df-für-übersicht-definieren-und-function-ausführen" id="toc-df-für-übersicht-definieren-und-function-ausführen" class="nav-link" data-scroll-target="#df-für-übersicht-definieren-und-function-ausführen"><span class="header-section-number">3.2.7.2</span> df für Übersicht definieren und Function ausführen</a></li>
  </ul></li>
  <li><a href="#entwicklung-über-die-jahre" id="toc-entwicklung-über-die-jahre" class="nav-link" data-scroll-target="#entwicklung-über-die-jahre"><span class="header-section-number">3.2.8</span> Entwicklung über die Jahre?!</a></li>
  </ul></li>
  <li><a href="#abstimmungen---daten-laden-umformen" id="toc-abstimmungen---daten-laden-umformen" class="nav-link" data-scroll-target="#abstimmungen---daten-laden-umformen"><span class="header-section-number">3.3</span> Abstimmungen - Daten laden &amp; Umformen</a>
  <ul>
  <li><a href="#swissvotes-datensatz-mit-abstimmungsdetails-laden" id="toc-swissvotes-datensatz-mit-abstimmungsdetails-laden" class="nav-link" data-scroll-target="#swissvotes-datensatz-mit-abstimmungsdetails-laden"><span class="header-section-number">3.3.1</span> Swissvotes-Datensatz mit Abstimmungsdetails laden</a></li>
  <li><a href="#parteinamen-inputs-konsolidieren-auf-vollständigkeit-prüfen" id="toc-parteinamen-inputs-konsolidieren-auf-vollständigkeit-prüfen" class="nav-link" data-scroll-target="#parteinamen-inputs-konsolidieren-auf-vollständigkeit-prüfen"><span class="header-section-number">3.3.2</span> Parteinamen Inputs konsolidieren &amp; auf Vollständigkeit prüfen</a></li>
  <li><a href="#clean-up-lookup-obsolete-objekte-nach-konsolidierung-löschen" id="toc-clean-up-lookup-obsolete-objekte-nach-konsolidierung-löschen" class="nav-link" data-scroll-target="#clean-up-lookup-obsolete-objekte-nach-konsolidierung-löschen"><span class="header-section-number">3.3.3</span> Clean-up “lookup”: Obsolete Objekte (nach konsolidierung) löschen</a></li>
  </ul></li>
  <li><a href="#abstimmungsergebnisse-transformieren-ergänzen" id="toc-abstimmungsergebnisse-transformieren-ergänzen" class="nav-link" data-scroll-target="#abstimmungsergebnisse-transformieren-ergänzen"><span class="header-section-number">3.4</span> Abstimmungsergebnisse transformieren &amp; ergänzen</a>
  <ul>
  <li><a href="#transformation-vom-wide-ins-long-format" id="toc-transformation-vom-wide-ins-long-format" class="nav-link" data-scroll-target="#transformation-vom-wide-ins-long-format"><span class="header-section-number">3.4.1</span> Transformation: Vom Wide ins Long Format</a>
  <ul class="collapse">
  <li><a href="#präfix-spalten-p--pdev---pos-inkl.-parolencluster-transformieren" id="toc-präfix-spalten-p--pdev---pos-inkl.-parolencluster-transformieren" class="nav-link" data-scroll-target="#präfix-spalten-p--pdev---pos-inkl.-parolencluster-transformieren"><span class="header-section-number">3.4.1.1</span> Präfix-Spalten: “p-” / “pdev-” &amp; “-pos” inkl. Parolencluster transformieren</a></li>
  <li><a href="#parteinamen-ergänzen-zeilen-mit--pos-endung-entfernen" id="toc-parteinamen-ergänzen-zeilen-mit--pos-endung-entfernen" class="nav-link" data-scroll-target="#parteinamen-ergänzen-zeilen-mit--pos-endung-entfernen"><span class="header-section-number">3.4.1.2</span> Parteinamen ergänzen &amp; Zeilen mit “-pos”-Endung entfernen</a></li>
  <li><a href="#parteistärken-ergänzen" id="toc-parteistärken-ergänzen" class="nav-link" data-scroll-target="#parteistärken-ergänzen"><span class="header-section-number">3.4.1.3</span> Parteistärken ergänzen</a></li>
  <li><a href="#spalten-ergänzen-aus-urprungsfile" id="toc-spalten-ergänzen-aus-urprungsfile" class="nav-link" data-scroll-target="#spalten-ergänzen-aus-urprungsfile"><span class="header-section-number">3.4.1.4</span> Spalten ergänzen (aus Urprungsfile)</a></li>
  <li><a href="#spaltenklassifizierung-und-levels" id="toc-spaltenklassifizierung-und-levels" class="nav-link" data-scroll-target="#spaltenklassifizierung-und-levels"><span class="header-section-number">3.4.1.5</span> Spaltenklassifizierung und Levels</a></li>
  <li><a href="#spalten-hinzufügen-berechnet" id="toc-spalten-hinzufügen-berechnet" class="nav-link" data-scroll-target="#spalten-hinzufügen-berechnet"><span class="header-section-number">3.4.1.6</span> Spalten hinzufügen (berechnet)</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#analysen" id="toc-analysen" class="nav-link" data-scroll-target="#analysen"><span class="header-section-number">3.5</span> Analysen</a>
  <ul>
  <li><a href="#abstimmungsergebnisse-mit-widersprüchlichen-parolen" id="toc-abstimmungsergebnisse-mit-widersprüchlichen-parolen" class="nav-link" data-scroll-target="#abstimmungsergebnisse-mit-widersprüchlichen-parolen"><span class="header-section-number">3.5.1</span> Abstimmungsergebnisse mit widersprüchlichen Parolen</a>
  <ul class="collapse">
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data"><span class="header-section-number">3.5.1.1</span> Data</a></li>
  </ul></li>
  <li><a href="#paradoxe-fälle-überarbeiten" id="toc-paradoxe-fälle-überarbeiten" class="nav-link" data-scroll-target="#paradoxe-fälle-überarbeiten"><span class="header-section-number">3.5.2</span> Paradoxe Fälle ÜBERARBEITEN</a>
  <ul class="collapse">
  <li><a href="#varianz" id="toc-varianz" class="nav-link" data-scroll-target="#varianz"><span class="header-section-number">3.5.2.1</span> Varianz</a></li>
  <li><a href="#varianz-gruppiert-nach-rechtsform" id="toc-varianz-gruppiert-nach-rechtsform" class="nav-link" data-scroll-target="#varianz-gruppiert-nach-rechtsform"><span class="header-section-number">3.5.2.2</span> Varianz gruppiert nach Rechtsform</a></li>
  <li><a href="#prüfung-der-normalverteilung" id="toc-prüfung-der-normalverteilung" class="nav-link" data-scroll-target="#prüfung-der-normalverteilung"><span class="header-section-number">3.5.2.3</span> Prüfung der Normalverteilung</a>
  <ul class="collapse">
  <li><a href="#grafisch" id="toc-grafisch" class="nav-link" data-scroll-target="#grafisch"><span class="header-section-number">3.5.2.3.1</span> Grafisch</a></li>
  <li><a href="#formale-prüfung-shapiro-wilk-test" id="toc-formale-prüfung-shapiro-wilk-test" class="nav-link" data-scroll-target="#formale-prüfung-shapiro-wilk-test"><span class="header-section-number">3.5.2.3.2</span> <strong>Formale Prüfung (Shapiro-Wilk-Test)</strong></a></li>
  </ul></li>
  <li><a href="#prüfung-der-varianzhomogenität-levene-test" id="toc-prüfung-der-varianzhomogenität-levene-test" class="nav-link" data-scroll-target="#prüfung-der-varianzhomogenität-levene-test"><span class="header-section-number">3.5.2.4</span> Prüfung der Varianzhomogenität (Levene-Test)</a></li>
  <li><a href="#t-test" id="toc-t-test" class="nav-link" data-scroll-target="#t-test"><span class="header-section-number">3.5.2.5</span> T-Test</a></li>
  <li><a href="#mann-whitney-u-test-wilcox" id="toc-mann-whitney-u-test-wilcox" class="nav-link" data-scroll-target="#mann-whitney-u-test-wilcox"><span class="header-section-number">3.5.2.6</span> Mann-Whitney-U-Test / Wilcox</a></li>
  <li><a href="#tables-annahme-ablehnungword" id="toc-tables-annahme-ablehnungword" class="nav-link" data-scroll-target="#tables-annahme-ablehnungword"><span class="header-section-number">3.5.2.7</span> Tables Annahme &amp; Ablehnung(Word)</a></li>
  <li><a href="#tables-varianz-word" id="toc-tables-varianz-word" class="nav-link" data-scroll-target="#tables-varianz-word"><span class="header-section-number">3.5.2.8</span> Tables Varianz (Word)</a></li>
  <li><a href="#tables-vergleichende-gruppenstatistik-word" id="toc-tables-vergleichende-gruppenstatistik-word" class="nav-link" data-scroll-target="#tables-vergleichende-gruppenstatistik-word"><span class="header-section-number">3.5.2.9</span> Tables vergleichende Gruppenstatistik (Word)</a></li>
  <li><a href="#plots---überarbeiten" id="toc-plots---überarbeiten" class="nav-link" data-scroll-target="#plots---überarbeiten"><span class="header-section-number">3.5.2.10</span> Plots - ÜBERARBEITEN</a></li>
  </ul></li>
  <li><a href="#korrelation" id="toc-korrelation" class="nav-link" data-scroll-target="#korrelation"><span class="header-section-number">3.5.3</span> Korrelation</a></li>
  </ul></li>
  <li><a href="#modelllierung" id="toc-modelllierung" class="nav-link" data-scroll-target="#modelllierung"><span class="header-section-number">3.6</span> Modelllierung</a>
  <ul>
  <li><a href="#lineare-regression" id="toc-lineare-regression" class="nav-link" data-scroll-target="#lineare-regression"><span class="header-section-number">3.6.1</span> Lineare Regression</a>
  <ul class="collapse">
  <li><a href="#modelle-erstellen" id="toc-modelle-erstellen" class="nav-link" data-scroll-target="#modelle-erstellen"><span class="header-section-number">3.6.1.1</span> Modelle erstellen</a></li>
  <li><a href="#kennzahlen-extrahieren" id="toc-kennzahlen-extrahieren" class="nav-link" data-scroll-target="#kennzahlen-extrahieren"><span class="header-section-number">3.6.1.2</span> Kennzahlen extrahieren</a></li>
  <li><a href="#visualisierung-der-modellgüte" id="toc-visualisierung-der-modellgüte" class="nav-link" data-scroll-target="#visualisierung-der-modellgüte"><span class="header-section-number">3.6.1.3</span> Visualisierung der Modellgüte</a></li>
  </ul></li>
  <li><a href="#logarithmische-regression" id="toc-logarithmische-regression" class="nav-link" data-scroll-target="#logarithmische-regression"><span class="header-section-number">3.6.2</span> Logarithmische Regression</a>
  <ul class="collapse">
  <li><a href="#daten-log-transformieren-und-bereinigen" id="toc-daten-log-transformieren-und-bereinigen" class="nav-link" data-scroll-target="#daten-log-transformieren-und-bereinigen"><span class="header-section-number">3.6.2.1</span> Daten log-transformieren und bereinigen</a></li>
  <li><a href="#multikollinearität-via-vif-erkennen-bereinigen-und-startmodelle-erstellen" id="toc-multikollinearität-via-vif-erkennen-bereinigen-und-startmodelle-erstellen" class="nav-link" data-scroll-target="#multikollinearität-via-vif-erkennen-bereinigen-und-startmodelle-erstellen"><span class="header-section-number">3.6.2.2</span> Multikollinearität via vif() erkennen, bereinigen und Startmodelle erstellen</a></li>
  <li><a href="#stepaic-für-modellauswahl" id="toc-stepaic-für-modellauswahl" class="nav-link" data-scroll-target="#stepaic-für-modellauswahl"><span class="header-section-number">3.6.2.3</span> stepAIC für Modellauswahl</a></li>
  <li><a href="#modelle-vergleichen" id="toc-modelle-vergleichen" class="nav-link" data-scroll-target="#modelle-vergleichen"><span class="header-section-number">3.6.2.4</span> Modelle vergleichen</a>
  <ul class="collapse">
  <li><a href="#gvif-werte" id="toc-gvif-werte" class="nav-link" data-scroll-target="#gvif-werte"><span class="header-section-number">3.6.2.4.1</span> GVIF-Werte</a></li>
  <li><a href="#aic-pseudo-r²-mcfadden-auc" id="toc-aic-pseudo-r²-mcfadden-auc" class="nav-link" data-scroll-target="#aic-pseudo-r²-mcfadden-auc"><span class="header-section-number">3.6.2.4.2</span> AIC, Pseudo-R² (McFadden) &amp; AUC</a></li>
  </ul></li>
  <li><a href="#odds-ratios-und-p-werte-interpretieren" id="toc-odds-ratios-und-p-werte-interpretieren" class="nav-link" data-scroll-target="#odds-ratios-und-p-werte-interpretieren"><span class="header-section-number">3.6.2.5</span> Odds-ratios und p-Werte interpretieren</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#parteilandschaft-schweiz" id="toc-parteilandschaft-schweiz" class="nav-link" data-scroll-target="#parteilandschaft-schweiz"><span class="header-section-number">3.7</span> Parteilandschaft Schweiz</a>
  <ul>
  <li><a href="#multi-dimensions-model" id="toc-multi-dimensions-model" class="nav-link" data-scroll-target="#multi-dimensions-model"><span class="header-section-number">3.7.1</span> Multi-Dimensions-Model</a>
  <ul class="collapse">
  <li><a href="#minimalwerte" id="toc-minimalwerte" class="nav-link" data-scroll-target="#minimalwerte"><span class="header-section-number">3.7.1.1</span> Minimalwerte</a></li>
  <li><a href="#durchschnittswerte-als-zentrum-und-minmax-als-ellipse" id="toc-durchschnittswerte-als-zentrum-und-minmax-als-ellipse" class="nav-link" data-scroll-target="#durchschnittswerte-als-zentrum-und-minmax-als-ellipse"><span class="header-section-number">3.7.1.2</span> Durchschnittswerte als Zentrum und Min/Max als Ellipse</a></li>
  <li><a href="#hauptparteien-durchschnittswerte-als-zentrum-und-minmax-als-ellipse-klein--und-regionalparteien-nur-mit-ihrem-durchschnittswert" id="toc-hauptparteien-durchschnittswerte-als-zentrum-und-minmax-als-ellipse-klein--und-regionalparteien-nur-mit-ihrem-durchschnittswert" class="nav-link" data-scroll-target="#hauptparteien-durchschnittswerte-als-zentrum-und-minmax-als-ellipse-klein--und-regionalparteien-nur-mit-ihrem-durchschnittswert"><span class="header-section-number">3.7.1.3</span> Hauptparteien: Durchschnittswerte als Zentrum und Min/Max als Ellipse / Klein- und Regionalparteien nur mit ihrem Durchschnittswert</a></li>
  </ul></li>
  <li><a href="#d-koordinatensystem-testweise" id="toc-d-koordinatensystem-testweise" class="nav-link" data-scroll-target="#d-koordinatensystem-testweise"><span class="header-section-number">3.7.2</span> 3D-Koordinatensystem (Testweise)</a></li>
  <li><a href="#tables-parties-rating" id="toc-tables-parties-rating" class="nav-link" data-scroll-target="#tables-parties-rating"><span class="header-section-number">3.7.3</span> Tables Parties Rating</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#backup" id="toc-backup" class="nav-link" data-scroll-target="#backup"><span class="header-section-number">4</span> BACKUP?!</a></li>
  <li><a href="#visualization" id="toc-visualization" class="nav-link" data-scroll-target="#visualization"><span class="header-section-number">5</span> Visualization</a>
  <ul>
  <li><a href="#tatsächliches-ergebnis-und-verteilung-der-parolen-ja-nein-keine" id="toc-tatsächliches-ergebnis-und-verteilung-der-parolen-ja-nein-keine" class="nav-link" data-scroll-target="#tatsächliches-ergebnis-und-verteilung-der-parolen-ja-nein-keine"><span class="header-section-number">5.0.0.1</span> Tatsächliches Ergebnis und Verteilung der Parolen (Ja-Nein-Keine)</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">cas_thesis_data_prep</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>DaaniiH </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 1, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="libraries" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Libraries</h1>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pxmake)   <span class="co"># to load PX files</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pxR)      <span class="co"># to load PX files</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite) <span class="co"># to load JSON files</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(writexl)  <span class="co"># Write Excel files</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flextable) <span class="co"># Tables for Word</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(officer)   <span class="co"># Tables for Word</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effects)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)  <span class="co"># Diagrams</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggforce)  <span class="co"># Diagrams</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot) <span class="co"># Korrelation</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggcorrplot)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pscl)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)   <span class="co"># Diagrams / Korrelation</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)   <span class="co"># Diagrams</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)       <span class="co"># datatable()</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)    <span class="co"># am Schluss laden, u.a. select() greift sonst aufs falsche</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="functions" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Functions</h1>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">### </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do">  </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Duplikate in df finden &amp; als $unique oder $duplicates selektionierbar machen</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>find_and_remove_duplicates <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique =</span> df[<span class="sc">!</span><span class="fu">duplicated</span>(df), ],</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">duplicates =</span> df[<span class="fu">duplicated</span>(df) <span class="sc">|</span> <span class="fu">duplicated</span>(df, <span class="at">fromLast =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="do">### </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do">  </span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Aktive National- &amp; Ständeräte identifizieren und selektionierbar machen</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>filter_active <span class="ot">&lt;-</span> <span class="cf">function</span>(data, von, bis) {</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  von <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(von)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  bis <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(bis)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">%&gt;%</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>      DateJoining <span class="sc">&lt;=</span> bis,                      <span class="co"># Eintritt vor/am Ende d. Zeitraums</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(DateLeaving) <span class="sc">|</span> DateLeaving <span class="sc">&gt;=</span> von  <span class="co"># Kein Austritt/nach Beginn des Z..</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="etl-extract-transform-load" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> <strong>ETL: Extract, Transform, Load</strong></h1>
<ul>
<li><p>Daten werden aus verschiedenen Excel-Dateien ausgelesen, unabhängig davon, wie komplex oder verschachtelt sie sind (z. B. mehrere Sheets, verbundene Zellen, unterteilte Datenblöcke).</p></li>
<li><p>Bei Excel-Dateien mit mehreren Sheets werden Functions angewendet.</p></li>
<li><p>Header werden identifiziert und ggf. aus mehreren Zeilen zusammengesetzt.</p></li>
<li><p>Daten werden bereinigt, normalisiert und in das gewünschte Zielformat gebracht (z. B. Wide zu Long, Entfernen von Leerzeilen, Auflösen von verbundenen Zellen, Vereinheitlichung der Spaltenstruktur).</p></li>
<li><p>Die transformierten Daten werden für die weitere Analyse und Visualisation zu Verfügung gestellt.</p></li>
</ul>
<section id="lookup-tabellen" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="lookup-tabellen"><span class="header-section-number">3.1</span> Lookup Tabellen</h2>
<section id="kantone" class="level4" data-number="3.1.0.1">
<h4 data-number="3.1.0.1" class="anchored" data-anchor-id="kantone"><span class="header-section-number">3.1.0.1</span> Kantone</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataframe bilden für Lookup der Kantonsnamen/-Kürzel</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>lookup_kantone <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Kanton =</span> <span class="fu">c</span>(<span class="st">"Aargau"</span>, <span class="st">"Appenzell A. Rh."</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Appenzell I. Rh."</span>, <span class="st">"Basel-Landschaft"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Basel-Stadt"</span>, <span class="st">"Bern"</span>, <span class="st">"Freiburg"</span>, <span class="st">"Genf"</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Glarus"</span>, <span class="st">"Graubünden"</span>, <span class="st">"Jura"</span>, <span class="st">"Luzern"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Neuenburg"</span>, <span class="st">"Nidwalden"</span>, <span class="st">"Obwalden"</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Schaffhausen"</span>, <span class="st">"Schwyz"</span>, <span class="st">"Solothurn"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"St. Gallen"</span>, <span class="st">"Tessin"</span>, <span class="st">"Thurgau"</span>, <span class="st">"Uri"</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Waadt"</span>, <span class="st">"Wallis"</span>, <span class="st">"Zug"</span>, <span class="st">"Zürich"</span>),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Kt =</span> <span class="fu">c</span>(<span class="st">"AG"</span>, <span class="st">"AR"</span>, <span class="st">"AI"</span>, <span class="st">"BL"</span>, <span class="st">"BS"</span>,<span class="st">"BE"</span>, <span class="st">"FR"</span>, <span class="st">"GE"</span>,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"GL"</span>, <span class="st">"GR"</span>, <span class="st">"JU"</span>, <span class="st">"LU"</span>, <span class="st">"NE"</span>,<span class="st">"NW"</span>, <span class="st">"OW"</span>, <span class="st">"SH"</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"SZ"</span>, <span class="st">"SO"</span>, <span class="st">"SG"</span>,<span class="st">"TI"</span>, <span class="st">"TG"</span>, <span class="st">"UR"</span>, <span class="st">"VD"</span>, <span class="st">"VS"</span>,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"ZG"</span>, <span class="st">"ZH"</span>),</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>                             <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="wahlberechtigte" class="level4" data-number="3.1.0.2">
<h4 data-number="3.1.0.2" class="anchored" data-anchor-id="wahlberechtigte"><span class="header-section-number">3.1.0.2</span> Wahlberechtigte</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Wahlberechtigte seit 1990</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>Wahlberechtigte_1990_2024 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/Wahlberechtigte_1990-2024.xlsx"</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">sheet =</span> <span class="st">"pivot_as_value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">year =</span> Jahr,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">stimmberechtigte_avg_kt =</span> Stimmberechtigte_avg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="parteien" class="level4" data-number="3.1.0.3">
<h4 data-number="3.1.0.3" class="anchored" data-anchor-id="parteien"><span class="header-section-number">3.1.0.3</span> Parteien</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Konsolidierte, bereinigte Lookup-Tabelle einlesen</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>lookup_parties_consolidated_raw <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/lookup_parties_consolidated.xlsx"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Duplikatzeilen anzeigen (für "party_orig_value")</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>duplikate <span class="ot">&lt;-</span> lookup_parties_consolidated_raw <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(party_orig_value) <span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Duplikate (von Execel nicht erkannt..) entfernen</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>lookup_parties_consolidated <span class="ot">&lt;-</span> lookup_parties_consolidated_raw <span class="sc">%&gt;%</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(party_orig_value, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="parteilandschaft---daten-laden" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="parteilandschaft---daten-laden"><span class="header-section-number">3.1.1</span> Parteilandschaft - Daten laden</h3>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>parties_rating <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/parties_economic_socio-political_rating.xlsx"</span>,</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">sheet =</span> <span class="st">"matrix_eco-socio_enhanced"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="wahlen---daten-laden-umformen" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="wahlen---daten-laden-umformen"><span class="header-section-number">3.2</span> Wahlen - Daten laden &amp; Umformen</h2>
<section id="bundesebene" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="bundesebene"><span class="header-section-number">3.2.1</span> Bundesebene</h3>
<section id="nationalrat" class="level4" data-number="3.2.1.1">
<h4 data-number="3.2.1.1" class="anchored" data-anchor-id="nationalrat"><span class="header-section-number">3.2.1.1</span> Nationalrat</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Header laden</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>header <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">read_excel</span>(<span class="st">"data/je-d-17.02.02.02.01.01_BUND_NATIONALRAT.xlsx"</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">skip =</span> <span class="dv">0</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">n_max =</span> <span class="dv">1</span>)[<span class="dv">1</span>, ])</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Spaltennamen "Partei 1" zu "Partei" umbenennen</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>header[header <span class="sc">==</span> <span class="st">"Partei 1"</span>] <span class="ot">&lt;-</span> <span class="st">"Partei"</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Daten ab Zeile 4 (+25) mit diesem Header einlesen</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>elec_nationalrat <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/je-d-17.02.02.02.01.01_BUND_NATIONALRAT.xlsx"</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>                               <span class="at">skip =</span> <span class="dv">3</span>,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>                               <span class="at">n_max =</span> <span class="dv">25</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>                               <span class="at">col_names =</span> header)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Refernzen zu Fussnoten aus Parteispalte löschen</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>elec_nationalrat<span class="sc">$</span>Partei <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s*</span><span class="sc">\\</span><span class="st">d+$"</span>,</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>                               <span class="st">""</span>,</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>                               elec_nationalrat<span class="sc">$</span>Partei)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="ständerat" class="level4" data-number="3.2.1.2">
<h4 data-number="3.2.1.2" class="anchored" data-anchor-id="ständerat"><span class="header-section-number">3.2.1.2</span> Ständerat</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Header laden</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>header <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">read_excel</span>(<span class="st">"data/je-d-17.02.03.01_BUND_STÄNDERAT.xlsx"</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">skip =</span> <span class="dv">0</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">n_max =</span> <span class="dv">1</span>)[<span class="dv">1</span>, ])</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Daten ab Zeile 5 (+14) mit diesem Header einlesen</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>elec_ständerat <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/je-d-17.02.03.01_BUND_STÄNDERAT.xlsx"</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                              <span class="at">skip =</span> <span class="dv">4</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">n_max =</span> <span class="dv">14</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>                              <span class="at">col_names =</span> header)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Refernzen zu Fussnoten aus Parteispalte löschen</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>elec_ständerat<span class="sc">$</span>Partei <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s*</span><span class="sc">\\</span><span class="st">d+$"</span>,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">""</span>,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>                                   elec_ständerat<span class="sc">$</span>Partei)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="national--ständerat-kombinieren" class="level4" data-number="3.2.1.3">
<h4 data-number="3.2.1.3" class="anchored" data-anchor-id="national--ständerat-kombinieren"><span class="header-section-number">3.2.1.3</span> National- &amp; Ständerat kombinieren</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Spaltenüberschriften anschauen (unique) &amp; Fussnoten entfernen</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">make.unique</span>(<span class="fu">colnames</span>(elec_nationalrat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Partei" "1919"   "1922"   "1925"   "1928"   "1931"   "1935"   "1939 2"
 [9] "1943"   "1947"   "1951"   "1955"   "1959"   "1963"   "1967"   "1971"  
[17] "1975"   "1979"   "1983"   "1987"   "1991"   "1995"   "1999"   "2003"  
[25] "2007"   "2011"   "2015"   "2019"   "2023"  </code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(elec_nationalrat) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">" </span><span class="sc">\\</span><span class="st">d+$"</span>,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">""</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">colnames</span>(elec_nationalrat))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">make.unique</span>(<span class="fu">colnames</span>(elec_nationalrat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Partei" "1919"   "1922"   "1925"   "1928"   "1931"   "1935"   "1939"  
 [9] "1943"   "1947"   "1951"   "1955"   "1959"   "1963"   "1967"   "1971"  
[17] "1975"   "1979"   "1983"   "1987"   "1991"   "1995"   "1999"   "2003"  
[25] "2007"   "2011"   "2015"   "2019"   "2023"  </code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make.unique</span>(<span class="fu">colnames</span>(elec_ständerat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Partei" "1919"   "1922"   "1925"   "1928"   "1931"   "1935"   "1939"  
 [9] "1943"   "1947"   "1951"   "1955"   "1959"   "1963"   "1967"   "1971"  
[17] "1975"   "1979 1" "1983"   "1987"   "1991"   "1995"   "1999"   "2003"  
[25] "2007"   "2011"   "2015"   "2019"   "2023"  </code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(elec_ständerat) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">" </span><span class="sc">\\</span><span class="st">d+$"</span>,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">""</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">colnames</span>(elec_ständerat))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">make.unique</span>(<span class="fu">colnames</span>(elec_ständerat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Partei" "1919"   "1922"   "1925"   "1928"   "1931"   "1935"   "1939"  
 [9] "1943"   "1947"   "1951"   "1955"   "1959"   "1963"   "1967"   "1971"  
[17] "1975"   "1979"   "1983"   "1987"   "1991"   "1995"   "1999"   "2003"  
[25] "2007"   "2011"   "2015"   "2019"   "2023"  </code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># df zusammenführen (Wide Format)</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>elec_nr_sr_combined_wide <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  elec_nationalrat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">role =</span> <span class="st">"Nationalrat"</span>),</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  elec_ständerat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">role =</span> <span class="st">"Ständerat"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(role, <span class="fu">everything</span>())</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># df ins Long Format umwandeln</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>elec_nr_sr_combined_long <span class="ot">&lt;-</span> elec_nr_sr_combined_wide <span class="sc">%&gt;%</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">matches</span>(<span class="st">"^</span><span class="sc">\\</span><span class="st">d{4}$"</span>),            <span class="co"># Spalten mit 4 Ziffern</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"election_year"</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"n_seats"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">election_year =</span> <span class="fu">as.integer</span>(election_year),   <span class="co"># Jahr als Zahl</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_seats =</span> <span class="fu">as.numeric</span>(n_seats))               <span class="co"># Sitze als Zahl oder NA</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>current_year <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">"%Y"</span>))  <span class="co"># aktuelles Jahr</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Zeitreihe für jede Partei/role vervollständigen und Werte fortschreiben</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>elec_nr_sr_combined <span class="ot">&lt;-</span> elec_nr_sr_combined_long <span class="sc">%&gt;%</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">party_orig_value =</span> Partei) <span class="sc">%&gt;%</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(role, party_orig_value) <span class="sc">%&gt;%</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">election_year =</span> <span class="fu">as.integer</span>(election_year),   <span class="co"># temporär numerisch</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">year =</span> election_year) <span class="sc">%&gt;%</span> </span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">year =</span> <span class="fu">seq</span>(<span class="fu">min</span>(election_year,              <span class="co"># von min() </span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>                          <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>                      current_year,<span class="dv">1</span>),                <span class="co"># bis aktuelles Jahr</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">n_seats =</span> <span class="cn">NA</span>,</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>                       <span class="at">election_year =</span> <span class="cn">NA</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(role,</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>          party_orig_value,</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>          year) <span class="sc">%&gt;%</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">block =</span> <span class="fu">cumsum</span>(<span class="sc">!</span><span class="fu">is.na</span>(election_year))) <span class="sc">%&gt;%</span> </span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Wahljahr als Block. fill() innerhalb Block, nicht über Wahlperioden hinweg.</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(role,</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>           party_orig_value,</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>           block) <span class="sc">%&gt;%</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(election_year,</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>       n_seats,</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>       <span class="at">.direction =</span> <span class="st">"down"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">election_year =</span> <span class="fu">as.character</span>(election_year),      <span class="co"># zurück als character</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">as.character</span>(year)) <span class="sc">%&gt;%</span>                    <span class="co"># dito</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>block)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="ergebnis-national-ständeratssitze" class="level4" data-number="3.2.1.4">
<h4 data-number="3.2.1.4" class="anchored" data-anchor-id="ergebnis-national-ständeratssitze"><span class="header-section-number">3.2.1.4</span> Ergebnis National &amp; Ständeratssitze</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ratssitze pro Jahr</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>elec_nr_sr_combined_sum_check <span class="ot">&lt;-</span> elec_nr_sr_combined <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, role) <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_n_seats =</span> <span class="fu">sum</span>(n_seats,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                                <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n=</span><span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 214 × 3
    year  role        total_n_seats
    &lt;chr&gt; &lt;chr&gt;               &lt;dbl&gt;
  1 1919  Nationalrat           189
  2 1919  Ständerat              44
  3 1920  Nationalrat           189
  4 1920  Ständerat              44
  5 1921  Nationalrat           189
  6 1921  Ständerat              44
  7 1922  Nationalrat           198
  8 1922  Ständerat              44
  9 1923  Nationalrat           198
 10 1923  Ständerat              44
 11 1924  Nationalrat           198
 12 1924  Ständerat              44
 13 1925  Nationalrat           198
 14 1925  Ständerat              44
 15 1926  Nationalrat           198
 16 1926  Ständerat              44
 17 1927  Nationalrat           198
 18 1927  Ständerat              44
 19 1928  Nationalrat           198
 20 1928  Ständerat              44
 21 1929  Nationalrat           198
 22 1929  Ständerat              44
 23 1930  Nationalrat           198
 24 1930  Ständerat              44
 25 1931  Nationalrat           187
 26 1931  Ständerat              44
 27 1932  Nationalrat           187
 28 1932  Ständerat              44
 29 1933  Nationalrat           187
 30 1933  Ständerat              44
 31 1934  Nationalrat           187
 32 1934  Ständerat              44
 33 1935  Nationalrat           187
 34 1935  Ständerat              44
 35 1936  Nationalrat           187
 36 1936  Ständerat              44
 37 1937  Nationalrat           187
 38 1937  Ständerat              44
 39 1938  Nationalrat           187
 40 1938  Ständerat              44
 41 1939  Nationalrat           187
 42 1939  Ständerat              44
 43 1940  Nationalrat           187
 44 1940  Ständerat              44
 45 1941  Nationalrat           187
 46 1941  Ständerat              44
 47 1942  Nationalrat           187
 48 1942  Ständerat              44
 49 1943  Nationalrat           194
 50 1943  Ständerat              44
 51 1944  Nationalrat           194
 52 1944  Ständerat              44
 53 1945  Nationalrat           194
 54 1945  Ständerat              44
 55 1946  Nationalrat           194
 56 1946  Ständerat              44
 57 1947  Nationalrat           194
 58 1947  Ständerat              44
 59 1948  Nationalrat           194
 60 1948  Ständerat              44
 61 1949  Nationalrat           194
 62 1949  Ständerat              44
 63 1950  Nationalrat           194
 64 1950  Ständerat              44
 65 1951  Nationalrat           196
 66 1951  Ständerat              44
 67 1952  Nationalrat           196
 68 1952  Ständerat              44
 69 1953  Nationalrat           196
 70 1953  Ständerat              44
 71 1954  Nationalrat           196
 72 1954  Ständerat              44
 73 1955  Nationalrat           196
 74 1955  Ständerat              44
 75 1956  Nationalrat           196
 76 1956  Ständerat              44
 77 1957  Nationalrat           196
 78 1957  Ständerat              44
 79 1958  Nationalrat           196
 80 1958  Ständerat              44
 81 1959  Nationalrat           196
 82 1959  Ständerat              44
 83 1960  Nationalrat           196
 84 1960  Ständerat              44
 85 1961  Nationalrat           196
 86 1961  Ständerat              44
 87 1962  Nationalrat           196
 88 1962  Ständerat              44
 89 1963  Nationalrat           200
 90 1963  Ständerat              44
 91 1964  Nationalrat           200
 92 1964  Ständerat              44
 93 1965  Nationalrat           200
 94 1965  Ständerat              44
 95 1966  Nationalrat           200
 96 1966  Ständerat              44
 97 1967  Nationalrat           200
 98 1967  Ständerat              44
 99 1968  Nationalrat           200
100 1968  Ständerat              44
101 1969  Nationalrat           200
102 1969  Ständerat              44
103 1970  Nationalrat           200
104 1970  Ständerat              44
105 1971  Nationalrat           200
106 1971  Ständerat              44
107 1972  Nationalrat           200
108 1972  Ständerat              44
109 1973  Nationalrat           200
110 1973  Ständerat              44
111 1974  Nationalrat           200
112 1974  Ständerat              44
113 1975  Nationalrat           200
114 1975  Ständerat              44
115 1976  Nationalrat           200
116 1976  Ständerat              44
117 1977  Nationalrat           200
118 1977  Ständerat              44
119 1978  Nationalrat           200
120 1978  Ständerat              44
121 1979  Nationalrat           200
122 1979  Ständerat              46
123 1980  Nationalrat           200
124 1980  Ständerat              46
125 1981  Nationalrat           200
126 1981  Ständerat              46
127 1982  Nationalrat           200
128 1982  Ständerat              46
129 1983  Nationalrat           200
130 1983  Ständerat              46
131 1984  Nationalrat           200
132 1984  Ständerat              46
133 1985  Nationalrat           200
134 1985  Ständerat              46
135 1986  Nationalrat           200
136 1986  Ständerat              46
137 1987  Nationalrat           200
138 1987  Ständerat              46
139 1988  Nationalrat           200
140 1988  Ständerat              46
141 1989  Nationalrat           200
142 1989  Ständerat              46
143 1990  Nationalrat           200
144 1990  Ständerat              46
145 1991  Nationalrat           200
146 1991  Ständerat              46
147 1992  Nationalrat           200
148 1992  Ständerat              46
149 1993  Nationalrat           200
150 1993  Ständerat              46
151 1994  Nationalrat           200
152 1994  Ständerat              46
153 1995  Nationalrat           200
154 1995  Ständerat              46
155 1996  Nationalrat           200
156 1996  Ständerat              46
157 1997  Nationalrat           200
158 1997  Ständerat              46
159 1998  Nationalrat           200
160 1998  Ständerat              46
161 1999  Nationalrat           200
162 1999  Ständerat              46
163 2000  Nationalrat           200
164 2000  Ständerat              46
165 2001  Nationalrat           200
166 2001  Ständerat              46
167 2002  Nationalrat           200
168 2002  Ständerat              46
169 2003  Nationalrat           200
170 2003  Ständerat              46
171 2004  Nationalrat           200
172 2004  Ständerat              46
173 2005  Nationalrat           200
174 2005  Ständerat              46
175 2006  Nationalrat           200
176 2006  Ständerat              46
177 2007  Nationalrat           200
178 2007  Ständerat              46
179 2008  Nationalrat           200
180 2008  Ständerat              46
181 2009  Nationalrat           200
182 2009  Ständerat              46
183 2010  Nationalrat           200
184 2010  Ständerat              46
185 2011  Nationalrat           200
186 2011  Ständerat              46
187 2012  Nationalrat           200
188 2012  Ständerat              46
189 2013  Nationalrat           200
190 2013  Ständerat              46
191 2014  Nationalrat           200
192 2014  Ständerat              46
193 2015  Nationalrat           200
194 2015  Ständerat              46
195 2016  Nationalrat           200
196 2016  Ständerat              46
197 2017  Nationalrat           200
198 2017  Ständerat              46
199 2018  Nationalrat           200
200 2018  Ständerat              46
201 2019  Nationalrat           200
202 2019  Ständerat              46
203 2020  Nationalrat           200
204 2020  Ständerat              46
205 2021  Nationalrat           200
206 2021  Ständerat              46
207 2022  Nationalrat           200
208 2022  Ständerat              46
209 2023  Nationalrat           200
210 2023  Ständerat              46
211 2024  Nationalrat           200
212 2024  Ständerat              46
213 2025  Nationalrat           200
214 2025  Ständerat              46</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># National- und Ständratssitze pro Partei und Jahr</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>elec_nr_sr_combined</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,173 × 5
   role        party_orig_value year  election_year n_seats
   &lt;chr&gt;       &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt;           &lt;dbl&gt;
 1 Nationalrat BDP              1919  1919               NA
 2 Nationalrat BDP              1920  1919               NA
 3 Nationalrat BDP              1921  1919               NA
 4 Nationalrat BDP              1922  1922               NA
 5 Nationalrat BDP              1923  1922               NA
 6 Nationalrat BDP              1924  1922               NA
 7 Nationalrat BDP              1925  1925               NA
 8 Nationalrat BDP              1926  1925               NA
 9 Nationalrat BDP              1927  1925               NA
10 Nationalrat BDP              1928  1928               NA
# ℹ 4,163 more rows</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO: Clean-up evt. einmal nach ganzem load.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean-up: Nicht mehr benötigte "election" Tabellen löschen</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"^elec_"</span>)[       <span class="co"># Objekte die mit elec_ starten aber nicht</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>   <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"(_combined|_combined_sum_check)$"</span>, <span class="co"># auf all_combined oder all_final enden</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"^elec_"</span>))])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="parteinamen-bund-für-lookup-tabelle" class="level4" data-number="3.2.1.5">
<h4 data-number="3.2.1.5" class="anchored" data-anchor-id="parteinamen-bund-für-lookup-tabelle"><span class="header-section-number">3.2.1.5</span> Parteinamen Bund (für Lookup-Tabelle)</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(elec_nr_sr_combined<span class="sc">$</span>party_orig_value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "BDP"       "CSP"       "CVP"       "Dem."      "Die Mitte" "EDU"      
 [7] "EVP"       "FDP"       "FGA"       "FPS"       "GLP"       "GRÜNE"    
[13] "LPS"       "LdU"       "Lega"      "MCR"       "POCH"      "PSA"      
[19] "PdA"       "Rep."      "SD"        "SP"        "SVP"       "Sol."     
[25] "Übrige"    "MCG (MCR)"</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parteien zwecks Lookup/Vereinheitlichung mit bereinigten Namen in df schreiben</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>lookup_input_nr_sr_parties_label  <span class="ot">&lt;-</span> elec_nr_sr_combined <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(party_orig_value) <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">party_orig_value =</span> <span class="fu">toupper</span>(party_orig_value),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">short_name =</span> party_orig_value,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">short_name =</span> <span class="fu">if_else</span>(short_name <span class="sc">==</span> <span class="st">"DIE MITTE"</span>,      <span class="co"># Umbenennen</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"MITTE"</span>,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>                              short_name),</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">short_name =</span> <span class="fu">if_else</span>(short_name <span class="sc">==</span> <span class="st">"MCG (MCR)"</span>,      <span class="co"># Umbenennen</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"MCG"</span>,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>                              short_name),</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">short_name =</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">""</span>, short_name),            <span class="co"># . entfernen</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">long_name =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">prefix =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">add_info =</span> <span class="cn">NA</span>,</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">level =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">source =</span> <span class="st">"National_und_Ständerat"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(party_orig_value,</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>         short_name,</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>         long_name,</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>         prefix,</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>         add_info,</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>         level,</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>         source) <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n=</span><span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 26 × 7
   party_orig_value short_name long_name prefix add_info level source           
   &lt;chr&gt;            &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;  &lt;lgl&gt;    &lt;chr&gt; &lt;chr&gt;            
 1 BDP              BDP        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
 2 CSP              CSP        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
 3 CVP              CVP        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
 4 DEM.             DEM        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
 5 DIE MITTE        MITTE      &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
 6 EDU              EDU        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
 7 EVP              EVP        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
 8 FDP              FDP        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
 9 FGA              FGA        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
10 FPS              FPS        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
11 GLP              GLP        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
12 GRÜNE            GRÜNE      &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
13 LPS              LPS        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
14 LDU              LDU        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
15 LEGA             LEGA       &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
16 MCR              MCR        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
17 POCH             POCH       &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
18 PSA              PSA        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
19 PDA              PDA        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
20 REP.             REP        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
21 SD               SD         &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
22 SP               SP         &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
23 SVP              SVP        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
24 SOL.             SOL        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
25 ÜBRIGE           ÜBRIGE     &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
26 MCG (MCR)        MCG        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Output prüfen (unique/distinct)</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>lookup_input_nr_sr_parties_label <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 26 × 7
   party_orig_value short_name long_name prefix add_info level source           
   &lt;chr&gt;            &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;  &lt;lgl&gt;    &lt;chr&gt; &lt;chr&gt;            
 1 BDP              BDP        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
 2 CSP              CSP        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
 3 CVP              CVP        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
 4 DEM.             DEM        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
 5 DIE MITTE        MITTE      &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
 6 EDU              EDU        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
 7 EVP              EVP        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
 8 FDP              FDP        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
 9 FGA              FGA        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
10 FPS              FPS        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
11 GLP              GLP        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
12 GRÜNE            GRÜNE      &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
13 LPS              LPS        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
14 LDU              LDU        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
15 LEGA             LEGA       &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
16 MCR              MCR        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
17 POCH             POCH       &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
18 PSA              PSA        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
19 PDA              PDA        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
20 REP.             REP        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
21 SD               SD         &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
22 SP               SP         &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
23 SVP              SVP        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
24 SOL.             SOL        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
25 ÜBRIGE           ÜBRIGE     &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…
26 MCG (MCR)        MCG        &lt;NA&gt;      &lt;NA&gt;   NA       &lt;NA&gt;  National_und_Stä…</code></pre>
</div>
</div>
</section>
</section>
<section id="kantonsebene---kantonale-regierung-exekutive" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="kantonsebene---kantonale-regierung-exekutive"><span class="header-section-number">3.2.2</span> Kantonsebene - Kantonale Regierung (Exekutive)</h3>
<p>Die Kantonalen Abstimmungen finden nicht in allen kantonen gleichzeitg statt. Deshalb genauer die Räte/Konstellation zum Zeitpunkt der jeweiligen Abstimmung zu prüfen.</p>
<p>Die Struktur der “schön formatierten” Exceldatei lässt keinen “simplen” Import zu.</p>
<ul>
<li><p>1 Excelsheet / Jahr</p></li>
<li><p>Header ist in Zeile 2 und nicht vollständig</p></li>
<li><p>Daten (für Kantone) starten in Zeile 4 aber enden auf Zeile 29 bevor es mit Kommentaren und Fussnoten weitergeht.</p></li>
</ul>
<section id="dateipfad-und-gewünschte-sheets-definieren" class="level4" data-number="3.2.2.1">
<h4 data-number="3.2.2.1" class="anchored" data-anchor-id="dateipfad-und-gewünschte-sheets-definieren"><span class="header-section-number">3.2.2.1</span> Dateipfad und gewünschte Sheets definieren</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>dateipfad <span class="ot">&lt;-</span> <span class="st">"data/je-d-17.02.06.01_KANTON_Kantonale_Regierungswahlen.xlsx"</span>  </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="do">##DATUMSFILTER##</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>selected_sheets <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"2025"</span>,<span class="st">"2024"</span>, <span class="st">"2023"</span>, <span class="st">"2022"</span>,<span class="st">"2021"</span>,<span class="st">"2020"</span>,<span class="st">"2019"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="function-laden" class="level4" data-number="3.2.2.2">
<h4 data-number="3.2.2.2" class="anchored" data-anchor-id="function-laden"><span class="header-section-number">3.2.2.2</span> Function laden</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>import_election_data <span class="ot">&lt;-</span> <span class="cf">function</span>(dateipfad, sheetname) {</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Headerzeilen einlesen  </span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  header <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(dateipfad,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">sheet =</span> sheetname,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">skip =</span> <span class="dv">1</span>,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>                               <span class="at">n_max =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>()</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Header anpassen: Wahljahr vereinheitlichen und Kanton hinzufügen</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  header[<span class="fu">grepl</span>(<span class="st">"^Wahljahr"</span>, header)] <span class="ot">&lt;-</span> <span class="st">"Wahljahr"</span> </span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  header <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Kanton"</span>, header)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Daten ab Zeile 4 importieren</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  daten_raw <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(dateipfad,</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sheet =</span> sheetname,</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>                          <span class="at">skip =</span> <span class="dv">3</span>,</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>                          <span class="at">col_names =</span> header)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Zeilen ohne "Wahljahr" ausschliessen</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>  wahljahr_col <span class="ot">&lt;-</span> <span class="fu">names</span>(daten_raw)[<span class="fu">grepl</span>(<span class="st">"^Wahljahr"</span>,</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">names</span>(daten_raw))][<span class="dv">1</span>]</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(daten_raw)[<span class="fu">names</span>(daten_raw) <span class="sc">==</span> wahljahr_col] <span class="ot">&lt;-</span> <span class="st">"Wahljahr"</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>  daten_wide <span class="ot">&lt;-</span> daten_raw <span class="sc">%&gt;%</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">suppressWarnings</span>(<span class="fu">as.numeric</span>(.data[[wahljahr_col]]))))</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Zu pivotierenden Spalten in numeric umwandeln</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>  cols_pivot <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(daten_wide),</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">c</span>(<span class="st">"Kanton"</span>, wahljahr_col))</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>  daten_wide <span class="ot">&lt;-</span> daten_wide <span class="sc">%&gt;%</span></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(cols_pivot),</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>                  as.numeric))</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pivotieren</span></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>  daten_long <span class="ot">&lt;-</span> daten_wide <span class="sc">%&gt;%</span></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">cols =</span> <span class="fu">all_of</span>(cols_pivot),</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_to =</span> <span class="st">"Partei"</span>,</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">values_to =</span> <span class="st">"Wert"</span>)</span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(daten_long)</span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="function-ausführen-konsolidation-aus-datenliste" class="level4" data-number="3.2.2.3">
<h4 data-number="3.2.2.3" class="anchored" data-anchor-id="function-ausführen-konsolidation-aus-datenliste"><span class="header-section-number">3.2.2.3</span> Function ausführen &amp; Konsolidation aus Datenliste</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Objekt erstellen, mit Sheets als tibble/dataframe</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>daten_liste <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">lapply</span>(selected_sheets,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                               <span class="cf">function</span>(sheet) <span class="fu">import_election_data</span> (dateipfad,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                                                                     sheet)),</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>                        selected_sheets)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(daten_liste)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>List of 7
 $ 2025: tibble [494 × 4] (S3: tbl_df/tbl/data.frame)
  ..$ Kanton  : chr [1:494] "Zürich" "Zürich" "Zürich" "Zürich" ...
  ..$ Wahljahr: num [1:494] 2023 2023 2023 2023 2023 ...
  ..$ Partei  : chr [1:494] "FDP 2" "SP" "SVP" "LP 2" ...
  ..$ Wert    : num [1:494] 1 1 2 NA 0 NA 0 1 NA NA ...
 $ 2024: tibble [494 × 4] (S3: tbl_df/tbl/data.frame)
  ..$ Kanton  : chr [1:494] "Zürich" "Zürich" "Zürich" "Zürich" ...
  ..$ Wahljahr: num [1:494] 2023 2023 2023 2023 2023 ...
  ..$ Partei  : chr [1:494] "FDP 2" "SP" "SVP" "LP 2" ...
  ..$ Wert    : num [1:494] 1 1 2 NA 0 NA 0 1 NA NA ...
 $ 2023: tibble [494 × 4] (S3: tbl_df/tbl/data.frame)
  ..$ Kanton  : chr [1:494] "Zürich" "Zürich" "Zürich" "Zürich" ...
  ..$ Wahljahr: num [1:494] 2023 2023 2023 2023 2023 ...
  ..$ Partei  : chr [1:494] "FDP 2)" "SP" "SVP" "LP 2)" ...
  ..$ Wert    : num [1:494] 1 1 2 NA 0 NA 0 1 NA NA ...
 $ 2022: tibble [494 × 4] (S3: tbl_df/tbl/data.frame)
  ..$ Kanton  : chr [1:494] "Zürich" "Zürich" "Zürich" "Zürich" ...
  ..$ Wahljahr: num [1:494] 2019 2019 2019 2019 2019 ...
  ..$ Partei  : chr [1:494] "FDP 2)" "SP" "SVP" "LP 2)" ...
  ..$ Wert    : num [1:494] 1 1 2 NA 0 NA NA NA 1 0 ...
 $ 2021: tibble [494 × 4] (S3: tbl_df/tbl/data.frame)
  ..$ Kanton  : chr [1:494] "Zürich" "Zürich" "Zürich" "Zürich" ...
  ..$ Wahljahr: num [1:494] 2019 2019 2019 2019 2019 ...
  ..$ Partei  : chr [1:494] "FDP 2)" "SP" "SVP" "LP 2)" ...
  ..$ Wert    : num [1:494] 1 1 2 NA 0 NA NA NA 1 0 ...
 $ 2020: tibble [780 × 4] (S3: tbl_df/tbl/data.frame)
  ..$ Kanton  : chr [1:780] "Zürich" "Zürich" "Zürich" "Zürich" ...
  ..$ Wahljahr: num [1:780] 2019 2019 2019 2019 2019 ...
  ..$ Partei  : chr [1:780] "FDP 2)" "CVP 3)" "SP" "SVP" ...
  ..$ Wert    : num [1:780] 1 1 1 2 NA NA NA 0 NA NA ...
 $ 2019: tibble [780 × 4] (S3: tbl_df/tbl/data.frame)
  ..$ Kanton  : chr [1:780] "Zürich" "Zürich" "Zürich" "Zürich" ...
  ..$ Wahljahr: num [1:780] 2019 2019 2019 2019 2019 ...
  ..$ Partei  : chr [1:780] "FDP 2)" "CVP 3)" "SP" "SVP" ...
  ..$ Wert    : num [1:780] 1 1 2 2 NA NA NA 0 NA NA ...</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Alle tibbles zu einem Dataframe zusammenfügen</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>elec_canton_combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(daten_liste,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">.id =</span> <span class="st">"year"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">election_year =</span> Wahljahr,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">party_orig_value =</span> Partei,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_seats =</span> Wert) <span class="sc">%&gt;%</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">role =</span> <span class="st">"Kantonsregierung"</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">election_year =</span> <span class="fu">as.character</span>(election_year)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(party_orig_value <span class="sc">!=</span> <span class="st">"Total"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lookup_kantone, <span class="at">by =</span> <span class="st">"Kanton"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(role,</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>         party_orig_value,</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>         year,</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>         election_year,</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>         n_seats,</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>         Kt,</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>         Kanton,</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>         <span class="fu">everything</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="ergebnis-kantonsregierung" class="level4" data-number="3.2.2.4">
<h4 data-number="3.2.2.4" class="anchored" data-anchor-id="ergebnis-kantonsregierung"><span class="header-section-number">3.2.2.4</span> Ergebnis Kantonsregierung</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ratssitze pro Jahr (nach-)prüfen</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>elec_canton_combined_sum_check <span class="ot">&lt;-</span> elec_canton_combined <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, role) <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_n_seats =</span> <span class="fu">sum</span>(n_seats,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                                <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n=</span><span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 3
  year  role             total_n_seats
  &lt;chr&gt; &lt;chr&gt;                    &lt;dbl&gt;
1 2019  Kantonsregierung           154
2 2020  Kantonsregierung           154
3 2021  Kantonsregierung           154
4 2022  Kantonsregierung           154
5 2023  Kantonsregierung           154
6 2024  Kantonsregierung           154
7 2025  Kantonsregierung           154</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># National- und Ständratssitze pro Partei und Jahr</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>elec_canton_combined</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,848 × 7
   role             party_orig_value year  election_year n_seats Kt    Kanton
   &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
 1 Kantonsregierung FDP 2            2025  2023                1 ZH    Zürich
 2 Kantonsregierung SP               2025  2023                1 ZH    Zürich
 3 Kantonsregierung SVP              2025  2023                2 ZH    Zürich
 4 Kantonsregierung LP 2             2025  2023               NA ZH    Zürich
 5 Kantonsregierung EVP              2025  2023                0 ZH    Zürich
 6 Kantonsregierung CSP              2025  2023               NA ZH    Zürich
 7 Kantonsregierung GLP              2025  2023                0 ZH    Zürich
 8 Kantonsregierung Die Mitte 3      2025  2023                1 ZH    Zürich
 9 Kantonsregierung CVP 3            2025  2023               NA ZH    Zürich
10 Kantonsregierung BDP 3            2025  2023               NA ZH    Zürich
# ℹ 3,838 more rows</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO: Clean-up evt. einmal nach ganzem load.</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean-up: Nicht mehr benötigte "election" Tabellen löschen</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"^elec_"</span>)[       <span class="co"># Objekte die mit elec_ starten aber nicht</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>   <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"(_combined|_combined_sum_check)$"</span>, <span class="co"># auf all_combined oder all_final enden</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"^elec_"</span>))])</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co"># datatable(elec_kantonale_regierung_combined,</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co">#           class = 'nowrap',</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co">#           filter = 'top',</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="co">#           options = list(pageLength = 7,</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="co">#                          scrollX = TRUE,</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co">#                          search = list(regex = TRUE,</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        caseInsensitive = TRUE)))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="parteinamen-kanton-für-lookup-tabelle" class="level4" data-number="3.2.2.5">
<h4 data-number="3.2.2.5" class="anchored" data-anchor-id="parteinamen-kanton-für-lookup-tabelle"><span class="header-section-number">3.2.2.5</span> Parteinamen Kanton (für Lookup-Tabelle)</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: output_canton_parties</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Parteinamenvarianten</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(elec_canton_combined<span class="sc">$</span>party_orig_value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "FDP 2"        "SP"           "SVP"          "LP 2"         "EVP"         
 [6] "CSP"          "GLP"          "Die Mitte 3"  "CVP 3"        "BDP 3"       
[11] "PdA"          "PSA"          "Grüne 5"      "FGA"          "Sol."        
[16] "Lega"         "MCG (MCR)"    "Übrige 4"     "FDP 2)"       "LP 2)"       
[21] "Die Mitte 3)" "CVP 3)"       "BDP 5)"       "Grüne 6)"     "MCR"         
[26] "Übrige 4)"    "GPS"          "Dem."         "LdU"          "DSP"         
[31] "BDP"          "POCH"         "SD"           "Rep."         "EDU"         
[36] "FPS"          "LS"           "JB"           "Front"        "Grüt"        
[41] "GP"          </code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parteien zwecks Lookup/Vereinheitlichung mit bereinigten Namen in df schreiben</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>lookup_input_canton_parties_label <span class="ot">&lt;-</span> elec_canton_combined <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">level =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">long_name =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">source =</span> <span class="st">"Kantonale_Regierung"</span>,</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">add_info =</span> <span class="fu">str_extract</span>(party_orig_value,</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"</span><span class="sc">\\</span><span class="st">d+(?=</span><span class="sc">\\</span><span class="st">)?$)"</span>),  <span class="co"># Zahl am Ende/vor Klammer-Ende</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">short_name =</span> <span class="fu">str_remove</span>(party_orig_value,</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"</span><span class="sc">\\</span><span class="st">s*</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">)?$"</span>), <span class="co"># - Leerzeichen/Zahl/Klammer</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">prefix =</span> <span class="cn">NA_character_</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(party_orig_value,</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>         short_name,</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>         long_name,</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>         prefix,</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>         add_info,</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>         level,</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>         source) <span class="sc">%&gt;%</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Großschreibung der short_name-Spalte</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">short_name =</span> <span class="fu">toupper</span>(short_name)) </span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Output prüfen (unique/distinct)</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>lookup_input_canton_parties_label <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 41 × 7
   party_orig_value short_name long_name prefix add_info level source           
   &lt;chr&gt;            &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;            
 1 FDP 2            FDP        &lt;NA&gt;      &lt;NA&gt;   2        &lt;NA&gt;  Kantonale_Regier…
 2 SP               SP         &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
 3 SVP              SVP        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
 4 LP 2             LP         &lt;NA&gt;      &lt;NA&gt;   2        &lt;NA&gt;  Kantonale_Regier…
 5 EVP              EVP        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
 6 CSP              CSP        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
 7 GLP              GLP        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
 8 Die Mitte 3      DIE MITTE  &lt;NA&gt;      &lt;NA&gt;   3        &lt;NA&gt;  Kantonale_Regier…
 9 CVP 3            CVP        &lt;NA&gt;      &lt;NA&gt;   3        &lt;NA&gt;  Kantonale_Regier…
10 BDP 3            BDP        &lt;NA&gt;      &lt;NA&gt;   3        &lt;NA&gt;  Kantonale_Regier…
11 PdA              PDA        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
12 PSA              PSA        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
13 Grüne 5          GRÜNE      &lt;NA&gt;      &lt;NA&gt;   5        &lt;NA&gt;  Kantonale_Regier…
14 FGA              FGA        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
15 Sol.             SOL.       &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
16 Lega             LEGA       &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
17 MCG (MCR)        MCG (MCR)  &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
18 Übrige 4         ÜBRIGE     &lt;NA&gt;      &lt;NA&gt;   4        &lt;NA&gt;  Kantonale_Regier…
19 FDP 2)           FDP        &lt;NA&gt;      &lt;NA&gt;   2        &lt;NA&gt;  Kantonale_Regier…
20 LP 2)            LP         &lt;NA&gt;      &lt;NA&gt;   2        &lt;NA&gt;  Kantonale_Regier…
21 Die Mitte 3)     DIE MITTE  &lt;NA&gt;      &lt;NA&gt;   3        &lt;NA&gt;  Kantonale_Regier…
22 CVP 3)           CVP        &lt;NA&gt;      &lt;NA&gt;   3        &lt;NA&gt;  Kantonale_Regier…
23 BDP 5)           BDP        &lt;NA&gt;      &lt;NA&gt;   5        &lt;NA&gt;  Kantonale_Regier…
24 Grüne 6)         GRÜNE      &lt;NA&gt;      &lt;NA&gt;   6        &lt;NA&gt;  Kantonale_Regier…
25 MCR              MCR        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
26 Übrige 4)        ÜBRIGE     &lt;NA&gt;      &lt;NA&gt;   4        &lt;NA&gt;  Kantonale_Regier…
27 GPS              GPS        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
28 Dem.             DEM.       &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
29 LdU              LDU        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
30 DSP              DSP        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
31 BDP              BDP        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
32 POCH             POCH       &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
33 SD               SD         &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
34 Rep.             REP.       &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
35 EDU              EDU        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
36 FPS              FPS        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
37 LS               LS         &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
38 JB               JB         &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
39 Front            FRONT      &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
40 Grüt             GRÜT       &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…
41 GP               GP         &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Kantonale_Regier…</code></pre>
</div>
</div>
</section>
</section>
<section id="gemeindeebene---exekutiven-der-statistischen-städte" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="gemeindeebene---exekutiven-der-statistischen-städte"><span class="header-section-number">3.2.3</span> Gemeindeebene - Exekutiven der statistischen Städte</h3>
<ul>
<li><p>1 Excelsheet / Jahr</p></li>
<li><p>Header zweizeilig mit Start in Zeile –&gt; 3 <code>skip = 2, n_max = 2,</code></p></li>
<li><p>Teils verbundene Header-Zeilen (vertikal/horizontal)</p></li>
<li><p>Cluster Einwohnerzahlen unterteilt Daten</p></li>
<li><p>Parteinamen uneinheitlich aufgrund von Fussnoten</p></li>
</ul>
<p>–&gt; Datenformat “wide” zuerst bereinigen und ins “long” Format bringen</p>
<section id="dateipfad-und-gewünschte-sheets-festlegen" class="level4" data-number="3.2.3.1">
<h4 data-number="3.2.3.1" class="anchored" data-anchor-id="dateipfad-und-gewünschte-sheets-festlegen"><span class="header-section-number">3.2.3.1</span> Dateipfad und gewünschte Sheets festlegen</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>dateipfad <span class="ot">&lt;-</span> <span class="st">"data/je-d-17.02.07.01_GEMEINDE_Die Exekutiven der statistischen Städte.xlsx"</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="do">##DATUMSFILTER##</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>selected_sheets <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"2024"</span>, <span class="st">"2023"</span>, <span class="st">"2022"</span>,<span class="st">"2021"</span>,<span class="st">"2020"</span>,<span class="st">"2019"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="function-für-den-import-der-gemeindedaten" class="level4" data-number="3.2.3.2">
<h4 data-number="3.2.3.2" class="anchored" data-anchor-id="function-für-den-import-der-gemeindedaten"><span class="header-section-number">3.2.3.2</span> Function für den Import der Gemeindedaten</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>importiere_sheet <span class="ot">&lt;-</span> <span class="cf">function</span>(dateipfad, sheetname) {</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>      <span class="do">########## HEADER ##########################################</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>      <span class="do">########## Auslesen/Zusammensetzen ################################</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Headerzeilen einlesen</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>      header <span class="ot">&lt;-</span> <span class="fu">suppressMessages</span>(<span class="fu">read_excel</span>(dateipfad,</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sheet =</span> sheetname,</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">skip =</span> <span class="dv">2</span>,</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">n_max =</span> <span class="dv">2</span>,</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">col_names =</span> <span class="cn">FALSE</span>))</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Daten  einlesen</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>      daten_raw <span class="ot">&lt;-</span> <span class="fu">suppressMessages</span>(<span class="fu">read_excel</span>(dateipfad,</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sheet =</span> sheetname,</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>                              <span class="at">skip =</span> <span class="dv">5</span>,</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>                              <span class="at">col_names =</span> <span class="cn">FALSE</span>))</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Spaltennamen zusammensetzen</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Leere Zellen in 1. Headerzeile mit Werten von rechts auffüllen wenn leer/NA</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>      header_filled <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(header))   <span class="co"># t() "matrix transpose"</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>      header_filled <span class="ot">&lt;-</span> <span class="fu">fill</span>(header_filled,        </span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>                            V1,                   <span class="co"># Header Spalte 1 (V1) auffüllen</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>                            <span class="at">.direction =</span> <span class="st">"down"</span>)  <span class="co"># Werte nach unten übernehmen</span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>      header_filled <span class="ot">&lt;-</span> <span class="fu">t</span>(header_filled)           <span class="co"># t() nochmals (zurück)</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Spaltennamen kombinieren</span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>      spaltennamen <span class="ot">&lt;-</span> <span class="fu">paste</span>(header_filled[<span class="dv">1</span>, ],</span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>                            header_filled[<span class="dv">2</span>, ],</span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>                            <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>      spaltennamen <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"_NA|NA_"</span>,<span class="st">""</span>, spaltennamen) <span class="co"># Entfernt überflüssige NAs</span></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Spaltennamen zuweisen</span></span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(daten_raw) <span class="ot">&lt;-</span> spaltennamen</span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>      <span class="do">########## TRANSPONIEREN ##########################################</span></span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a>      <span class="do">########## Gemeindegrössen Cluster ################################</span></span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Cluster Einwohnerzahl als Spalte verwenden</span></span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a>      daten_wide <span class="ot">&lt;-</span> daten_raw <span class="sc">%&gt;%</span></span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(Gemeindegrösse<span class="at">_Cluster =</span>             <span class="co"># Name der neuen Spalte</span></span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">ifelse</span>(</span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">is.na</span>(                           <span class="co"># 4) auf NA prüfen</span></span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">suppressWarnings</span>(        <span class="co"># 3) Warnung aus (z.B. "≥ ..Einw..")</span></span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">as.numeric</span>(                    <span class="co"># 2) Wert als Zahl </span></span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">gsub</span>(<span class="st">"'"</span>, <span class="st">""</span>, <span class="st">`</span><span class="at">Kantons-Nr.</span><span class="st">`</span>)   <span class="co"># 1) Tausender Zeichen (')                                                              entfernen</span></span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a>                   ))),</span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">as.character</span>(<span class="st">`</span><span class="at">Kantons-Nr.</span><span class="st">`</span>),     <span class="co"># 5) Wert von "Kantons-Nr" </span></span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a>                   <span class="cn">NA_character_</span>                    <span class="co">#    sonst NA   </span></span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a>                 ))  <span class="sc">%&gt;%</span></span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fill</span>(Gemeindegrösse_Cluster,</span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true" tabindex="-1"></a>             <span class="at">.direction =</span> <span class="st">"down"</span>) <span class="sc">%&gt;%</span>              <span class="co"># Cluster nach unten auffüllen</span></span>
<span id="cb44-54"><a href="#cb44-54" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">suppressWarnings</span>(</span>
<span id="cb44-55"><a href="#cb44-55" aria-hidden="true" tabindex="-1"></a>          <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"'"</span>, <span class="st">""</span>, <span class="st">`</span><span class="at">Kantons-Nr.</span><span class="st">`</span>))))) <span class="co"># Herausfiltern von Zeilen                                                           mit NICHT-numerischem Wert</span></span>
<span id="cb44-56"><a href="#cb44-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-57"><a href="#cb44-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-58"><a href="#cb44-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ansicht (Snapshot) nach transponieren</span></span>
<span id="cb44-59"><a href="#cb44-59" aria-hidden="true" tabindex="-1"></a>    daten_wide[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,                    <span class="co"># 10 Zeilen</span></span>
<span id="cb44-60"><a href="#cb44-60" aria-hidden="true" tabindex="-1"></a>               <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,                  <span class="co"># 10 Spalten +</span></span>
<span id="cb44-61"><a href="#cb44-61" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">ncol</span>(daten_wide))]     <span class="co"># Letzte Spalte</span></span>
<span id="cb44-62"><a href="#cb44-62" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># ncol() von df daten_wide --&gt; Anz. Spalten</span></span>
<span id="cb44-63"><a href="#cb44-63" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># Anzahl Spalten = Position letzte Spalte</span></span>
<span id="cb44-64"><a href="#cb44-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-65"><a href="#cb44-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-66"><a href="#cb44-66" aria-hidden="true" tabindex="-1"></a>    <span class="do">########## TRANSPONIEREN ##########################################</span></span>
<span id="cb44-67"><a href="#cb44-67" aria-hidden="true" tabindex="-1"></a>    <span class="do">########## Frauen, Männer, Total &amp; Parteien ## ####################</span></span>
<span id="cb44-68"><a href="#cb44-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-69"><a href="#cb44-69" aria-hidden="true" tabindex="-1"></a>    daten_long <span class="ot">&lt;-</span> daten_wide <span class="sc">%&gt;%</span></span>
<span id="cb44-70"><a href="#cb44-70" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">matches</span>(<span class="st">"(_Frauen|_Männer|_Total)$"</span>),</span>
<span id="cb44-71"><a href="#cb44-71" aria-hidden="true" tabindex="-1"></a>                    <span class="sc">~</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.numeric</span>(.)))) <span class="sc">%&gt;%</span>       <span class="co"># Werte numerisch</span></span>
<span id="cb44-72"><a href="#cb44-72" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">matches</span>(<span class="st">"(_Frauen|_Männer|_Total)$"</span>),   <span class="co"># Spaltenauswahl</span></span>
<span id="cb44-73"><a href="#cb44-73" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"party_orig_value"</span>, <span class="st">"m_w_Total"</span>),  <span class="co"># Label-Spalte</span></span>
<span id="cb44-74"><a href="#cb44-74" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_pattern =</span> <span class="st">"^(.*)_(Frauen|Männer|Total)$"</span>,<span class="co"># RegEx</span></span>
<span id="cb44-75"><a href="#cb44-75" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"Wert"</span>)                            <span class="co"># Wert-Spalte</span></span>
<span id="cb44-76"><a href="#cb44-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-77"><a href="#cb44-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(daten_long)</span>
<span id="cb44-78"><a href="#cb44-78" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="import-der-dateien-testen-optional" class="level4" data-number="3.2.3.3">
<h4 data-number="3.2.3.3" class="anchored" data-anchor-id="import-der-dateien-testen-optional"><span class="header-section-number">3.2.3.3</span> Import der Dateien testen (optional)</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (sheet <span class="cf">in</span> selected_sheets) {</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">-----------------------------</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Versuche Sheet:"</span>, sheet, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> <span class="fu">importiere_sheet</span>(dateipfad, sheet)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Sheet erfolgreich eingelesen:"</span>, sheet, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Zusammenfassung:</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Anzahl Zeilen:"</span>, <span class="fu">nrow</span>(dat), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Anzahl Spalten:"</span>, <span class="fu">ncol</span>(dat), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Spaltennamen (erste 15):"</span>, <span class="fu">paste</span>(<span class="fu">names</span>(dat)[<span class="dv">1</span><span class="sc">:</span><span class="fu">min</span>(<span class="dv">15</span>, <span class="fu">ncol</span>(dat))], <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Fehler beim Einlesen von Sheet:"</span>, sheet, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Fehlermeldung:"</span>, e<span class="sc">$</span>message, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>    <span class="cn">FALSE</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
-----------------------------
Versuche Sheet: 2024 
Sheet erfolgreich eingelesen: 2024 
Anzahl Zeilen: 7515 
Anzahl Spalten: 10 
Spaltennamen (erste 15): Kantons-Nr., Kanton, Gemeinde-Nr., Gemeinde, Wahljahr, Einwohner, Gemeindegrösse_Cluster, party_orig_value, m_w_Total, Wert 

-----------------------------
Versuche Sheet: 2023 
Sheet erfolgreich eingelesen: 2023 
Anzahl Zeilen: 7776 
Anzahl Spalten: 10 
Spaltennamen (erste 15): Kantons-Nr., Kanton, Gemeinde-Nr., Gemeinde, Wahljahr, Einwohner, Gemeindegrösse_Cluster, party_orig_value, m_w_Total, Wert 

-----------------------------
Versuche Sheet: 2022 
Sheet erfolgreich eingelesen: 2022 
Anzahl Zeilen: 7776 
Anzahl Spalten: 10 
Spaltennamen (erste 15): Kantons-Nr., Kanton, Gemeinde-Nr., Gemeinde, Wahljahr, Einwohner, Gemeindegrösse_Cluster, party_orig_value, m_w_Total, Wert 

-----------------------------
Versuche Sheet: 2021 
Sheet erfolgreich eingelesen: 2021 
Anzahl Zeilen: 7776 
Anzahl Spalten: 10 
Spaltennamen (erste 15): Kantons-Nr., Kanton, Gemeinde-Nr., Gemeinde, Wahljahr, Einwohner, Gemeindegrösse_Cluster, party_orig_value, m_w_Total, Wert 

-----------------------------
Versuche Sheet: 2020 
Sheet erfolgreich eingelesen: 2020 
Anzahl Zeilen: 7290 
Anzahl Spalten: 10 
Spaltennamen (erste 15): Kantons-Nr., Kanton, Gemeinde-Nr., Gemeinde, Wahljahr, Einwohner, Gemeindegrösse_Cluster, party_orig_value, m_w_Total, Wert 

-----------------------------
Versuche Sheet: 2019 
Sheet erfolgreich eingelesen: 2019 
Anzahl Zeilen: 14580 
Anzahl Spalten: 11 
Spaltennamen (erste 15): Kantons-Nr., Kanton, Gemeinde-Nr., Gemeinde, Einwohner, Grössenklasse-Nr., Grössenklasse, Gemeindegrösse_Cluster, party_orig_value, m_w_Total, Wert </code></pre>
</div>
</div>
</section>
<section id="function-ausführen-konsolidation-aus-datenliste-1" class="level4" data-number="3.2.3.4">
<h4 data-number="3.2.3.4" class="anchored" data-anchor-id="function-ausführen-konsolidation-aus-datenliste-1"><span class="header-section-number">3.2.3.4</span> Function ausführen &amp; Konsolidation aus Datenliste</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Objekt erstellen, mit Sheets als tibble/dataframe</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>daten_liste <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">lapply</span>(selected_sheets,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>                               <span class="cf">function</span>(sheet) <span class="fu">importiere_sheet</span>(dateipfad, sheet)),</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>                        selected_sheets)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(daten_liste)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>List of 6
 $ 2024: tibble [7,515 × 10] (S3: tbl_df/tbl/data.frame)
  ..$ Kantons-Nr.           : chr [1:7515] "1" "1" "1" "1" ...
  ..$ Kanton                : chr [1:7515] "ZH" "ZH" "ZH" "ZH" ...
  ..$ Gemeinde-Nr.          : num [1:7515] 230 230 230 230 230 230 230 230 230 230 ...
  ..$ Gemeinde              : chr [1:7515] "Winterthur" "Winterthur" "Winterthur" "Winterthur" ...
  ..$ Wahljahr              : num [1:7515] 2022 2022 2022 2022 2022 ...
  ..$ Einwohner             : num [1:7515] 115129 115129 115129 115129 115129 ...
  ..$ Gemeindegrösse_Cluster: chr [1:7515] "≥ 100'000 Einwohnerinnen und Einwohner" "≥ 100'000 Einwohnerinnen und Einwohner" "≥ 100'000 Einwohnerinnen und Einwohner" "≥ 100'000 Einwohnerinnen und Einwohner" ...
  ..$ party_orig_value      : chr [1:7515] "FDP 1" "FDP 1" "FDP 1" "Die Mitte 2" ...
  ..$ m_w_Total             : chr [1:7515] "Frauen" "Männer" "Total" "Frauen" ...
  ..$ Wert                  : num [1:7515] 0 1 1 0 1 1 NA NA NA 1 ...
 $ 2023: tibble [7,776 × 10] (S3: tbl_df/tbl/data.frame)
  ..$ Kantons-Nr.           : chr [1:7776] "1" "1" "1" "1" ...
  ..$ Kanton                : chr [1:7776] "ZH" "ZH" "ZH" "ZH" ...
  ..$ Gemeinde-Nr.          : num [1:7776] 230 230 230 230 230 230 230 230 230 230 ...
  ..$ Gemeinde              : chr [1:7776] "Winterthur" "Winterthur" "Winterthur" "Winterthur" ...
  ..$ Wahljahr              : num [1:7776] 2022 2022 2022 2022 2022 ...
  ..$ Einwohner             : num [1:7776] 115129 115129 115129 115129 115129 ...
  ..$ Gemeindegrösse_Cluster: chr [1:7776] "≥ 100'000 Einwohnerinnen und Einwohner" "≥ 100'000 Einwohnerinnen und Einwohner" "≥ 100'000 Einwohnerinnen und Einwohner" "≥ 100'000 Einwohnerinnen und Einwohner" ...
  ..$ party_orig_value      : chr [1:7776] "FDP 1" "FDP 1" "FDP 1" "Die Mitte 2" ...
  ..$ m_w_Total             : chr [1:7776] "Frauen" "Männer" "Total" "Frauen" ...
  ..$ Wert                  : num [1:7776] 0 1 1 0 1 1 NA NA NA 1 ...
 $ 2022: tibble [7,776 × 10] (S3: tbl_df/tbl/data.frame)
  ..$ Kantons-Nr.           : chr [1:7776] "1" "1" "1" "1" ...
  ..$ Kanton                : chr [1:7776] "ZH" "ZH" "ZH" "ZH" ...
  ..$ Gemeinde-Nr.          : num [1:7776] 230 230 230 230 230 230 230 230 230 230 ...
  ..$ Gemeinde              : chr [1:7776] "Winterthur" "Winterthur" "Winterthur" "Winterthur" ...
  ..$ Wahljahr              : num [1:7776] 2022 2022 2022 2022 2022 ...
  ..$ Einwohner             : num [1:7776] 115129 115129 115129 115129 115129 ...
  ..$ Gemeindegrösse_Cluster: chr [1:7776] "≥ 100'000 Einwohnerinnen und Einwohner" "≥ 100'000 Einwohnerinnen und Einwohner" "≥ 100'000 Einwohnerinnen und Einwohner" "≥ 100'000 Einwohnerinnen und Einwohner" ...
  ..$ party_orig_value      : chr [1:7776] "FDP 1" "FDP 1" "FDP 1" "Die Mitte 2" ...
  ..$ m_w_Total             : chr [1:7776] "Frauen" "Männer" "Total" "Frauen" ...
  ..$ Wert                  : num [1:7776] 0 1 1 0 1 1 NA NA NA 1 ...
 $ 2021: tibble [7,776 × 10] (S3: tbl_df/tbl/data.frame)
  ..$ Kantons-Nr.           : chr [1:7776] "1" "1" "1" "1" ...
  ..$ Kanton                : chr [1:7776] "ZH" "ZH" "ZH" "ZH" ...
  ..$ Gemeinde-Nr.          : num [1:7776] 230 230 230 230 230 230 230 230 230 230 ...
  ..$ Gemeinde              : chr [1:7776] "Winterthur" "Winterthur" "Winterthur" "Winterthur" ...
  ..$ Wahljahr              : num [1:7776] 2018 2018 2018 2018 2018 ...
  ..$ Einwohner             : num [1:7776] 110912 110912 110912 110912 110912 ...
  ..$ Gemeindegrösse_Cluster: chr [1:7776] "≥ 100'000 Einwohnerinnen und Einwohner" "≥ 100'000 Einwohnerinnen und Einwohner" "≥ 100'000 Einwohnerinnen und Einwohner" "≥ 100'000 Einwohnerinnen und Einwohner" ...
  ..$ party_orig_value      : chr [1:7776] "FDP 1" "FDP 1" "FDP 1" "Die Mitte 2" ...
  ..$ m_w_Total             : chr [1:7776] "Frauen" "Männer" "Total" "Frauen" ...
  ..$ Wert                  : num [1:7776] 1 1 2 NA NA NA 0 1 1 2 ...
 $ 2020: tibble [7,290 × 10] (S3: tbl_df/tbl/data.frame)
  ..$ Kantons-Nr.           : chr [1:7290] "1" "1" "1" "1" ...
  ..$ Kanton                : chr [1:7290] "ZH" "ZH" "ZH" "ZH" ...
  ..$ Gemeinde-Nr.          : num [1:7290] 230 230 230 230 230 230 230 230 230 230 ...
  ..$ Gemeinde              : chr [1:7290] "Winterthur" "Winterthur" "Winterthur" "Winterthur" ...
  ..$ Wahljahr              : num [1:7290] 2018 2018 2018 2018 2018 ...
  ..$ Einwohner             : num [1:7290] 110912 110912 110912 110912 110912 ...
  ..$ Gemeindegrösse_Cluster: chr [1:7290] "≥ 100'000 Einwohnerinnen und Einwohner" "≥ 100'000 Einwohnerinnen und Einwohner" "≥ 100'000 Einwohnerinnen und Einwohner" "≥ 100'000 Einwohnerinnen und Einwohner" ...
  ..$ party_orig_value      : chr [1:7290] "FDP 1)" "FDP 1)" "FDP 1)" "CVP" ...
  ..$ m_w_Total             : chr [1:7290] "Frauen" "Männer" "Total" "Frauen" ...
  ..$ Wert                  : num [1:7290] 1 1 2 0 1 1 2 1 3 NA ...
 $ 2019: tibble [14,580 × 11] (S3: tbl_df/tbl/data.frame)
  ..$ Kantons-Nr.           : chr [1:14580] "1" "1" "1" "1" ...
  ..$ Kanton                : chr [1:14580] "ZH" "ZH" "ZH" "ZH" ...
  ..$ Gemeinde-Nr.          : num [1:14580] 230 230 230 230 230 230 230 230 230 230 ...
  ..$ Gemeinde              : chr [1:14580] "Winterthur" "Winterthur" "Winterthur" "Winterthur" ...
  ..$ Einwohner             : num [1:14580] 111851 111851 111851 111851 111851 ...
  ..$ Grössenklasse-Nr.     : chr [1:14580] "4" "4" "4" "4" ...
  ..$ Grössenklasse         : chr [1:14580] "≥ 100'000 Einwohnerinnen und Einwohner" "≥ 100'000 Einwohnerinnen und Einwohner" "≥ 100'000 Einwohnerinnen und Einwohner" "≥ 100'000 Einwohnerinnen und Einwohner" ...
  ..$ Gemeindegrösse_Cluster: chr [1:14580] "≥ 100'000 Einwohnerinnen und Einwohner" "≥ 100'000 Einwohnerinnen und Einwohner" "≥ 100'000 Einwohnerinnen und Einwohner" "≥ 100'000 Einwohnerinnen und Einwohner" ...
  ..$ party_orig_value      : chr [1:14580] "FDP 1)" "FDP 1)" "FDP 1)" "CVP" ...
  ..$ m_w_Total             : chr [1:14580] "Frauen" "Männer" "Total" "Frauen" ...
  ..$ Wert                  : num [1:14580] 1 1 2 0 1 1 2 1 3 NA ...</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lapply(daten_liste, summary)</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Alle tibbles zu einem Dataframe zusammenfügen</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>elec_gemeinde_combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(daten_liste,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">.id =</span> <span class="st">"year"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(m_w_Total <span class="sc">==</span> <span class="st">"Total"</span>,</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>         party_orig_value <span class="sc">!=</span> <span class="st">"Total"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">election_year =</span> Wahljahr,</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_seats =</span> Wert,</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">Kt =</span> Kanton) <span class="sc">%&gt;%</span> </span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">role =</span> <span class="st">"Gemeindeexekutive"</span>,</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">election_year =</span> <span class="fu">as.character</span>(election_year)) <span class="sc">%&gt;%</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">'Grössenklasse-Nr.'</span>,</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>            Grössenklasse,</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">Kantons-Nr.</span><span class="st">`</span>,</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>            m_w_Total)) <span class="sc">%&gt;%</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lookup_kantone, <span class="at">by =</span> <span class="st">"Kt"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(role,</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>         party_orig_value,</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>         year,</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>         election_year,</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>         n_seats,</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>         Kt,</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>         Kanton,</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>         <span class="fu">everything</span>())</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a><span class="co">#  year in integer umwandeln</span></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>elec_gemeinde_combined<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(elec_gemeinde_combined<span class="sc">$</span>year))</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Fehlende Jahre ergänzen</span></span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>current_year <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">"%Y"</span>))</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>max_year <span class="ot">&lt;-</span> <span class="fu">max</span>(elec_gemeinde_combined<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (max_year <span class="sc">&lt;</span> current_year) {</span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Für jedes fehlende Jahr</span></span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (y <span class="cf">in</span> (max_year<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>current_year) {</span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Letzte Werte kopieren und Jahr anpassen</span></span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a>    last_year_data <span class="ot">&lt;-</span> elec_gemeinde_combined <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> max_year)</span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a>    last_year_data<span class="sc">$</span>year <span class="ot">&lt;-</span> y</span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a>    last_year_data<span class="sc">$</span>election_year <span class="ot">&lt;-</span> <span class="fu">as.character</span>(y)</span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a>    elec_gemeinde_combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(elec_gemeinde_combined, last_year_data)</span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="ergebnis-gemeinde-bzw.-exekutiven-statistischer-städte" class="level4" data-number="3.2.3.5">
<h4 data-number="3.2.3.5" class="anchored" data-anchor-id="ergebnis-gemeinde-bzw.-exekutiven-statistischer-städte"><span class="header-section-number">3.2.3.5</span> Ergebnis Gemeinde bzw. Exekutiven statistischer Städte</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ratssitze pro Jahr (nach-)prüfen</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>elec_gemeinde_combined_sum_check <span class="ot">&lt;-</span> elec_gemeinde_combined <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span>                         <span class="co"># Gruppieren nach Jahr</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">summe =</span> <span class="fu">sum</span>(n_seats, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="co"># Summe berechnen, NAs ignorieren</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO: Clean-up evt. einmal nach ganzem load.</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean-up: Nicht mehr benötigte "election" Tabellen löschen</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a> <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"^elec_"</span>)[       <span class="co"># Objekte die mit elec_ starten aber nicht</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>   <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"(_combined|_combined_sum_check)$"</span>, <span class="co"># auf all_combined oder all_final enden</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"^elec_"</span>))])</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co"> Grosses Datatable, deshalb auskommentieren oder ander Lösung..</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="co"># datatable(elec_gemeinde_exekutiven_combined,</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="co">#           class = 'nowrap',</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="co">#           filter = 'top',</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a><span class="co">#           options = list(pageLength = 7,</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a><span class="co">#                          scrollX = TRUE,</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a><span class="co">#                          search = list(regex = TRUE,</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        caseInsensitive = TRUE)))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="parteinamen-gemeinde-für-lookup-tabelle" class="level4" data-number="3.2.3.6">
<h4 data-number="3.2.3.6" class="anchored" data-anchor-id="parteinamen-gemeinde-für-lookup-tabelle"><span class="header-section-number">3.2.3.6</span> Parteinamen Gemeinde (für Lookup-Tabelle)</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parteinamenvarianten</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(elec_gemeinde_combined<span class="sc">$</span>party_orig_value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "FDP 1"       "Die Mitte 2" "CVP 2"       "SP"          "SVP"        
 [6] "LP 1"        "EVP"         "CSP"         "GLP"         "PdA"        
[11] "GRÜNE 3"     "EDU"         "Lega"        "Übrige"      "BDP 2"      
[16] "FDP 1)"      "CVP"         "LP 1)"       "BDP"         "GPS"        
[21] "Dem."        "LdU"         "DSP"         "PSA"         "POCH"       
[26] "GA"          "Sol."        "SD"          "Rep."        "FPS"        
[31] "MCR"         "LS"          "JB"          "Front"       "Grüt"       </code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parteien zwecks Lookup/Vereinheitlichung mit bereinigten Namen in df schreiben</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>lookup_input_gemeinde_parties_label <span class="ot">&lt;-</span> elec_gemeinde_combined <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">add_info =</span> <span class="fu">str_extract</span>(party_orig_value,</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"</span><span class="sc">\\</span><span class="st">d+(?=</span><span class="sc">\\</span><span class="st">)?$)"</span>),  <span class="co"># Zahl am Ende/vor Klammer-Ende</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">short_name =</span> <span class="fu">str_remove</span>(party_orig_value,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"</span><span class="sc">\\</span><span class="st">s*</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">)?$"</span>), <span class="co"># - Leerzeichen/Zahl/Klammer</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">long_name =</span> <span class="cn">NA_character_</span>, </span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">prefix =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">level =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">source =</span> <span class="st">"Gemeinde_Exekutiven"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Großschreibung der short_name-Spalte</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">short_name =</span> <span class="fu">toupper</span>(short_name))<span class="sc">%&gt;%</span> </span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(party_orig_value,</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>         short_name,</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>         long_name,</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>         prefix,</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>         add_info,</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>         level,</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>         source)</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Output prüfen (unique/distinct)</span></span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>lookup_input_gemeinde_parties_label <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 35 × 7
   party_orig_value short_name long_name prefix add_info level source           
   &lt;chr&gt;            &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;            
 1 FDP 1            FDP        &lt;NA&gt;      &lt;NA&gt;   1        &lt;NA&gt;  Gemeinde_Exekuti…
 2 Die Mitte 2      DIE MITTE  &lt;NA&gt;      &lt;NA&gt;   2        &lt;NA&gt;  Gemeinde_Exekuti…
 3 CVP 2            CVP        &lt;NA&gt;      &lt;NA&gt;   2        &lt;NA&gt;  Gemeinde_Exekuti…
 4 SP               SP         &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
 5 SVP              SVP        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
 6 LP 1             LP         &lt;NA&gt;      &lt;NA&gt;   1        &lt;NA&gt;  Gemeinde_Exekuti…
 7 EVP              EVP        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
 8 CSP              CSP        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
 9 GLP              GLP        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
10 PdA              PDA        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
11 GRÜNE 3          GRÜNE      &lt;NA&gt;      &lt;NA&gt;   3        &lt;NA&gt;  Gemeinde_Exekuti…
12 EDU              EDU        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
13 Lega             LEGA       &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
14 Übrige           ÜBRIGE     &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
15 BDP 2            BDP        &lt;NA&gt;      &lt;NA&gt;   2        &lt;NA&gt;  Gemeinde_Exekuti…
16 FDP 1)           FDP        &lt;NA&gt;      &lt;NA&gt;   1        &lt;NA&gt;  Gemeinde_Exekuti…
17 CVP              CVP        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
18 LP 1)            LP         &lt;NA&gt;      &lt;NA&gt;   1        &lt;NA&gt;  Gemeinde_Exekuti…
19 BDP              BDP        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
20 GPS              GPS        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
21 Dem.             DEM.       &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
22 LdU              LDU        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
23 DSP              DSP        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
24 PSA              PSA        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
25 POCH             POCH       &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
26 GA               GA         &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
27 Sol.             SOL.       &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
28 SD               SD         &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
29 Rep.             REP.       &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
30 FPS              FPS        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
31 MCR              MCR        &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
32 LS               LS         &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
33 JB               JB         &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
34 Front            FRONT      &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…
35 Grüt             GRÜT       &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;  Gemeinde_Exekuti…</code></pre>
</div>
</div>
</section>
</section>
<section id="listen-aller-staatsebenen-konsolidieren-einheitliche-parteinamen-joinen" class="level3" data-number="3.2.4">
<h3 data-number="3.2.4" class="anchored" data-anchor-id="listen-aller-staatsebenen-konsolidieren-einheitliche-parteinamen-joinen"><span class="header-section-number">3.2.4</span> Listen aller Staatsebenen konsolidieren &amp; einheitliche Parteinamen joinen</h3>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In allen Dataframes die year-Spalte vereinheitlichen</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>elec_nr_sr_combined<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(elec_nr_sr_combined<span class="sc">$</span>year))</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>elec_canton_combined<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(elec_canton_combined<span class="sc">$</span>year))</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>elec_gemeinde_combined<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(elec_gemeinde_combined<span class="sc">$</span>year))</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>lookup_parties_consolidated <span class="sc">%&gt;%</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(party_orig_value) <span class="sc">%&gt;%</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 2
# ℹ 2 variables: party_orig_value &lt;chr&gt;, n &lt;int&gt;</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>lookup_parties_consolidated <span class="sc">%&gt;%</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(party_orig_value, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 561 × 9
   Partei Parteiname party_orig_value short_name long_name prefix add_info level
   &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;            &lt;chr&gt;      &lt;lgl&gt;     &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;
 1 OTHERS Andere (S… p-others_counte… OTHERS     NA        p      counterp state
 2 OTHERS Andere (S… p-others_counte… OTHERS     NA        p      counter… state
 3 OTHERS Andere (S… p-others_free    OTHERS     NA        p      free     state
 4 OTHERS Andere (S… p-others_free-fr OTHERS     NA        p      free-fr  state
 5 OTHERS Andere (S… p-others_init    OTHERS     NA        p      init     state
 6 OTHERS Andere (S… p-others_init-fr OTHERS     NA        p      init-fr  state
 7 OTHERS Andere (S… p-others_no      OTHERS     NA        p      no       state
 8 OTHERS Andere (S… p-others_no-fr   OTHERS     NA        p      no-fr    state
 9 OTHERS Andere (S… p-others_yes     OTHERS     NA        p      yes      state
10 OTHERS Andere (S… p-others_yes-fr  OTHERS     NA        p      yes-fr   state
# ℹ 551 more rows
# ℹ 1 more variable: source &lt;chr&gt;</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co">#write_xlsx(elec_all_combined,"tmp_elec_all_combined.xlsx")</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Vereinheitlichte Dataframes (Exekutiven je Staatsebene) konsolidieren</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>elec_all_combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(elec_nr_sr_combined,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>                               elec_canton_combined,</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>                               elec_gemeinde_combined) <span class="sc">%&gt;%</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Lookup für einheiltiche Parteinamen anwenden</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lookup_parties_consolidated <span class="sc">%&gt;%</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(Partei,</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>                     Parteiname,</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>                     party_orig_value),</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">"party_orig_value"</span>,</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">relationship =</span> <span class="st">"many-to-many"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(Partei,</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>           Parteiname,</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">.after =</span> party_orig_value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="clean-up-election-obsolete-objekte-nach-konsolidierung-löschen" class="level3" data-number="3.2.5">
<h3 data-number="3.2.5" class="anchored" data-anchor-id="clean-up-election-obsolete-objekte-nach-konsolidierung-löschen"><span class="header-section-number">3.2.5</span> Clean-up “Election”: Obsolete Objekte (nach Konsolidierung) löschen</h3>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean-up entfernt Objekte die mit "elec_" starten, ausser bei Endung auf</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co"># "_all_combined" oder "_all_final"</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"^elec_"</span>)[       <span class="co"># Objekte die mit elec_ starten aber nicht</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>   <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"(_all_combined|_all_final)$"</span>, <span class="co"># auf all_combined oder all_final enden</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"^elec_"</span>))])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="parteistärken-berechnen---sitze-aggregiert-auf-staatsebene" class="level3" data-number="3.2.6">
<h3 data-number="3.2.6" class="anchored" data-anchor-id="parteistärken-berechnen---sitze-aggregiert-auf-staatsebene"><span class="header-section-number">3.2.6</span> Parteistärken berechnen - Sitze aggregiert auf Staatsebene</h3>
<section id="jahre-eingrenzen" class="level4" data-number="3.2.6.1">
<h4 data-number="3.2.6.1" class="anchored" data-anchor-id="jahre-eingrenzen"><span class="header-section-number">3.2.6.1</span> Jahre eingrenzen</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="do">##DATUMSFILTER##</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Jahre eingrenzen</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>elec_all_combined_input <span class="ot">&lt;-</span>  elec_all_combined <span class="sc">%&gt;%</span> </span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="st">"2019"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="dataframes-vereinheitlichen-und-ggfs.-aggregieren" class="level4" data-number="3.2.6.2">
<h4 data-number="3.2.6.2" class="anchored" data-anchor-id="dataframes-vereinheitlichen-und-ggfs.-aggregieren"><span class="header-section-number">3.2.6.2</span> Dataframes vereinheitlichen und ggfs. aggregieren</h4>
<section id="staatsebene-national--und-ständerat-as-is" class="level5" data-number="3.2.6.2.1">
<h5 data-number="3.2.6.2.1" class="anchored" data-anchor-id="staatsebene-national--und-ständerat-as-is"><span class="header-section-number">3.2.6.2.1</span> Staatsebene: National- und Ständerat “as is”</h5>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>elec_nr_sr_lvl_state <span class="ot">&lt;-</span> elec_all_combined_input <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(role <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ständerat"</span>,</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Nationalrat"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>           Partei) <span class="sc">%&gt;%</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_seats_sum =</span> <span class="fu">sum</span>(n_seats,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_seats_pct =</span> <span class="dv">100</span> <span class="sc">*</span> n_seats_sum <span class="sc">/</span> <span class="fu">sum</span>(n_seats_sum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_seats_sum <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="kantonsebene-gewichtung-nach-stimmberechtigten-je-kanton-für-aggregation-auf-staatsebene" class="level5" data-number="3.2.6.2.2">
<h5 data-number="3.2.6.2.2" class="anchored" data-anchor-id="kantonsebene-gewichtung-nach-stimmberechtigten-je-kanton-für-aggregation-auf-staatsebene"><span class="header-section-number">3.2.6.2.2</span> Kantonsebene: Gewichtung nach Stimmberechtigten je Kanton für Aggregation auf Staatsebene</h5>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregiert auf Kantonsebene</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>elec_kanton_lvl_kt <span class="ot">&lt;-</span> elec_all_combined_input <span class="sc">%&gt;%</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(role <span class="sc">==</span> <span class="st">"Kantonsregierung"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>           Kt,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>           Partei) <span class="sc">%&gt;%</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_seats_sum =</span> <span class="fu">sum</span>(n_seats,</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>                              <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>           Kt) <span class="sc">%&gt;%</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_seats_pct =</span> <span class="dv">100</span> <span class="sc">*</span> n_seats_sum <span class="sc">/</span> <span class="fu">sum</span>(n_seats_sum,</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a><span class="co"># integer vs. character --&gt; anpassen</span></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>Wahlberechtigte_1990_2024 <span class="ot">&lt;-</span> Wahlberechtigte_1990_2024 <span class="sc">%&gt;%</span></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(year)))</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregiert auf Staatsebene</span></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>elec_kanton_lvl_state <span class="ot">&lt;-</span> elec_all_combined_input <span class="sc">%&gt;%</span></span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(role <span class="sc">==</span> <span class="st">"Kantonsregierung"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(Wahlberechtigte_1990_2024 <span class="sc">%&gt;%</span></span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>              <span class="fu">summarise</span>(<span class="at">stimmberechtigte_avg_state =</span> <span class="fu">sum</span>(stimmberechtigte_avg_kt,</span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>                                                         <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"year"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_seats_weighted =</span> n_seats <span class="sc">*</span> stimmberechtigte_avg_state) <span class="sc">%&gt;%</span></span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,</span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a>           Partei) <span class="sc">%&gt;%</span></span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_seats_sum =</span> <span class="fu">sum</span>(n_seats,</span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>                              <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_seats_sum_weighted =</span> <span class="fu">sum</span>(n_seats_weighted,</span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">stimmberechtigte_avg_state =</span> <span class="fu">first</span>(stimmberechtigte_avg_state),</span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_seats_pct =</span></span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a>           <span class="dv">100</span> <span class="sc">*</span> n_seats_sum <span class="sc">/</span> <span class="fu">sum</span>(n_seats_sum,</span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_seats_pct_weighted =</span></span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true" tabindex="-1"></a>           <span class="dv">100</span> <span class="sc">*</span> n_seats_sum_weighted <span class="sc">/</span> <span class="fu">sum</span>(n_seats_sum_weighted,</span>
<span id="cb63-44"><a href="#cb63-44" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb63-45"><a href="#cb63-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="gemeindeebene-gewichtung-nach-einwohner-je-statistische-stadt-aggregiert-auf-kanton--und-staatsebene" class="level5" data-number="3.2.6.2.3">
<h5 data-number="3.2.6.2.3" class="anchored" data-anchor-id="gemeindeebene-gewichtung-nach-einwohner-je-statistische-stadt-aggregiert-auf-kanton--und-staatsebene"><span class="header-section-number">3.2.6.2.3</span> Gemeindeebene: Gewichtung nach Einwohner je “statistische Stadt” aggregiert auf Kanton- und Staatsebene</h5>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregiert auf Gemeindeebene</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>elec_gemeinde_lvl_gemeinde  <span class="ot">&lt;-</span> elec_all_combined_input <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(role <span class="sc">==</span> <span class="st">"Gemeindeexekutive"</span>,</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>         n_seats <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>           Gemeinde,</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>           Partei) <span class="sc">%&gt;%</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_seats_sum =</span> <span class="fu">sum</span>(n_seats,</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>           Gemeinde) <span class="sc">%&gt;%</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_seats_pct =</span> <span class="dv">100</span><span class="sc">*</span> n_seats_sum <span class="sc">/</span> <span class="fu">sum</span>(n_seats_sum,</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregiert auf Kantonsebene</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>elec_gemeinde_lvl_kt <span class="ot">&lt;-</span> elec_all_combined_input <span class="sc">%&gt;%</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(role <span class="sc">==</span> <span class="st">"Gemeindeexekutive"</span>,</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>         n_seats <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>           Kt,</span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>           Gemeinde,</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>           Partei) <span class="sc">%&gt;%</span></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_seats_sum =</span> <span class="fu">sum</span>(n_seats, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">Einwohner =</span> <span class="fu">first</span>(Einwohner),</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weighted_seats =</span> n_seats_sum <span class="sc">*</span> Einwohner) <span class="sc">%&gt;%</span></span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,</span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>           Kt,</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>           Partei) <span class="sc">%&gt;%</span></span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_seats_sum =</span> <span class="fu">sum</span>(n_seats_sum,                  <span class="co"># ungewichtete Sitze</span></span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>                              <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_seats_sum_weighted =</span> <span class="fu">sum</span>(weighted_seats,      <span class="co"># gewichtete Sitze</span></span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,</span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>           Kt) <span class="sc">%&gt;%</span></span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_seats_pct =</span> <span class="dv">100</span> <span class="sc">*</span>                                <span class="co"># ungewichtet %</span></span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>           n_seats_sum <span class="sc">/</span> <span class="fu">sum</span>(n_seats_sum,</span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a>                             <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_seats_pct_weighted =</span> <span class="dv">100</span> <span class="sc">*</span>                       <span class="co"># gewichtet %  </span></span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a>           n_seats_sum_weighted <span class="sc">/</span> <span class="fu">sum</span>(n_seats_sum_weighted,</span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregiert auf Staatsebene </span></span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a>elec_gemeinde_lvl_state <span class="ot">&lt;-</span> elec_all_combined_input <span class="sc">%&gt;%</span></span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(role <span class="sc">==</span> <span class="st">"Gemeindeexekutive"</span>,</span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true" tabindex="-1"></a>         n_seats <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-51"><a href="#cb64-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,</span>
<span id="cb64-52"><a href="#cb64-52" aria-hidden="true" tabindex="-1"></a>           Gemeinde,</span>
<span id="cb64-53"><a href="#cb64-53" aria-hidden="true" tabindex="-1"></a>           Partei) <span class="sc">%&gt;%</span></span>
<span id="cb64-54"><a href="#cb64-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_seats_sum =</span> <span class="fu">sum</span>(n_seats,</span>
<span id="cb64-55"><a href="#cb64-55" aria-hidden="true" tabindex="-1"></a>                              <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb64-56"><a href="#cb64-56" aria-hidden="true" tabindex="-1"></a>            <span class="at">Einwohner =</span> <span class="fu">first</span>(Einwohner),</span>
<span id="cb64-57"><a href="#cb64-57" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-58"><a href="#cb64-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weighted_seats =</span> n_seats_sum <span class="sc">*</span> Einwohner) <span class="sc">%&gt;%</span></span>
<span id="cb64-59"><a href="#cb64-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,</span>
<span id="cb64-60"><a href="#cb64-60" aria-hidden="true" tabindex="-1"></a>           Partei) <span class="sc">%&gt;%</span></span>
<span id="cb64-61"><a href="#cb64-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_seats_sum =</span> <span class="fu">sum</span>(n_seats_sum,                   <span class="co"># ungewichtete Sitze</span></span>
<span id="cb64-62"><a href="#cb64-62" aria-hidden="true" tabindex="-1"></a>                              <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb64-63"><a href="#cb64-63" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_seats_sum_weighted =</span> <span class="fu">sum</span>(weighted_seats,       <span class="co"># gewichtete Sitze</span></span>
<span id="cb64-64"><a href="#cb64-64" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb64-65"><a href="#cb64-65" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-66"><a href="#cb64-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb64-67"><a href="#cb64-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_seats_pct =</span> <span class="dv">100</span> <span class="sc">*</span></span>
<span id="cb64-68"><a href="#cb64-68" aria-hidden="true" tabindex="-1"></a>           n_seats_sum <span class="sc">/</span> <span class="fu">sum</span>(n_seats_sum,</span>
<span id="cb64-69"><a href="#cb64-69" aria-hidden="true" tabindex="-1"></a>                             <span class="at">na.rm =</span> <span class="cn">TRUE</span>),                  <span class="co"># ungewichtet %</span></span>
<span id="cb64-70"><a href="#cb64-70" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_seats_pct_weighted =</span> <span class="dv">100</span> <span class="sc">*</span></span>
<span id="cb64-71"><a href="#cb64-71" aria-hidden="true" tabindex="-1"></a>           n_seats_sum_weighted <span class="sc">/</span> <span class="fu">sum</span>(n_seats_sum_weighted,</span>
<span id="cb64-72"><a href="#cb64-72" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span>     <span class="co"># gewichtet %</span></span>
<span id="cb64-73"><a href="#cb64-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
<section id="übersicht-aller-elec_-dataframes" class="level3" data-number="3.2.7">
<h3 data-number="3.2.7" class="anchored" data-anchor-id="übersicht-aller-elec_-dataframes"><span class="header-section-number">3.2.7</span> Übersicht aller elec_ dataframes</h3>
<section id="function-für-df-übersicht" class="level4" data-number="3.2.7.1">
<h4 data-number="3.2.7.1" class="anchored" data-anchor-id="function-für-df-übersicht"><span class="header-section-number">3.2.7.1</span> Function für df() Übersicht</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>df_overview <span class="ot">&lt;-</span> <span class="cf">function</span>(df_name) {</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">get</span>(df_name)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"===="</span>, df_name, <span class="st">"====</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Anzahl Zeilen:"</span>, <span class="fu">nrow</span>(df), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Anzahl Spalten:"</span>, <span class="fu">ncol</span>(df), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Spaltennamen:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">names</span>(df))</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Dynamische Sortierung: Nur vorhandene Spalten werden verwendet</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>  sort_cols <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  sort_orders <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1) Nach year (aufsteigend)</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"year"</span> <span class="sc">%in%</span> <span class="fu">names</span>(df)) {</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>year)</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>    sort_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(sort_cols, <span class="st">"year"</span>)</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>    sort_orders <span class="ot">&lt;-</span> <span class="fu">c</span>(sort_orders, <span class="cn">TRUE</span>) <span class="co"># TRUE = aufsteigend</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2) Nach Gemeinde (alphabetisch)</span></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"Gemeinde"</span> <span class="sc">%in%</span> <span class="fu">names</span>(df)) {</span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>    sort_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(sort_cols, <span class="st">"Gemeinde"</span>)</span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>    sort_orders <span class="ot">&lt;-</span> <span class="fu">c</span>(sort_orders, <span class="cn">TRUE</span>)</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3) Kt (alphabetisch)</span></span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"Kt"</span> <span class="sc">%in%</span> <span class="fu">names</span>(df)) {</span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>    sort_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(sort_cols, <span class="st">"Kt"</span>)</span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>    sort_orders <span class="ot">&lt;-</span> <span class="fu">c</span>(sort_orders, <span class="cn">TRUE</span>)</span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4) n_seats_sum (absteigend)</span></span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"n_seats_sum"</span> <span class="sc">%in%</span> <span class="fu">names</span>(df)) {</span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">$</span>n_seats_sum <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>n_seats_sum)</span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a>    sort_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(sort_cols, <span class="st">"n_seats_sum"</span>)</span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a>    sort_orders <span class="ot">&lt;-</span> <span class="fu">c</span>(sort_orders, <span class="cn">FALSE</span>) <span class="co"># FALSE = absteigend</span></span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sortiere Dataframe, falls mindestens eine Sortierspalte vorhanden ist</span></span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(sort_cols) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Erzeuge eine Liste von Spalten für do.call(order, ...)</span></span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a>    order_args <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_along</span>(sort_cols), <span class="cf">function</span>(i) {</span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a>      col <span class="ot">&lt;-</span> df[[sort_cols[i]]]</span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span>sort_orders[i]) <span class="sc">-</span>col <span class="cf">else</span> col</span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> df[<span class="fu">do.call</span>(order, order_args), ]</span>
<span id="cb65-45"><a href="#cb65-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-46"><a href="#cb65-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-47"><a href="#cb65-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prüfung auf gültige Zahlen in n_seats_sum</span></span>
<span id="cb65-48"><a href="#cb65-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"n_seats_sum"</span> <span class="sc">%in%</span> <span class="fu">names</span>(df)) {</span>
<span id="cb65-49"><a href="#cb65-49" aria-hidden="true" tabindex="-1"></a>    valid_rows <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>n_seats_sum) <span class="sc">&amp;</span> <span class="fu">is.finite</span>(<span class="fu">as.numeric</span>(df<span class="sc">$</span>n_seats_sum))</span>
<span id="cb65-50"><a href="#cb65-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">any</span>(<span class="sc">!</span>valid_rows)) {</span>
<span id="cb65-51"><a href="#cb65-51" aria-hidden="true" tabindex="-1"></a>      last_valid_row <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span>valid_rows)[<span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb65-52"><a href="#cb65-52" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb65-53"><a href="#cb65-53" aria-hidden="true" tabindex="-1"></a>      last_valid_row <span class="ot">&lt;-</span> <span class="fu">nrow</span>(df)</span>
<span id="cb65-54"><a href="#cb65-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb65-55"><a href="#cb65-55" aria-hidden="true" tabindex="-1"></a>    rows_to_show <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">max</span>(<span class="dv">1</span>, last_valid_row)</span>
<span id="cb65-56"><a href="#cb65-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Zeilen mit Zahlen in 'n_seats_sum' (sortiert):</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb65-57"><a href="#cb65-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(df[rows_to_show, , <span class="at">drop =</span> <span class="cn">FALSE</span>])</span>
<span id="cb65-58"><a href="#cb65-58" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb65-59"><a href="#cb65-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Erste 3 Zeilen:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb65-60"><a href="#cb65-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">head</span>(df, <span class="dv">3</span>))</span>
<span id="cb65-61"><a href="#cb65-61" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-62"><a href="#cb65-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb65-63"><a href="#cb65-63" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="df-für-übersicht-definieren-und-function-ausführen" class="level4" data-number="3.2.7.2">
<h4 data-number="3.2.7.2" class="anchored" data-anchor-id="df-für-übersicht-definieren-und-function-ausführen"><span class="header-section-number">3.2.7.2</span> df für Übersicht definieren und Function ausführen</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Liste der Dataframes</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>df_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"elec_gemeinde_lvl_gemeinde"</span>,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"elec_gemeinde_lvl_kt"</span>,</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">"elec_gemeinde_lvl_state"</span>,</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">"elec_kanton_lvl_kt"</span>,</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">"elec_kanton_lvl_state"</span>,</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>              <span class="st">"elec_nr_sr_lvl_state"</span>)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Übersicht für alle Dataframes erstellen</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (name <span class="cf">in</span> df_names) {</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">df_overview</span>(name)</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>==== elec_gemeinde_lvl_gemeinde ====
Anzahl Zeilen: 4637 
Anzahl Spalten: 5 
Spaltennamen:
[1] "year"        "Gemeinde"    "Partei"      "n_seats_sum" "n_seats_pct"
Zeilen mit Zahlen in 'n_seats_sum' (sortiert):
# A tibble: 4,637 × 5
    year Gemeinde Partei n_seats_sum n_seats_pct
   &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;
 1  2019 Aarau    FDP              2        28.6
 2  2019 Aarau    SP               2        28.6
 3  2019 Aarau    CVP              1        14.3
 4  2019 Aarau    GRÜNE            1        14.3
 5  2019 Aarau    ÜBRIGE           1        14.3
 6  2019 Adliswil FDP              2        28.6
 7  2019 Adliswil ÜBRIGE           2        28.6
 8  2019 Adliswil CVP              1        14.3
 9  2019 Adliswil SP               1        14.3
10  2019 Adliswil SVP              1        14.3
# ℹ 4,627 more rows


==== elec_gemeinde_lvl_kt ====
Anzahl Zeilen: 1083 
Anzahl Spalten: 7 
Spaltennamen:
[1] "year"                 "Kt"                   "Partei"              
[4] "n_seats_sum"          "n_seats_sum_weighted" "n_seats_pct"         
[7] "n_seats_pct_weighted"
Zeilen mit Zahlen in 'n_seats_sum' (sortiert):
# A tibble: 1,083 × 7
    year Kt    Partei n_seats_sum n_seats_sum_weighted n_seats_pct
   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;        &lt;dbl&gt;                &lt;dbl&gt;       &lt;dbl&gt;
 1  2019 AG    FDP             17               247929       25   
 2  2019 AG    ÜBRIGE          15               219033       22.1 
 3  2019 AG    SP              13               200875       19.1 
 4  2019 AG    CVP             11               179675       16.2 
 5  2019 AG    SVP              6                74557        8.82
 6  2019 AG    GRÜNE            4                60825        5.88
 7  2019 AG    GLP              2                25188        2.94
 8  2019 AR    ÜBRIGE           2                31490       28.6 
 9  2019 AR    CVP              1                15745       14.3 
10  2019 AR    EVP              1                15745       14.3 
# ℹ 1,073 more rows
# ℹ 1 more variable: n_seats_pct_weighted &lt;dbl&gt;


==== elec_gemeinde_lvl_state ====
Anzahl Zeilen: 103 
Anzahl Spalten: 6 
Spaltennamen:
[1] "year"                 "Partei"               "n_seats_sum"         
[4] "n_seats_sum_weighted" "n_seats_pct"          "n_seats_pct_weighted"
Zeilen mit Zahlen in 'n_seats_sum' (sortiert):
# A tibble: 103 × 6
    year Partei n_seats_sum n_seats_sum_weighted n_seats_pct
   &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;                &lt;dbl&gt;       &lt;dbl&gt;
 1  2019 FDP            292              6410290      27.7  
 2  2019 SP             220              7087159      20.8  
 3  2019 CVP            162              3380882      15.3  
 4  2019 SVP            131              2152118      12.4  
 5  2019 ÜBRIGE         105              2003701       9.94 
 6  2019 GRÜNE           63              3023756       5.97 
 7  2019 GLP             29              1064924       2.75 
 8  2019 EVP             20               324771       1.89 
 9  2019 CSP              8               122063       0.758
10  2019 BDP              7               127311       0.663
# ℹ 93 more rows
# ℹ 1 more variable: n_seats_pct_weighted &lt;dbl&gt;


==== elec_kanton_lvl_kt ====
Anzahl Zeilen: 3848 
Anzahl Spalten: 5 
Spaltennamen:
[1] "year"        "Kt"          "Partei"      "n_seats_sum" "n_seats_pct"
Zeilen mit Zahlen in 'n_seats_sum' (sortiert):
# A tibble: 3,848 × 5
    year Kt    Partei n_seats_sum n_seats_pct
   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;
 1  2019 AG    SVP              2          40
 2  2019 AG    CVP              1          20
 3  2019 AG    FDP              1          20
 4  2019 AG    SP               1          20
 5  2019 AG    BDP              0           0
 6  2019 AG    CSP              0           0
 7  2019 AG    DEM              0           0
 8  2019 AG    DSP              0           0
 9  2019 AG    EDU              0           0
10  2019 AG    EVP              0           0
# ℹ 3,838 more rows


==== elec_kanton_lvl_state ====
Anzahl Zeilen: 148 
Anzahl Spalten: 7 
Spaltennamen:
[1] "year"                       "Partei"                    
[3] "n_seats_sum"                "n_seats_sum_weighted"      
[5] "stimmberechtigte_avg_state" "n_seats_pct"               
[7] "n_seats_pct_weighted"      
Zeilen mit Zahlen in 'n_seats_sum' (sortiert):
# A tibble: 148 × 7
    year Partei n_seats_sum n_seats_sum_weighted stimmberechtigte_avg_state
   &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;                &lt;dbl&gt;                      &lt;dbl&gt;
 1  2019 FDP             39            211955133                    5434747
 2  2019 CVP             38            206520386                    5434747
 3  2019 SP              30            163042410                    5434747
 4  2019 SVP             24            130433928                    5434747
 5  2019 ÜBRIGE           8             43477976                    5434747
 6  2019 GRÜNE            7             38043229                    5434747
 7  2019 BDP              3             16304241                    5434747
 8  2019 LEGA             2             10869494                    5434747
 9  2019 CSP              1              5434747                    5434747
10  2019 LP               1              5434747                    5434747
# ℹ 138 more rows
# ℹ 2 more variables: n_seats_pct &lt;dbl&gt;, n_seats_pct_weighted &lt;dbl&gt;


==== elec_nr_sr_lvl_state ====
Anzahl Zeilen: 85 
Anzahl Spalten: 4 
Spaltennamen:
[1] "year"        "Partei"      "n_seats_sum" "n_seats_pct"
Zeilen mit Zahlen in 'n_seats_sum' (sortiert):
# A tibble: 85 × 4
    year Partei n_seats_sum n_seats_pct
   &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;
 1  2019 SVP             59      24.0  
 2  2019 SP              48      19.5  
 3  2019 FDP             41      16.7  
 4  2019 CVP             38      15.4  
 5  2019 GRÜNE           33      13.4  
 6  2019 GLP             16       6.50 
 7  2019 BDP              3       1.22 
 8  2019 EVP              3       1.22 
 9  2019 EDU              1       0.407
10  2019 LEGA             1       0.407
# ℹ 75 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="entwicklung-über-die-jahre" class="level3" data-number="3.2.8">
<h3 data-number="3.2.8" class="anchored" data-anchor-id="entwicklung-über-die-jahre"><span class="header-section-number">3.2.8</span> Entwicklung über die Jahre?!</h3>
</section>
</section>
<section id="abstimmungen---daten-laden-umformen" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="abstimmungen---daten-laden-umformen"><span class="header-section-number">3.3</span> Abstimmungen - Daten laden &amp; Umformen</h2>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO: Wofür?</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  </span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # Manuell migrierte Lookup Tabellen aus dem PDF-Codebook (swissvotes.ch) laden</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="co"># # Parteien</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="co"># lookups_codebook_parties &lt;- read_excel("data/lookup_codebook.xlsx",</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        sheet = "parties")</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="co"># # Parteiparolen</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="co"># lookups_codebook_paroles &lt;- read_excel("data/lookup_codebook.xlsx",</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        sheet = "paroles")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="swissvotes-datensatz-mit-abstimmungsdetails-laden" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="swissvotes-datensatz-mit-abstimmungsdetails-laden"><span class="header-section-number">3.3.1</span> Swissvotes-Datensatz mit Abstimmungsdetails laden</h3>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ergbenisse der Schweizweite Abstimmungen laden</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>voting_raw <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"data/abstimmungen_swissvotes_DATASET CSV 09-02-2025.csv"</span>,</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">delim =</span> <span class="st">";"</span>,</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">escape_double =</span> <span class="cn">FALSE</span>,</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">trim_ws =</span> <span class="cn">TRUE</span>,</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Datum formatieren</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>voting_raw <span class="ot">&lt;-</span> voting_raw <span class="sc">%&gt;%</span> </span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">datum =</span> <span class="fu">dmy</span>(datum))</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a><span class="do">##DATUMSFILTER##</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Einträge vor 2019 exkludieren</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>voting_raw_5y <span class="ot">&lt;-</span> voting_raw <span class="sc">%&gt;%</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(datum <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2019-01-01"</span>))</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a><span class="co"># #TODO: Löschen, nicht benötigt?!</span></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a><span class="co"># # Abstimmungsdaten der letzten 5 Jahre in Vektor schreiben für spätere Selektion</span></span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a><span class="co"># voting_5y_dates &lt;- voting_5y %&gt;%</span></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(datum) %&gt;%</span></span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   distinct() %&gt;%</span></span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   pull(datum) %&gt;%</span></span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   as.character()</span></span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Abstimmungen als datatable() anzeigen</span></span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a><span class="co"># datatable(voting_5y,</span></span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a><span class="co">#           class = 'nowrap',</span></span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a><span class="co">#           filter = 'top',</span></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a><span class="co">#           options = list(pageLength = 7,</span></span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a><span class="co">#                          scrollX = TRUE,</span></span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a><span class="co">#                          search = list(regex = TRUE,</span></span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        caseInsensitive = TRUE)))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parteien aus Parolen-Spalten (p- &amp; pdev-..-..) identifizieren</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>lookup_input_party_label_vote <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Block 1: Staatsebene - Mutterparteien, Verbände &amp; weitere Organisationen</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">party_orig_value =</span> <span class="fu">grep</span>(<span class="st">"^p-"</span>,</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">names</span>(voting_raw_5y),</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">value =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">level =</span> <span class="st">"state"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate</span>(</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>      party_orig_value,</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"prefix"</span>, <span class="st">"short_name"</span>, <span class="st">"add_info"</span>),</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">sep =</span> <span class="st">"[-_]"</span>,</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">remove =</span> <span class="cn">FALSE</span>,</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">extra =</span> <span class="st">"merge"</span>,</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">"right"</span>),</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Block 2: Kantonsebene - Jungparteien, Frauensektionen, etc.</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">party_orig_value =</span> <span class="fu">grep</span>(<span class="st">"^pdev-"</span>,</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">names</span>(voting_raw_5y),</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>                               <span class="at">value =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">level =</span> <span class="st">"canton_fraction"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate</span>(</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>      party_orig_value,</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"prefix"</span>, <span class="st">"short_name"</span>, <span class="st">"add_info"</span>),</span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">sep =</span> <span class="st">"[-_]"</span>,</span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">remove =</span> <span class="cn">FALSE</span>,</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">extra =</span> <span class="st">"merge"</span>,</span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">"right"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Großschreibung der short_name-Spalte</span></span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">short_name =</span> <span class="fu">toupper</span>(short_name),</span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">long_name =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">source =</span> <span class="st">"Abstimmungen"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(party_orig_value,</span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a>         short_name,</span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a>         long_name,</span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a>         prefix,</span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a>         add_info,</span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a>         level,</span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a>         source)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="parteinamen-inputs-konsolidieren-auf-vollständigkeit-prüfen" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="parteinamen-inputs-konsolidieren-auf-vollständigkeit-prüfen"><span class="header-section-number">3.3.2</span> Parteinamen Inputs konsolidieren &amp; auf Vollständigkeit prüfen</h3>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parteilabel-Varaianten aus den Input Files (Wahlen &amp; Abstimmungen) konsolidieren</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>lookup_input_party_label_combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  lookup_input_canton_parties_label,</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  lookup_input_gemeinde_parties_label,</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  lookup_input_nr_sr_parties_label,</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  lookup_input_party_label_vote) <span class="sc">%&gt;%</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Abgleich der Parteinamen mit Lookup-Master</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Fehlende Werte mittels Anti-Join in separatem Dataframe speichern</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>lookup_input_party_label_missing_in_master <span class="ot">&lt;-</span> lookup_input_party_label_combined <span class="sc">%&gt;%</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>    lookup_parties_consolidated <span class="sc">%&gt;%</span> <span class="fu">select</span>(party_orig_value),</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"party_orig_value"</span>)</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Ergebnis anzeigen</span></span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(lookup_input_party_label_missing_in_master) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(lookup_input_party_label_missing_in_master)</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Partei Lookup Master ist vollständig"</span>)</span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="clean-up-lookup-obsolete-objekte-nach-konsolidierung-löschen" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="clean-up-lookup-obsolete-objekte-nach-konsolidierung-löschen"><span class="header-section-number">3.3.3</span> Clean-up “lookup”: Obsolete Objekte (nach konsolidierung) löschen</h3>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean-up: Nicht mehr benötigte "lookup" Tabellen löschen</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"^lookup_input"</span>)[       <span class="co"># mit lookup_input starten aber</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>   <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"(_combined|_master)$"</span>,   <span class="co"># nicht mit _combined / all_final enden</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"^lookup_input"</span>))])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="abstimmungsergebnisse-transformieren-ergänzen" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="abstimmungsergebnisse-transformieren-ergänzen"><span class="header-section-number">3.4</span> Abstimmungsergebnisse transformieren &amp; ergänzen</h2>
<section id="transformation-vom-wide-ins-long-format" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="transformation-vom-wide-ins-long-format"><span class="header-section-number">3.4.1</span> Transformation: Vom Wide ins Long Format</h3>
<section id="präfix-spalten-p--pdev---pos-inkl.-parolencluster-transformieren" class="level4" data-number="3.4.1.1">
<h4 data-number="3.4.1.1" class="anchored" data-anchor-id="präfix-spalten-p--pdev---pos-inkl.-parolencluster-transformieren"><span class="header-section-number">3.4.1.1</span> Präfix-Spalten: “p-” / “pdev-” &amp; “-pos” inkl. Parolencluster transformieren</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Spaltennamen extrahieren, die ins Long Format sollen</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>sel_cols <span class="ot">&lt;-</span> <span class="fu">names</span>(voting_raw_5y)[</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grepl</span>(<span class="st">"^p-|^pdev-|(-pos)"</span>,</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">names</span>(voting_raw_5y))</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Spalteninhalte als Charakter definieren</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>voting_raw_5y[sel_cols] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(voting_raw_5y[sel_cols],</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>                                             as.character)</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Wide in Long Format</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>tmp_voting_long <span class="ot">&lt;-</span> voting_raw_5y <span class="sc">%&gt;%</span>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">all_of</span>(sel_cols),</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">names_to =</span> <span class="st">"variable"</span>,</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Table: Lookup für p- und pdev-</span></span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>lookup_parole <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="at">text =</span> <span class="st">'1</span><span class="sc">\t</span><span class="st">parole_Ja</span></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a><span class="st">                                    2</span><span class="sc">\t</span><span class="st">parole_Nein</span></span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a><span class="st">                                    3</span><span class="sc">\t</span><span class="st">parole_keine</span></span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a><span class="st">                                    4</span><span class="sc">\t</span><span class="st">parole_Enthalten</span></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a><span class="st">                                    5</span><span class="sc">\t</span><span class="st">parole_keine</span></span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a><span class="st">                                    8</span><span class="sc">\t</span><span class="st">parole_Gegenentwurf (Stichfrage))</span></span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a><span class="st">                                    9</span><span class="sc">\t</span><span class="st">parole_Volksinitiative (Stichfrage)</span></span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a><span class="st">                                    66</span><span class="sc">\t</span><span class="st">parole_keine</span></span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a><span class="st">                                    .</span><span class="sc">\t</span><span class="st">parole_keine</span></span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a><span class="st">                                    9999</span><span class="sc">\t</span><span class="st">parole_keine</span></span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a><span class="st">                                    </span><span class="sc">\t</span><span class="st">parole_keine'</span>,</span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a>                            <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>,</span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a>                            <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"wert"</span>,</span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"label"</span>),</span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a>                            <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>,</span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a>                            <span class="at">fill =</span> <span class="cn">TRUE</span>,</span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a>                            <span class="at">quote =</span> <span class="st">""</span>)</span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Table: Lookup für -pos</span></span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true" tabindex="-1"></a>lookup_pos <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="at">text =</span> <span class="st">'.</span><span class="sc">\t</span><span class="st">pos_Missing</span></span>
<span id="cb73-37"><a href="#cb73-37" aria-hidden="true" tabindex="-1"></a><span class="st">                                  1</span><span class="sc">\t</span><span class="st">pos_Befürwortend</span></span>
<span id="cb73-38"><a href="#cb73-38" aria-hidden="true" tabindex="-1"></a><span class="st">                                  2</span><span class="sc">\t</span><span class="st">pos_Ablehnend</span></span>
<span id="cb73-39"><a href="#cb73-39" aria-hidden="true" tabindex="-1"></a><span class="st">                                  3</span><span class="sc">\t</span><span class="st">pos_Keine</span></span>
<span id="cb73-40"><a href="#cb73-40" aria-hidden="true" tabindex="-1"></a><span class="st">                                  8</span><span class="sc">\t</span><span class="st">pos_Vorzug Gegenentwurf (bei Stichfragen)</span></span>
<span id="cb73-41"><a href="#cb73-41" aria-hidden="true" tabindex="-1"></a><span class="st">                                  9</span><span class="sc">\t</span><span class="st">pos_Vorzug Volksinitiative (bei Stichfragen)'</span>,</span>
<span id="cb73-42"><a href="#cb73-42" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>,</span>
<span id="cb73-43"><a href="#cb73-43" aria-hidden="true" tabindex="-1"></a>                         <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"wert"</span>,</span>
<span id="cb73-44"><a href="#cb73-44" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"label"</span>),</span>
<span id="cb73-45"><a href="#cb73-45" aria-hidden="true" tabindex="-1"></a>                         <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>,</span>
<span id="cb73-46"><a href="#cb73-46" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fill =</span> <span class="cn">TRUE</span>,</span>
<span id="cb73-47"><a href="#cb73-47" aria-hidden="true" tabindex="-1"></a>                         <span class="at">quote =</span> <span class="st">""</span>)</span>
<span id="cb73-48"><a href="#cb73-48" aria-hidden="true" tabindex="-1"></a>lookup_pos<span class="sc">$</span>wert <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">trimws</span>(lookup_pos<span class="sc">$</span>wert))</span>
<span id="cb73-49"><a href="#cb73-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-50"><a href="#cb73-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-51"><a href="#cb73-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Lookup anwenden (Join)</span></span>
<span id="cb73-52"><a href="#cb73-52" aria-hidden="true" tabindex="-1"></a><span class="co"># value als Character</span></span>
<span id="cb73-53"><a href="#cb73-53" aria-hidden="true" tabindex="-1"></a>lookup_parole<span class="sc">$</span>wert <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">trimws</span>(lookup_parole<span class="sc">$</span>wert))</span>
<span id="cb73-54"><a href="#cb73-54" aria-hidden="true" tabindex="-1"></a>lookup_pos<span class="sc">$</span>wert <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">trimws</span>(lookup_pos<span class="sc">$</span>wert))</span>
<span id="cb73-55"><a href="#cb73-55" aria-hidden="true" tabindex="-1"></a>tmp_voting_long<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">trimws</span>(tmp_voting_long<span class="sc">$</span>value))</span>
<span id="cb73-56"><a href="#cb73-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-57"><a href="#cb73-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Join je nach variable-Typ</span></span>
<span id="cb73-58"><a href="#cb73-58" aria-hidden="true" tabindex="-1"></a>tmp_voting_long <span class="ot">&lt;-</span> tmp_voting_long <span class="sc">%&gt;%</span></span>
<span id="cb73-59"><a href="#cb73-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">trimws</span>(value))  <span class="sc">%&gt;%</span></span>
<span id="cb73-60"><a href="#cb73-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lookup_type =</span> <span class="fu">case_when</span>(<span class="fu">grepl</span>(<span class="st">"^p-|^pdev-"</span>,</span>
<span id="cb73-61"><a href="#cb73-61" aria-hidden="true" tabindex="-1"></a>                                       variable) <span class="sc">~</span> <span class="st">"parole"</span>,</span>
<span id="cb73-62"><a href="#cb73-62" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">grepl</span>(<span class="st">"-pos"</span>,</span>
<span id="cb73-63"><a href="#cb73-63" aria-hidden="true" tabindex="-1"></a>                                       variable) <span class="sc">~</span> <span class="st">"pos"</span>,</span>
<span id="cb73-64"><a href="#cb73-64" aria-hidden="true" tabindex="-1"></a>                                 <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb73-65"><a href="#cb73-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lookup_parole <span class="sc">%&gt;%</span></span>
<span id="cb73-66"><a href="#cb73-66" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rename</span>(<span class="at">label_parole =</span> label),</span>
<span id="cb73-67"><a href="#cb73-67" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"value"</span> <span class="ot">=</span> <span class="st">"wert"</span>),</span>
<span id="cb73-68"><a href="#cb73-68" aria-hidden="true" tabindex="-1"></a>            <span class="at">na_matches =</span> <span class="st">"never"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-69"><a href="#cb73-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lookup_pos <span class="sc">%&gt;%</span></span>
<span id="cb73-70"><a href="#cb73-70" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rename</span>(<span class="at">label_pos =</span> label),</span>
<span id="cb73-71"><a href="#cb73-71" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"value"</span> <span class="ot">=</span> <span class="st">"wert"</span>),</span>
<span id="cb73-72"><a href="#cb73-72" aria-hidden="true" tabindex="-1"></a>            <span class="at">na_matches =</span> <span class="st">"never"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-73"><a href="#cb73-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">case_when</span>(lookup_type <span class="sc">==</span> <span class="st">"parole"</span> <span class="sc">~</span> label_parole,</span>
<span id="cb73-74"><a href="#cb73-74" aria-hidden="true" tabindex="-1"></a>                           lookup_type <span class="sc">==</span> <span class="st">"pos"</span> <span class="sc">~</span> label_pos,</span>
<span id="cb73-75"><a href="#cb73-75" aria-hidden="true" tabindex="-1"></a>                           <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb73-76"><a href="#cb73-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>label_parole,</span>
<span id="cb73-77"><a href="#cb73-77" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>label_pos,</span>
<span id="cb73-78"><a href="#cb73-78" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>lookup_type)</span>
<span id="cb73-79"><a href="#cb73-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-80"><a href="#cb73-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-81"><a href="#cb73-81" aria-hidden="true" tabindex="-1"></a><span class="co"># NA korrigeren (= keine Meinung/Empfehlung)</span></span>
<span id="cb73-82"><a href="#cb73-82" aria-hidden="true" tabindex="-1"></a>tmp_voting_long <span class="ot">&lt;-</span> tmp_voting_long <span class="sc">%&gt;%</span></span>
<span id="cb73-83"><a href="#cb73-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">case_when</span>(</span>
<span id="cb73-84"><a href="#cb73-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(label) <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">"^p-|^pdev-"</span>, variable) <span class="sc">~</span> <span class="st">"parole_keine"</span>,</span>
<span id="cb73-85"><a href="#cb73-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(label) <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">"-pos"</span>, variable)       <span class="sc">~</span> <span class="st">"pos_keine"</span>,</span>
<span id="cb73-86"><a href="#cb73-86" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span>                                         <span class="sc">~</span> label))</span>
<span id="cb73-87"><a href="#cb73-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-88"><a href="#cb73-88" aria-hidden="true" tabindex="-1"></a><span class="co"># One-Hot-Encoding (Dummy-Codierung)</span></span>
<span id="cb73-89"><a href="#cb73-89" aria-hidden="true" tabindex="-1"></a>tmp_voting_long<span class="sc">$</span>dummy <span class="ot">&lt;-</span> <span class="dv">1</span>L</span>
<span id="cb73-90"><a href="#cb73-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-91"><a href="#cb73-91" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivotieren: Jede label-Ausprägung wird eigene Spalte, 1 falls zutreffend, sonst 0</span></span>
<span id="cb73-92"><a href="#cb73-92" aria-hidden="true" tabindex="-1"></a>tmp_voting_wide <span class="ot">&lt;-</span> tmp_voting_long <span class="sc">%&gt;%</span></span>
<span id="cb73-93"><a href="#cb73-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb73-94"><a href="#cb73-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(tmp_voting_long), <span class="fu">c</span>(<span class="st">"value"</span>, <span class="st">"label"</span>, <span class="st">"dummy"</span>)),</span>
<span id="cb73-95"><a href="#cb73-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> label,</span>
<span id="cb73-96"><a href="#cb73-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> dummy,</span>
<span id="cb73-97"><a href="#cb73-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_fill =</span> <span class="dv">0</span>)</span>
<span id="cb73-98"><a href="#cb73-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-99"><a href="#cb73-99" aria-hidden="true" tabindex="-1"></a>voting_5y_long <span class="ot">&lt;-</span> tmp_voting_wide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="parteinamen-ergänzen-zeilen-mit--pos-endung-entfernen" class="level4" data-number="3.4.1.2">
<h4 data-number="3.4.1.2" class="anchored" data-anchor-id="parteinamen-ergänzen-zeilen-mit--pos-endung-entfernen"><span class="header-section-number">3.4.1.2</span> Parteinamen ergänzen &amp; Zeilen mit “-pos”-Endung entfernen</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>tmp_voting_5y_long <span class="ot">&lt;-</span> voting_5y_long <span class="sc">%&gt;%</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Zeilen mit "-pos" in Spalte "variable" herausfiltern </span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(variable, <span class="st">"-pos$"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lookup_parties_consolidated <span class="sc">%&gt;%</span> <span class="fu">select</span>(party_orig_value,</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>                                                   Partei),</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"variable"</span> <span class="ot">=</span> <span class="st">"party_orig_value"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">relocate</span>(Partei, <span class="at">.after =</span> variable)</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>voting_5y_long <span class="ot">&lt;-</span> tmp_voting_5y_long</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(tmp_voting_5y_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="parteistärken-ergänzen" class="level4" data-number="3.4.1.3">
<h4 data-number="3.4.1.3" class="anchored" data-anchor-id="parteistärken-ergänzen"><span class="header-section-number">3.4.1.3</span> Parteistärken ergänzen</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># "year" in Quellen as.numeric() definieren</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>elec_nr_sr_lvl_state <span class="ot">&lt;-</span> elec_nr_sr_lvl_state <span class="sc">%&gt;%</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year))</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>elec_kanton_lvl_state <span class="ot">&lt;-</span> elec_kanton_lvl_state <span class="sc">%&gt;%</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year))</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>elec_gemeinde_lvl_state <span class="ot">&lt;-</span> elec_gemeinde_lvl_state <span class="sc">%&gt;%</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year))</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Parteistärken (Staatsebene) dazu laden</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>voting_5y_long_strength <span class="ot">&lt;-</span> voting_5y_long <span class="sc">%&gt;%</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"^pdev-"</span>, variable)) <span class="sc">%&gt;%</span>      <span class="co"># pdev- ausschliessen</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">year</span>(datum))) <span class="sc">%&gt;%</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(anr, year, Partei, annahme, parole_Ja, parole_Nein, parole_keine) <span class="sc">%&gt;%</span> </span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># National- und Ständerat</span></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(elec_nr_sr_lvl_state <span class="sc">%&gt;%</span> <span class="fu">select</span>(year,</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>                                            Partei,</span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>                                            n_seats_sum,</span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>                                            n_seats_pct) <span class="sc">%&gt;%</span></span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rename</span>(<span class="at">n_seats_state =</span> n_seats_sum,</span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n_seats_pct_state =</span> n_seats_pct),</span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>,</span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Partei"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Kanton</span></span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(elec_kanton_lvl_state <span class="sc">%&gt;%</span> <span class="fu">select</span>(year,</span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a>                                            Partei,</span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a>                                            n_seats_sum,</span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a>                                            n_seats_pct,</span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a>                                            n_seats_sum_weighted,</span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a>                                            n_seats_pct_weighted) <span class="sc">%&gt;%</span></span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rename</span>(<span class="at">n_seats_kanton =</span> n_seats_sum,</span>
<span id="cb75-32"><a href="#cb75-32" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n_seats_pct_kanton =</span> n_seats_pct,</span>
<span id="cb75-33"><a href="#cb75-33" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n_seats_sum_weighted_kt =</span> n_seats_sum_weighted,</span>
<span id="cb75-34"><a href="#cb75-34" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n_seats_pct_weighted_kt =</span> n_seats_pct_weighted),</span>
<span id="cb75-35"><a href="#cb75-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"Partei"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb75-36"><a href="#cb75-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Gemeinde</span></span>
<span id="cb75-37"><a href="#cb75-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(elec_gemeinde_lvl_state <span class="sc">%&gt;%</span> <span class="fu">select</span>(year,</span>
<span id="cb75-38"><a href="#cb75-38" aria-hidden="true" tabindex="-1"></a>                                               Partei,</span>
<span id="cb75-39"><a href="#cb75-39" aria-hidden="true" tabindex="-1"></a>                                               n_seats_sum,</span>
<span id="cb75-40"><a href="#cb75-40" aria-hidden="true" tabindex="-1"></a>                                               n_seats_pct,</span>
<span id="cb75-41"><a href="#cb75-41" aria-hidden="true" tabindex="-1"></a>                                               n_seats_sum_weighted,</span>
<span id="cb75-42"><a href="#cb75-42" aria-hidden="true" tabindex="-1"></a>                                               n_seats_pct_weighted) <span class="sc">%&gt;%</span></span>
<span id="cb75-43"><a href="#cb75-43" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rename</span>(<span class="at">n_seats_gemeinde =</span> n_seats_sum,</span>
<span id="cb75-44"><a href="#cb75-44" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n_seats_pct_gemeinde =</span> n_seats_pct,</span>
<span id="cb75-45"><a href="#cb75-45" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n_seats_sum_weighted_gemeinde =</span> n_seats_sum_weighted,</span>
<span id="cb75-46"><a href="#cb75-46" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n_seats_pct_weighted_gemeinde =</span> n_seats_pct_weighted),</span>
<span id="cb75-47"><a href="#cb75-47" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"Partei"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb75-48"><a href="#cb75-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Partei)) <span class="sc">%&gt;%</span></span>
<span id="cb75-49"><a href="#cb75-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prozentwerte pro anr/year normieren (Für noch enthaltene Parteien)</span></span>
<span id="cb75-50"><a href="#cb75-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(anr, year) <span class="sc">%&gt;%</span></span>
<span id="cb75-51"><a href="#cb75-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_seats_pct_state_norm =</span></span>
<span id="cb75-52"><a href="#cb75-52" aria-hidden="true" tabindex="-1"></a>           n_seats_pct_state <span class="sc">/</span> <span class="fu">sum</span>(n_seats_pct_state,</span>
<span id="cb75-53"><a href="#cb75-53" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-54"><a href="#cb75-54" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_seats_pct_weighted_kt_norm =</span></span>
<span id="cb75-55"><a href="#cb75-55" aria-hidden="true" tabindex="-1"></a>           n_seats_pct_weighted_kt <span class="sc">/</span> <span class="fu">sum</span>(n_seats_pct_weighted_kt,</span>
<span id="cb75-56"><a href="#cb75-56" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-57"><a href="#cb75-57" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_seats_pct_weighted_gemeinde_norm =</span></span>
<span id="cb75-58"><a href="#cb75-58" aria-hidden="true" tabindex="-1"></a>           n_seats_pct_weighted_gemeinde <span class="sc">/</span> <span class="fu">sum</span>(n_seats_pct_weighted_gemeinde,</span>
<span id="cb75-59"><a href="#cb75-59" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb75-60"><a href="#cb75-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb75-61"><a href="#cb75-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-62"><a href="#cb75-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-63"><a href="#cb75-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Parteistärke anwenden und aufsummieren</span></span>
<span id="cb75-64"><a href="#cb75-64" aria-hidden="true" tabindex="-1"></a><span class="co"># # tmp</span></span>
<span id="cb75-65"><a href="#cb75-65" aria-hidden="true" tabindex="-1"></a><span class="co"># voting_5y_long_strength_with_seats &lt;- voting_5y_long_strength %&gt;% </span></span>
<span id="cb75-66"><a href="#cb75-66" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(n_seats_state &gt; 0 |</span></span>
<span id="cb75-67"><a href="#cb75-67" aria-hidden="true" tabindex="-1"></a><span class="co">#          n_seats_kanton &gt; 0 |</span></span>
<span id="cb75-68"><a href="#cb75-68" aria-hidden="true" tabindex="-1"></a><span class="co">#          n_seats_gemeinde &gt; 0)</span></span>
<span id="cb75-69"><a href="#cb75-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-70"><a href="#cb75-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Neue Spalten mit den gewichteten Parolen berechnen (mit den normierten Prozentwerten)</span></span>
<span id="cb75-71"><a href="#cb75-71" aria-hidden="true" tabindex="-1"></a>voting_5y_long_strength_wtd <span class="ot">&lt;-</span> voting_5y_long_strength <span class="sc">%&gt;%</span></span>
<span id="cb75-72"><a href="#cb75-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb75-73"><a href="#cb75-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">parole_Nein_wtd_state     =</span> parole_Nein   <span class="sc">*</span> n_seats_pct_state_norm,</span>
<span id="cb75-74"><a href="#cb75-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">parole_Ja_wtd_state       =</span> parole_Ja     <span class="sc">*</span> n_seats_pct_state_norm,</span>
<span id="cb75-75"><a href="#cb75-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">parole_Keine_wtd_state    =</span> parole_keine  <span class="sc">*</span> n_seats_pct_state_norm,</span>
<span id="cb75-76"><a href="#cb75-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-77"><a href="#cb75-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">parole_Nein_wtd_kt        =</span> parole_Nein   <span class="sc">*</span> n_seats_pct_weighted_kt_norm,</span>
<span id="cb75-78"><a href="#cb75-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">parole_Ja_wtd_kt          =</span> parole_Ja     <span class="sc">*</span> n_seats_pct_weighted_kt_norm,</span>
<span id="cb75-79"><a href="#cb75-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">parole_Keine_wtd_kt       =</span> parole_keine  <span class="sc">*</span> n_seats_pct_weighted_kt_norm,</span>
<span id="cb75-80"><a href="#cb75-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-81"><a href="#cb75-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">parole_Nein_wtd_gem       =</span> parole_Nein   <span class="sc">*</span> n_seats_pct_weighted_gemeinde_norm,</span>
<span id="cb75-82"><a href="#cb75-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">parole_Ja_wtd_gem         =</span> parole_Ja     <span class="sc">*</span> n_seats_pct_weighted_gemeinde_norm,</span>
<span id="cb75-83"><a href="#cb75-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">parole_Keine_wtd_gem      =</span> parole_keine  <span class="sc">*</span> n_seats_pct_weighted_gemeinde_norm)</span>
<span id="cb75-84"><a href="#cb75-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-85"><a href="#cb75-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Gruppieren und aufsummieren nach anr und year</span></span>
<span id="cb75-86"><a href="#cb75-86" aria-hidden="true" tabindex="-1"></a>voting_5y_long_strength_wtd_summary <span class="ot">&lt;-</span> voting_5y_long_strength_wtd <span class="sc">%&gt;%</span></span>
<span id="cb75-87"><a href="#cb75-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(anr, year, annahme) <span class="sc">%&gt;%</span></span>
<span id="cb75-88"><a href="#cb75-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb75-89"><a href="#cb75-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_parole_Nein       =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(parole_Nein_wtd_state, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-90"><a href="#cb75-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_parole_Ja         =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(parole_Ja_wtd_state, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-91"><a href="#cb75-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_parole_Keine      =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(parole_Keine_wtd_state, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-92"><a href="#cb75-92" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-93"><a href="#cb75-93" aria-hidden="true" tabindex="-1"></a>    <span class="at">kt_parole_Nein          =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(parole_Nein_wtd_kt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-94"><a href="#cb75-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">kt_parole_Ja            =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(parole_Ja_wtd_kt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-95"><a href="#cb75-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">kt_parole_Keine         =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(parole_Keine_wtd_kt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-96"><a href="#cb75-96" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-97"><a href="#cb75-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">gemeinde_parole_Nein    =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(parole_Nein_wtd_gem, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-98"><a href="#cb75-98" aria-hidden="true" tabindex="-1"></a>    <span class="at">gemeinde_parole_Ja      =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(parole_Ja_wtd_gem, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-99"><a href="#cb75-99" aria-hidden="true" tabindex="-1"></a>    <span class="at">gemeinde_parole_Keine   =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(parole_Keine_wtd_gem, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-100"><a href="#cb75-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb75-101"><a href="#cb75-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-102"><a href="#cb75-102" aria-hidden="true" tabindex="-1"></a><span class="co"># Kontrolle:  Summen = 100 ?</span></span>
<span id="cb75-103"><a href="#cb75-103" aria-hidden="true" tabindex="-1"></a>voting_5y_long_strength_wtd_summary <span class="sc">%&gt;%</span></span>
<span id="cb75-104"><a href="#cb75-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parole_sum =</span> </span>
<span id="cb75-105"><a href="#cb75-105" aria-hidden="true" tabindex="-1"></a>           state_parole_Nein <span class="sc">+</span> state_parole_Ja <span class="sc">+</span> state_parole_Keine) <span class="sc">%&gt;%</span></span>
<span id="cb75-106"><a href="#cb75-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(anr, year, parole_sum) <span class="sc">%&gt;%</span> </span>
<span id="cb75-107"><a href="#cb75-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(parole_sum))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 52 × 3
     anr  year parole_sum
   &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
 1   626  2019        100
 2   637  2020        100
 3   627  2019        100
 4   628  2019        100
 5   630  2020        100
 6   631  2020        100
 7   633  2020        100
 8   634  2020        100
 9   636  2020        100
10   638  2021        100
# ℹ 42 more rows</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write_xlsx(voting_5y_long_strength_wtd_summary, "tmp_voting_5y_long_strength_wtd_summary.xlsx")</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO: Clean-up "voting" tabellen</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="spalten-ergänzen-aus-urprungsfile" class="level4" data-number="3.4.1.4">
<h4 data-number="3.4.1.4" class="anchored" data-anchor-id="spalten-ergänzen-aus-urprungsfile"><span class="header-section-number">3.4.1.4</span> Spalten ergänzen (aus Urprungsfile)</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(voting_5y_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [25,844 × 380] (S3: tbl_df/tbl/data.frame)
 $ anr                : num [1:25844] 626 626 626 626 626 626 626 626 626 626 ...
 $ datum              : Date[1:25844], format: "2019-02-10" "2019-02-10" ...
 $ titel_kurz_d       : chr [1:25844] "Zersiedelungsinitiative" "Zersiedelungsinitiative" "Zersiedelungsinitiative" "Zersiedelungsinitiative" ...
 $ titel_kurz_f       : chr [1:25844] "Initiative contre le mitage" "Initiative contre le mitage" "Initiative contre le mitage" "Initiative contre le mitage" ...
 $ titel_kurz_e       : chr [1:25844] "Initiative against urban sprawl" "Initiative against urban sprawl" "Initiative against urban sprawl" "Initiative against urban sprawl" ...
 $ titel_off_d        : chr [1:25844] "Volksinitiative «Zersiedelung stoppen – für eine nachhaltige Siedlungsentwicklung (Zersiedelungsinitiative)»" "Volksinitiative «Zersiedelung stoppen – für eine nachhaltige Siedlungsentwicklung (Zersiedelungsinitiative)»" "Volksinitiative «Zersiedelung stoppen – für eine nachhaltige Siedlungsentwicklung (Zersiedelungsinitiative)»" "Volksinitiative «Zersiedelung stoppen – für eine nachhaltige Siedlungsentwicklung (Zersiedelungsinitiative)»" ...
 $ titel_off_f        : chr [1:25844] "Initiative populaire «Stopper le mitage – pour un développement durable du milieu bâti (initiative contre le mitage)»" "Initiative populaire «Stopper le mitage – pour un développement durable du milieu bâti (initiative contre le mitage)»" "Initiative populaire «Stopper le mitage – pour un développement durable du milieu bâti (initiative contre le mitage)»" "Initiative populaire «Stopper le mitage – pour un développement durable du milieu bâti (initiative contre le mitage)»" ...
 $ stichwort          : chr [1:25844] "." "." "." "." ...
 $ swissvoteslink     : chr [1:25844] "https://swissvotes.ch/vote/626.00" "https://swissvotes.ch/vote/626.00" "https://swissvotes.ch/vote/626.00" "https://swissvotes.ch/vote/626.00" ...
 $ anzahl             : num [1:25844] 1 1 1 1 1 1 1 1 1 1 ...
 $ rechtsform         : num [1:25844] 3 3 3 3 3 3 3 3 3 3 ...
 $ init_formul        : num [1:25844] 1 1 1 1 1 1 1 1 1 1 ...
 $ kurzbetitel        : chr [1:25844] "Volk und Stände wollen keine starre Bauzonenobergrenze" "Volk und Stände wollen keine starre Bauzonenobergrenze" "Volk und Stände wollen keine starre Bauzonenobergrenze" "Volk und Stände wollen keine starre Bauzonenobergrenze" ...
 $ anneepolitique     : chr [1:25844] "https://anneepolitique.swiss/prozesse/58251" "https://anneepolitique.swiss/prozesse/58251" "https://anneepolitique.swiss/prozesse/58251" "https://anneepolitique.swiss/prozesse/58251" ...
 $ bkchrono-de        : chr [1:25844] "https://www.bk.admin.ch/ch/d/pore/vi/vis461.html" "https://www.bk.admin.ch/ch/d/pore/vi/vis461.html" "https://www.bk.admin.ch/ch/d/pore/vi/vis461.html" "https://www.bk.admin.ch/ch/d/pore/vi/vis461.html" ...
 $ bkchrono-fr        : chr [1:25844] "https://www.bk.admin.ch/ch/f/pore/vi/vis461.html" "https://www.bk.admin.ch/ch/f/pore/vi/vis461.html" "https://www.bk.admin.ch/ch/f/pore/vi/vis461.html" "https://www.bk.admin.ch/ch/f/pore/vi/vis461.html" ...
 $ d1e1               : num [1:25844] 9 9 9 9 9 9 9 9 9 9 ...
 $ d1e2               : chr [1:25844] "9.1" "9.1" "9.1" "9.1" ...
 $ d1e3               : chr [1:25844] "9.11" "9.11" "9.11" "9.11" ...
 $ d2e1               : chr [1:25844] "." "." "." "." ...
 $ d2e2               : chr [1:25844] "." "." "." "." ...
 $ d2e3               : chr [1:25844] "." "." "." "." ...
 $ d3e1               : chr [1:25844] "." "." "." "." ...
 $ d3e2               : chr [1:25844] "." "." "." "." ...
 $ d3e3               : chr [1:25844] "." "." "." "." ...
 $ dep                : chr [1:25844] "7" "7" "7" "7" ...
 $ legislatur         : num [1:25844] 50 50 50 50 50 50 50 50 50 50 ...
 $ legisjahr          : chr [1:25844] "2015-2019" "2015-2019" "2015-2019" "2015-2019" ...
 $ gesch_nr           : chr [1:25844] "17.063" "17.063" "17.063" "17.063" ...
 $ entwurf_nr         : num [1:25844] 1 1 1 1 1 1 1 1 1 1 ...
 $ curiavista-de      : chr [1:25844] "https://www.parlament.ch/de/ratsbetrieb/suche-curia-vista/geschaeft?AffairId=20170063" "https://www.parlament.ch/de/ratsbetrieb/suche-curia-vista/geschaeft?AffairId=20170063" "https://www.parlament.ch/de/ratsbetrieb/suche-curia-vista/geschaeft?AffairId=20170063" "https://www.parlament.ch/de/ratsbetrieb/suche-curia-vista/geschaeft?AffairId=20170063" ...
 $ curiavista-fr      : chr [1:25844] "https://www.parlament.ch/fr/ratsbetrieb/suche-curia-vista/geschaeft?AffairId=20170063" "https://www.parlament.ch/fr/ratsbetrieb/suche-curia-vista/geschaeft?AffairId=20170063" "https://www.parlament.ch/fr/ratsbetrieb/suche-curia-vista/geschaeft?AffairId=20170063" "https://www.parlament.ch/fr/ratsbetrieb/suche-curia-vista/geschaeft?AffairId=20170063" ...
 $ pa-iv              : num [1:25844] 0 0 0 0 0 0 0 0 0 0 ...
 $ nrja               : chr [1:25844] "37" "37" "37" "37" ...
 $ nrnein             : chr [1:25844] "143" "143" "143" "143" ...
 $ srja               : chr [1:25844] "3" "3" "3" "3" ...
 $ srnein             : chr [1:25844] "34" "34" "34" "34" ...
 $ dat-preexam        : chr [1:25844] "07.04.2015" "07.04.2015" "07.04.2015" "07.04.2015" ...
 $ dat-start          : chr [1:25844] "21.04.2015" "21.04.2015" "21.04.2015" "21.04.2015" ...
 $ dat-limit          : chr [1:25844] "21.10.2016" "21.10.2016" "21.10.2016" "21.10.2016" ...
 $ sammelfrist        : num [1:25844] 549 549 549 549 549 549 549 549 549 549 ...
 $ unter-quorum       : chr [1:25844] "100’000" "100’000" "100’000" "100’000" ...
 $ dat-submit         : chr [1:25844] "21.10.2016" "21.10.2016" "21.10.2016" "21.10.2016" ...
 $ dat-success        : chr [1:25844] "29.11.2016" "29.11.2016" "29.11.2016" "29.11.2016" ...
 $ dat-message        : chr [1:25844] "11.10.2017" "11.10.2017" "11.10.2017" "11.10.2017" ...
 $ dat-parl           : chr [1:25844] "15.06.2018" "15.06.2018" "15.06.2018" "15.06.2018" ...
 $ dat-force          : chr [1:25844] "0" "0" "0" "0" ...
 $ dauer_bv           : chr [1:25844] "247" "247" "247" "247" ...
 $ dauer_abst         : chr [1:25844] "240" "240" "240" "240" ...
 $ i-dauer_tot        : chr [1:25844] "842" "842" "842" "842" ...
 $ i-dauer_samm       : chr [1:25844] "549" "549" "549" "549" ...
 $ i-dauer_br         : chr [1:25844] "355" "355" "355" "355" ...
 $ fr-dauer_samm      : chr [1:25844] "." "." "." "." ...
 $ fr-dauer_tot       : chr [1:25844] "." "." "." "." ...
 $ unter_g            : chr [1:25844] "113216" "113216" "113216" "113216" ...
 $ unter_u            : chr [1:25844] "212" "212" "212" "212" ...
 $ sammeltempo        : chr [1:25844] "206" "206" "206" "206" ...
 $ sparedays          : chr [1:25844] "0" "0" "0" "0" ...
 $ urheber            : chr [1:25844] "Junge Grüne" "Junge Grüne" "Junge Grüne" "Junge Grüne" ...
 $ urheber-fr         : chr [1:25844] "Jeunes Vert-e-s" "Jeunes Vert-e-s" "Jeunes Vert-e-s" "Jeunes Vert-e-s" ...
 $ info_br-de         : chr [1:25844] "https://web.archive.org/web/20190124203413/https://www.admin.ch/gov/de/start/dokumentation/abstimmungen/2019021"| __truncated__ "https://web.archive.org/web/20190124203413/https://www.admin.ch/gov/de/start/dokumentation/abstimmungen/2019021"| __truncated__ "https://web.archive.org/web/20190124203413/https://www.admin.ch/gov/de/start/dokumentation/abstimmungen/2019021"| __truncated__ "https://web.archive.org/web/20190124203413/https://www.admin.ch/gov/de/start/dokumentation/abstimmungen/2019021"| __truncated__ ...
 $ info_br-fr         : chr [1:25844] "https://web.archive.org/web/20190117231207/https://www.admin.ch/gov/fr/accueil/documentation/votations/20190210"| __truncated__ "https://web.archive.org/web/20190117231207/https://www.admin.ch/gov/fr/accueil/documentation/votations/20190210"| __truncated__ "https://web.archive.org/web/20190117231207/https://www.admin.ch/gov/fr/accueil/documentation/votations/20190210"| __truncated__ "https://web.archive.org/web/20190117231207/https://www.admin.ch/gov/fr/accueil/documentation/votations/20190210"| __truncated__ ...
 $ info_br-en         : chr [1:25844] "." "." "." "." ...
 $ info_dep-de        : chr [1:25844] "." "." "." "." ...
 $ info_dep-fr        : chr [1:25844] "." "." "." "." ...
 $ info_dep-en        : chr [1:25844] NA NA NA NA ...
 $ info_amt-de        : chr [1:25844] NA NA NA NA ...
 $ info_amt-fr        : chr [1:25844] NA NA NA NA ...
 $ info_amt-en        : chr [1:25844] NA NA NA NA ...
 $ easyvideo_de       : chr [1:25844] "https://www.youtube.com/watch?v=qoIRWl5oItw" "https://www.youtube.com/watch?v=qoIRWl5oItw" "https://www.youtube.com/watch?v=qoIRWl5oItw" "https://www.youtube.com/watch?v=qoIRWl5oItw" ...
 $ easyvideo_fr       : chr [1:25844] "https://www.youtube.com/watch?v=EONHAANjv9s" "https://www.youtube.com/watch?v=EONHAANjv9s" "https://www.youtube.com/watch?v=EONHAANjv9s" "https://www.youtube.com/watch?v=EONHAANjv9s" ...
 $ web-yes-1-de       : chr [1:25844] NA NA NA NA ...
 $ web-yes-1-fr       : chr [1:25844] NA NA NA NA ...
 $ web-yes-2-de       : chr [1:25844] NA NA NA NA ...
 $ web-yes-2-fr       : chr [1:25844] NA NA NA NA ...
 $ web-yes-3-de       : chr [1:25844] NA NA NA NA ...
 $ web-yes-3-fr       : chr [1:25844] NA NA NA NA ...
 $ web-no-1-de        : chr [1:25844] NA NA NA NA ...
 $ web-no-1-fr        : chr [1:25844] NA NA NA NA ...
 $ web-no-2-de        : chr [1:25844] NA NA NA NA ...
 $ web-no-2-fr        : chr [1:25844] NA NA NA NA ...
 $ web-no-3-de        : chr [1:25844] NA NA NA NA ...
 $ web-no-3-fr        : chr [1:25844] NA NA NA NA ...
 $ nr-wahl            : chr [1:25844] "2015" "2015" "2015" "2015" ...
 $ w-fdp              : chr [1:25844] "16.40" "16.40" "16.40" "16.40" ...
 $ w-sp               : chr [1:25844] "18.80" "18.80" "18.80" "18.80" ...
 $ w-svp              : chr [1:25844] "29.40" "29.40" "29.40" "29.40" ...
 $ w-mitte            : chr [1:25844] "." "." "." "." ...
 $ w-evp              : chr [1:25844] "1.90" "1.90" "1.90" "1.90" ...
 $ w-gps              : chr [1:25844] "7.10" "7.10" "7.10" "7.10" ...
 $ w-glp              : chr [1:25844] "4.60" "4.60" "4.60" "4.60" ...
 $ w-csp              : chr [1:25844] "0.20" "0.20" "0.20" "0.20" ...
 $ w-pda              : chr [1:25844] "0.90" "0.90" "0.90" "0.90" ...
 $ w-sd               : chr [1:25844] "0.10" "0.10" "0.10" "0.10" ...
 $ w-edu              : chr [1:25844] "1.20" "1.20" "1.20" "1.20" ...
 $ w-fps              : chr [1:25844] "0.00" "0.00" "0.00" "0.00" ...
 $ w-lega             : chr [1:25844] "1.00" "1.00" "1.00" "1.00" ...
 $ w-kvp              : chr [1:25844] "." "." "." "." ...
 $ w-mcg              : chr [1:25844] "0.30" "0.30" "0.30" "0.30" ...
  [list output truncated]</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(voting_5y_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "anr"                 "datum"               "titel_kurz_d"       
  [4] "titel_kurz_f"        "titel_kurz_e"        "titel_off_d"        
  [7] "titel_off_f"         "stichwort"           "swissvoteslink"     
 [10] "anzahl"              "rechtsform"          "init_formul"        
 [13] "kurzbetitel"         "anneepolitique"      "bkchrono-de"        
 [16] "bkchrono-fr"         "d1e1"                "d1e2"               
 [19] "d1e3"                "d2e1"                "d2e2"               
 [22] "d2e3"                "d3e1"                "d3e2"               
 [25] "d3e3"                "dep"                 "legislatur"         
 [28] "legisjahr"           "gesch_nr"            "entwurf_nr"         
 [31] "curiavista-de"       "curiavista-fr"       "pa-iv"              
 [34] "nrja"                "nrnein"              "srja"               
 [37] "srnein"              "dat-preexam"         "dat-start"          
 [40] "dat-limit"           "sammelfrist"         "unter-quorum"       
 [43] "dat-submit"          "dat-success"         "dat-message"        
 [46] "dat-parl"            "dat-force"           "dauer_bv"           
 [49] "dauer_abst"          "i-dauer_tot"         "i-dauer_samm"       
 [52] "i-dauer_br"          "fr-dauer_samm"       "fr-dauer_tot"       
 [55] "unter_g"             "unter_u"             "sammeltempo"        
 [58] "sparedays"           "urheber"             "urheber-fr"         
 [61] "info_br-de"          "info_br-fr"          "info_br-en"         
 [64] "info_dep-de"         "info_dep-fr"         "info_dep-en"        
 [67] "info_amt-de"         "info_amt-fr"         "info_amt-en"        
 [70] "easyvideo_de"        "easyvideo_fr"        "web-yes-1-de"       
 [73] "web-yes-1-fr"        "web-yes-2-de"        "web-yes-2-fr"       
 [76] "web-yes-3-de"        "web-yes-3-fr"        "web-no-1-de"        
 [79] "web-no-1-fr"         "web-no-2-de"         "web-no-2-fr"        
 [82] "web-no-3-de"         "web-no-3-fr"         "nr-wahl"            
 [85] "w-fdp"               "w-sp"                "w-svp"              
 [88] "w-mitte"             "w-evp"               "w-gps"              
 [91] "w-glp"               "w-csp"               "w-pda"              
 [94] "w-sd"                "w-edu"               "w-fps"              
 [97] "w-lega"              "w-kvp"               "w-mcg"              
[100] "w-cvp"               "w-bdp"               "w-lps"              
[103] "w-ldu"               "w-poch"              "w-rep"              
[106] "w-ubrige"            "ja-lager"            "nein-lager"         
[109] "keinepar-summe"      "leer-summe"          "freigabe-summe"     
[112] "unbekannt-summe"     "neutral-summe"       "poster_ja_mfg"      
[115] "poster_nein_mfg"     "poster_ja_sa"        "poster_nein_sa"     
[118] "poster_ja_bs"        "poster_nein_bs"      "inserate-total"     
[121] "inserate-je-ausgabe" "inserate-ja"         "inserate-nein"      
[124] "inserate-neutral"    "inserate-jaanteil"   "mediares-tot"       
[127] "mediares-d"          "mediares-f"          "mediaton-tot"       
[130] "mediaton-d"          "mediaton-f"          "finanz-link-de"     
[133] "finanz-link-fr"      "finanz-ja-tot"       "finanz-ja-gr-de"    
[136] "finanz-ja-gr-fr"     "finanz-nein-tot"     "finanz-nein-gr-de"  
[139] "finanz-nein-gr-fr"   "volk"                "stand"              
[142] "annahme"             "berecht"             "stimmen"            
[145] "bet"                 "leer"                "ungultig"           
[148] "gultig"              "volkja"              "volknein"           
[151] "volkja-proz"         "kt-ja"               "kt-nein"            
[154] "ktjaproz"            "zh-berecht"          "zh-stimmen"         
[157] "zh-bet"              "zh-gultig"           "zh-ja"              
[160] "zh-nein"             "zh-japroz"           "zh-annahme"         
[163] "be-berecht"          "be-stimmen"          "be-bet"             
[166] "be-gultig"           "be-ja"               "be-nein"            
[169] "be-japroz"           "be-annahme"          "lu-berecht"         
[172] "lu-stimmen"          "lu-bet"              "lu-gultig"          
[175] "lu-ja"               "lu-nein"             "lu-japroz"          
[178] "lu-annahme"          "ur-berecht"          "ur-stimmen"         
[181] "ur-bet"              "ur-gultig"           "ur-ja"              
[184] "ur-nein"             "ur-japroz"           "ur-annahme"         
[187] "sz-berecht"          "sz-stimmen"          "sz-bet"             
[190] "sz-gultig"           "sz-ja"               "sz-nein"            
[193] "sz-japroz"           "sz-annahme"          "ow-berecht"         
[196] "ow-stimmen"          "ow-bet"              "ow-gultig"          
[199] "ow-ja"               "ow-nein"             "ow-japroz"          
[202] "ow-annahme"          "nw-berecht"          "nw-stimmen"         
[205] "nw-bet"              "nw-gultig"           "nw-ja"              
[208] "nw-nein"             "nw-japroz"           "nw-annahme"         
[211] "gl-berecht"          "gl-stimmen"          "gl-bet"             
[214] "gl-gultig"           "gl-ja"               "gl-nein"            
[217] "gl-japroz"           "gl-annahme"          "zg-berecht"         
[220] "zg-stimmen"          "zg-bet"              "zg-gultig"          
[223] "zg-ja"               "zg-nein"             "zg-japroz"          
[226] "zg-annahme"          "fr-berecht"          "fr-stimmen"         
[229] "fr-bet"              "fr-gultig"           "fr-ja"              
[232] "fr-nein"             "fr-japroz"           "fr-annahme"         
[235] "so-berecht"          "so-stimmen"          "so-bet"             
[238] "so-gultig"           "so-ja"               "so-nein"            
[241] "so-japroz"           "so-annahme"          "bs-berecht"         
[244] "bs-stimmen"          "bs-bet"              "bs-gultig"          
[247] "bs-ja"               "bs-nein"             "bs-japroz"          
[250] "bs-annahme"          "bl-berecht"          "bl-stimmen"         
[253] "bl-bet"              "bl-gultig"           "bl-ja"              
[256] "bl-nein"             "bl-japroz"           "bl-annahme"         
[259] "sh-berecht"          "sh-stimmen"          "sh-bet"             
[262] "sh-gultig"           "sh-ja"               "sh-nein"            
[265] "sh-japroz"           "sh-annahme"          "ar-berecht"         
[268] "ar-stimmen"          "ar-bet"              "ar-gultig"          
[271] "ar-ja"               "ar-nein"             "ar-japroz"          
[274] "ar-annahme"          "ai-berecht"          "ai-stimmen"         
[277] "ai-bet"              "ai-gultig"           "ai-ja"              
[280] "ai-nein"             "ai-japroz"           "ai-annahme"         
[283] "sg-berecht"          "sg-stimmen"          "sg-bet"             
[286] "sg-gultig"           "sg-ja"               "sg-nein"            
[289] "sg-japroz"           "sg-annahme"          "gr-berecht"         
[292] "gr-stimmen"          "gr-bet"              "gr-gultig"          
[295] "gr-ja"               "gr-nein"             "gr-japroz"          
[298] "gr-annahme"          "ag-berecht"          "ag-stimmen"         
[301] "ag-bet"              "ag-gultig"           "ag-ja"              
[304] "ag-nein"             "ag-japroz"           "ag-annahme"         
[307] "tg-berecht"          "tg-stimmen"          "tg-bet"             
[310] "tg-gultig"           "tg-ja"               "tg-nein"            
[313] "tg-japroz"           "tg-annahme"          "ti-berecht"         
[316] "ti-stimmen"          "ti-bet"              "ti-gultig"          
[319] "ti-ja"               "ti-nein"             "ti-japroz"          
[322] "ti-annahme"          "vd-berecht"          "vd-stimmen"         
[325] "vd-bet"              "vd-gultig"           "vd-ja"              
[328] "vd-nein"             "vd-japroz"           "vd-annahme"         
[331] "vs-berecht"          "vs-stimmen"          "vs-bet"             
[334] "vs-gultig"           "vs-ja"               "vs-nein"            
[337] "vs-japroz"           "vs-annahme"          "ne-berecht"         
[340] "ne-stimmen"          "ne-bet"              "ne-gultig"          
[343] "ne-ja"               "ne-nein"             "ne-japroz"          
[346] "ne-annahme"          "ge-berecht"          "ge-stimmen"         
[349] "ge-bet"              "ge-gultig"           "ge-ja"              
[352] "ge-nein"             "ge-japroz"           "ge-annahme"         
[355] "ju-berecht"          "ju-stimmen"          "ju-bet"             
[358] "ju-gultig"           "ju-ja"               "ju-nein"            
[361] "ju-japroz"           "ju-annahme"          "bkresults-de"       
[364] "bkresults-fr"        "bfsdash-de"          "bfsdash-fr"         
[367] "bfsdash-en"          "bfsmap-de"           "bfsmap-fr"          
[370] "bfsmap-en"           "nach_cockpit_d"      "nach_cockpit_f"     
[373] "nach_cockpit_e"      "variable"            "Partei"             
[376] "pos_Ablehnend"       "parole_Nein"         "parole_Ja"          
[379] "parole_keine"        "pos_Befürwortend"   </code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vorerst ignorierte Spalten (partiell) wieder hinzufügen</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>voting_5y_final <span class="ot">&lt;-</span> voting_5y_long_strength_wtd_summary <span class="sc">%&gt;%</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(voting_5y_long <span class="sc">%&gt;%</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(anr,</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>                     titel_kurz_d,</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>                     dep,              <span class="co"># 1 Eidg. Dep. für ausw. Angel. (EDA)</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>                                       <span class="co"># 2 Eidg. Dep. des Innern (EDI)2</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>                                       <span class="co"># 3 Eidg. Justiz- und PolizeiDep. (EJPD)3</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>                                       <span class="co"># 4 Eidg. Dep. für Verteidigung,                                                      Bevölkerungsschutz und Sport (VBS)4</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>                                       <span class="co"># 5 Eidg. FinanzDep. (EFD)5</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>                                       <span class="co"># 6 Eidg. Dep. für Wirtschaft, Bildung und</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>                                       <span class="co"># Forschung (WBF)6</span></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>                                       <span class="co"># 7 Eidg. Dep. für Umwelt, Verkehr, Energie                                            und Kommunikation (UVEK)7</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>                                       <span class="co"># 8 Schweizerische Bundeskanzlei (BK)</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>                     rechtsform,       <span class="co">#1 Obligatorisches Referendum</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>                                       <span class="co">#2 Fakultatives Referendum</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>                                       <span class="co">#3 Volksinitiative</span></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>                                       <span class="co">#4 Direkter Gegenentwurf zu Volksinitiative</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>                                       <span class="co">#5 Stichfrage</span></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">inserate_total      =</span> <span class="st">`</span><span class="at">inserate-total</span><span class="st">`</span>,</span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">inserate_je_ausgabe =</span> <span class="st">`</span><span class="at">inserate-je-ausgabe</span><span class="st">`</span>,</span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">inserate_ja         =</span> <span class="st">`</span><span class="at">inserate-ja</span><span class="st">`</span>,</span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>                     <span class="co">#inserate_jaanteil   = `inserate-jaanteil`,</span></span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a>                     <span class="at">inserate_nein       =</span> <span class="st">`</span><span class="at">inserate-nein</span><span class="st">`</span>,</span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a>                     <span class="at">inserate_neutral    =</span> <span class="st">`</span><span class="at">inserate-neutral</span><span class="st">`</span>,</span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mediares_tot        =</span> <span class="st">`</span><span class="at">mediares-tot</span><span class="st">`</span>,</span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mediaton_tot        =</span> <span class="st">`</span><span class="at">mediaton-tot</span><span class="st">`</span>,</span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a>                     nrja,</span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a>                     nrnein,</span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a>                     srja,</span>
<span id="cb82-32"><a href="#cb82-32" aria-hidden="true" tabindex="-1"></a>                     srnein,</span>
<span id="cb82-33"><a href="#cb82-33" aria-hidden="true" tabindex="-1"></a>                  </span>
<span id="cb82-34"><a href="#cb82-34" aria-hidden="true" tabindex="-1"></a>                     bet,</span>
<span id="cb82-35"><a href="#cb82-35" aria-hidden="true" tabindex="-1"></a>                     leer,</span>
<span id="cb82-36"><a href="#cb82-36" aria-hidden="true" tabindex="-1"></a>                     ungultig,</span>
<span id="cb82-37"><a href="#cb82-37" aria-hidden="true" tabindex="-1"></a>                     gultig,</span>
<span id="cb82-38"><a href="#cb82-38" aria-hidden="true" tabindex="-1"></a>                     <span class="at">volkja_proz        =</span> <span class="st">`</span><span class="at">volkja-proz</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb82-39"><a href="#cb82-39" aria-hidden="true" tabindex="-1"></a>              <span class="fu">distinct</span>(),</span>
<span id="cb82-40"><a href="#cb82-40" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">"anr"</span>)</span>
<span id="cb82-41"><a href="#cb82-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-42"><a href="#cb82-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-43"><a href="#cb82-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Zeilenzahl prüfen</span></span>
<span id="cb82-44"><a href="#cb82-44" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(voting_5y_final) <span class="sc">==</span> <span class="fu">nrow</span>(voting_5y_long_strength_wtd_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
<section id="spaltenklassifizierung-und-levels" class="level4" data-number="3.4.1.5">
<h4 data-number="3.4.1.5" class="anchored" data-anchor-id="spaltenklassifizierung-und-levels"><span class="header-section-number">3.4.1.5</span> Spaltenklassifizierung und Levels</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(voting_5y_final)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [52 × 31] (S3: tbl_df/tbl/data.frame)
 $ anr                  : num [1:52] 626 627 628 629 630 631 632 633 634 635 ...
 $ year                 : num [1:52] 2019 2019 2019 2020 2020 ...
 $ annahme              : chr [1:52] "0" "1" "1" "0" ...
 $ state_parole_Nein    : num [1:52] 64.8 20.1 24.6 66 24.6 ...
 $ state_parole_Ja      : num [1:52] 34.8 54.9 74.6 33.6 73.8 ...
 $ state_parole_Keine   : num [1:52] 0.41 25 0.82 0.41 1.64 ...
 $ kt_parole_Nein       : num [1:52] 71.72 4.83 16.55 70.63 17.48 ...
 $ kt_parole_Ja         : num [1:52] 25.5 75.9 80.7 25.9 79 ...
 $ kt_parole_Keine      : num [1:52] 2.76 19.31 2.76 3.5 3.5 ...
 $ gemeinde_parole_Nein : num [1:52] 53.89 16.74 8.92 54.56 8.76 ...
 $ gemeinde_parole_Ja   : num [1:52] 43.7 71.1 87.7 42.5 86.9 ...
 $ gemeinde_parole_Keine: num [1:52] 2.4 12.2 3.38 2.98 4.29 ...
 $ titel_kurz_d         : chr [1:52] "Zersiedelungsinitiative" "Steuerreform und AHV-Finanzierung (STAF)" "Umsetzung der EU-Waffenrichtlinie" "Initiative «Mehr bezahlbare Wohnungen»" ...
 $ dep                  : chr [1:52] "7" "5" "3" "6" ...
 $ rechtsform           : num [1:52] 3 2 2 3 2 3 2 2 2 2 ...
 $ inserate_total       : chr [1:52] "290" "774" "364" "275" ...
 $ inserate_je_ausgabe  : chr [1:52] "0.15" "0.40" "0.19" "0.14" ...
 $ inserate_ja          : chr [1:52] "15" "760" "252" "41" ...
 $ inserate_nein        : chr [1:52] "258" "5" "102" "234" ...
 $ inserate_neutral     : chr [1:52] "17" "9" "10" "0" ...
 $ mediares_tot         : chr [1:52] "312" "455" "344" "253" ...
 $ mediaton_tot         : chr [1:52] "-14" "16" "26" "0" ...
 $ nrja                 : chr [1:52] "37" "112" "120" "56" ...
 $ nrnein               : chr [1:52] "143" "67" "69" "140" ...
 $ srja                 : chr [1:52] "3" "39" "34" "13" ...
 $ srnein               : chr [1:52] "34" "4" "6" "30" ...
 $ bet                  : chr [1:52] "37.92" "43.74" "43.88" "41.68" ...
 $ leer                 : chr [1:52] "23068" "49337" "23110" "28176" ...
 $ ungultig             : chr [1:52] "7116" "8477" "7687" "6661" ...
 $ gultig               : num [1:52] 2028754 2321604 2356154 2244071 2241395 ...
 $ volkja_proz          : num [1:52] 36.3 66.4 63.7 43 63.1 ...</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>voting_5y_final <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">annahme                =</span> <span class="fu">as.numeric</span>(annahme),</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">dep                    =</span> <span class="fu">factor</span>(rechtsform,</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>,</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"5"</span>, <span class="st">"6"</span>, <span class="st">"7"</span>, <span class="st">"8"</span>),</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"EDA"</span>, <span class="st">"EDI"</span>, <span class="st">"EJPD"</span>, <span class="st">"VBS"</span>,</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"EFD"</span>, <span class="st">"WBF"</span>, <span class="st">"UVEK"</span>, <span class="st">"BK"</span> )),</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">rechtsform             =</span> <span class="fu">factor</span>(rechtsform,</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"1"</span>,<span class="st">"2"</span>,<span class="st">"3"</span>,<span class="st">"4"</span>,<span class="st">"5"</span>),</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Obligatorisches Referendum"</span>,</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>                                                   <span class="st">"Fakultatives Referendum"</span>,</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>                                                   <span class="st">"Volksinitiative"</span>,</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>                                                   <span class="st">"Direkter Gegenentwurf"</span>,</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>                                                   <span class="st">"Stichfrage"</span>)),</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">inserate_total         =</span> <span class="fu">as.numeric</span>(inserate_total),</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">inserate_je_ausgabe    =</span> <span class="fu">as.numeric</span>(inserate_je_ausgabe),</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">inserate_ja            =</span> <span class="fu">as.numeric</span>(inserate_ja),</span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">inserate_nein          =</span> <span class="fu">as.numeric</span>(inserate_nein),</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">inserate_neutral       =</span> <span class="fu">as.numeric</span>(inserate_neutral),</span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>         <span class="co">#inserate_ja_pct        = as.numeric(inserate_ja),</span></span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>         <span class="co">#inserate_nein_pct      = as.numeric(inserate_nein),</span></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>         <span class="co">#inserate_neutral_pct   = as.numeric(inserate_neutral),</span></span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">nrja                   =</span> <span class="fu">as.numeric</span>(nrja),</span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>         <span class="co">#nrja_pct               = as.numeric(nrja_pct),</span></span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">nrnein                 =</span> <span class="fu">as.numeric</span>(nrnein),</span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>         <span class="co">#nrnein_pct             = as.numeric(nrnein_pct),</span></span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">srja                   =</span> <span class="fu">as.numeric</span>(srja),</span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>         <span class="co">#srja_pct               = as.numeric(srja_pct),</span></span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">srnein                 =</span> <span class="fu">as.numeric</span>(srnein),</span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a>         <span class="co">#srnein_pct             = as.numeric(srnein_pct),</span></span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">mediares_tot           =</span> <span class="fu">as.numeric</span>(mediares_tot),</span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">mediaton_tot           =</span> <span class="fu">as.numeric</span>(mediaton_tot),</span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">bet                    =</span> <span class="fu">as.numeric</span>(bet),</span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">leer                   =</span> <span class="fu">as.numeric</span>(leer),</span>
<span id="cb86-36"><a href="#cb86-36" aria-hidden="true" tabindex="-1"></a>         <span class="at">ungultig               =</span> <span class="fu">as.numeric</span>(ungultig),</span>
<span id="cb86-37"><a href="#cb86-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">gultig                 =</span> <span class="fu">as.numeric</span>(gultig))</span>
<span id="cb86-38"><a href="#cb86-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-39"><a href="#cb86-39" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(voting_5y_final)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [52 × 31] (S3: tbl_df/tbl/data.frame)
 $ anr                  : num [1:52] 626 627 628 629 630 631 632 633 634 635 ...
 $ year                 : num [1:52] 2019 2019 2019 2020 2020 ...
 $ annahme              : num [1:52] 0 1 1 0 1 0 0 0 1 1 ...
 $ state_parole_Nein    : num [1:52] 64.8 20.1 24.6 66 24.6 ...
 $ state_parole_Ja      : num [1:52] 34.8 54.9 74.6 33.6 73.8 ...
 $ state_parole_Keine   : num [1:52] 0.41 25 0.82 0.41 1.64 ...
 $ kt_parole_Nein       : num [1:52] 71.72 4.83 16.55 70.63 17.48 ...
 $ kt_parole_Ja         : num [1:52] 25.5 75.9 80.7 25.9 79 ...
 $ kt_parole_Keine      : num [1:52] 2.76 19.31 2.76 3.5 3.5 ...
 $ gemeinde_parole_Nein : num [1:52] 53.89 16.74 8.92 54.56 8.76 ...
 $ gemeinde_parole_Ja   : num [1:52] 43.7 71.1 87.7 42.5 86.9 ...
 $ gemeinde_parole_Keine: num [1:52] 2.4 12.2 3.38 2.98 4.29 ...
 $ titel_kurz_d         : chr [1:52] "Zersiedelungsinitiative" "Steuerreform und AHV-Finanzierung (STAF)" "Umsetzung der EU-Waffenrichtlinie" "Initiative «Mehr bezahlbare Wohnungen»" ...
 $ dep                  : Factor w/ 8 levels "EDA","EDI","EJPD",..: 3 2 2 3 2 3 2 2 2 2 ...
 $ rechtsform           : Factor w/ 5 levels "Obligatorisches Referendum",..: 3 2 2 3 2 3 2 2 2 2 ...
 $ inserate_total       : num [1:52] 290 774 364 275 25 ...
 $ inserate_je_ausgabe  : num [1:52] 0.15 0.4 0.19 0.14 0.01 0.34 0.56 0.02 0.12 0.11 ...
 $ inserate_ja          : num [1:52] 15 760 252 41 17 228 288 6 35 177 ...
 $ inserate_nein        : num [1:52] 258 5 102 234 4 422 780 26 196 19 ...
 $ inserate_neutral     : num [1:52] 17 9 10 0 4 8 5 2 1 15 ...
 $ mediares_tot         : num [1:52] 312 455 344 253 249 636 266 172 264 306 ...
 $ mediaton_tot         : num [1:52] -14 16 26 0 37 -35 2 -4 27 13 ...
 $ nrja                 : num [1:52] 37 112 120 56 121 53 117 132 129 123 ...
 $ nrnein               : num [1:52] 143 67 69 140 67 142 71 62 66 68 ...
 $ srja                 : num [1:52] 3 39 34 13 30 5 28 25 31 33 ...
 $ srnein               : num [1:52] 34 4 6 30 12 37 16 17 11 10 ...
 $ bet                  : num [1:52] 37.9 43.7 43.9 41.7 41.7 ...
 $ leer                 : num [1:52] 23068 49337 23110 28176 31597 ...
 $ ungultig             : num [1:52] 7116 8477 7687 6661 6769 ...
 $ gultig               : num [1:52] 2028754 2321604 2356154 2244071 2241395 ...
 $ volkja_proz          : num [1:52] 36.3 66.4 63.7 43 63.1 ...</code></pre>
</div>
</div>
</section>
<section id="spalten-hinzufügen-berechnet" class="level4" data-number="3.4.1.6">
<h4 data-number="3.4.1.6" class="anchored" data-anchor-id="spalten-hinzufügen-berechnet"><span class="header-section-number">3.4.1.6</span> Spalten hinzufügen (berechnet)</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (Alle) Inserate-Anteile in Prozent</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>voting_5y_final <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">inserate_ja_pct =</span> <span class="dv">100</span> <span class="sc">*</span> inserate_ja <span class="sc">/</span> inserate_total,</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">inserate_nein_pct =</span> <span class="dv">100</span> <span class="sc">*</span> inserate_nein <span class="sc">/</span> inserate_total,</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">inserate_neutral_pct =</span> <span class="dv">100</span> <span class="sc">*</span> inserate_neutral <span class="sc">/</span> inserate_total,</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">nrja_pct     =</span> <span class="dv">100</span> <span class="sc">*</span> nrja <span class="sc">/</span> (nrja <span class="sc">+</span> nrnein),</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">nrnein_pct   =</span> <span class="dv">100</span> <span class="sc">*</span> nrnein <span class="sc">/</span> (nrja <span class="sc">+</span> nrnein),</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">srja_pct     =</span> <span class="dv">100</span> <span class="sc">*</span> srja <span class="sc">/</span> (srja <span class="sc">+</span> srnein),</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">srnein_pct   =</span> <span class="dv">100</span> <span class="sc">*</span> srnein <span class="sc">/</span> (srja <span class="sc">+</span> srnein))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Function: “Klassenmutation” Codeblock schreiben</p>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co">#df_name &lt;- "voting_5y_final"</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Funktion: Erzeugt den Mutate-Block</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>generate_codeblock_4_type_conversion <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">df_name =</span> <span class="st">"df"</span>) {</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Spaltennamen und deren aktuelle Klassen holen</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>  col_names <span class="ot">&lt;-</span> <span class="fu">names</span>(df)</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>  col_classes <span class="ot">&lt;-</span> <span class="fu">sapply</span>(df, class)</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Länge des längsten Spaltennamens</span></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>  max_len <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">nchar</span>(col_names))</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Erzeuge ästhetische Codezeilen</span></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>  code_lines <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map2_chr</span>(</span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>    col_names, col_classes,</span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(col, col_class) {</span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>      padding <span class="ot">&lt;-</span> <span class="fu">strrep</span>(<span class="st">" "</span>,</span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>                        max_len <span class="sc">-</span> <span class="fu">nchar</span>(col))</span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"    "</span>, col, padding, <span class="st">" = as."</span>, col_class, <span class="st">"("</span>, col, <span class="st">")"</span>)</span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ganze mutate()-Struktur zusammensetzen</span></span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste0</span>(</span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a>    df_name, <span class="st">" &lt;- "</span>, df_name, <span class="st">" %&gt;%</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"  mutate(</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(code_lines, <span class="at">collapse =</span> <span class="st">",</span><span class="sc">\n</span><span class="st">"</span>),</span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"</span><span class="sc">\n</span><span class="st">  )</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-31"><a href="#cb89-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Function ausführen</span></span>
<span id="cb89-32"><a href="#cb89-32" aria-hidden="true" tabindex="-1"></a><span class="co"># df-Namen angeben für 1) Spaltenherkunft und 2) neues df im Codeblock</span></span>
<span id="cb89-33"><a href="#cb89-33" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_codeblock_4_type_conversion</span>(voting_5y_final,</span>
<span id="cb89-34"><a href="#cb89-34" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"voting_5y_final"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>voting_5y_final &lt;- voting_5y_final %&gt;%
  mutate(
    anr                   = as.numeric(anr),
    year                  = as.numeric(year),
    annahme               = as.numeric(annahme),
    state_parole_Nein     = as.numeric(state_parole_Nein),
    state_parole_Ja       = as.numeric(state_parole_Ja),
    state_parole_Keine    = as.numeric(state_parole_Keine),
    kt_parole_Nein        = as.numeric(kt_parole_Nein),
    kt_parole_Ja          = as.numeric(kt_parole_Ja),
    kt_parole_Keine       = as.numeric(kt_parole_Keine),
    gemeinde_parole_Nein  = as.numeric(gemeinde_parole_Nein),
    gemeinde_parole_Ja    = as.numeric(gemeinde_parole_Ja),
    gemeinde_parole_Keine = as.numeric(gemeinde_parole_Keine),
    titel_kurz_d          = as.character(titel_kurz_d),
    dep                   = as.factor(dep),
    rechtsform            = as.factor(rechtsform),
    inserate_total        = as.numeric(inserate_total),
    inserate_je_ausgabe   = as.numeric(inserate_je_ausgabe),
    inserate_ja           = as.numeric(inserate_ja),
    inserate_nein         = as.numeric(inserate_nein),
    inserate_neutral      = as.numeric(inserate_neutral),
    mediares_tot          = as.numeric(mediares_tot),
    mediaton_tot          = as.numeric(mediaton_tot),
    nrja                  = as.numeric(nrja),
    nrnein                = as.numeric(nrnein),
    srja                  = as.numeric(srja),
    srnein                = as.numeric(srnein),
    bet                   = as.numeric(bet),
    leer                  = as.numeric(leer),
    ungultig              = as.numeric(ungultig),
    gultig                = as.numeric(gultig),
    volkja_proz           = as.numeric(volkja_proz),
    inserate_ja_pct       = as.numeric(inserate_ja_pct),
    inserate_nein_pct     = as.numeric(inserate_nein_pct),
    inserate_neutral_pct  = as.numeric(inserate_neutral_pct),
    nrja_pct              = as.numeric(nrja_pct),
    nrnein_pct            = as.numeric(nrnein_pct),
    srja_pct              = as.numeric(srja_pct),
    srnein_pct            = as.numeric(srnein_pct)
  )</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="analysen" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="analysen"><span class="header-section-number">3.5</span> Analysen</h2>
<section id="abstimmungsergebnisse-mit-widersprüchlichen-parolen" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1" class="anchored" data-anchor-id="abstimmungsergebnisse-mit-widersprüchlichen-parolen"><span class="header-section-number">3.5.1</span> Abstimmungsergebnisse mit widersprüchlichen Parolen</h3>
<section id="data" class="level4" data-number="3.5.1.1">
<h4 data-number="3.5.1.1" class="anchored" data-anchor-id="data"><span class="header-section-number">3.5.1.1</span> Data</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO: Umwandlung obsolet?!</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="co">#relevante Spalten in numerisch umwandeln</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>voting_5y_final <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">annahme =</span> <span class="fu">as.numeric</span>(annahme),</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">state_parole_Ja =</span> <span class="fu">as.numeric</span>(state_parole_Ja),</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">kt_parole_Ja =</span> <span class="fu">as.numeric</span>(kt_parole_Ja),</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">gemeinde_parole_Ja =</span> <span class="fu">as.numeric</span>(gemeinde_parole_Ja))</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a><span class="do">#### ANGENOMMEN</span></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Angenommene Abstimmungen</span></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>angenommen <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(annahme <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Ja-Parole &gt; 50% auf mind. einer Ebene</span></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>angenommen <span class="ot">&lt;-</span> angenommen <span class="sc">%&gt;%</span></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ja_parole_50 =</span> (state_parole_Ja <span class="sc">&gt;=</span> <span class="dv">50</span>) <span class="sc">|</span></span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>                        (kt_parole_Ja <span class="sc">&gt;=</span> <span class="dv">50</span>) <span class="sc">|</span></span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>                        (gemeinde_parole_Ja <span class="sc">&gt;=</span> <span class="dv">50</span>))</span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Abstimmungen ANGENOMMEN obwohl Parolen ABLEHNEND waren</span></span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a>angenommen_ohne_ja_parole_50 <span class="ot">&lt;-</span> angenommen <span class="sc">%&gt;%</span></span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ja_parole_50 <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(anr,</span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a>         titel_kurz_d,</span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a>         annahme,</span>
<span id="cb91-30"><a href="#cb91-30" aria-hidden="true" tabindex="-1"></a>         volkja_proz,</span>
<span id="cb91-31"><a href="#cb91-31" aria-hidden="true" tabindex="-1"></a>         state_parole_Ja,</span>
<span id="cb91-32"><a href="#cb91-32" aria-hidden="true" tabindex="-1"></a>         kt_parole_Ja,</span>
<span id="cb91-33"><a href="#cb91-33" aria-hidden="true" tabindex="-1"></a>         gemeinde_parole_Ja)</span>
<span id="cb91-34"><a href="#cb91-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-35"><a href="#cb91-35" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(angenommen_ohne_ja_parole_50)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
    anr titel_kurz_d            annahme volkja_proz state_parole_Ja kt_parole_Ja
  &lt;dbl&gt; &lt;chr&gt;                     &lt;dbl&gt;       &lt;dbl&gt;           &lt;dbl&gt;        &lt;dbl&gt;
1   638 Initiative für ein Ver…       1        51.2            25           20.1
2   640 Freihandelsabkommen mi…       1        51.6            48.0         48.6
3   645 Gesetz über polizeilic…       1        56.6            42.2         47.9
4   665 Initiative für eine 13…       1        58.2            39           25.3
# ℹ 1 more variable: gemeinde_parole_Ja &lt;dbl&gt;</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="do">#### ABGELEHNT</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Abgelehnte Abstimmungen</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>abgelehnt <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(annahme <span class="sc">!=</span> <span class="dv">1</span>)</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Nein-Parole &gt; 50% auf mind. einer Ebene</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>abgelehnt <span class="ot">&lt;-</span> abgelehnt <span class="sc">%&gt;%</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nein_parole_50 =</span> (state_parole_Nein <span class="sc">&gt;=</span> <span class="dv">50</span>) <span class="sc">|</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>                          (kt_parole_Nein <span class="sc">&gt;=</span> <span class="dv">50</span>) <span class="sc">|</span></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>                          (gemeinde_parole_Nein <span class="sc">&gt;=</span> <span class="dv">50</span>))</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Abstimmungen ABGELEHNT obwohl Parolen BEFÜRWORTEND waren</span></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>abgelehnt_ohne_nein_parole_50 <span class="ot">&lt;-</span> abgelehnt <span class="sc">%&gt;%</span></span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nein_parole_50 <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(anr,</span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>         titel_kurz_d,</span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>         annahme,</span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a>         volkja_proz,</span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>         state_parole_Nein,</span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>         kt_parole_Nein,</span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>         gemeinde_parole_Nein)</span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(abgelehnt_ohne_nein_parole_50)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 7
     anr titel_kurz_d       annahme volkja_proz state_parole_Nein kt_parole_Nein
   &lt;dbl&gt; &lt;chr&gt;                &lt;dbl&gt;       &lt;dbl&gt;             &lt;dbl&gt;          &lt;dbl&gt;
 1   632 Jagdgesetz               0        48.1              41.4           26.6
 2   633 Erhöhung der steu…       0        36.8              40.6           26.6
 3   639 Gesetz über elekt…       0        35.6              40.6           27.1
 4   641 Trinkwasserinitia…       0        39.3              42.2           49.3
 5   642 Pestizidinitiative       0        39.4              41.8           49.3
 6   644 CO2-Gesetz               0        48.4              25.4           20.1
 7   646 «99%-Initiative»         0        35.1              48.4           50  
 8   653 Gesetz über die S…       0        37.4              35.2           25.7
 9   654 Medienpaket              0        45.4              41.8           44.4
10   661 Verrechnungssteue…       0        48.0              34.8           25.7
11   672 Reform der berufl…       0        32.9              38.5           24.0
12   675 Kündigung wegen E…       0        46.2              38             24.0
# ℹ 1 more variable: gemeinde_parole_Nein &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="paradoxe-fälle-überarbeiten" class="level3" data-number="3.5.2">
<h3 data-number="3.5.2" class="anchored" data-anchor-id="paradoxe-fälle-überarbeiten"><span class="header-section-number">3.5.2</span> Paradoxe Fälle ÜBERARBEITEN</h3>
<p>ob und wie stark die Parolen der Parteien (auf Staats-, Kantons- und Gemeindeebene) mit dem Abstimmungsausgang zusammenhängen – insbesondere in Fällen, wo die Ja-Parole unter 50 % liegt, die Vorlage aber trotzdem angenommen wird (und umgekehrt).</p>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fälle identifizieren: "Paradoxe" Abstimmungen</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Annahme == 1, aber state_parole_Ja &lt; 50 (und/oder die anderen Ebenen)</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Annahme == 0, aber state_parole_Ja &gt;= 50 (und/oder die anderen Ebenen)</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Annahme als numerisch </span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO: OBSOLET?</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>voting_5y_final<span class="sc">$</span>annahme <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(voting_5y_final<span class="sc">$</span>annahme)</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fälle identifizieren</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>paradoxe_faelle <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((annahme <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> (state_parole_Ja <span class="sc">&lt;</span> <span class="dv">50</span> <span class="sc">|</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>                            kt_parole_Ja <span class="sc">&lt;</span> <span class="dv">50</span> <span class="sc">|</span></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>                            gemeinde_parole_Ja <span class="sc">&lt;</span> <span class="dv">50</span>)) <span class="sc">|</span></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>           (annahme <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> (state_parole_Ja <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">|</span></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>                              kt_parole_Ja <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">|</span></span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>                              gemeinde_parole_Ja <span class="sc">&gt;=</span> <span class="dv">50</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(anr, titel_kurz_d, annahme, state_parole_Ja, kt_parole_Ja, gemeinde_parole_Ja)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="varianz" class="level4" data-number="3.5.2.1">
<h4 data-number="3.5.2.1" class="anchored" data-anchor-id="varianz"><span class="header-section-number">3.5.2.1</span> Varianz</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Abweichungen berechnen</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>voting_5y_final <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_state =</span> state_parole_Ja <span class="sc">-</span> volkja_proz,</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">diff_kanton =</span> kt_parole_Ja <span class="sc">-</span> volkja_proz,</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">diff_gemeinde =</span> gemeinde_parole_Ja <span class="sc">-</span> volkja_proz)</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Mittelwert und Standardabweichung der Abweichungen je Parole berechnen</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>summary_stats_v1 <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_state =</span> <span class="fu">mean</span>(diff_state),</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_state =</span> <span class="fu">sd</span>(diff_state),</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_kanton =</span> <span class="fu">mean</span>(diff_kanton),</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_kanton =</span> <span class="fu">sd</span>(diff_kanton),</span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_gemeinde =</span> <span class="fu">mean</span>(diff_gemeinde),</span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_gemeinde =</span> <span class="fu">sd</span>(diff_gemeinde)) <span class="sc">%&gt;%</span></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"stat"</span>,</span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Parole"</span>),</span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"_"</span>,</span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> stat,</span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parole =</span> dplyr<span class="sc">::</span><span class="fu">recode</span>(Parole,</span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"state"</span> <span class="ot">=</span> <span class="st">"State"</span>,</span>
<span id="cb96-24"><a href="#cb96-24" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"kanton"</span> <span class="ot">=</span> <span class="st">"Kanton"</span>,</span>
<span id="cb96-25"><a href="#cb96-25" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"gemeinde"</span> <span class="ot">=</span> <span class="st">"Gemeinde"</span>))</span>
<span id="cb96-26"><a href="#cb96-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-27"><a href="#cb96-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualisierung als Balkendiagramm mit Fehlerbalken (±1 SD)</span></span>
<span id="cb96-28"><a href="#cb96-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(summary_stats_v1,</span>
<span id="cb96-29"><a href="#cb96-29" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Parole,</span>
<span id="cb96-30"><a href="#cb96-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> mean,</span>
<span id="cb96-31"><a href="#cb96-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> Parole)) <span class="sc">+</span></span>
<span id="cb96-32"><a href="#cb96-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.6</span>,</span>
<span id="cb96-33"><a href="#cb96-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb96-34"><a href="#cb96-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean <span class="sc">-</span> sd,</span>
<span id="cb96-35"><a href="#cb96-35" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> mean <span class="sc">+</span> sd),</span>
<span id="cb96-36"><a href="#cb96-36" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb96-37"><a href="#cb96-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb96-38"><a href="#cb96-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Mittlere Abweichung der Parolen vom Volksentscheid</span><span class="sc">\n</span><span class="st">mit Standardabweichung"</span>,</span>
<span id="cb96-39"><a href="#cb96-39" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Parole"</span>,</span>
<span id="cb96-40"><a href="#cb96-40" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Mittlere Abweichung (±1 SD, Prozentpunkte)"</span>) <span class="sc">+</span></span>
<span id="cb96-41"><a href="#cb96-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cas_thesis_data_prep_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>summary_stats_v1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  Parole     mean    sd
  &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;
1 State    -2.20   13.8
2 Kanton   -1.74   18.6
3 Gemeinde  0.722  16.4</code></pre>
</div>
</div>
</section>
<section id="varianz-gruppiert-nach-rechtsform" class="level4" data-number="3.5.2.2">
<h4 data-number="3.5.2.2" class="anchored" data-anchor-id="varianz-gruppiert-nach-rechtsform"><span class="header-section-number">3.5.2.2</span> Varianz gruppiert nach Rechtsform</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Abweichungen berechnen</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>voting_5y_final <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_state =</span> state_parole_Ja <span class="sc">-</span> volkja_proz,</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">diff_kanton =</span> kt_parole_Ja <span class="sc">-</span> volkja_proz,</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">diff_gemeinde =</span> gemeinde_parole_Ja <span class="sc">-</span> volkja_proz)</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Zusammenfassen nach "dep" gruppiert</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>summary_stats_v2 <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(rechtsform) <span class="sc">%&gt;%</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_state =</span> <span class="fu">mean</span>(diff_state),</span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_state =</span> <span class="fu">sd</span>(diff_state),</span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_kanton =</span> <span class="fu">mean</span>(diff_kanton),</span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_kanton =</span> <span class="fu">sd</span>(diff_kanton),</span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_gemeinde =</span> <span class="fu">mean</span>(diff_gemeinde),</span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_gemeinde =</span> <span class="fu">sd</span>(diff_gemeinde)) <span class="sc">%&gt;%</span></span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>rechtsform,</span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"stat"</span>, <span class="st">"Parole"</span>),</span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"_"</span>,</span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> stat,</span>
<span id="cb99-21"><a href="#cb99-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb99-22"><a href="#cb99-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parole =</span> dplyr<span class="sc">::</span><span class="fu">recode</span>(Parole,</span>
<span id="cb99-23"><a href="#cb99-23" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"state"</span> <span class="ot">=</span> <span class="st">"State"</span>,</span>
<span id="cb99-24"><a href="#cb99-24" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"kanton"</span> <span class="ot">=</span> <span class="st">"Kanton"</span>,</span>
<span id="cb99-25"><a href="#cb99-25" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"gemeinde"</span> <span class="ot">=</span> <span class="st">"Gemeinde"</span>))</span>
<span id="cb99-26"><a href="#cb99-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-27"><a href="#cb99-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualisierung nach "dep"-Gruppe</span></span>
<span id="cb99-28"><a href="#cb99-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(summary_stats_v2, <span class="fu">aes</span>(<span class="at">x =</span> Parole, <span class="at">y =</span> mean, <span class="at">fill =</span> Parole)) <span class="sc">+</span></span>
<span id="cb99-29"><a href="#cb99-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb99-30"><a href="#cb99-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean <span class="sc">-</span> sd, <span class="at">ymax =</span> mean <span class="sc">+</span> sd), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb99-31"><a href="#cb99-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> rechtsform) <span class="sc">+</span></span>
<span id="cb99-32"><a href="#cb99-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb99-33"><a href="#cb99-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Mittlere Abweichung der Parolen vom Volksentscheid</span><span class="sc">\n</span><span class="st">mit Standardabweichung nach Rechtsform"</span>,</span>
<span id="cb99-34"><a href="#cb99-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Parole"</span>,</span>
<span id="cb99-35"><a href="#cb99-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Mittlere Abweichung (±1 SD, Prozentpunkte)"</span>) <span class="sc">+</span></span>
<span id="cb99-36"><a href="#cb99-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cas_thesis_data_prep_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>summary_stats_v2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 4
  rechtsform                 Parole     mean    sd
  &lt;fct&gt;                      &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;
1 Obligatorisches Referendum State    -11.9   8.53
2 Obligatorisches Referendum Kanton    -3.33 12.3 
3 Obligatorisches Referendum Gemeinde -21.1  14.9 
4 Fakultatives Referendum    State      2.40 11.3 
5 Fakultatives Referendum    Kanton     9.97 13.8 
6 Fakultatives Referendum    Gemeinde   6.40 13.6 
7 Volksinitiative            State     -7.62 15.3 
8 Volksinitiative            Kanton   -17.8  12.0 
9 Volksinitiative            Gemeinde  -5.04 16.9 </code></pre>
</div>
</div>
</section>
<section id="prüfung-der-normalverteilung" class="level4" data-number="3.5.2.3">
<h4 data-number="3.5.2.3" class="anchored" data-anchor-id="prüfung-der-normalverteilung"><span class="header-section-number">3.5.2.3</span> Prüfung der Normalverteilung</h4>
<section id="grafisch" class="level5" data-number="3.5.2.3.1">
<h5 data-number="3.5.2.3.1" class="anchored" data-anchor-id="grafisch"><span class="header-section-number">3.5.2.3.1</span> Grafisch</h5>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Nur die beiden großen Gruppen auswählen</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>gruppen <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Fakultatives Referendum"</span>, <span class="st">"Volksinitiative"</span>)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>df_sub <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span> <span class="fu">filter</span>(rechtsform <span class="sc">%in%</span> gruppen)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogramm mit Facet für jede Gruppe</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_sub, <span class="fu">aes</span>(<span class="at">x =</span> diff_state, <span class="at">fill =</span> rechtsform)) <span class="sc">+</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">bins =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> rechtsform) <span class="sc">+</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogramm der diff_state nach Rechtsform"</span>,</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"diff_state"</span>, <span class="at">y =</span> <span class="st">"Anzahl"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cas_thesis_data_prep_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># QQ-Plot für jede Gruppe</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_sub, <span class="fu">aes</span>(<span class="at">sample =</span> diff_state)) <span class="sc">+</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq</span>() <span class="sc">+</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq_line</span>() <span class="sc">+</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> rechtsform) <span class="sc">+</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"QQ-Plot der diff_state nach Rechtsform"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cas_thesis_data_prep_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="formale-prüfung-shapiro-wilk-test" class="level5" data-number="3.5.2.3.2">
<h5 data-number="3.5.2.3.2" class="anchored" data-anchor-id="formale-prüfung-shapiro-wilk-test"><span class="header-section-number">3.5.2.3.2</span> <strong>Formale Prüfung (Shapiro-Wilk-Test)</strong></h5>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shapiro-Wilk-Test für jede Gruppe</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(df_sub<span class="sc">$</span>diff_state[df_sub<span class="sc">$</span>rechtsform <span class="sc">==</span> <span class="st">"Fakultatives Referendum"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  df_sub$diff_state[df_sub$rechtsform == "Fakultatives Referendum"]
W = 0.98319, p-value = 0.9108</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(df_sub<span class="sc">$</span>diff_state[df_sub<span class="sc">$</span>rechtsform <span class="sc">==</span> <span class="st">"Volksinitiative"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  df_sub$diff_state[df_sub$rechtsform == "Volksinitiative"]
W = 0.97931, p-value = 0.9151</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(df_sub<span class="sc">$</span>diff_kanton[df_sub<span class="sc">$</span>rechtsform <span class="sc">==</span> <span class="st">"Fakultatives Referendum"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  df_sub$diff_kanton[df_sub$rechtsform == "Fakultatives Referendum"]
W = 0.96781, p-value = 0.5019</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(df_sub<span class="sc">$</span>diff_kanton[df_sub<span class="sc">$</span>rechtsform <span class="sc">==</span> <span class="st">"Volksinitiative"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  df_sub$diff_kanton[df_sub$rechtsform == "Volksinitiative"]
W = 0.89525, p-value = 0.02834</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(df_sub<span class="sc">$</span>diff_gemeinde[df_sub<span class="sc">$</span>rechtsform <span class="sc">==</span> <span class="st">"Fakultatives Referendum"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  df_sub$diff_gemeinde[df_sub$rechtsform == "Fakultatives Referendum"]
W = 0.95721, p-value = 0.2801</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(df_sub<span class="sc">$</span>diff_gemeinde[df_sub<span class="sc">$</span>rechtsform <span class="sc">==</span> <span class="st">"Volksinitiative"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  df_sub$diff_gemeinde[df_sub$rechtsform == "Volksinitiative"]
W = 0.93253, p-value = 0.1547</code></pre>
</div>
</div>
</section>
</section>
<section id="prüfung-der-varianzhomogenität-levene-test" class="level4" data-number="3.5.2.4">
<h4 data-number="3.5.2.4" class="anchored" data-anchor-id="prüfung-der-varianzhomogenität-levene-test"><span class="header-section-number">3.5.2.4</span> Prüfung der Varianzhomogenität (Levene-Test)</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">leveneTest</span>(diff_state <span class="sc">~</span> rechtsform, <span class="at">data =</span> df_sub)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Levene's Test for Homogeneity of Variance (center = median)
      Df F value Pr(&gt;F)
group  1  1.3502  0.251
      48               </code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">leveneTest</span>(diff_kanton <span class="sc">~</span> rechtsform, <span class="at">data =</span> df_sub)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Levene's Test for Homogeneity of Variance (center = median)
      Df F value Pr(&gt;F)
group  1   0.641 0.4273
      48               </code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">leveneTest</span>(diff_gemeinde <span class="sc">~</span> rechtsform, <span class="at">data =</span> df_sub)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Levene's Test for Homogeneity of Variance (center = median)
      Df F value Pr(&gt;F)
group  1  0.7233 0.3993
      48               </code></pre>
</div>
</div>
</section>
<section id="t-test" class="level4" data-number="3.5.2.5">
<h4 data-number="3.5.2.5" class="anchored" data-anchor-id="t-test"><span class="header-section-number">3.5.2.5</span> T-Test</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(diff_state <span class="sc">~</span> rechtsform, <span class="at">data =</span> df_sub, <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Two Sample t-test

data:  diff_state by rechtsform
t = 2.6654, df = 48, p-value = 0.01044
alternative hypothesis: true difference in means between group Fakultatives Referendum and group Volksinitiative is not equal to 0
95 percent confidence interval:
  2.46122 17.57714
sample estimates:
mean in group Fakultatives Referendum         mean in group Volksinitiative 
                             2.395285                             -7.623895 </code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co">#t.test(diff_kanton ~ rechtsform, data = df_sub, var.equal = TRUE)</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(diff_gemeinde <span class="sc">~</span> rechtsform, <span class="at">data =</span> df_sub, <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Two Sample t-test

data:  diff_gemeinde by rechtsform
t = 2.6503, df = 48, p-value = 0.01086
alternative hypothesis: true difference in means between group Fakultatives Referendum and group Volksinitiative is not equal to 0
95 percent confidence interval:
  2.761337 20.119384
sample estimates:
mean in group Fakultatives Referendum         mean in group Volksinitiative 
                             6.398941                             -5.041420 </code></pre>
</div>
</div>
</section>
<section id="mann-whitney-u-test-wilcox" class="level4" data-number="3.5.2.6">
<h4 data-number="3.5.2.6" class="anchored" data-anchor-id="mann-whitney-u-test-wilcox"><span class="header-section-number">3.5.2.6</span> Mann-Whitney-U-Test / Wilcox</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># wilcox.test(diff_state ~ rechtsform, data = df_sub)</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(diff_kanton <span class="sc">~</span> rechtsform, <span class="at">data =</span> df_sub)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon rank sum exact test

data:  diff_kanton by rechtsform
W = 576, p-value = 1.584e-09
alternative hypothesis: true location shift is not equal to 0</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># wilcox.test(diff_gemeinde ~ rechtsform, data = df_sub)</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Mediane</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>df_sub <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(rechtsform) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">Median =</span> <span class="fu">median</span>(diff_kanton))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  rechtsform              Median
  &lt;fct&gt;                    &lt;dbl&gt;
1 Fakultatives Referendum   10.7
2 Volksinitiative          -17.1</code></pre>
</div>
</div>
</section>
<section id="tables-annahme-ablehnungword" class="level4" data-number="3.5.2.7">
<h4 data-number="3.5.2.7" class="anchored" data-anchor-id="tables-annahme-ablehnungword"><span class="header-section-number">3.5.2.7</span> Tables Annahme &amp; Ablehnung(Word)</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Funktion für identische Formatierung</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>format_table <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>  df[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df[[<span class="dv">1</span>]])</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>  df[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df[[<span class="dv">3</span>]])</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">flextable</span>(df)</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">theme_vanilla</span>(ft)</span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">font</span>(ft, <span class="at">fontname =</span> <span class="st">"Courier New"</span>, <span class="at">part =</span> <span class="st">"all"</span>)</span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">fontsize</span>(ft, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">part =</span> <span class="st">"all"</span>)</span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">colformat_double</span>(ft, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ft &lt;- colformat_double(ft, digits = 1, suffix = "%")</span></span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">width</span>(ft, <span class="at">j =</span> <span class="dv">2</span>, <span class="at">width =</span> <span class="dv">2</span>)</span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ft)</span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb130-14"><a href="#cb130-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-15"><a href="#cb130-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabelle 1: ANGENOMMEN</span></span>
<span id="cb130-16"><a href="#cb130-16" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">head</span>(angenommen_ohne_ja_parole_50)</span>
<span id="cb130-17"><a href="#cb130-17" aria-hidden="true" tabindex="-1"></a>ft1 <span class="ot">&lt;-</span> <span class="fu">format_table</span>(df1)</span>
<span id="cb130-18"><a href="#cb130-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-19"><a href="#cb130-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabelle 2: ABGELEHNT</span></span>
<span id="cb130-20"><a href="#cb130-20" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">head</span>(abgelehnt_ohne_nein_parole_50)</span>
<span id="cb130-21"><a href="#cb130-21" aria-hidden="true" tabindex="-1"></a>ft2 <span class="ot">&lt;-</span> <span class="fu">format_table</span>(df2)</span>
<span id="cb130-22"><a href="#cb130-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-23"><a href="#cb130-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-24"><a href="#cb130-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Word-Dokument erstellen und beide Tabellen einfügen ---</span></span>
<span id="cb130-25"><a href="#cb130-25" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">read_docx</span>()</span>
<span id="cb130-26"><a href="#cb130-26" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">body_add_par</span>(doc,</span>
<span id="cb130-27"><a href="#cb130-27" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Annahme trotz fehlender Unterstützung durch Parolen"</span>,</span>
<span id="cb130-28"><a href="#cb130-28" aria-hidden="true" tabindex="-1"></a>                    <span class="at">style =</span> <span class="st">"heading 1"</span>)</span>
<span id="cb130-29"><a href="#cb130-29" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">body_add_flextable</span>(doc,</span>
<span id="cb130-30"><a href="#cb130-30" aria-hidden="true" tabindex="-1"></a>                          ft1)</span>
<span id="cb130-31"><a href="#cb130-31" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">body_add_par</span>(doc, <span class="st">""</span>) <span class="co"># Leerzeile</span></span>
<span id="cb130-32"><a href="#cb130-32" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">body_add_par</span>(doc,</span>
<span id="cb130-33"><a href="#cb130-33" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Ablehnung trotz fehlender Unterstützung durch Parolen"</span>,</span>
<span id="cb130-34"><a href="#cb130-34" aria-hidden="true" tabindex="-1"></a>                    <span class="at">style =</span> <span class="st">"heading 1"</span>)</span>
<span id="cb130-35"><a href="#cb130-35" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">body_add_flextable</span>(doc,</span>
<span id="cb130-36"><a href="#cb130-36" aria-hidden="true" tabindex="-1"></a>                          ft2)</span>
<span id="cb130-37"><a href="#cb130-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-38"><a href="#cb130-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-39"><a href="#cb130-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Speichern </span></span>
<span id="cb130-40"><a href="#cb130-40" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(doc, <span class="at">target =</span> <span class="st">"result/Annahme_Ablehnung.docx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="tables-varianz-word" class="level4" data-number="3.5.2.8">
<h4 data-number="3.5.2.8" class="anchored" data-anchor-id="tables-varianz-word"><span class="header-section-number">3.5.2.8</span> Tables Varianz (Word)</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Funktion für identische Formatierung</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>format_table <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>  df[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df[[<span class="dv">1</span>]])</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">flextable</span>(df)</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">theme_vanilla</span>(ft)</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">font</span>(ft, <span class="at">fontname =</span> <span class="st">"Courier New"</span>, <span class="at">part =</span> <span class="st">"all"</span>)</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">fontsize</span>(ft, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">part =</span> <span class="st">"all"</span>)</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">colformat_double</span>(ft, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ft &lt;- colformat_double(ft, digits = 1, suffix = "%")</span></span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">width</span>(ft, <span class="at">j =</span> <span class="dv">2</span>, <span class="at">width =</span> <span class="dv">2</span>)</span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ft)</span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabelle 1: VARIANZ</span></span>
<span id="cb131-16"><a href="#cb131-16" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">head</span>(summary_stats_v1, <span class="dv">10</span>)</span>
<span id="cb131-17"><a href="#cb131-17" aria-hidden="true" tabindex="-1"></a>ft1 <span class="ot">&lt;-</span> <span class="fu">format_table</span>(df1)</span>
<span id="cb131-18"><a href="#cb131-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-19"><a href="#cb131-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabelle 2: VARIANZ Gruppiert nach Rechtsform</span></span>
<span id="cb131-20"><a href="#cb131-20" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">head</span>(summary_stats_v2, <span class="dv">10</span>)</span>
<span id="cb131-21"><a href="#cb131-21" aria-hidden="true" tabindex="-1"></a>ft2 <span class="ot">&lt;-</span> <span class="fu">format_table</span>(df2)</span>
<span id="cb131-22"><a href="#cb131-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-23"><a href="#cb131-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-24"><a href="#cb131-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Word-Dokument erstellen und beide Tabellen einfügen ---</span></span>
<span id="cb131-25"><a href="#cb131-25" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">read_docx</span>()</span>
<span id="cb131-26"><a href="#cb131-26" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">body_add_par</span>(doc,</span>
<span id="cb131-27"><a href="#cb131-27" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Mittlere Abweichung der Parolen vom Volksentscheid - Mit Standardabweichung"</span>,</span>
<span id="cb131-28"><a href="#cb131-28" aria-hidden="true" tabindex="-1"></a>                    <span class="at">style =</span> <span class="st">"heading 1"</span>)</span>
<span id="cb131-29"><a href="#cb131-29" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">body_add_flextable</span>(doc,</span>
<span id="cb131-30"><a href="#cb131-30" aria-hidden="true" tabindex="-1"></a>                          ft1)</span>
<span id="cb131-31"><a href="#cb131-31" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">body_add_par</span>(doc, <span class="st">""</span>) <span class="co"># Leerzeile</span></span>
<span id="cb131-32"><a href="#cb131-32" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">body_add_par</span>(doc,</span>
<span id="cb131-33"><a href="#cb131-33" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Mittlere Abweichung der Parolen vom Volksentscheid - Mit Standardabweichung. Gruppiert nach Rechtsform"</span>,</span>
<span id="cb131-34"><a href="#cb131-34" aria-hidden="true" tabindex="-1"></a>                    <span class="at">style =</span> <span class="st">"heading 1"</span>)</span>
<span id="cb131-35"><a href="#cb131-35" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">body_add_flextable</span>(doc,</span>
<span id="cb131-36"><a href="#cb131-36" aria-hidden="true" tabindex="-1"></a>                          ft2)</span>
<span id="cb131-37"><a href="#cb131-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-38"><a href="#cb131-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Speichern </span></span>
<span id="cb131-39"><a href="#cb131-39" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(doc, <span class="at">target =</span> <span class="st">"result/Varianz.docx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="tables-vergleichende-gruppenstatistik-word" class="level4" data-number="3.5.2.9">
<h4 data-number="3.5.2.9" class="anchored" data-anchor-id="tables-vergleichende-gruppenstatistik-word"><span class="header-section-number">3.5.2.9</span> Tables vergleichende Gruppenstatistik (Word)</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Todo</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="plots---überarbeiten" class="level4" data-number="3.5.2.10">
<h4 data-number="3.5.2.10" class="anchored" data-anchor-id="plots---überarbeiten"><span class="header-section-number">3.5.2.10</span> Plots - ÜBERARBEITEN</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="do">#### ANGENOMMEN</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Daten filtern und Bedingung setzen</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">annahme =</span> <span class="fu">as.numeric</span>(annahme),</span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">state_parole_Ja =</span> <span class="fu">as.numeric</span>(state_parole_Ja),</span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">kt_parole_Ja =</span> <span class="fu">as.numeric</span>(kt_parole_Ja),</span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">gemeinde_parole_Ja =</span> <span class="fu">as.numeric</span>(gemeinde_parole_Ja)) <span class="sc">%&gt;%</span></span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(annahme <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Nur angenommene Abstimmungen</span></span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">keine_ja_parole_50 =</span> (state_parole_Ja <span class="sc">&lt;=</span> <span class="dv">50</span>) <span class="sc">&amp;</span></span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a>                              (kt_parole_Ja <span class="sc">&lt;=</span> <span class="dv">50</span>) <span class="sc">&amp;</span></span>
<span id="cb133-16"><a href="#cb133-16" aria-hidden="true" tabindex="-1"></a>                              (gemeinde_parole_Ja <span class="sc">&lt;=</span> <span class="dv">50</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb133-17"><a href="#cb133-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(anr,</span>
<span id="cb133-18"><a href="#cb133-18" aria-hidden="true" tabindex="-1"></a>         titel_kurz_d,</span>
<span id="cb133-19"><a href="#cb133-19" aria-hidden="true" tabindex="-1"></a>         state_parole_Ja,</span>
<span id="cb133-20"><a href="#cb133-20" aria-hidden="true" tabindex="-1"></a>         kt_parole_Ja,</span>
<span id="cb133-21"><a href="#cb133-21" aria-hidden="true" tabindex="-1"></a>         gemeinde_parole_Ja,</span>
<span id="cb133-22"><a href="#cb133-22" aria-hidden="true" tabindex="-1"></a>         keine_ja_parole_50)</span>
<span id="cb133-23"><a href="#cb133-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-24"><a href="#cb133-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Daten ins long format</span></span>
<span id="cb133-25"><a href="#cb133-25" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb133-26"><a href="#cb133-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(state_parole_Ja,</span>
<span id="cb133-27"><a href="#cb133-27" aria-hidden="true" tabindex="-1"></a>                        kt_parole_Ja,</span>
<span id="cb133-28"><a href="#cb133-28" aria-hidden="true" tabindex="-1"></a>                        gemeinde_parole_Ja),</span>
<span id="cb133-29"><a href="#cb133-29" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Ebene"</span>,</span>
<span id="cb133-30"><a href="#cb133-30" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Ja_Parole"</span>)</span>
<span id="cb133-31"><a href="#cb133-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-32"><a href="#cb133-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Farbspalte für Hervorhebung</span></span>
<span id="cb133-33"><a href="#cb133-33" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> df_long <span class="sc">%&gt;%</span></span>
<span id="cb133-34"><a href="#cb133-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">highlight =</span> <span class="fu">ifelse</span>(keine_ja_parole_50,</span>
<span id="cb133-35"><a href="#cb133-35" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"keine Mehrheit"</span>,</span>
<span id="cb133-36"><a href="#cb133-36" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"mind. 1 Mehrheit"</span>))</span>
<span id="cb133-37"><a href="#cb133-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-38"><a href="#cb133-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb133-39"><a href="#cb133-39" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_long,</span>
<span id="cb133-40"><a href="#cb133-40" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(titel_kurz_d,</span>
<span id="cb133-41"><a href="#cb133-41" aria-hidden="true" tabindex="-1"></a>                       anr),</span>
<span id="cb133-42"><a href="#cb133-42" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> Ja_Parole,</span>
<span id="cb133-43"><a href="#cb133-43" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> Ebene,</span>
<span id="cb133-44"><a href="#cb133-44" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> highlight)) <span class="sc">+</span></span>
<span id="cb133-45"><a href="#cb133-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>,</span>
<span id="cb133-46"><a href="#cb133-46" aria-hidden="true" tabindex="-1"></a>           <span class="at">position =</span> <span class="st">"dodge"</span>,</span>
<span id="cb133-47"><a href="#cb133-47" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb133-48"><a href="#cb133-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">50</span>,</span>
<span id="cb133-49"><a href="#cb133-49" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb133-50"><a href="#cb133-50" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb133-51"><a href="#cb133-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"keine Mehrheit"</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb133-52"><a href="#cb133-52" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"mind. 1 Mehrheit"</span> <span class="ot">=</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb133-53"><a href="#cb133-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Abstimmung"</span>,</span>
<span id="cb133-54"><a href="#cb133-54" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Ja-Parole (%)"</span>,</span>
<span id="cb133-55"><a href="#cb133-55" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Ebene"</span>,</span>
<span id="cb133-56"><a href="#cb133-56" aria-hidden="true" tabindex="-1"></a>       <span class="at">alpha =</span> <span class="st">"Hervorhebung"</span>,</span>
<span id="cb133-57"><a href="#cb133-57" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Ja-Parole-Anteile bei angenommenen Abstimmungen"</span>) <span class="sc">+</span></span>
<span id="cb133-58"><a href="#cb133-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,</span>
<span id="cb133-59"><a href="#cb133-59" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cas_thesis_data_prep_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="do">#### ABGELEHNT</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Daten filtern und Bedingung setzen</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>df_negativ <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">annahme =</span> <span class="fu">as.numeric</span>(annahme),</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">state_parole_Ja =</span> <span class="fu">as.numeric</span>(state_parole_Ja),</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">kt_parole_Ja =</span> <span class="fu">as.numeric</span>(kt_parole_Ja),</span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">gemeinde_parole_Ja =</span> <span class="fu">as.numeric</span>(gemeinde_parole_Ja)) <span class="sc">%&gt;%</span></span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(annahme <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Nur abgelehnte Abstimmungen</span></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ja_parole_mehrheit =</span> (state_parole_Ja <span class="sc">&gt;</span> <span class="dv">50</span>) <span class="sc">|</span></span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>                              (kt_parole_Ja <span class="sc">&gt;</span> <span class="dv">50</span>) <span class="sc">|</span></span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>                              (gemeinde_parole_Ja <span class="sc">&gt;</span> <span class="dv">50</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(anr,</span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a>         titel_kurz_d,</span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a>         state_parole_Ja,</span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a>         kt_parole_Ja,</span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a>         gemeinde_parole_Ja,</span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a>         ja_parole_mehrheit)</span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Daten ins long format</span></span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a>df_negativ_long <span class="ot">&lt;-</span> df_negativ <span class="sc">%&gt;%</span></span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(state_parole_Ja,</span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a>                        kt_parole_Ja,</span>
<span id="cb134-26"><a href="#cb134-26" aria-hidden="true" tabindex="-1"></a>                        gemeinde_parole_Ja),</span>
<span id="cb134-27"><a href="#cb134-27" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Ebene"</span>,</span>
<span id="cb134-28"><a href="#cb134-28" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Ja_Parole"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-29"><a href="#cb134-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">highlight =</span> <span class="fu">ifelse</span>(ja_parole_mehrheit,</span>
<span id="cb134-30"><a href="#cb134-30" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Mehrheit Ja-Parole"</span>,</span>
<span id="cb134-31"><a href="#cb134-31" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Keine Mehrheit"</span>))</span>
<span id="cb134-32"><a href="#cb134-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-33"><a href="#cb134-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb134-34"><a href="#cb134-34" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_negativ_long,</span>
<span id="cb134-35"><a href="#cb134-35" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(titel_kurz_d,</span>
<span id="cb134-36"><a href="#cb134-36" aria-hidden="true" tabindex="-1"></a>                       anr),</span>
<span id="cb134-37"><a href="#cb134-37" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> Ja_Parole,</span>
<span id="cb134-38"><a href="#cb134-38" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> Ebene,</span>
<span id="cb134-39"><a href="#cb134-39" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> highlight)) <span class="sc">+</span></span>
<span id="cb134-40"><a href="#cb134-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>,</span>
<span id="cb134-41"><a href="#cb134-41" aria-hidden="true" tabindex="-1"></a>           <span class="at">position =</span> <span class="st">"dodge"</span>,</span>
<span id="cb134-42"><a href="#cb134-42" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb134-43"><a href="#cb134-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">50</span>,</span>
<span id="cb134-44"><a href="#cb134-44" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb134-45"><a href="#cb134-45" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb134-46"><a href="#cb134-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Mehrheit Ja-Parole"</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb134-47"><a href="#cb134-47" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Keine Mehrheit"</span> <span class="ot">=</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb134-48"><a href="#cb134-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Abstimmung"</span>,</span>
<span id="cb134-49"><a href="#cb134-49" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Ja-Parole (%)"</span>,</span>
<span id="cb134-50"><a href="#cb134-50" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Ebene"</span>,</span>
<span id="cb134-51"><a href="#cb134-51" aria-hidden="true" tabindex="-1"></a>       <span class="at">alpha =</span> <span class="st">"Hervorhebung"</span>,</span>
<span id="cb134-52"><a href="#cb134-52" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Abgelehnte Abstimmungen mit Ja-Parolen-Mehrheit"</span>) <span class="sc">+</span></span>
<span id="cb134-53"><a href="#cb134-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,</span>
<span id="cb134-54"><a href="#cb134-54" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cas_thesis_data_prep_files/figure-html/unnamed-chunk-18-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="korrelation" class="level3" data-number="3.5.3">
<h3 data-number="3.5.3" class="anchored" data-anchor-id="korrelation"><span class="header-section-number">3.5.3</span> Korrelation</h3>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(voting_5y_final)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [52 × 41] (S3: tbl_df/tbl/data.frame)
 $ anr                  : num [1:52] 626 627 628 629 630 631 632 633 634 635 ...
 $ year                 : num [1:52] 2019 2019 2019 2020 2020 ...
 $ annahme              : num [1:52] 0 1 1 0 1 0 0 0 1 1 ...
 $ state_parole_Nein    : num [1:52] 64.8 20.1 24.6 66 24.6 ...
 $ state_parole_Ja      : num [1:52] 34.8 54.9 74.6 33.6 73.8 ...
 $ state_parole_Keine   : num [1:52] 0.41 25 0.82 0.41 1.64 ...
 $ kt_parole_Nein       : num [1:52] 71.72 4.83 16.55 70.63 17.48 ...
 $ kt_parole_Ja         : num [1:52] 25.5 75.9 80.7 25.9 79 ...
 $ kt_parole_Keine      : num [1:52] 2.76 19.31 2.76 3.5 3.5 ...
 $ gemeinde_parole_Nein : num [1:52] 53.89 16.74 8.92 54.56 8.76 ...
 $ gemeinde_parole_Ja   : num [1:52] 43.7 71.1 87.7 42.5 86.9 ...
 $ gemeinde_parole_Keine: num [1:52] 2.4 12.2 3.38 2.98 4.29 ...
 $ titel_kurz_d         : chr [1:52] "Zersiedelungsinitiative" "Steuerreform und AHV-Finanzierung (STAF)" "Umsetzung der EU-Waffenrichtlinie" "Initiative «Mehr bezahlbare Wohnungen»" ...
 $ dep                  : Factor w/ 8 levels "EDA","EDI","EJPD",..: 3 2 2 3 2 3 2 2 2 2 ...
 $ rechtsform           : Factor w/ 5 levels "Obligatorisches Referendum",..: 3 2 2 3 2 3 2 2 2 2 ...
 $ inserate_total       : num [1:52] 290 774 364 275 25 ...
 $ inserate_je_ausgabe  : num [1:52] 0.15 0.4 0.19 0.14 0.01 0.34 0.56 0.02 0.12 0.11 ...
 $ inserate_ja          : num [1:52] 15 760 252 41 17 228 288 6 35 177 ...
 $ inserate_nein        : num [1:52] 258 5 102 234 4 422 780 26 196 19 ...
 $ inserate_neutral     : num [1:52] 17 9 10 0 4 8 5 2 1 15 ...
 $ mediares_tot         : num [1:52] 312 455 344 253 249 636 266 172 264 306 ...
 $ mediaton_tot         : num [1:52] -14 16 26 0 37 -35 2 -4 27 13 ...
 $ nrja                 : num [1:52] 37 112 120 56 121 53 117 132 129 123 ...
 $ nrnein               : num [1:52] 143 67 69 140 67 142 71 62 66 68 ...
 $ srja                 : num [1:52] 3 39 34 13 30 5 28 25 31 33 ...
 $ srnein               : num [1:52] 34 4 6 30 12 37 16 17 11 10 ...
 $ bet                  : num [1:52] 37.9 43.7 43.9 41.7 41.7 ...
 $ leer                 : num [1:52] 23068 49337 23110 28176 31597 ...
 $ ungultig             : num [1:52] 7116 8477 7687 6661 6769 ...
 $ gultig               : num [1:52] 2028754 2321604 2356154 2244071 2241395 ...
 $ volkja_proz          : num [1:52] 36.3 66.4 63.7 43 63.1 ...
 $ inserate_ja_pct      : num [1:52] 5.17 98.19 69.23 14.91 68 ...
 $ inserate_nein_pct    : num [1:52] 88.966 0.646 28.022 85.091 16 ...
 $ inserate_neutral_pct : num [1:52] 5.86 1.16 2.75 0 16 ...
 $ nrja_pct             : num [1:52] 20.6 62.6 63.5 28.6 64.4 ...
 $ nrnein_pct           : num [1:52] 79.4 37.4 36.5 71.4 35.6 ...
 $ srja_pct             : num [1:52] 8.11 90.7 85 30.23 71.43 ...
 $ srnein_pct           : num [1:52] 91.9 9.3 15 69.8 28.6 ...
 $ diff_state           : num [1:52] -1.5 -11.46 10.85 -9.34 10.68 ...
 $ diff_kanton          : num [1:52] -10.82 9.48 16.95 -17.08 15.93 ...
 $ diff_gemeinde        : num [1:52] 7.365 4.685 23.953 -0.496 23.856 ...</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Auswahl relevanter numerischer Variablen</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>subset_corr <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(annahme,</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>         volkja_proz,</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>         diff_state,</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>         diff_kanton,</span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>         diff_gemeinde,</span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>         state_parole_Ja,</span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>         kt_parole_Ja,</span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>         gemeinde_parole_Ja,</span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a>         inserate_total,</span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a>         inserate_ja_pct,</span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a>         mediares_tot,</span>
<span id="cb137-14"><a href="#cb137-14" aria-hidden="true" tabindex="-1"></a>         mediaton_tot,</span>
<span id="cb137-15"><a href="#cb137-15" aria-hidden="true" tabindex="-1"></a>         bet,</span>
<span id="cb137-16"><a href="#cb137-16" aria-hidden="true" tabindex="-1"></a>         nrja_pct,</span>
<span id="cb137-17"><a href="#cb137-17" aria-hidden="true" tabindex="-1"></a>         srja_pct)</span>
<span id="cb137-18"><a href="#cb137-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-19"><a href="#cb137-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-20"><a href="#cb137-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-21"><a href="#cb137-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Erste Visualisierung: Streudiagrammmatrix</span></span>
<span id="cb137-22"><a href="#cb137-22" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(subset_corr, <span class="at">main =</span> <span class="st">"Streudiagrammmatrix der ausgewählten Variablen"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cas_thesis_data_prep_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prüfung auf Normalverteilung</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>subset_corr_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(subset_corr, <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"Variable"</span>, <span class="at">values_to =</span> <span class="st">"Wert"</span>)</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogramme</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(subset_corr_long, <span class="fu">aes</span>(<span class="at">x =</span> Wert)) <span class="sc">+</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">10</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Variable, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogramme der ausgewählten Variablen"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cas_thesis_data_prep_files/figure-html/unnamed-chunk-19-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># QQ-Plots</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(subset_corr_long, <span class="fu">aes</span>(<span class="at">sample =</span> Wert)) <span class="sc">+</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq</span>() <span class="sc">+</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq_line</span>() <span class="sc">+</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Variable, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"QQ-Plots der ausgewählten Variablen"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cas_thesis_data_prep_files/figure-html/unnamed-chunk-19-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shapiro-Wilk-Test für alle Variablen</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(subset_corr, <span class="dv">2</span>, shapiro.test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$annahme

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.63462, p-value = 3.991e-10


$volkja_proz

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.98521, p-value = 0.7613


$diff_state

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.98555, p-value = 0.7762


$diff_kanton

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.96748, p-value = 0.1649


$diff_gemeinde

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.95869, p-value = 0.06865


$state_parole_Ja

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.91076, p-value = 0.0008678


$kt_parole_Ja

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.91807, p-value = 0.001592


$gemeinde_parole_Ja

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.92065, p-value = 0.001982


$inserate_total

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.86025, p-value = 0.0001923


$inserate_ja_pct

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.89545, p-value = 0.001638


$mediares_tot

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.90343, p-value = 0.0004819


$mediaton_tot

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.98094, p-value = 0.5668


$bet

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.90901, p-value = 0.0007528


$nrja_pct

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.95562, p-value = 0.0506


$srja_pct

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.90134, p-value = 0.0004091</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Korrelationsmatrix berechnen</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # Pearson-Korrelation (für normalverteilte Variablen)</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a><span class="co"># cor_matrix_pearson &lt;- cor(subset_corr, use = "complete.obs", method = "pearson")</span></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a><span class="co"># print(round(cor_matrix_pearson, 2))</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Spearman-Korrelation (robuster bei Nicht-Normalverteilung)</span></span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>cor_matrix_spearman <span class="ot">&lt;-</span> <span class="fu">cor</span>(subset_corr, <span class="at">use =</span> <span class="st">"complete.obs"</span>, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(cor_matrix_spearman, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                   annahme volkja_proz diff_state diff_kanton diff_gemeinde
annahme               1.00        0.85      -0.17        0.12          0.00
volkja_proz           0.85        1.00      -0.15        0.14          0.14
diff_state           -0.17       -0.15       1.00        0.82          0.70
diff_kanton           0.12        0.14       0.82        1.00          0.53
diff_gemeinde         0.00        0.14       0.70        0.53          1.00
state_parole_Ja       0.55        0.65       0.56        0.75          0.50
kt_parole_Ja          0.50        0.60       0.55        0.83          0.44
gemeinde_parole_Ja    0.47        0.64       0.39        0.39          0.78
inserate_total       -0.40       -0.17       0.22        0.04          0.20
inserate_ja_pct       0.38        0.44       0.11        0.47         -0.06
mediares_tot          0.04        0.16       0.02       -0.06          0.12
mediaton_tot          0.57        0.68       0.25        0.37          0.46
bet                  -0.16       -0.23       0.05       -0.12         -0.06
nrja_pct              0.53        0.53       0.40        0.62          0.43
srja_pct              0.59        0.61       0.27        0.57          0.31
                   state_parole_Ja kt_parole_Ja gemeinde_parole_Ja
annahme                       0.55         0.50               0.47
volkja_proz                   0.65         0.60               0.64
diff_state                    0.56         0.55               0.39
diff_kanton                   0.75         0.83               0.39
diff_gemeinde                 0.50         0.44               0.78
state_parole_Ja               1.00         0.93               0.72
kt_parole_Ja                  0.93         1.00               0.63
gemeinde_parole_Ja            0.72         0.63               1.00
inserate_total               -0.07        -0.06               0.11
inserate_ja_pct               0.42         0.59               0.14
mediares_tot                  0.02        -0.01               0.19
mediaton_tot                  0.65         0.57               0.74
bet                          -0.10        -0.25              -0.11
nrja_pct                      0.78         0.71               0.56
srja_pct                      0.74         0.70               0.52
                   inserate_total inserate_ja_pct mediares_tot mediaton_tot
annahme                     -0.40            0.38         0.04         0.57
volkja_proz                 -0.17            0.44         0.16         0.68
diff_state                   0.22            0.11         0.02         0.25
diff_kanton                  0.04            0.47        -0.06         0.37
diff_gemeinde                0.20           -0.06         0.12         0.46
state_parole_Ja             -0.07            0.42         0.02         0.65
kt_parole_Ja                -0.06            0.59        -0.01         0.57
gemeinde_parole_Ja           0.11            0.14         0.19         0.74
inserate_total               1.00           -0.05         0.59         0.12
inserate_ja_pct             -0.05            1.00         0.04         0.38
mediares_tot                 0.59            0.04         1.00         0.24
mediaton_tot                 0.12            0.38         0.24         1.00
bet                          0.13           -0.32         0.32        -0.02
nrja_pct                    -0.19            0.48         0.01         0.56
srja_pct                    -0.07            0.57         0.06         0.57
                     bet nrja_pct srja_pct
annahme            -0.16     0.53     0.59
volkja_proz        -0.23     0.53     0.61
diff_state          0.05     0.40     0.27
diff_kanton        -0.12     0.62     0.57
diff_gemeinde      -0.06     0.43     0.31
state_parole_Ja    -0.10     0.78     0.74
kt_parole_Ja       -0.25     0.71     0.70
gemeinde_parole_Ja -0.11     0.56     0.52
inserate_total      0.13    -0.19    -0.07
inserate_ja_pct    -0.32     0.48     0.57
mediares_tot        0.32     0.01     0.06
mediaton_tot       -0.02     0.56     0.57
bet                 1.00    -0.01    -0.10
nrja_pct           -0.01     1.00     0.86
srja_pct           -0.10     0.86     1.00</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Visualisierung der Korrelationsmatrix</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor_matrix_spearman, <span class="at">method =</span> <span class="st">"color"</span>, <span class="at">addCoef.col =</span> <span class="st">"black"</span>, <span class="at">tl.col =</span> <span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cas_thesis_data_prep_files/figure-html/unnamed-chunk-19-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># #Visualisierung der Korrelationsmatrix als Heatmap</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="co"># melted_cor &lt;- melt(round(cor_matrix_spearman, 2))</span></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(data = melted_cor,</span></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a><span class="co">#        aes(x=Var1,</span></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a><span class="co">#            y=Var2,</span></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a><span class="co">#            fill=value)) +</span></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_tile() +</span></span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_text(aes(label = value),</span></span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a><span class="co">#             size = 4) +</span></span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_gradient2(low = "blue",</span></span>
<span id="cb145-11"><a href="#cb145-11" aria-hidden="true" tabindex="-1"></a><span class="co">#                        high = "red", </span></span>
<span id="cb145-12"><a href="#cb145-12" aria-hidden="true" tabindex="-1"></a><span class="co">#                        limit = c(-1,1),</span></span>
<span id="cb145-13"><a href="#cb145-13" aria-hidden="true" tabindex="-1"></a><span class="co">#                        name="Correlation") +</span></span>
<span id="cb145-14"><a href="#cb145-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.title.x = element_blank(),</span></span>
<span id="cb145-15"><a href="#cb145-15" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.title.y = element_blank(),</span></span>
<span id="cb145-16"><a href="#cb145-16" aria-hidden="true" tabindex="-1"></a><span class="co">#         panel.background = element_blank())</span></span>
<span id="cb145-17"><a href="#cb145-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-18"><a href="#cb145-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-19"><a href="#cb145-19" aria-hidden="true" tabindex="-1"></a><span class="co"># #Visualisierung der Korrelationsmatrix mit ggcorrplot</span></span>
<span id="cb145-20"><a href="#cb145-20" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(cor_matrix_spearman, lab = TRUE)</span></span>
<span id="cb145-21"><a href="#cb145-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-22"><a href="#cb145-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-23"><a href="#cb145-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-24"><a href="#cb145-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-25"><a href="#cb145-25" aria-hidden="true" tabindex="-1"></a><span class="co">#Hier WEITERARBEITEN </span></span>
<span id="cb145-26"><a href="#cb145-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-27"><a href="#cb145-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Signifikanz einzelner Korrelationen prüfen</span></span>
<span id="cb145-28"><a href="#cb145-28" aria-hidden="true" tabindex="-1"></a><span class="co"># cor.test(voting_5y_final$diff_state, voting_5y_final$volkja_proz, method = "pearson")</span></span>
<span id="cb145-29"><a href="#cb145-29" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(voting_5y_final<span class="sc">$</span>diff_kanton, voting_5y_final<span class="sc">$</span>inserate_ja_pct, <span class="at">method =</span> <span class="st">"spearman"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Spearman's rank correlation rho

data:  voting_5y_final$diff_kanton and voting_5y_final$inserate_ja_pct
S = 5257.8, p-value = 0.002671
alternative hypothesis: true rho is not equal to 0
sample estimates:
      rho 
0.4678374 </code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Zielvariablen</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>target_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"annahme"</span>,</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"volkja_proz"</span>)</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Numerische Variablen im df ohne Zielvariablen</span></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>compare_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(subset_corr),</span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>                        target_vars)</span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Kombis von Zielvariable und Vergleichsvariablen testen</span></span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a>cor_test_result <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">target =</span> target_vars,</span>
<span id="cb147-11"><a href="#cb147-11" aria-hidden="true" tabindex="-1"></a>                               <span class="at">compare_to =</span> compare_vars) <span class="sc">%&gt;%</span></span>
<span id="cb147-12"><a href="#cb147-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">test =</span> <span class="fu">map2</span>(target,</span>
<span id="cb147-13"><a href="#cb147-13" aria-hidden="true" tabindex="-1"></a>                     compare_to,</span>
<span id="cb147-14"><a href="#cb147-14" aria-hidden="true" tabindex="-1"></a>                     <span class="sc">~</span> <span class="fu">cor.test</span>(subset_corr[[.x]],</span>
<span id="cb147-15"><a href="#cb147-15" aria-hidden="true" tabindex="-1"></a>                                subset_corr[[.y]],</span>
<span id="cb147-16"><a href="#cb147-16" aria-hidden="true" tabindex="-1"></a>                                <span class="at">method =</span> <span class="st">"spearman"</span>)),</span>
<span id="cb147-17"><a href="#cb147-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">rho =</span> <span class="fu">map_dbl</span>(test, <span class="sc">~</span> .x<span class="sc">$</span>estimate),</span>
<span id="cb147-18"><a href="#cb147-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">p_value =</span> <span class="fu">map_dbl</span>(test, <span class="sc">~</span> .x<span class="sc">$</span>p.value)) <span class="sc">%&gt;%</span></span>
<span id="cb147-19"><a href="#cb147-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(target,</span>
<span id="cb147-20"><a href="#cb147-20" aria-hidden="true" tabindex="-1"></a>         compare_to,</span>
<span id="cb147-21"><a href="#cb147-21" aria-hidden="true" tabindex="-1"></a>         rho,</span>
<span id="cb147-22"><a href="#cb147-22" aria-hidden="true" tabindex="-1"></a>         p_value)</span>
<span id="cb147-23"><a href="#cb147-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-24"><a href="#cb147-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Ergebnis anzeigen</span></span>
<span id="cb147-25"><a href="#cb147-25" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cor_test_result) <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n=</span><span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 26 × 4
   target  compare_to              rho    p_value
   &lt;chr&gt;   &lt;chr&gt;                 &lt;dbl&gt;      &lt;dbl&gt;
 1 annahme diff_state         -0.267   0.0554    
 2 annahme diff_kanton         0       1         
 3 annahme diff_gemeinde      -0.00257 0.986     
 4 annahme state_parole_Ja     0.471   0.000428  
 5 annahme kt_parole_Ja        0.413   0.00235   
 6 annahme gemeinde_parole_Ja  0.491   0.000219  
 7 annahme inserate_total     -0.398   0.0122    
 8 annahme inserate_ja_pct     0.384   0.0158    
 9 annahme mediares_tot        0.140   0.322     
10 annahme mediaton_tot        0.573   0.00000885
# ℹ 16 more rows
# A tibble: 26 × 4
   target      compare_to              rho     p_value
   &lt;chr&gt;       &lt;chr&gt;                 &lt;dbl&gt;       &lt;dbl&gt;
 1 annahme     diff_state         -0.267   0.0554     
 2 annahme     diff_kanton         0       1          
 3 annahme     diff_gemeinde      -0.00257 0.986      
 4 annahme     state_parole_Ja     0.471   0.000428   
 5 annahme     kt_parole_Ja        0.413   0.00235    
 6 annahme     gemeinde_parole_Ja  0.491   0.000219   
 7 annahme     inserate_total     -0.398   0.0122     
 8 annahme     inserate_ja_pct     0.384   0.0158     
 9 annahme     mediares_tot        0.140   0.322      
10 annahme     mediaton_tot        0.573   0.00000885 
11 annahme     bet                -0.0694  0.625      
12 annahme     nrja_pct            0.578   0.00000712 
13 annahme     srja_pct            0.526   0.0000624  
14 volkja_proz diff_state         -0.272   0.0510     
15 volkja_proz diff_kanton         0.0593  0.676      
16 volkja_proz diff_gemeinde       0.0827  0.560      
17 volkja_proz state_parole_Ja     0.563   0.0000141  
18 volkja_proz kt_parole_Ja        0.550   0.0000239  
19 volkja_proz gemeinde_parole_Ja  0.619   0.00000100 
20 volkja_proz inserate_total     -0.167   0.311      
21 volkja_proz inserate_ja_pct     0.438   0.00534    
22 volkja_proz mediares_tot        0.223   0.111      
23 volkja_proz mediaton_tot        0.657   0.000000126
24 volkja_proz bet                -0.113   0.425      
25 volkja_proz nrja_pct            0.633   0.000000471
26 volkja_proz srja_pct            0.612   0.00000144 </code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>cor_test_result_filtered <span class="ot">&lt;-</span> cor_test_result <span class="sc">%&gt;%</span> </span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(rho) <span class="sc">&gt;</span> <span class="fl">0.5</span>,</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>         p_value <span class="sc">&lt;</span> <span class="fl">0.05</span>) <span class="sc">%&gt;%</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(target,</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">desc</span>(<span class="fu">abs</span>(rho)))</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO word print..</span></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Ergebnis anzeigen</span></span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cor_test_result_filtered)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 4
  target      compare_to           rho     p_value
  &lt;chr&gt;       &lt;chr&gt;              &lt;dbl&gt;       &lt;dbl&gt;
1 annahme     nrja_pct           0.578 0.00000712 
2 annahme     mediaton_tot       0.573 0.00000885 
3 annahme     srja_pct           0.526 0.0000624  
4 volkja_proz mediaton_tot       0.657 0.000000126
5 volkja_proz nrja_pct           0.633 0.000000471
6 volkja_proz gemeinde_parole_Ja 0.619 0.00000100 
7 volkja_proz srja_pct           0.612 0.00000144 
8 volkja_proz state_parole_Ja    0.563 0.0000141  
9 volkja_proz kt_parole_Ja       0.550 0.0000239  </code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co"># VIF mit allen Variablen</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="co"># mod_vif &lt;- lm(volkja_proz ~ </span></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                 diff_state + diff_kanton + diff_gemeinde +</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                 state_parole_Ja + kt_parole_Ja + gemeinde_parole_Ja +</span></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a><span class="co">#                 inserate_total + inserate_ja_pct + mediares_tot + mediaton_tot +</span></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a><span class="co">#                 bet + nrja_pct + srja_pct,</span></span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a><span class="co">#               data = voting_5y_final)</span></span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a><span class="co"># vif(mod_vif)</span></span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a><span class="co">#alias(mod_vif)</span></span>
<span id="cb151-11"><a href="#cb151-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-12"><a href="#cb151-12" aria-hidden="true" tabindex="-1"></a>mod_vif_fixed <span class="ot">&lt;-</span> <span class="fu">lm</span>(volkja_proz <span class="sc">~</span></span>
<span id="cb151-13"><a href="#cb151-13" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># diff_state + diff_kanton + diff_gemeinde +</span></span>
<span id="cb151-14"><a href="#cb151-14" aria-hidden="true" tabindex="-1"></a>                      state_parole_Ja <span class="sc">+</span> kt_parole_Ja <span class="sc">+</span> gemeinde_parole_Ja <span class="sc">+</span></span>
<span id="cb151-15"><a href="#cb151-15" aria-hidden="true" tabindex="-1"></a>                      inserate_total <span class="sc">+</span> inserate_ja_pct <span class="sc">+</span> mediares_tot <span class="sc">+</span></span>
<span id="cb151-16"><a href="#cb151-16" aria-hidden="true" tabindex="-1"></a>                      mediaton_tot <span class="sc">+</span> bet <span class="sc">+</span> nrja_pct <span class="sc">+</span> srja_pct,</span>
<span id="cb151-17"><a href="#cb151-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> voting_5y_final)</span>
<span id="cb151-18"><a href="#cb151-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-19"><a href="#cb151-19" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(mod_vif_fixed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   state_parole_Ja       kt_parole_Ja gemeinde_parole_Ja     inserate_total 
         19.224599          14.965330           7.935408           1.852499 
   inserate_ja_pct       mediares_tot       mediaton_tot                bet 
          3.292273           2.017894           3.732611           1.865852 
          nrja_pct           srja_pct 
         11.130373          11.048177 </code></pre>
</div>
</div>
</section>
</section>
<section id="modelllierung" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="modelllierung"><span class="header-section-number">3.6</span> Modelllierung</h2>
<section id="lineare-regression" class="level3" data-number="3.6.1">
<h3 data-number="3.6.1" class="anchored" data-anchor-id="lineare-regression"><span class="header-section-number">3.6.1</span> Lineare Regression</h3>
<section id="modelle-erstellen" class="level4" data-number="3.6.1.1">
<h4 data-number="3.6.1.1" class="anchored" data-anchor-id="modelle-erstellen"><span class="header-section-number">3.6.1.1</span> Modelle erstellen</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co">#SR und NR als Parlament zusammenfassen</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>voting_5y_final <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parliament_ja_avg =</span> (nrja_pct <span class="sc">+</span> srja_pct) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Modell state</span></span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>lm_state <span class="ot">&lt;-</span> <span class="fu">lm</span>(volkja_proz <span class="sc">~</span> state_parole_Ja <span class="sc">+</span></span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>                 inserate_total <span class="sc">+</span> inserate_ja_pct <span class="sc">+</span></span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a>                 mediares_tot <span class="sc">+</span> mediaton_tot <span class="sc">+</span></span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a>                 bet,</span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> voting_5y_final)</span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = volkja_proz ~ state_parole_Ja + inserate_total + 
    inserate_ja_pct + mediares_tot + mediaton_tot + bet, data = voting_5y_final)

Residuals:
    Min      1Q  Median      3Q     Max 
-13.082  -4.614  -1.985   4.665  19.641 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     41.28542   11.35141   3.637 0.000959 ***
state_parole_Ja  0.28154    0.12853   2.190 0.035895 *  
inserate_total  -0.01122    0.00528  -2.125 0.041438 *  
inserate_ja_pct  0.04133    0.05027   0.822 0.417080    
mediares_tot     0.02079    0.01183   1.758 0.088300 .  
mediaton_tot     0.24274    0.11803   2.057 0.047947 *  
bet             -0.19954    0.18090  -1.103 0.278224    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 8.325 on 32 degrees of freedom
  (13 Beobachtungen als fehlend gelöscht)
Multiple R-squared:  0.6218,    Adjusted R-squared:  0.5509 
F-statistic:  8.77 on 6 and 32 DF,  p-value: 1.111e-05</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modell kanton</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>lm_kanton<span class="ot">&lt;-</span> <span class="fu">lm</span>(volkja_proz <span class="sc">~</span> kt_parole_Ja <span class="sc">+</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>                 inserate_total <span class="sc">+</span> inserate_ja_pct <span class="sc">+</span></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>                 mediares_tot <span class="sc">+</span> mediaton_tot <span class="sc">+</span></span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>                 bet,</span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> voting_5y_final)</span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_kanton)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = volkja_proz ~ kt_parole_Ja + inserate_total + inserate_ja_pct + 
    mediares_tot + mediaton_tot + bet, data = voting_5y_final)

Residuals:
     Min       1Q   Median       3Q      Max 
-13.0188  -5.9105  -0.9957   5.7537  21.3344 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     47.069903  10.742731   4.382 0.000119 ***
kt_parole_Ja     0.168110   0.093562   1.797 0.081814 .  
inserate_total  -0.010769   0.005387  -1.999 0.054165 .  
inserate_ja_pct  0.017955   0.055925   0.321 0.750253    
mediares_tot     0.022403   0.012120   1.848 0.073797 .  
mediaton_tot     0.319524   0.104095   3.070 0.004346 ** 
bet             -0.211499   0.184686  -1.145 0.260627    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 8.508 on 32 degrees of freedom
  (13 Beobachtungen als fehlend gelöscht)
Multiple R-squared:  0.605, Adjusted R-squared:  0.5309 
F-statistic: 8.168 on 6 and 32 DF,  p-value: 2.124e-05</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modell gemeinde</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>lm_gemeinde<span class="ot">&lt;-</span> <span class="fu">lm</span>(volkja_proz <span class="sc">~</span> gemeinde_parole_Ja <span class="sc">+</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>                   inserate_total <span class="sc">+</span> inserate_ja_pct <span class="sc">+</span></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>                   mediares_tot <span class="sc">+</span> mediaton_tot <span class="sc">+</span></span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>                   bet,</span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> voting_5y_final)</span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_gemeinde)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = volkja_proz ~ gemeinde_parole_Ja + inserate_total + 
    inserate_ja_pct + mediares_tot + mediaton_tot + bet, data = voting_5y_final)

Residuals:
    Min      1Q  Median      3Q     Max 
-13.396  -5.584  -1.657   5.364  23.262 

Coefficients:
                    Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept)        40.384143  13.543873   2.982  0.00544 **
gemeinde_parole_Ja  0.163433   0.111757   1.462  0.15338   
inserate_total     -0.011175   0.005491  -2.035  0.05019 . 
inserate_ja_pct     0.078187   0.052700   1.484  0.14769   
mediares_tot        0.019171   0.012325   1.555  0.12966   
mediaton_tot        0.251002   0.145997   1.719  0.09523 . 
bet                -0.118044   0.200379  -0.589  0.55993   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 8.643 on 32 degrees of freedom
  (13 Beobachtungen als fehlend gelöscht)
Multiple R-squared:  0.5924,    Adjusted R-squared:  0.516 
F-statistic: 7.751 on 6 and 32 DF,  p-value: 3.381e-05</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modell parliament</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>lm_parliament<span class="ot">&lt;-</span> <span class="fu">lm</span>(volkja_proz <span class="sc">~</span> parliament_ja_avg <span class="sc">+</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>                     inserate_total <span class="sc">+</span> inserate_ja_pct <span class="sc">+</span></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>                     mediares_tot <span class="sc">+</span> mediaton_tot <span class="sc">+</span></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>                     bet,</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> voting_5y_final)</span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_parliament)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = volkja_proz ~ parliament_ja_avg + inserate_total + 
    inserate_ja_pct + mediares_tot + mediaton_tot + bet, data = voting_5y_final)

Residuals:
    Min      1Q  Median      3Q     Max 
-15.954  -5.097  -1.309   5.279  20.677 

Coefficients:
                   Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       50.850677  10.207919   4.981  2.1e-05 ***
parliament_ja_avg  0.158178   0.082844   1.909  0.06522 .  
inserate_total    -0.009622   0.005372  -1.791  0.08273 .  
inserate_ja_pct    0.001830   0.059023   0.031  0.97546    
mediares_tot       0.019472   0.012033   1.618  0.11543    
mediaton_tot       0.317515   0.102466   3.099  0.00403 ** 
bet               -0.279232   0.186014  -1.501  0.14313    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 8.458 on 32 degrees of freedom
  (13 Beobachtungen als fehlend gelöscht)
Multiple R-squared:  0.6096,    Adjusted R-squared:  0.5364 
F-statistic: 8.328 on 6 and 32 DF,  p-value: 1.784e-05</code></pre>
</div>
</div>
</section>
<section id="kennzahlen-extrahieren" class="level4" data-number="3.6.1.2">
<h4 data-number="3.6.1.2" class="anchored" data-anchor-id="kennzahlen-extrahieren"><span class="header-section-number">3.6.1.2</span> Kennzahlen extrahieren</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>model_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">State =</span> lm_state,</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Kanton =</span> lm_kanton,</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Gemeinde =</span> lm_gemeinde,</span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Parliament =</span> lm_parliament)</span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Funktion zum Extrahieren der Werte</span></span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a>model_stats <span class="ot">&lt;-</span> <span class="fu">lapply</span>(model_list, <span class="cf">function</span>(mod) {</span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">R2 =</span> <span class="fu">summary</span>(mod)<span class="sc">$</span>r.squared,</span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">AdjR2 =</span> <span class="fu">summary</span>(mod)<span class="sc">$</span>adj.r.squared,</span>
<span id="cb161-10"><a href="#cb161-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">AIC =</span> <span class="fu">AIC</span>(mod),</span>
<span id="cb161-11"><a href="#cb161-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">BIC =</span> <span class="fu">BIC</span>(mod))</span>
<span id="cb161-12"><a href="#cb161-12" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb161-13"><a href="#cb161-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-14"><a href="#cb161-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-15"><a href="#cb161-15" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO Table Word</span></span>
<span id="cb161-16"><a href="#cb161-16" aria-hidden="true" tabindex="-1"></a><span class="co"># In Dataframe umwandeln</span></span>
<span id="cb161-17"><a href="#cb161-17" aria-hidden="true" tabindex="-1"></a>model_stats_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, model_stats)</span>
<span id="cb161-18"><a href="#cb161-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(model_stats_df, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              R2 AdjR2     AIC     BIC
State      0.622 0.551 284.261 297.569
Kanton     0.605 0.531 285.961 299.269
Gemeinde   0.592 0.516 287.186 300.495
Parliament 0.610 0.536 285.501 298.810</code></pre>
</div>
</div>
</section>
<section id="visualisierung-der-modellgüte" class="level4" data-number="3.6.1.3">
<h4 data-number="3.6.1.3" class="anchored" data-anchor-id="visualisierung-der-modellgüte"><span class="header-section-number">3.6.1.3</span> Visualisierung der Modellgüte</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Balkendiagramm für R² und Adjusted R²</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(model_stats_df)</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Model <span class="ot">&lt;-</span> <span class="fu">rownames</span>(df)</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>df_melt <span class="ot">&lt;-</span> <span class="fu">melt</span>(df, <span class="at">id.vars =</span> <span class="st">"Model"</span>)</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_melt[df_melt<span class="sc">$</span>variable <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"R2"</span>,</span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"AdjR2"</span>), ],</span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">x =</span> Model,</span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> value,</span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> variable)) <span class="sc">+</span></span>
<span id="cb163-11"><a href="#cb163-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>,</span>
<span id="cb163-12"><a href="#cb163-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">position =</span> <span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb163-13"><a href="#cb163-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb163-14"><a href="#cb163-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Vergleich der Modellgüte (R² und Adjusted R²)"</span>,</span>
<span id="cb163-15"><a href="#cb163-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Wert"</span>,</span>
<span id="cb163-16"><a href="#cb163-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Modell"</span>) <span class="sc">+</span></span>
<span id="cb163-17"><a href="#cb163-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cas_thesis_data_prep_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># AIC/BIC Vergleich (niedriger = besser)</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_melt[df_melt<span class="sc">$</span>variable <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"AIC"</span>, <span class="st">"BIC"</span>), ],</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Model,</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> value,</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> variable)) <span class="sc">+</span></span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>,</span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">position =</span> <span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Vergleich von AIC und BIC der Modelle"</span>,</span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Wert"</span>,</span>
<span id="cb164-10"><a href="#cb164-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Modell"</span>) <span class="sc">+</span></span>
<span id="cb164-11"><a href="#cb164-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cas_thesis_data_prep_files/figure-html/unnamed-chunk-22-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="logarithmische-regression" class="level3" data-number="3.6.2">
<h3 data-number="3.6.2" class="anchored" data-anchor-id="logarithmische-regression"><span class="header-section-number">3.6.2</span> Logarithmische Regression</h3>
<section id="daten-log-transformieren-und-bereinigen" class="level4" data-number="3.6.2.1">
<h4 data-number="3.6.2.1" class="anchored" data-anchor-id="daten-log-transformieren-und-bereinigen"><span class="header-section-number">3.6.2.1</span> Daten log-transformieren und bereinigen</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>voting_5y_final_log <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_mediares =</span> <span class="fu">log</span>(mediares_tot <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_inserate_total =</span> <span class="fu">log</span>(inserate_total <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_inserate_ja_pct =</span> <span class="fu">log</span>(inserate_ja_pct <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_inserate_neutral_pct =</span> <span class="fu">log</span>(inserate_neutral_pct <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_bet =</span> <span class="fu">log</span>(bet <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_leer =</span> <span class="fu">log</span>(leer <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_ungultig =</span> <span class="fu">log</span>(ungultig <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb165-9"><a href="#cb165-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_gultig =</span> <span class="fu">log</span>(gultig <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb165-10"><a href="#cb165-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="multikollinearität-via-vif-erkennen-bereinigen-und-startmodelle-erstellen" class="level4" data-number="3.6.2.2">
<h4 data-number="3.6.2.2" class="anchored" data-anchor-id="multikollinearität-via-vif-erkennen-bereinigen-und-startmodelle-erstellen"><span class="header-section-number">3.6.2.2</span> Multikollinearität via vif() erkennen, bereinigen und Startmodelle erstellen</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>mod_log_state <span class="ot">&lt;-</span> <span class="fu">glm</span>(annahme <span class="sc">~</span> state_parole_Ja <span class="sc">+</span> </span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>                     <span class="co">#kt_parole_Ja + gemeinde_parole_Ja + parliament_ja_avg +</span></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>                     log_mediares <span class="sc">+</span> log_inserate_total <span class="sc">+</span></span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>                     log_inserate_ja_pct <span class="sc">+</span> log_inserate_neutral_pct <span class="sc">+</span> log_bet <span class="sc">+</span></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>                     <span class="co">#log_leer + log_ungultig + log_gultig + </span></span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>                     <span class="co">#rechtsform + </span></span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>                     dep,</span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> voting_5y_final_log,</span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> binomial)</span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(mod_log_state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                             GVIF Df GVIF^(1/(2*Df))
state_parole_Ja          3.503335  1        1.871720
log_mediares             2.326847  1        1.525401
log_inserate_total       3.128317  1        1.768705
log_inserate_ja_pct      1.988018  1        1.409971
log_inserate_neutral_pct 1.793314  1        1.339147
log_bet                  1.578331  1        1.256316
dep                      3.994563  2        1.413733</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>mod_log_kanton <span class="ot">&lt;-</span> <span class="fu">glm</span>(annahme <span class="sc">~</span>  kt_parole_Ja <span class="sc">+</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>                     <span class="co">#state_parole_Ja +gemeinde_parole_Ja + parliament_ja_avg +</span></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>                     log_mediares <span class="sc">+</span> log_inserate_total <span class="sc">+</span></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>                     log_inserate_ja_pct <span class="sc">+</span> log_inserate_neutral_pct <span class="sc">+</span> log_bet <span class="sc">+</span></span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>                     <span class="co">#log_leer + log_ungultig + log_gultig + </span></span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>                     <span class="co">#rechtsform + </span></span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>                     dep,</span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> voting_5y_final_log,</span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> binomial)</span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(mod_log_kanton)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                             GVIF Df GVIF^(1/(2*Df))
kt_parole_Ja             5.122563  1        2.263308
log_mediares             2.491248  1        1.578369
log_inserate_total       2.887225  1        1.699184
log_inserate_ja_pct      1.833897  1        1.354215
log_inserate_neutral_pct 1.584018  1        1.258578
log_bet                  1.295296  1        1.138111
dep                      4.904241  2        1.488137</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>mod_log_gemeinde <span class="ot">&lt;-</span> <span class="fu">glm</span>(annahme <span class="sc">~</span> gemeinde_parole_Ja <span class="sc">+</span> </span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>                            <span class="co">#state_parole_Ja + #kt_parole_Ja + parliament_ja_avg +</span></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>                            log_mediares <span class="sc">+</span> log_inserate_total <span class="sc">+</span></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>                            log_inserate_ja_pct <span class="sc">+</span> log_inserate_neutral_pct <span class="sc">+</span></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>                            <span class="co">#log_bet + log_leer + log_ungultig + log_gultig + </span></span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>                            <span class="co">#rechtsform +</span></span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a>                            dep,</span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">data =</span> voting_5y_final_log,</span>
<span id="cb170-9"><a href="#cb170-9" aria-hidden="true" tabindex="-1"></a>                            <span class="at">family =</span> binomial)</span>
<span id="cb170-10"><a href="#cb170-10" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(mod_log_gemeinde)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                              GVIF Df GVIF^(1/(2*Df))
gemeinde_parole_Ja       10.050745  1        3.170291
log_mediares              1.558934  1        1.248573
log_inserate_total        6.965823  1        2.639285
log_inserate_ja_pct       3.753340  1        1.937354
log_inserate_neutral_pct  1.573607  1        1.254435
dep                       5.996269  2        1.564841</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>mod_log_parliament <span class="ot">&lt;-</span> <span class="fu">glm</span>(annahme <span class="sc">~</span> parliament_ja_avg <span class="sc">+</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>                            <span class="co">#state_parole_Ja + #kt_parole_Ja + gemeinde_parole_Ja +</span></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>                            log_mediares <span class="sc">+</span> log_inserate_total <span class="sc">+</span></span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>                            log_inserate_ja_pct <span class="sc">+</span> log_inserate_neutral_pct <span class="sc">+</span></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>                            <span class="co">#log_bet + log_leer + log_ungultig + log_gultig + </span></span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>                            <span class="co">#rechtsform +</span></span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>                            dep,</span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">data =</span> voting_5y_final_log,</span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a>                            <span class="at">family =</span> binomial)</span>
<span id="cb172-10"><a href="#cb172-10" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(mod_log_parliament)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                              GVIF Df GVIF^(1/(2*Df))
parliament_ja_avg        11.224060  1        3.350233
log_mediares              1.952281  1        1.397241
log_inserate_total        2.249792  1        1.499931
log_inserate_ja_pct       1.889262  1        1.374504
log_inserate_neutral_pct  1.491983  1        1.221467
dep                      12.949231  2        1.896972</code></pre>
</div>
</div>
</section>
<section id="stepaic-für-modellauswahl" class="level4" data-number="3.6.2.3">
<h4 data-number="3.6.2.3" class="anchored" data-anchor-id="stepaic-für-modellauswahl"><span class="header-section-number">3.6.2.3</span> stepAIC für Modellauswahl</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>step_state <span class="ot">&lt;-</span> <span class="fu">stepAIC</span>(mod_log_state, <span class="at">direction =</span> <span class="st">"both"</span>,</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>step_kanton <span class="ot">&lt;-</span> <span class="fu">stepAIC</span>(mod_log_kanton, <span class="at">direction =</span> <span class="st">"both"</span>,</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>step_gemeinde <span class="ot">&lt;-</span> <span class="fu">stepAIC</span>(mod_log_gemeinde, <span class="at">direction =</span> <span class="st">"both"</span>,</span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a>step_parliament <span class="ot">&lt;-</span> <span class="fu">stepAIC</span>(mod_log_parliament, <span class="at">direction =</span> <span class="st">"both"</span>,</span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">trace =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="modelle-vergleichen" class="level4" data-number="3.6.2.4">
<h4 data-number="3.6.2.4" class="anchored" data-anchor-id="modelle-vergleichen"><span class="header-section-number">3.6.2.4</span> Modelle vergleichen</h4>
<section id="gvif-werte" class="level5" data-number="3.6.2.4.1">
<h5 data-number="3.6.2.4.1" class="anchored" data-anchor-id="gvif-werte"><span class="header-section-number">3.6.2.4.1</span> GVIF-Werte</h5>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co"># GVIF-Werte</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Liste aller Modelle</span></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>model_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">mod_log_state      =</span> mod_log_state,</span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mod_log_kanton     =</span> mod_log_kanton,</span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mod_log_gemeinde   =</span> mod_log_gemeinde,</span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mod_log_parliament =</span> mod_log_parliament)</span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Funktion zur Berechnung und Ausgabe</span></span>
<span id="cb175-9"><a href="#cb175-9" aria-hidden="true" tabindex="-1"></a>vif_bandbreite_max <span class="ot">&lt;-</span> <span class="cf">function</span>(model, model_name) {</span>
<span id="cb175-10"><a href="#cb175-10" aria-hidden="true" tabindex="-1"></a>  vif_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">vif</span>(model))</span>
<span id="cb175-11"><a href="#cb175-11" aria-hidden="true" tabindex="-1"></a>  range_gvif <span class="ot">&lt;-</span> <span class="fu">range</span>(vif_df<span class="sc">$</span><span class="st">`</span><span class="at">GVIF^(1/(2*Df))</span><span class="st">`</span>)</span>
<span id="cb175-12"><a href="#cb175-12" aria-hidden="true" tabindex="-1"></a>  bandbreite_gvif <span class="ot">&lt;-</span> <span class="fu">diff</span>(range_gvif)</span>
<span id="cb175-13"><a href="#cb175-13" aria-hidden="true" tabindex="-1"></a>  max_gvif <span class="ot">&lt;-</span> <span class="fu">max</span>(vif_df<span class="sc">$</span><span class="st">`</span><span class="at">GVIF^(1/(2*Df))</span><span class="st">`</span>)</span>
<span id="cb175-14"><a href="#cb175-14" aria-hidden="true" tabindex="-1"></a>  max_gvif_var <span class="ot">&lt;-</span> <span class="fu">rownames</span>(vif_df)[<span class="fu">which.max</span>(vif_df<span class="sc">$</span><span class="st">`</span><span class="at">GVIF^(1/(2*Df))</span><span class="st">`</span>)]</span>
<span id="cb175-15"><a href="#cb175-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"------"</span>, model_name, <span class="st">"------</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb175-16"><a href="#cb175-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Bandbreite (Range):"</span>,</span>
<span id="cb175-17"><a href="#cb175-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(range_gvif[<span class="dv">1</span>], <span class="dv">3</span>), <span class="st">"-"</span>, <span class="fu">round</span>(range_gvif[<span class="dv">2</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb175-18"><a href="#cb175-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Bandbreite (Differenz):"</span>,</span>
<span id="cb175-19"><a href="#cb175-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(bandbreite_gvif, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb175-20"><a href="#cb175-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Höchster GVIF^(1/(2Df)) Wert:"</span>,</span>
<span id="cb175-21"><a href="#cb175-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(max_gvif, <span class="dv">3</span>), <span class="st">"("</span>, max_gvif_var, <span class="st">")</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb175-22"><a href="#cb175-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb175-23"><a href="#cb175-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-24"><a href="#cb175-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Schleife über alle Modelle</span></span>
<span id="cb175-25"><a href="#cb175-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (name <span class="cf">in</span> <span class="fu">names</span>(model_list)) {</span>
<span id="cb175-26"><a href="#cb175-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vif_bandbreite_max</span>(model_list[[name]], name)</span>
<span id="cb175-27"><a href="#cb175-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>------ mod_log_state ------
Bandbreite (Range): 1.256 - 1.872 
Bandbreite (Differenz): 0.615 
Höchster GVIF^(1/(2Df)) Wert: 1.872 ( state_parole_Ja )

------ mod_log_kanton ------
Bandbreite (Range): 1.138 - 2.263 
Bandbreite (Differenz): 1.125 
Höchster GVIF^(1/(2Df)) Wert: 2.263 ( kt_parole_Ja )

------ mod_log_gemeinde ------
Bandbreite (Range): 1.249 - 3.17 
Bandbreite (Differenz): 1.922 
Höchster GVIF^(1/(2Df)) Wert: 3.17 ( gemeinde_parole_Ja )

------ mod_log_parliament ------
Bandbreite (Range): 1.221 - 3.35 
Bandbreite (Differenz): 2.129 
Höchster GVIF^(1/(2Df)) Wert: 3.35 ( parliament_ja_avg )</code></pre>
</div>
</div>
</section>
<section id="aic-pseudo-r²-mcfadden-auc" class="level5" data-number="3.6.2.4.2">
<h5 data-number="3.6.2.4.2" class="anchored" data-anchor-id="aic-pseudo-r²-mcfadden-auc"><span class="header-section-number">3.6.2.4.2</span> AIC, Pseudo-R² (McFadden) &amp; AUC</h5>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co"># stepAIC() zu kombinieren</span></span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">State =</span> step_state,</span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">Kanton =</span> step_kanton,</span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">Gemeinde =</span> step_gemeinde,</span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">Parlament =</span> step_parliament)</span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # AIC</span></span>
<span id="cb177-8"><a href="#cb177-8" aria-hidden="true" tabindex="-1"></a><span class="co"># sapply(models, AIC)</span></span>
<span id="cb177-9"><a href="#cb177-9" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb177-10"><a href="#cb177-10" aria-hidden="true" tabindex="-1"></a><span class="co"># # Pseudo-R² (McFadden)</span></span>
<span id="cb177-11"><a href="#cb177-11" aria-hidden="true" tabindex="-1"></a><span class="co"># sapply(models, function(m) round(pR2(m)["McFadden"], 3))</span></span>
<span id="cb177-12"><a href="#cb177-12" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb177-13"><a href="#cb177-13" aria-hidden="true" tabindex="-1"></a><span class="co"># # AUC</span></span>
<span id="cb177-14"><a href="#cb177-14" aria-hidden="true" tabindex="-1"></a><span class="co"># sapply(models, function(m) {</span></span>
<span id="cb177-15"><a href="#cb177-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   prob &lt;- predict(m, type = "response")</span></span>
<span id="cb177-16"><a href="#cb177-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   roc_obj &lt;- roc(voting_5y_final_log$annahme, prob)</span></span>
<span id="cb177-17"><a href="#cb177-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   round(auc(roc_obj), 3)</span></span>
<span id="cb177-18"><a href="#cb177-18" aria-hidden="true" tabindex="-1"></a><span class="co"># })</span></span>
<span id="cb177-19"><a href="#cb177-19" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb177-20"><a href="#cb177-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-21"><a href="#cb177-21" aria-hidden="true" tabindex="-1"></a><span class="co">#  Ergebnisse</span></span>
<span id="cb177-22"><a href="#cb177-22" aria-hidden="true" tabindex="-1"></a>AICs <span class="ot">&lt;-</span> <span class="fu">sapply</span>(models, AIC)</span>
<span id="cb177-23"><a href="#cb177-23" aria-hidden="true" tabindex="-1"></a>McFadden <span class="ot">&lt;-</span> <span class="fu">sapply</span>(models, <span class="cf">function</span>(m) <span class="fu">round</span>(<span class="fu">pR2</span>(m)[<span class="st">"McFadden"</span>], <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>fitting null model for pseudo-r2
fitting null model for pseudo-r2
fitting null model for pseudo-r2
fitting null model for pseudo-r2</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>AUCs <span class="ot">&lt;-</span> <span class="fu">sapply</span>(models, <span class="cf">function</span>(m) {</span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>  prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(m, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>  roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(voting_5y_final_log<span class="sc">$</span>annahme, prob)</span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">auc</span>(roc_obj), <span class="dv">3</span>)</span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-7"><a href="#cb179-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Zusammenfassung als Dataframe</span></span>
<span id="cb179-8"><a href="#cb179-8" aria-hidden="true" tabindex="-1"></a>summary_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb179-9"><a href="#cb179-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Modell =</span> <span class="fu">names</span>(models),</span>
<span id="cb179-10"><a href="#cb179-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">AIC =</span> <span class="fu">round</span>(AICs, <span class="dv">2</span>),</span>
<span id="cb179-11"><a href="#cb179-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">McFadden_R2 =</span> <span class="fu">as.numeric</span>(McFadden),</span>
<span id="cb179-12"><a href="#cb179-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">AUC =</span> <span class="fu">as.numeric</span>(AUCs),</span>
<span id="cb179-13"><a href="#cb179-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb179-14"><a href="#cb179-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb179-15"><a href="#cb179-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-16"><a href="#cb179-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Ausgabe</span></span>
<span id="cb179-17"><a href="#cb179-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(summary_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     Modell   AIC McFadden_R2   AUC
1     State 37.98       0.480 0.923
2    Kanton 42.21       0.365 0.878
3  Gemeinde 36.53       0.470 0.918
4 Parlament 40.23       0.438 0.910</code></pre>
</div>
</div>
</section>
</section>
<section id="odds-ratios-und-p-werte-interpretieren" class="level4" data-number="3.6.2.5">
<h4 data-number="3.6.2.5" class="anchored" data-anchor-id="odds-ratios-und-p-werte-interpretieren"><span class="header-section-number">3.6.2.5</span> Odds-ratios und p-Werte interpretieren</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(step_state))  <span class="co"># Odds Ratios</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       (Intercept)    state_parole_Ja       log_mediares log_inserate_total 
      772.96035633         1.15396601        13.09548350         0.15949434 
           log_bet 
        0.01096805 </code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(step_state)    <span class="co"># p-Werte und Interpretation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = annahme ~ state_parole_Ja + log_mediares + log_inserate_total + 
    log_bet, family = binomial, data = voting_5y_final_log)

Coefficients:
                   Estimate Std. Error z value Pr(&gt;|z|)   
(Intercept)         6.65023   12.83206   0.518  0.60428   
state_parole_Ja     0.14320    0.05223   2.742  0.00611 **
log_mediares        2.57227    1.48193   1.736  0.08261 . 
log_inserate_total -1.83575    0.65741  -2.792  0.00523 **
log_bet            -4.51277    3.29473  -1.370  0.17078   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 53.834  on 38  degrees of freedom
Residual deviance: 27.981  on 34  degrees of freedom
AIC: 37.981

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(step_kanton))  <span class="co"># Odds Ratios</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       (Intercept)       kt_parole_Ja       log_mediares log_inserate_total 
      0.0001394356       1.0717423606       8.7373072929       0.2911552373 </code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(step_kanton)    <span class="co"># p-Werte und Interpretation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = annahme ~ kt_parole_Ja + log_mediares + log_inserate_total, 
    family = binomial, data = voting_5y_final_log)

Coefficients:
                   Estimate Std. Error z value Pr(&gt;|z|)   
(Intercept)        -8.87791    6.58973  -1.347  0.17790   
kt_parole_Ja        0.06929    0.02353   2.945  0.00323 **
log_mediares        2.16760    1.33060   1.629  0.10330   
log_inserate_total -1.23390    0.48038  -2.569  0.01021 * 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 53.834  on 38  degrees of freedom
Residual deviance: 34.211  on 35  degrees of freedom
AIC: 42.211

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(step_gemeinde))  <span class="co"># Odds Ratios</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        (Intercept)  gemeinde_parole_Ja  log_inserate_total log_inserate_ja_pct 
          0.6098334           1.1170761           0.1805824           3.2693150 </code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(step_gemeinde)    <span class="co"># p-Werte und Interpretation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = annahme ~ gemeinde_parole_Ja + log_inserate_total + 
    log_inserate_ja_pct, family = binomial, data = voting_5y_final_log)

Coefficients:
                    Estimate Std. Error z value Pr(&gt;|z|)  
(Intercept)         -0.49457    3.00979  -0.164   0.8695  
gemeinde_parole_Ja   0.11071    0.04461   2.482   0.0131 *
log_inserate_total  -1.71157    0.72328  -2.366   0.0180 *
log_inserate_ja_pct  1.18458    0.63377   1.869   0.0616 .
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 53.834  on 38  degrees of freedom
Residual deviance: 28.534  on 35  degrees of freedom
AIC: 36.534

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(step_parliament))  <span class="co"># Odds Ratios</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       (Intercept)  parliament_ja_avg log_inserate_total             depEDI 
      4.618938e+03       1.197799e+00       2.988300e-01       8.542105e-07 
           depEJPD 
      2.076312e-04 </code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(step_parliament)    <span class="co"># p-Werte und Interpretation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = annahme ~ parliament_ja_avg + log_inserate_total + 
    dep, family = binomial, data = voting_5y_final_log)

Coefficients:
                     Estimate Std. Error z value Pr(&gt;|z|)  
(Intercept)           8.43792 2770.32195   0.003   0.9976  
parliament_ja_avg     0.18049    0.08315   2.171   0.0300 *
log_inserate_total   -1.20788    0.50756  -2.380   0.0173 *
depEDI              -13.97309 2770.31601  -0.005   0.9960  
depEJPD              -8.47975 2770.31935  -0.003   0.9976  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 53.834  on 38  degrees of freedom
Residual deviance: 30.232  on 34  degrees of freedom
AIC: 40.232

Number of Fisher Scoring iterations: 16</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="parteilandschaft-schweiz" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="parteilandschaft-schweiz"><span class="header-section-number">3.7</span> Parteilandschaft Schweiz</h2>
<section id="multi-dimensions-model" class="level3" data-number="3.7.1">
<h3 data-number="3.7.1" class="anchored" data-anchor-id="multi-dimensions-model"><span class="header-section-number">3.7.1</span> Multi-Dimensions-Model</h3>
<section id="minimalwerte" class="level4" data-number="3.7.1.1">
<h4 data-number="3.7.1.1" class="anchored" data-anchor-id="minimalwerte"><span class="header-section-number">3.7.1.1</span> Minimalwerte</h4>
<p>Für jede Partei den Minimalwert des Abstimmungsverhaltens zu verwenden, basiert auf der Zielsetzung, die klarste politische Position einer Partei in einem bestimmten Themenbereich zu identifizieren. Diese Methodik stellt sicher, dass auch bei wenigen Abweichungen von der Mehrheitslinie die tatsächliche Haltung der Partei deutlich erkennbar bleibt.</p>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(parties_rating,</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> eco_pct_min_x,</span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> socio_pct_min_y,</span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> Partei)) <span class="sc">+</span></span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">50</span>, <span class="at">xend =</span> <span class="dv">50</span>,</span>
<span id="cb197-8"><a href="#cb197-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">100</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb197-9"><a href="#cb197-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">xend =</span> <span class="dv">100</span>,</span>
<span id="cb197-10"><a href="#cb197-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="dv">50</span>, <span class="at">yend =</span> <span class="dv">50</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb197-11"><a href="#cb197-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb197-12"><a href="#cb197-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb197-13"><a href="#cb197-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">0</span>,</span>
<span id="cb197-14"><a href="#cb197-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(parties_rating<span class="sc">$</span>socio_pct_min_y) <span class="sc">+</span> <span class="dv">55</span>,</span>
<span id="cb197-15"><a href="#cb197-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Links/staatsgläubig"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb197-16"><a href="#cb197-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb197-17"><a href="#cb197-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">100</span>,</span>
<span id="cb197-18"><a href="#cb197-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(parties_rating<span class="sc">$</span>socio_pct_min_y) <span class="sc">+</span> <span class="dv">55</span>,</span>
<span id="cb197-19"><a href="#cb197-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Rechts/marktwirtschaftlich"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb197-20"><a href="#cb197-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb197-21"><a href="#cb197-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">50</span>,</span>
<span id="cb197-22"><a href="#cb197-22" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(parties_rating<span class="sc">$</span>socio_pct_min_y) <span class="sc">-</span> <span class="dv">3</span>,</span>
<span id="cb197-23"><a href="#cb197-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Autoritär/Konservativ"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb197-24"><a href="#cb197-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb197-25"><a href="#cb197-25" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">50</span>,</span>
<span id="cb197-26"><a href="#cb197-26" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(parties_rating<span class="sc">$</span>socio_pct_min_y) <span class="sc">+</span> <span class="dv">103</span>,</span>
<span id="cb197-27"><a href="#cb197-27" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Libertär/Progressiv"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb197-28"><a href="#cb197-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb197-29"><a href="#cb197-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Wirtschaftspolitisch"</span>,</span>
<span id="cb197-30"><a href="#cb197-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Gesellschaftspolitisch"</span>,</span>
<span id="cb197-31"><a href="#cb197-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Politische Positionierung im Zwei-Achsen-Modell"</span>,</span>
<span id="cb197-32"><a href="#cb197-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Grundlage: Minimalwerte des Abstimmungsverhaltens"</span>) <span class="sc">+</span></span>
<span id="cb197-33"><a href="#cb197-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb197-34"><a href="#cb197-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>,</span>
<span id="cb197-35"><a href="#cb197-35" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">30</span>)),</span>
<span id="cb197-36"><a href="#cb197-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>,</span>
<span id="cb197-37"><a href="#cb197-37" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">5</span>)),</span>
<span id="cb197-38"><a href="#cb197-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>,</span>
<span id="cb197-39"><a href="#cb197-39" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">5</span>))) <span class="sc">+</span></span>
<span id="cb197-40"><a href="#cb197-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">105</span>),</span>
<span id="cb197-41"><a href="#cb197-41" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">105</span>),</span>
<span id="cb197-42"><a href="#cb197-42" aria-hidden="true" tabindex="-1"></a>                  <span class="at">clip =</span> <span class="st">"off"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cas_thesis_data_prep_files/figure-html/plot_parties_avg-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Alle "problematischen" Zeilen (NA oder out-of-bounds)</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; Keine Inputwerte bzw. nur Durschnitte (in separater Spalte)</span></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>tmp_removed_rows <span class="ot">&lt;-</span> parties_rating <span class="sc">%&gt;%</span></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(eco_pct_min_x) <span class="sc">|</span> <span class="fu">is.na</span>(socio_pct_min_y) <span class="sc">|</span></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a>    eco_pct_min_x <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> eco_pct_min_x <span class="sc">&gt;</span> <span class="dv">100</span> <span class="sc">|</span></span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a>    socio_pct_min_y <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> socio_pct_min_y <span class="sc">&gt;</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="durchschnittswerte-als-zentrum-und-minmax-als-ellipse" class="level4" data-number="3.7.1.2">
<h4 data-number="3.7.1.2" class="anchored" data-anchor-id="durchschnittswerte-als-zentrum-und-minmax-als-ellipse"><span class="header-section-number">3.7.1.2</span> Durchschnittswerte als Zentrum und Min/Max als Ellipse</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(parties_rating,</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> eco_pct_avg_x,</span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> socio_pct_avg_y,</span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> Partei)) <span class="sc">+</span></span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ellipse</span>(</span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x0 =</span> eco_pct_avg_x,</span>
<span id="cb199-7"><a href="#cb199-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">y0 =</span> socio_pct_avg_y,</span>
<span id="cb199-8"><a href="#cb199-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">a =</span> (eco_pct_max_x <span class="sc">-</span> eco_pct_min_x) <span class="sc">/</span> <span class="dv">2</span>, <span class="co"># Halbachse x</span></span>
<span id="cb199-9"><a href="#cb199-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">b =</span> (socio_pct_max_y <span class="sc">-</span> socio_pct_min_y) <span class="sc">/</span> <span class="dv">2</span>, <span class="co"># Halbachse y</span></span>
<span id="cb199-10"><a href="#cb199-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">angle =</span> <span class="dv">0</span>),</span>
<span id="cb199-11"><a href="#cb199-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"gray80"</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb199-12"><a href="#cb199-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb199-13"><a href="#cb199-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb199-14"><a href="#cb199-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">50</span>, <span class="at">xend =</span> <span class="dv">50</span>,</span>
<span id="cb199-15"><a href="#cb199-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">100</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb199-16"><a href="#cb199-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">xend =</span> <span class="dv">100</span>,</span>
<span id="cb199-17"><a href="#cb199-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="dv">50</span>, <span class="at">yend =</span> <span class="dv">50</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb199-18"><a href="#cb199-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb199-19"><a href="#cb199-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">0</span>,</span>
<span id="cb199-20"><a href="#cb199-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(parties_rating<span class="sc">$</span>socio_pct_min_y) <span class="sc">+</span> <span class="dv">55</span>,</span>
<span id="cb199-21"><a href="#cb199-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Links/staatsgläubig"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb199-22"><a href="#cb199-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb199-23"><a href="#cb199-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">100</span>,</span>
<span id="cb199-24"><a href="#cb199-24" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(parties_rating<span class="sc">$</span>socio_pct_min_y) <span class="sc">+</span> <span class="dv">55</span>,</span>
<span id="cb199-25"><a href="#cb199-25" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Rechts/marktwirtschaftlich"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb199-26"><a href="#cb199-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb199-27"><a href="#cb199-27" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">50</span>,</span>
<span id="cb199-28"><a href="#cb199-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(parties_rating<span class="sc">$</span>socio_pct_min_y) <span class="sc">-</span> <span class="dv">3</span>,</span>
<span id="cb199-29"><a href="#cb199-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Autoritär/Konservativ"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb199-30"><a href="#cb199-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb199-31"><a href="#cb199-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">50</span>,</span>
<span id="cb199-32"><a href="#cb199-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(parties_rating<span class="sc">$</span>socio_pct_min_y) <span class="sc">+</span> <span class="dv">103</span>,</span>
<span id="cb199-33"><a href="#cb199-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Libertär/Progressiv"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb199-34"><a href="#cb199-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="sc">+</span><span class="dv">110</span>)) <span class="sc">+</span></span>
<span id="cb199-35"><a href="#cb199-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Wirtschaftspolitisch"</span>,</span>
<span id="cb199-36"><a href="#cb199-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Gesellschaftspolitisch"</span>,</span>
<span id="cb199-37"><a href="#cb199-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Politische Positionierung im Zwei-Achsen-Modell"</span>,</span>
<span id="cb199-38"><a href="#cb199-38" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Grundlage: Durchschnitt des Abstimmungsverhaltens als Zentrum, Min-/Max als Ellipse"</span>) <span class="sc">+</span></span>
<span id="cb199-39"><a href="#cb199-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb199-40"><a href="#cb199-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>,</span>
<span id="cb199-41"><a href="#cb199-41" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">30</span>)),</span>
<span id="cb199-42"><a href="#cb199-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>,</span>
<span id="cb199-43"><a href="#cb199-43" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">5</span>)),</span>
<span id="cb199-44"><a href="#cb199-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>,</span>
<span id="cb199-45"><a href="#cb199-45" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">5</span>))) <span class="sc">+</span></span>
<span id="cb199-46"><a href="#cb199-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb199-47"><a href="#cb199-47" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb199-48"><a href="#cb199-48" aria-hidden="true" tabindex="-1"></a>                  <span class="at">clip =</span> <span class="st">"off"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cas_thesis_data_prep_files/figure-html/plot_parties_avg_min_max-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="hauptparteien-durchschnittswerte-als-zentrum-und-minmax-als-ellipse-klein--und-regionalparteien-nur-mit-ihrem-durchschnittswert" class="level4" data-number="3.7.1.3">
<h4 data-number="3.7.1.3" class="anchored" data-anchor-id="hauptparteien-durchschnittswerte-als-zentrum-und-minmax-als-ellipse-klein--und-regionalparteien-nur-mit-ihrem-durchschnittswert"><span class="header-section-number">3.7.1.3</span> Hauptparteien: Durchschnittswerte als Zentrum und Min/Max als Ellipse / Klein- und Regionalparteien nur mit ihrem Durchschnittswert</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(parties_rating,</span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> eco_pct_avg_x,</span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> socio_pct_avg_y,</span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> Partei)) <span class="sc">+</span></span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ellipse</span>(<span class="fu">aes</span>(<span class="at">x0 =</span> eco_pct_avg_x,</span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y0 =</span> socio_pct_avg_y,</span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">a =</span> (eco_pct_max_x <span class="sc">-</span> eco_pct_min_x) <span class="sc">/</span> <span class="dv">2</span>, <span class="co"># Halbachse x</span></span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">b =</span> (socio_pct_max_y <span class="sc">-</span> socio_pct_min_y) <span class="sc">/</span> <span class="dv">2</span>, <span class="co"># Halbachse y</span></span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">angle =</span> <span class="dv">0</span>),</span>
<span id="cb200-10"><a href="#cb200-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">"gray80"</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb200-11"><a href="#cb200-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb200-12"><a href="#cb200-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb200-13"><a href="#cb200-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Kleinere Parteien</span></span>
<span id="cb200-14"><a href="#cb200-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(parties_rating,</span>
<span id="cb200-15"><a href="#cb200-15" aria-hidden="true" tabindex="-1"></a>                           <span class="st">`</span><span class="at">Grosse Partei</span><span class="st">`</span> <span class="sc">==</span> <span class="st">"n"</span> <span class="sc">&amp;</span></span>
<span id="cb200-16"><a href="#cb200-16" aria-hidden="true" tabindex="-1"></a>                             Relevanz_nationale_Abstimmungen <span class="sc">!=</span> <span class="st">"-"</span>),</span>
<span id="cb200-17"><a href="#cb200-17" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> eco_x,</span>
<span id="cb200-18"><a href="#cb200-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> socio_y),</span>
<span id="cb200-19"><a href="#cb200-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"grey"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">stroke =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb200-20"><a href="#cb200-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb200-21"><a href="#cb200-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Labels der kleineren Partein</span></span>
<span id="cb200-22"><a href="#cb200-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">subset</span>(parties_rating,</span>
<span id="cb200-23"><a href="#cb200-23" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">Grosse Partei</span><span class="st">`</span> <span class="sc">==</span> <span class="st">"n"</span> <span class="sc">&amp;</span></span>
<span id="cb200-24"><a href="#cb200-24" aria-hidden="true" tabindex="-1"></a>                            Relevanz_nationale_Abstimmungen <span class="sc">!=</span> <span class="st">"-"</span>),</span>
<span id="cb200-25"><a href="#cb200-25" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> eco_x,</span>
<span id="cb200-26"><a href="#cb200-26" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> socio_y,</span>
<span id="cb200-27"><a href="#cb200-27" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> Partei),</span>
<span id="cb200-28"><a href="#cb200-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">fontface =</span> <span class="st">"plain"</span>, <span class="at">color =</span> <span class="st">"darkgrey"</span>) <span class="sc">+</span></span>
<span id="cb200-29"><a href="#cb200-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb200-30"><a href="#cb200-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">50</span>, <span class="at">xend =</span> <span class="dv">50</span>,</span>
<span id="cb200-31"><a href="#cb200-31" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">100</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb200-32"><a href="#cb200-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">xend =</span> <span class="dv">100</span>,</span>
<span id="cb200-33"><a href="#cb200-33" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="dv">50</span>, <span class="at">yend =</span> <span class="dv">50</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb200-34"><a href="#cb200-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb200-35"><a href="#cb200-35" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">0</span>,</span>
<span id="cb200-36"><a href="#cb200-36" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(parties_rating<span class="sc">$</span>socio_pct_min_y) <span class="sc">+</span> <span class="dv">55</span>,</span>
<span id="cb200-37"><a href="#cb200-37" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Links/staatsgläubig"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb200-38"><a href="#cb200-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb200-39"><a href="#cb200-39" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">100</span>,</span>
<span id="cb200-40"><a href="#cb200-40" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(parties_rating<span class="sc">$</span>socio_pct_min_y) <span class="sc">+</span> <span class="dv">55</span>,</span>
<span id="cb200-41"><a href="#cb200-41" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Rechts/marktwirtschaftlich"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb200-42"><a href="#cb200-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb200-43"><a href="#cb200-43" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">50</span>,</span>
<span id="cb200-44"><a href="#cb200-44" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(parties_rating<span class="sc">$</span>socio_pct_min_y) <span class="sc">-</span> <span class="dv">3</span>,</span>
<span id="cb200-45"><a href="#cb200-45" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Autoritär/Konservativ"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb200-46"><a href="#cb200-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb200-47"><a href="#cb200-47" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">50</span>,</span>
<span id="cb200-48"><a href="#cb200-48" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(parties_rating<span class="sc">$</span>socio_pct_min_y) <span class="sc">+</span> <span class="dv">103</span>,</span>
<span id="cb200-49"><a href="#cb200-49" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Libertär/Progressiv"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb200-50"><a href="#cb200-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="sc">+</span><span class="dv">110</span>)) <span class="sc">+</span></span>
<span id="cb200-51"><a href="#cb200-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Wirtschaftspolitisch"</span>,</span>
<span id="cb200-52"><a href="#cb200-52" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Gesellschaftspolitisch"</span>,</span>
<span id="cb200-53"><a href="#cb200-53" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Politische Positionierung im Zwei-Achsen-Modell"</span>,</span>
<span id="cb200-54"><a href="#cb200-54" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Durchschnitt des Abstimmungsverhaltens als Zentrum, Min-/Max als Ellipse"</span>) <span class="sc">+</span></span>
<span id="cb200-55"><a href="#cb200-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb200-56"><a href="#cb200-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>,</span>
<span id="cb200-57"><a href="#cb200-57" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">30</span>)),</span>
<span id="cb200-58"><a href="#cb200-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>,</span>
<span id="cb200-59"><a href="#cb200-59" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">5</span>)),</span>
<span id="cb200-60"><a href="#cb200-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>,</span>
<span id="cb200-61"><a href="#cb200-61" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">5</span>))) <span class="sc">+</span></span>
<span id="cb200-62"><a href="#cb200-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb200-63"><a href="#cb200-63" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb200-64"><a href="#cb200-64" aria-hidden="true" tabindex="-1"></a>                  <span class="at">clip =</span> <span class="st">"off"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cas_thesis_data_prep_files/figure-html/plot_parties_avg_min_max_incl_minor-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="d-koordinatensystem-testweise" class="level3" data-number="3.7.2">
<h3 data-number="3.7.2" class="anchored" data-anchor-id="d-koordinatensystem-testweise"><span class="header-section-number">3.7.2</span> 3D-Koordinatensystem (Testweise)</h3>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Datenframe erstellen</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>parties <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Partei =</span> <span class="fu">c</span>(<span class="st">"SP"</span>, <span class="st">"SVP"</span>, <span class="st">"FDP"</span>, <span class="st">"GPS"</span>, <span class="st">"GLP"</span>, <span class="st">"Mitte"</span>, <span class="st">"EVP"</span>, <span class="st">"EDU"</span>),</span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Wirtschaft =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">85</span>, <span class="dv">80</span>, <span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">60</span>, <span class="dv">40</span>, <span class="dv">90</span>),      <span class="co"># Links = niedrig, Rechts = hoch</span></span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Gesellschaft =</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">20</span>, <span class="dv">55</span>, <span class="dv">90</span>, <span class="dv">75</span>, <span class="dv">45</span>, <span class="dv">50</span>, <span class="dv">20</span>),    <span class="co"># Libertär = hoch, Autoritär = niedrig</span></span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Kosmopolitismus =</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">15</span>, <span class="dv">60</span>, <span class="dv">95</span>, <span class="dv">85</span>, <span class="dv">50</span>, <span class="dv">55</span>, <span class="dv">20</span>)  <span class="co"># Kosmopolitisch = hoch, Nationalistisch = niedrig</span></span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb201-8"><a href="#cb201-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-9"><a href="#cb201-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Interaktives 3D-Scatterplot mit Plotly</span></span>
<span id="cb201-10"><a href="#cb201-10" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(</span>
<span id="cb201-11"><a href="#cb201-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> parties,</span>
<span id="cb201-12"><a href="#cb201-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="sc">~</span>Wirtschaft,</span>
<span id="cb201-13"><a href="#cb201-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="sc">~</span>Gesellschaft,</span>
<span id="cb201-14"><a href="#cb201-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">z =</span> <span class="sc">~</span>Kosmopolitismus,</span>
<span id="cb201-15"><a href="#cb201-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> <span class="sc">~</span>Partei,</span>
<span id="cb201-16"><a href="#cb201-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">'scatter3d'</span>,</span>
<span id="cb201-17"><a href="#cb201-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">'markers+text'</span>,</span>
<span id="cb201-18"><a href="#cb201-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">5</span>),</span>
<span id="cb201-19"><a href="#cb201-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">textposition =</span> <span class="st">'top center'</span></span>
<span id="cb201-20"><a href="#cb201-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb201-21"><a href="#cb201-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-22"><a href="#cb201-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Achsen benennen und Layout anpassen</span></span>
<span id="cb201-23"><a href="#cb201-23" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span> <span class="fu">layout</span>(</span>
<span id="cb201-24"><a href="#cb201-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">scene =</span> <span class="fu">list</span>(</span>
<span id="cb201-25"><a href="#cb201-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Wirtschaftspolitik (links – rechts)"</span>),</span>
<span id="cb201-26"><a href="#cb201-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Gesellschaftspolitik (autoritär – libertär)"</span>),</span>
<span id="cb201-27"><a href="#cb201-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">zaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Kosmopolitismus – Nationalismus"</span>)</span>
<span id="cb201-28"><a href="#cb201-28" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb201-29"><a href="#cb201-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Schweizer Parteien im 3D-Koordinatensystem nach Kitschelt"</span></span>
<span id="cb201-30"><a href="#cb201-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb201-31"><a href="#cb201-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-32"><a href="#cb201-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot anzeigen</span></span>
<span id="cb201-33"><a href="#cb201-33" aria-hidden="true" tabindex="-1"></a>fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-69a174861f8d21f089a4" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-69a174861f8d21f089a4">{"x":{"visdat":{"1f7048a47c8d":["function () ","plotlyVisDat"]},"cur_data":"1f7048a47c8d","attrs":{"1f7048a47c8d":{"x":{},"y":{},"z":{},"text":{},"mode":"markers+text","marker":{"size":5},"textposition":"top center","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Wirtschaftspolitik (links – rechts)"},"yaxis":{"title":"Gesellschaftspolitik (autoritär – libertär)"},"zaxis":{"title":"Kosmopolitismus – Nationalismus"}},"title":"Schweizer Parteien im 3D-Koordinatensystem nach Kitschelt","hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[20,85,80,30,60,60,40,90],"y":[90,20,55,90,75,45,50,20],"z":[90,15,60,95,85,50,55,20],"text":["SP","SVP","FDP","GPS","GLP","Mitte","EVP","EDU"],"mode":"markers+text","marker":{"color":"rgba(31,119,180,1)","size":5,"line":{"color":"rgba(31,119,180,1)"}},"textposition":["top center","top center","top center","top center","top center","top center","top center","top center"],"type":"scatter3d","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="tables-parties-rating" class="level3" data-number="3.7.3">
<h3 data-number="3.7.3" class="anchored" data-anchor-id="tables-parties-rating"><span class="header-section-number">3.7.3</span> Tables Parties Rating</h3>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Funktion für identische Formatierung</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>format_table <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># df[[1]] &lt;- as.character(df[[1]])</span></span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># df[[3]] &lt;- as.character(df[[3]])</span></span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">flextable</span>(df)</span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">theme_vanilla</span>(ft)</span>
<span id="cb202-7"><a href="#cb202-7" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">font</span>(ft, <span class="at">fontname =</span> <span class="st">"Courier New"</span>, <span class="at">part =</span> <span class="st">"all"</span>)</span>
<span id="cb202-8"><a href="#cb202-8" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">fontsize</span>(ft, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">part =</span> <span class="st">"all"</span>)</span>
<span id="cb202-9"><a href="#cb202-9" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">colformat_double</span>(ft, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb202-10"><a href="#cb202-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ft &lt;- colformat_double(ft, digits = 1, suffix = "%")</span></span>
<span id="cb202-11"><a href="#cb202-11" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">width</span>(ft, <span class="at">j =</span> <span class="dv">2</span>, <span class="at">width =</span> <span class="dv">2</span>)</span>
<span id="cb202-12"><a href="#cb202-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ft)</span>
<span id="cb202-13"><a href="#cb202-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb202-14"><a href="#cb202-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-15"><a href="#cb202-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabelle 1: Parties Rating</span></span>
<span id="cb202-16"><a href="#cb202-16" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">head</span>(parties_rating, <span class="dv">8</span>)</span>
<span id="cb202-17"><a href="#cb202-17" aria-hidden="true" tabindex="-1"></a>ft1 <span class="ot">&lt;-</span> <span class="fu">format_table</span>(df1)</span>
<span id="cb202-18"><a href="#cb202-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-19"><a href="#cb202-19" aria-hidden="true" tabindex="-1"></a><span class="co"># # Tabelle 2: ABGELEHNT</span></span>
<span id="cb202-20"><a href="#cb202-20" aria-hidden="true" tabindex="-1"></a><span class="co"># df2 &lt;- head(parties_rating)</span></span>
<span id="cb202-21"><a href="#cb202-21" aria-hidden="true" tabindex="-1"></a><span class="co"># ft2 &lt;- format_table(df2)</span></span>
<span id="cb202-22"><a href="#cb202-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-23"><a href="#cb202-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-24"><a href="#cb202-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Word-Dokument erstellen und beide Tabellen einfügen ---</span></span>
<span id="cb202-25"><a href="#cb202-25" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">read_docx</span>()</span>
<span id="cb202-26"><a href="#cb202-26" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">body_add_par</span>(doc,</span>
<span id="cb202-27"><a href="#cb202-27" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Rating der Parteien"</span>,</span>
<span id="cb202-28"><a href="#cb202-28" aria-hidden="true" tabindex="-1"></a>                    <span class="at">style =</span> <span class="st">"heading 1"</span>)</span>
<span id="cb202-29"><a href="#cb202-29" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">body_add_flextable</span>(doc,</span>
<span id="cb202-30"><a href="#cb202-30" aria-hidden="true" tabindex="-1"></a>                          ft1)</span>
<span id="cb202-31"><a href="#cb202-31" aria-hidden="true" tabindex="-1"></a><span class="co"># doc &lt;- body_add_par(doc, "") # Leerzeile</span></span>
<span id="cb202-32"><a href="#cb202-32" aria-hidden="true" tabindex="-1"></a><span class="co"># doc &lt;- body_add_par(doc,</span></span>
<span id="cb202-33"><a href="#cb202-33" aria-hidden="true" tabindex="-1"></a><span class="co">#                     "Ablehnung trotz fehlender Unterstützung durch Parolen",</span></span>
<span id="cb202-34"><a href="#cb202-34" aria-hidden="true" tabindex="-1"></a><span class="co">#                     style = "heading 1")</span></span>
<span id="cb202-35"><a href="#cb202-35" aria-hidden="true" tabindex="-1"></a><span class="co"># doc &lt;- body_add_flextable(doc,</span></span>
<span id="cb202-36"><a href="#cb202-36" aria-hidden="true" tabindex="-1"></a><span class="co">#                           ft2)</span></span>
<span id="cb202-37"><a href="#cb202-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-38"><a href="#cb202-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-39"><a href="#cb202-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Speichern </span></span>
<span id="cb202-40"><a href="#cb202-40" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(doc, <span class="at">target =</span> <span class="st">"result/Parties_Rating.docx"</span>)</span>
<span id="cb202-41"><a href="#cb202-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-42"><a href="#cb202-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-43"><a href="#cb202-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-44"><a href="#cb202-44" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(parties_rating)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 46 × 16
   Partei Partei_lang       `Grosse Partei` Relevanz_nationale_A…¹ eco_pct_min_x
   &lt;chr&gt;  &lt;chr&gt;             &lt;chr&gt;           &lt;chr&gt;                          &lt;dbl&gt;
 1 EVP    Evangelische Vol… y               Mittel                          24.5
 2 FDP    Freisinnig-demok… y               Sehr hoch                       74  
 3 GLP    Grünliberale Par… y               Mittel bis hoch                 50  
 4 GPS    Grüne             y               Hoch                            10.6
 5 Mitte  Die Mitte         y               Sehr hoch                       44.9
 6 SPS    SP                y               Sehr hoch                        0  
 7 SVP    Schweizerische V… y               Sehr hoch                       54.3
 8 UCSP   Christlichsozial… n               -                               NA  
 9 PDA    Partei der Arbeit n               Klein                           NA  
10 SD     Schweizer Demokr… n               Klein                           NA  
# ℹ 36 more rows
# ℹ abbreviated name: ¹​Relevanz_nationale_Abstimmungen
# ℹ 11 more variables: eco_pct_avg_x &lt;dbl&gt;, eco_pct_max_x &lt;dbl&gt;,
#   socio_pct_min_y &lt;dbl&gt;, socio_pct_avg_y &lt;dbl&gt;, socio_pct_max_y &lt;dbl&gt;,
#   Positionierung &lt;chr&gt;, eco_x &lt;dbl&gt;, socio_y &lt;dbl&gt;, Kommentar &lt;chr&gt;,
#   Quelle1 &lt;chr&gt;, Quelle2 &lt;chr&gt;</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="backup" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> BACKUP?!</h1>
</section>
<section id="visualization" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Visualization</h1>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>voting_5y_plot_data <span class="ot">&lt;-</span> voting_5y_long <span class="sc">%&gt;%</span> </span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(datum,</span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>         titel_kurz_d,</span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>         rechtsform,</span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a>         annahme)</span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a>split_list <span class="ot">&lt;-</span> voting_5y_plot_data <span class="sc">%&gt;%</span></span>
<span id="cb204-8"><a href="#cb204-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(rechtsform) <span class="sc">%&gt;%</span></span>
<span id="cb204-9"><a href="#cb204-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_split</span>()      </span>
<span id="cb204-10"><a href="#cb204-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-11"><a href="#cb204-11" aria-hidden="true" tabindex="-1"></a>voting_obli_referendum <span class="ot">&lt;-</span> split_list[[<span class="dv">1</span>]]</span>
<span id="cb204-12"><a href="#cb204-12" aria-hidden="true" tabindex="-1"></a>voting_faku_referendum <span class="ot">&lt;-</span> split_list[[<span class="dv">2</span>]]</span>
<span id="cb204-13"><a href="#cb204-13" aria-hidden="true" tabindex="-1"></a>voting_volksinitiative <span class="ot">&lt;-</span> split_list[[<span class="dv">3</span>]]</span>
<span id="cb204-14"><a href="#cb204-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-15"><a href="#cb204-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Heatmap erstellen</span></span>
<span id="cb204-16"><a href="#cb204-16" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> voting_5y_plot_data <span class="sc">%&gt;%</span></span>
<span id="cb204-17"><a href="#cb204-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">annahme =</span> <span class="fu">factor</span>(annahme, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Nein"</span>, <span class="st">"Ja"</span>)))</span>
<span id="cb204-18"><a href="#cb204-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-19"><a href="#cb204-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Heatmap</span></span>
<span id="cb204-20"><a href="#cb204-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data,</span>
<span id="cb204-21"><a href="#cb204-21" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> annahme,</span>
<span id="cb204-22"><a href="#cb204-22" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> titel_kurz_d,</span>
<span id="cb204-23"><a href="#cb204-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> annahme)) <span class="sc">+</span></span>
<span id="cb204-24"><a href="#cb204-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb204-25"><a href="#cb204-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Nein"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Ja"</span> <span class="ot">=</span> <span class="st">"green"</span>)) <span class="sc">+</span></span>
<span id="cb204-26"><a href="#cb204-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb204-27"><a href="#cb204-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Heatmap der Abstimmungsergebnisse"</span>,</span>
<span id="cb204-28"><a href="#cb204-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Ergebnis"</span>,</span>
<span id="cb204-29"><a href="#cb204-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Vorlage"</span>,</span>
<span id="cb204-30"><a href="#cb204-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Annahme"</span></span>
<span id="cb204-31"><a href="#cb204-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb204-32"><a href="#cb204-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb204-33"><a href="#cb204-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cas_thesis_data_prep_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> voting_5y_plot_data <span class="sc">%&gt;%</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">annahme =</span> <span class="fu">factor</span>(annahme, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"0"</span>,<span class="st">"1"</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Nein"</span>, <span class="st">"Ja"</span>)))</span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(plot_data<span class="sc">$</span>annahme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Nein" "Ja"  </code></pre>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data,</span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> annahme,</span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> titel_kurz_d,</span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> annahme)) <span class="sc">+</span></span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb207-6"><a href="#cb207-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Nein"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Ja"</span> <span class="ot">=</span> <span class="st">"green"</span>)) <span class="sc">+</span></span>
<span id="cb207-7"><a href="#cb207-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb207-8"><a href="#cb207-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Heatmap der Abstimmungsergebnisse"</span>,</span>
<span id="cb207-9"><a href="#cb207-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Ergebnis"</span>,</span>
<span id="cb207-10"><a href="#cb207-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Vorlage"</span>,</span>
<span id="cb207-11"><a href="#cb207-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Annahme"</span></span>
<span id="cb207-12"><a href="#cb207-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb207-13"><a href="#cb207-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb207-14"><a href="#cb207-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb207-15"><a href="#cb207-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> rechtsform, <span class="at">scales =</span> <span class="st">"free_y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cas_thesis_data_prep_files/figure-html/unnamed-chunk-30-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="tatsächliches-ergebnis-und-verteilung-der-parolen-ja-nein-keine" class="level4" data-number="5.0.0.1">
<h4 data-number="5.0.0.1" class="anchored" data-anchor-id="tatsächliches-ergebnis-und-verteilung-der-parolen-ja-nein-keine"><span class="header-section-number">5.0.0.1</span> Tatsächliches Ergebnis und Verteilung der Parolen (Ja-Nein-Keine)</h4>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verteilung Ja/Nein/Keine pro Abstimmung - State - 2020</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Tatsächliches Abstiummungsergebnis (annahme) auch abbilden</span></span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Split nach Staatsebene</span></span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a><span class="co"># tatsächliches Abstiummungsergebnis bei 0 (0) oder 100% (1) als PUnkt darstellen.</span></span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a><span class="co"># nicht nur state_parole_ sondern auch kt_parole_ und gemeinde_parole_ anzeigen.</span></span>
<span id="cb208-6"><a href="#cb208-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-7"><a href="#cb208-7" aria-hidden="true" tabindex="-1"></a><span class="do">##DATUMSFILTER##</span></span>
<span id="cb208-8"><a href="#cb208-8" aria-hidden="true" tabindex="-1"></a>jahr <span class="ot">&lt;-</span> <span class="dv">2020</span></span>
<span id="cb208-9"><a href="#cb208-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-10"><a href="#cb208-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Daten für den Balkenplot vorbereiten (alle parole-Spalten, Quelle extrahieren)</span></span>
<span id="cb208-11"><a href="#cb208-11" aria-hidden="true" tabindex="-1"></a>df_plot <span class="ot">&lt;-</span> voting_5y_long_strength_wtd_summary <span class="sc">%&gt;%</span></span>
<span id="cb208-12"><a href="#cb208-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> jahr) <span class="sc">%&gt;%</span></span>
<span id="cb208-13"><a href="#cb208-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(anr, <span class="fu">matches</span>(<span class="st">"^(state|kt|gemeinde)_parole_"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb208-14"><a href="#cb208-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb208-15"><a href="#cb208-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">matches</span>(<span class="st">"^(state|kt|gemeinde)_parole_"</span>),</span>
<span id="cb208-16"><a href="#cb208-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"parole_typ"</span>,</span>
<span id="cb208-17"><a href="#cb208-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"wert"</span></span>
<span id="cb208-18"><a href="#cb208-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb208-19"><a href="#cb208-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb208-20"><a href="#cb208-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">parole_quelle =</span> <span class="fu">case_when</span>(</span>
<span id="cb208-21"><a href="#cb208-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"^state_parole_"</span>, parole_typ) <span class="sc">~</span> <span class="st">"National- &amp; Ständerat"</span>,</span>
<span id="cb208-22"><a href="#cb208-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"^kt_parole_"</span>, parole_typ) <span class="sc">~</span> <span class="st">"Kantonsregierung*"</span>,</span>
<span id="cb208-23"><a href="#cb208-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"^gemeinde_parole_"</span>, parole_typ) <span class="sc">~</span> <span class="st">"Gemeinde*"</span></span>
<span id="cb208-24"><a href="#cb208-24" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb208-25"><a href="#cb208-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">parole_typ =</span> <span class="fu">case_when</span>(</span>
<span id="cb208-26"><a href="#cb208-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"_Nein$"</span>, parole_typ) <span class="sc">~</span> <span class="st">"Nein"</span>,</span>
<span id="cb208-27"><a href="#cb208-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"_Ja$"</span>, parole_typ) <span class="sc">~</span> <span class="st">"Ja"</span>,</span>
<span id="cb208-28"><a href="#cb208-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"_Keine$"</span>, parole_typ) <span class="sc">~</span> <span class="st">"Keine"</span></span>
<span id="cb208-29"><a href="#cb208-29" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb208-30"><a href="#cb208-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">anr =</span> <span class="fu">factor</span>(anr, <span class="at">levels =</span> <span class="fu">unique</span>(anr)),</span>
<span id="cb208-31"><a href="#cb208-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">parole_quelle =</span> <span class="fu">factor</span>(parole_quelle, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"National- &amp; Ständerat"</span>,</span>
<span id="cb208-32"><a href="#cb208-32" aria-hidden="true" tabindex="-1"></a>                                                     <span class="st">"Kantonsregierung*"</span>,</span>
<span id="cb208-33"><a href="#cb208-33" aria-hidden="true" tabindex="-1"></a>                                                     <span class="st">"Gemeinde*"</span>)))</span>
<span id="cb208-34"><a href="#cb208-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-35"><a href="#cb208-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Annahme-Daten für die Punkte vorbereiten</span></span>
<span id="cb208-36"><a href="#cb208-36" aria-hidden="true" tabindex="-1"></a>df_annahme <span class="ot">&lt;-</span> voting_5y_long_strength_wtd_summary <span class="sc">%&gt;%</span></span>
<span id="cb208-37"><a href="#cb208-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> jahr) <span class="sc">%&gt;%</span></span>
<span id="cb208-38"><a href="#cb208-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(anr, annahme) <span class="sc">%&gt;%</span></span>
<span id="cb208-39"><a href="#cb208-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb208-40"><a href="#cb208-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">anr =</span> <span class="fu">factor</span>(anr, <span class="at">levels =</span> <span class="fu">unique</span>(df_plot<span class="sc">$</span>anr)),</span>
<span id="cb208-41"><a href="#cb208-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">annahme =</span> <span class="fu">as.numeric</span>(annahme) <span class="co"># Annahme: 0 oder 1</span></span>
<span id="cb208-42"><a href="#cb208-42" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb208-43"><a href="#cb208-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-44"><a href="#cb208-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot mit Balken und Annahme-Punkt, getrennt nach parole_quelle</span></span>
<span id="cb208-45"><a href="#cb208-45" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb208-46"><a href="#cb208-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb208-47"><a href="#cb208-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_plot,</span>
<span id="cb208-48"><a href="#cb208-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> anr, <span class="at">y =</span> wert, <span class="at">fill =</span> parole_typ),</span>
<span id="cb208-49"><a href="#cb208-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">"identity"</span>,</span>
<span id="cb208-50"><a href="#cb208-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"fill"</span>,</span>
<span id="cb208-51"><a href="#cb208-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb208-52"><a href="#cb208-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb208-53"><a href="#cb208-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_annahme,</span>
<span id="cb208-54"><a href="#cb208-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> anr, <span class="at">y =</span> annahme),</span>
<span id="cb208-55"><a href="#cb208-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb208-56"><a href="#cb208-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb208-57"><a href="#cb208-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb208-58"><a href="#cb208-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> parole_quelle, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb208-59"><a href="#cb208-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb208-60"><a href="#cb208-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Abstimmung (anr)"</span>,</span>
<span id="cb208-61"><a href="#cb208-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Anteil"</span>,</span>
<span id="cb208-62"><a href="#cb208-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Parole"</span>,</span>
<span id="cb208-63"><a href="#cb208-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Verteilung Ja/Nein/Keine pro Abstimmung –"</span>, jahr),</span>
<span id="cb208-64"><a href="#cb208-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"* aggregiert, gewichtet nach Stimmberechtigten/Einwohner"</span>),</span>
<span id="cb208-65"><a href="#cb208-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Quelle: Eigene Berechnung"</span>)) <span class="sc">+</span></span>
<span id="cb208-66"><a href="#cb208-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb208-67"><a href="#cb208-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Ja"</span> <span class="ot">=</span> <span class="st">"#66A61E"</span>,</span>
<span id="cb208-68"><a href="#cb208-68" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Keine"</span> <span class="ot">=</span> <span class="st">"#BDBDBD"</span>,</span>
<span id="cb208-69"><a href="#cb208-69" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Nein"</span> <span class="ot">=</span> <span class="st">"#D95F02"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cas_thesis_data_prep_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_fill_brewer(palette = "Dark2")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: Nicht nur pro Jahr sondern auch Departement? Tatsächliche ja/nein/enthalten hinzufügen.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code anzeigen</summary>
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_plot,</span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> anr, <span class="at">y =</span> wert, <span class="at">fill =</span> parole_typ),</span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">"identity"</span>,</span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"fill"</span>,</span>
<span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">1</span></span>
<span id="cb211-8"><a href="#cb211-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb211-9"><a href="#cb211-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb211-10"><a href="#cb211-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_annahme,</span>
<span id="cb211-11"><a href="#cb211-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> anr, <span class="at">y =</span> annahme, <span class="at">shape =</span> <span class="st">"Abstimmungsergebnis"</span>),</span>
<span id="cb211-12"><a href="#cb211-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb211-13"><a href="#cb211-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb211-14"><a href="#cb211-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(</span>
<span id="cb211-15"><a href="#cb211-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">""</span>, <span class="co">#Abstimmungsergebnis</span></span>
<span id="cb211-16"><a href="#cb211-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Abstimmungsergebnis"</span> <span class="ot">=</span> <span class="dv">16</span>)</span>
<span id="cb211-17"><a href="#cb211-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb211-18"><a href="#cb211-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb211-19"><a href="#cb211-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Parolen:"</span>,</span>
<span id="cb211-20"><a href="#cb211-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Ja"</span> <span class="ot">=</span> <span class="st">"#66A61E"</span>, <span class="st">"Keine"</span> <span class="ot">=</span> <span class="st">"#BDBDBD"</span>, <span class="st">"Nein"</span> <span class="ot">=</span> <span class="st">"#D95F02"</span>)</span>
<span id="cb211-21"><a href="#cb211-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb211-22"><a href="#cb211-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb211-23"><a href="#cb211-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">1</span>),</span>
<span id="cb211-24"><a href="#cb211-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill  =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">2</span>)</span>
<span id="cb211-25"><a href="#cb211-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb211-26"><a href="#cb211-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb211-27"><a href="#cb211-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> parole_quelle, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb211-28"><a href="#cb211-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb211-29"><a href="#cb211-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Abstimmung (anr)"</span>,</span>
<span id="cb211-30"><a href="#cb211-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Anteil"</span>,</span>
<span id="cb211-31"><a href="#cb211-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Verteilung Ja/Nein/Keine pro Abstimmung –"</span>, jahr),</span>
<span id="cb211-32"><a href="#cb211-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"* aggregiert, gewichtet nach Stimmberechtigten/Einwohner"</span>,</span>
<span id="cb211-33"><a href="#cb211-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Quelle: Eigene Berechnung"</span></span>
<span id="cb211-34"><a href="#cb211-34" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb211-35"><a href="#cb211-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb211-36"><a href="#cb211-36" aria-hidden="true" tabindex="-1"></a>                          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb211-37"><a href="#cb211-37" aria-hidden="true" tabindex="-1"></a>                          <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cas_thesis_data_prep_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<!-- -->

</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb212" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "cas_thesis_data_prep"</span></span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "DaaniiH"</span></span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2025-06-01</span></span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb212-9"><a href="#cb212-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb212-10"><a href="#cb212-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: right</span></span>
<span id="cb212-11"><a href="#cb212-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 5</span></span>
<span id="cb212-12"><a href="#cb212-12" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb212-13"><a href="#cb212-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb212-14"><a href="#cb212-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Code anzeigen" # Optional, Text für den Aufklapp-Link</span></span>
<span id="cb212-15"><a href="#cb212-15" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true              # Optional, Toolbar für Code-Chunks</span></span>
<span id="cb212-16"><a href="#cb212-16" aria-hidden="true" tabindex="-1"></a><span class="co">    max-width: none</span></span>
<span id="cb212-17"><a href="#cb212-17" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb212-18"><a href="#cb212-18" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb212-19"><a href="#cb212-19" aria-hidden="true" tabindex="-1"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb212-20"><a href="#cb212-20" aria-hidden="true" tabindex="-1"></a><span class="an">number-sections:</span><span class="co"> true</span></span>
<span id="cb212-21"><a href="#cb212-21" aria-hidden="true" tabindex="-1"></a><span class="an">theme:</span><span class="co"> bootstrap</span></span>
<span id="cb212-22"><a href="#cb212-22" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb212-23"><a href="#cb212-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-24"><a href="#cb212-24" aria-hidden="true" tabindex="-1"></a><span class="fu"># Libraries</span></span>
<span id="cb212-25"><a href="#cb212-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-28"><a href="#cb212-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-29"><a href="#cb212-29" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load_libraries</span></span>
<span id="cb212-30"><a href="#cb212-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-31"><a href="#cb212-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb212-32"><a href="#cb212-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb212-33"><a href="#cb212-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pxmake)   <span class="co"># to load PX files</span></span>
<span id="cb212-34"><a href="#cb212-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pxR)      <span class="co"># to load PX files</span></span>
<span id="cb212-35"><a href="#cb212-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite) <span class="co"># to load JSON files</span></span>
<span id="cb212-36"><a href="#cb212-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-37"><a href="#cb212-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb212-38"><a href="#cb212-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-39"><a href="#cb212-39" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(writexl)  <span class="co"># Write Excel files</span></span>
<span id="cb212-40"><a href="#cb212-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-41"><a href="#cb212-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flextable) <span class="co"># Tables for Word</span></span>
<span id="cb212-42"><a href="#cb212-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(officer)   <span class="co"># Tables for Word</span></span>
<span id="cb212-43"><a href="#cb212-43" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effects)</span>
<span id="cb212-44"><a href="#cb212-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-45"><a href="#cb212-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-46"><a href="#cb212-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-47"><a href="#cb212-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)  <span class="co"># Diagrams</span></span>
<span id="cb212-48"><a href="#cb212-48" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggforce)  <span class="co"># Diagrams</span></span>
<span id="cb212-49"><a href="#cb212-49" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot) <span class="co"># Korrelation</span></span>
<span id="cb212-50"><a href="#cb212-50" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggcorrplot)</span>
<span id="cb212-51"><a href="#cb212-51" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb212-52"><a href="#cb212-52" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb212-53"><a href="#cb212-53" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb212-54"><a href="#cb212-54" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb212-55"><a href="#cb212-55" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pscl)</span>
<span id="cb212-56"><a href="#cb212-56" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb212-57"><a href="#cb212-57" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)   <span class="co"># Diagrams / Korrelation</span></span>
<span id="cb212-58"><a href="#cb212-58" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)   <span class="co"># Diagrams</span></span>
<span id="cb212-59"><a href="#cb212-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-60"><a href="#cb212-60" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)       <span class="co"># datatable()</span></span>
<span id="cb212-61"><a href="#cb212-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-62"><a href="#cb212-62" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span>
<span id="cb212-63"><a href="#cb212-63" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb212-64"><a href="#cb212-64" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb212-65"><a href="#cb212-65" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)    <span class="co"># am Schluss laden, u.a. select() greift sonst aufs falsche</span></span>
<span id="cb212-66"><a href="#cb212-66" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-67"><a href="#cb212-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-68"><a href="#cb212-68" aria-hidden="true" tabindex="-1"></a><span class="fu"># Functions</span></span>
<span id="cb212-69"><a href="#cb212-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-72"><a href="#cb212-72" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-73"><a href="#cb212-73" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load_functions</span></span>
<span id="cb212-74"><a href="#cb212-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-75"><a href="#cb212-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-76"><a href="#cb212-76" aria-hidden="true" tabindex="-1"></a><span class="do">### </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do">  </span></span>
<span id="cb212-77"><a href="#cb212-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Duplikate in df finden &amp; als $unique oder $duplicates selektionierbar machen</span></span>
<span id="cb212-78"><a href="#cb212-78" aria-hidden="true" tabindex="-1"></a>find_and_remove_duplicates <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb212-79"><a href="#cb212-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb212-80"><a href="#cb212-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique =</span> df[<span class="sc">!</span><span class="fu">duplicated</span>(df), ],</span>
<span id="cb212-81"><a href="#cb212-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">duplicates =</span> df[<span class="fu">duplicated</span>(df) <span class="sc">|</span> <span class="fu">duplicated</span>(df, <span class="at">fromLast =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb212-82"><a href="#cb212-82" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb212-83"><a href="#cb212-83" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb212-84"><a href="#cb212-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-85"><a href="#cb212-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-86"><a href="#cb212-86" aria-hidden="true" tabindex="-1"></a><span class="do">### </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do">  </span></span>
<span id="cb212-87"><a href="#cb212-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Aktive National- &amp; Ständeräte identifizieren und selektionierbar machen</span></span>
<span id="cb212-88"><a href="#cb212-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-89"><a href="#cb212-89" aria-hidden="true" tabindex="-1"></a>filter_active <span class="ot">&lt;-</span> <span class="cf">function</span>(data, von, bis) {</span>
<span id="cb212-90"><a href="#cb212-90" aria-hidden="true" tabindex="-1"></a>  von <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(von)</span>
<span id="cb212-91"><a href="#cb212-91" aria-hidden="true" tabindex="-1"></a>  bis <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(bis)</span>
<span id="cb212-92"><a href="#cb212-92" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">%&gt;%</span></span>
<span id="cb212-93"><a href="#cb212-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb212-94"><a href="#cb212-94" aria-hidden="true" tabindex="-1"></a>      DateJoining <span class="sc">&lt;=</span> bis,                      <span class="co"># Eintritt vor/am Ende d. Zeitraums</span></span>
<span id="cb212-95"><a href="#cb212-95" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(DateLeaving) <span class="sc">|</span> DateLeaving <span class="sc">&gt;=</span> von  <span class="co"># Kein Austritt/nach Beginn des Z..</span></span>
<span id="cb212-96"><a href="#cb212-96" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb212-97"><a href="#cb212-97" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb212-98"><a href="#cb212-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-99"><a href="#cb212-99" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-100"><a href="#cb212-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-101"><a href="#cb212-101" aria-hidden="true" tabindex="-1"></a><span class="fu"># **ETL: Extract, Transform, Load**</span></span>
<span id="cb212-102"><a href="#cb212-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-103"><a href="#cb212-103" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Daten werden aus verschiedenen Excel-Dateien ausgelesen, unabhängig davon, wie komplex oder verschachtelt sie sind (z. B. mehrere Sheets, verbundene Zellen, unterteilte Datenblöcke).</span>
<span id="cb212-104"><a href="#cb212-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-105"><a href="#cb212-105" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Bei Excel-Dateien mit mehreren Sheets werden Functions angewendet.</span>
<span id="cb212-106"><a href="#cb212-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-107"><a href="#cb212-107" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Header werden identifiziert und ggf. aus mehreren Zeilen zusammengesetzt.</span>
<span id="cb212-108"><a href="#cb212-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-109"><a href="#cb212-109" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Daten werden bereinigt, normalisiert und in das gewünschte Zielformat gebracht (z. B. Wide zu Long, Entfernen von Leerzeilen, Auflösen von verbundenen Zellen, Vereinheitlichung der Spaltenstruktur).</span>
<span id="cb212-110"><a href="#cb212-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-111"><a href="#cb212-111" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Die transformierten Daten werden für die weitere Analyse und Visualisation zu Verfügung gestellt.</span>
<span id="cb212-112"><a href="#cb212-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-113"><a href="#cb212-113" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lookup Tabellen</span></span>
<span id="cb212-114"><a href="#cb212-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-115"><a href="#cb212-115" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Kantone</span></span>
<span id="cb212-116"><a href="#cb212-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-119"><a href="#cb212-119" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-120"><a href="#cb212-120" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load_lookup_canton</span></span>
<span id="cb212-121"><a href="#cb212-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-122"><a href="#cb212-122" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataframe bilden für Lookup der Kantonsnamen/-Kürzel</span></span>
<span id="cb212-123"><a href="#cb212-123" aria-hidden="true" tabindex="-1"></a>lookup_kantone <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Kanton =</span> <span class="fu">c</span>(<span class="st">"Aargau"</span>, <span class="st">"Appenzell A. Rh."</span>,</span>
<span id="cb212-124"><a href="#cb212-124" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Appenzell I. Rh."</span>, <span class="st">"Basel-Landschaft"</span>,</span>
<span id="cb212-125"><a href="#cb212-125" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Basel-Stadt"</span>, <span class="st">"Bern"</span>, <span class="st">"Freiburg"</span>, <span class="st">"Genf"</span>,</span>
<span id="cb212-126"><a href="#cb212-126" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Glarus"</span>, <span class="st">"Graubünden"</span>, <span class="st">"Jura"</span>, <span class="st">"Luzern"</span>,</span>
<span id="cb212-127"><a href="#cb212-127" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Neuenburg"</span>, <span class="st">"Nidwalden"</span>, <span class="st">"Obwalden"</span>,</span>
<span id="cb212-128"><a href="#cb212-128" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Schaffhausen"</span>, <span class="st">"Schwyz"</span>, <span class="st">"Solothurn"</span>,</span>
<span id="cb212-129"><a href="#cb212-129" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"St. Gallen"</span>, <span class="st">"Tessin"</span>, <span class="st">"Thurgau"</span>, <span class="st">"Uri"</span>,</span>
<span id="cb212-130"><a href="#cb212-130" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Waadt"</span>, <span class="st">"Wallis"</span>, <span class="st">"Zug"</span>, <span class="st">"Zürich"</span>),</span>
<span id="cb212-131"><a href="#cb212-131" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Kt =</span> <span class="fu">c</span>(<span class="st">"AG"</span>, <span class="st">"AR"</span>, <span class="st">"AI"</span>, <span class="st">"BL"</span>, <span class="st">"BS"</span>,<span class="st">"BE"</span>, <span class="st">"FR"</span>, <span class="st">"GE"</span>,</span>
<span id="cb212-132"><a href="#cb212-132" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"GL"</span>, <span class="st">"GR"</span>, <span class="st">"JU"</span>, <span class="st">"LU"</span>, <span class="st">"NE"</span>,<span class="st">"NW"</span>, <span class="st">"OW"</span>, <span class="st">"SH"</span>,</span>
<span id="cb212-133"><a href="#cb212-133" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"SZ"</span>, <span class="st">"SO"</span>, <span class="st">"SG"</span>,<span class="st">"TI"</span>, <span class="st">"TG"</span>, <span class="st">"UR"</span>, <span class="st">"VD"</span>, <span class="st">"VS"</span>,</span>
<span id="cb212-134"><a href="#cb212-134" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"ZG"</span>, <span class="st">"ZH"</span>),</span>
<span id="cb212-135"><a href="#cb212-135" aria-hidden="true" tabindex="-1"></a>                             <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb212-136"><a href="#cb212-136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-137"><a href="#cb212-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-138"><a href="#cb212-138" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Wahlberechtigte</span></span>
<span id="cb212-139"><a href="#cb212-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-142"><a href="#cb212-142" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-143"><a href="#cb212-143" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load_lookup_wahlberechtigte</span></span>
<span id="cb212-144"><a href="#cb212-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-145"><a href="#cb212-145" aria-hidden="true" tabindex="-1"></a><span class="co"># Wahlberechtigte seit 1990</span></span>
<span id="cb212-146"><a href="#cb212-146" aria-hidden="true" tabindex="-1"></a>Wahlberechtigte_1990_2024 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/Wahlberechtigte_1990-2024.xlsx"</span>,</span>
<span id="cb212-147"><a href="#cb212-147" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">sheet =</span> <span class="st">"pivot_as_value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb212-148"><a href="#cb212-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">year =</span> Jahr,</span>
<span id="cb212-149"><a href="#cb212-149" aria-hidden="true" tabindex="-1"></a>         <span class="at">stimmberechtigte_avg_kt =</span> Stimmberechtigte_avg)</span>
<span id="cb212-150"><a href="#cb212-150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-151"><a href="#cb212-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-152"><a href="#cb212-152" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Parteien</span></span>
<span id="cb212-153"><a href="#cb212-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-156"><a href="#cb212-156" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-157"><a href="#cb212-157" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load_lookup_parties</span></span>
<span id="cb212-158"><a href="#cb212-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-159"><a href="#cb212-159" aria-hidden="true" tabindex="-1"></a><span class="co"># Konsolidierte, bereinigte Lookup-Tabelle einlesen</span></span>
<span id="cb212-160"><a href="#cb212-160" aria-hidden="true" tabindex="-1"></a>lookup_parties_consolidated_raw <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/lookup_parties_consolidated.xlsx"</span>)</span>
<span id="cb212-161"><a href="#cb212-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-162"><a href="#cb212-162" aria-hidden="true" tabindex="-1"></a><span class="co"># Duplikatzeilen anzeigen (für "party_orig_value")</span></span>
<span id="cb212-163"><a href="#cb212-163" aria-hidden="true" tabindex="-1"></a>duplikate <span class="ot">&lt;-</span> lookup_parties_consolidated_raw <span class="sc">%&gt;%</span></span>
<span id="cb212-164"><a href="#cb212-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(party_orig_value) <span class="sc">%&gt;%</span></span>
<span id="cb212-165"><a href="#cb212-165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-166"><a href="#cb212-166" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb212-167"><a href="#cb212-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-168"><a href="#cb212-168" aria-hidden="true" tabindex="-1"></a><span class="co"># Duplikate (von Execel nicht erkannt..) entfernen</span></span>
<span id="cb212-169"><a href="#cb212-169" aria-hidden="true" tabindex="-1"></a>lookup_parties_consolidated <span class="ot">&lt;-</span> lookup_parties_consolidated_raw <span class="sc">%&gt;%</span></span>
<span id="cb212-170"><a href="#cb212-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(party_orig_value, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb212-171"><a href="#cb212-171" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-172"><a href="#cb212-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-173"><a href="#cb212-173" aria-hidden="true" tabindex="-1"></a><span class="fu">### Parteilandschaft - Daten laden</span></span>
<span id="cb212-174"><a href="#cb212-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-177"><a href="#cb212-177" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-178"><a href="#cb212-178" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load_parties_rating</span></span>
<span id="cb212-179"><a href="#cb212-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-180"><a href="#cb212-180" aria-hidden="true" tabindex="-1"></a>parties_rating <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/parties_economic_socio-political_rating.xlsx"</span>,</span>
<span id="cb212-181"><a href="#cb212-181" aria-hidden="true" tabindex="-1"></a>                             <span class="at">sheet =</span> <span class="st">"matrix_eco-socio_enhanced"</span>)</span>
<span id="cb212-182"><a href="#cb212-182" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-183"><a href="#cb212-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-184"><a href="#cb212-184" aria-hidden="true" tabindex="-1"></a><span class="fu">## Wahlen - Daten laden &amp; Umformen</span></span>
<span id="cb212-185"><a href="#cb212-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-186"><a href="#cb212-186" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bundesebene</span></span>
<span id="cb212-187"><a href="#cb212-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-188"><a href="#cb212-188" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Nationalrat</span></span>
<span id="cb212-189"><a href="#cb212-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-192"><a href="#cb212-192" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-193"><a href="#cb212-193" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load_nationalrat</span></span>
<span id="cb212-194"><a href="#cb212-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-195"><a href="#cb212-195" aria-hidden="true" tabindex="-1"></a><span class="co"># Header laden</span></span>
<span id="cb212-196"><a href="#cb212-196" aria-hidden="true" tabindex="-1"></a>header <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">read_excel</span>(<span class="st">"data/je-d-17.02.02.02.01.01_BUND_NATIONALRAT.xlsx"</span>,</span>
<span id="cb212-197"><a href="#cb212-197" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">skip =</span> <span class="dv">0</span>,</span>
<span id="cb212-198"><a href="#cb212-198" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">n_max =</span> <span class="dv">1</span>)[<span class="dv">1</span>, ])</span>
<span id="cb212-199"><a href="#cb212-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-200"><a href="#cb212-200" aria-hidden="true" tabindex="-1"></a><span class="co"># Spaltennamen "Partei 1" zu "Partei" umbenennen</span></span>
<span id="cb212-201"><a href="#cb212-201" aria-hidden="true" tabindex="-1"></a>header[header <span class="sc">==</span> <span class="st">"Partei 1"</span>] <span class="ot">&lt;-</span> <span class="st">"Partei"</span></span>
<span id="cb212-202"><a href="#cb212-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-203"><a href="#cb212-203" aria-hidden="true" tabindex="-1"></a><span class="co"># Daten ab Zeile 4 (+25) mit diesem Header einlesen</span></span>
<span id="cb212-204"><a href="#cb212-204" aria-hidden="true" tabindex="-1"></a>elec_nationalrat <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/je-d-17.02.02.02.01.01_BUND_NATIONALRAT.xlsx"</span>,</span>
<span id="cb212-205"><a href="#cb212-205" aria-hidden="true" tabindex="-1"></a>                               <span class="at">skip =</span> <span class="dv">3</span>,</span>
<span id="cb212-206"><a href="#cb212-206" aria-hidden="true" tabindex="-1"></a>                               <span class="at">n_max =</span> <span class="dv">25</span>,</span>
<span id="cb212-207"><a href="#cb212-207" aria-hidden="true" tabindex="-1"></a>                               <span class="at">col_names =</span> header)</span>
<span id="cb212-208"><a href="#cb212-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-209"><a href="#cb212-209" aria-hidden="true" tabindex="-1"></a><span class="co"># Refernzen zu Fussnoten aus Parteispalte löschen</span></span>
<span id="cb212-210"><a href="#cb212-210" aria-hidden="true" tabindex="-1"></a>elec_nationalrat<span class="sc">$</span>Partei <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s*</span><span class="sc">\\</span><span class="st">d+$"</span>,</span>
<span id="cb212-211"><a href="#cb212-211" aria-hidden="true" tabindex="-1"></a>                               <span class="st">""</span>,</span>
<span id="cb212-212"><a href="#cb212-212" aria-hidden="true" tabindex="-1"></a>                               elec_nationalrat<span class="sc">$</span>Partei)</span>
<span id="cb212-213"><a href="#cb212-213" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-214"><a href="#cb212-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-215"><a href="#cb212-215" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Ständerat</span></span>
<span id="cb212-216"><a href="#cb212-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-219"><a href="#cb212-219" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-220"><a href="#cb212-220" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load_ständerat</span></span>
<span id="cb212-221"><a href="#cb212-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-222"><a href="#cb212-222" aria-hidden="true" tabindex="-1"></a><span class="co"># Header laden</span></span>
<span id="cb212-223"><a href="#cb212-223" aria-hidden="true" tabindex="-1"></a>header <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">read_excel</span>(<span class="st">"data/je-d-17.02.03.01_BUND_STÄNDERAT.xlsx"</span>,</span>
<span id="cb212-224"><a href="#cb212-224" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">skip =</span> <span class="dv">0</span>,</span>
<span id="cb212-225"><a href="#cb212-225" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">n_max =</span> <span class="dv">1</span>)[<span class="dv">1</span>, ])</span>
<span id="cb212-226"><a href="#cb212-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-227"><a href="#cb212-227" aria-hidden="true" tabindex="-1"></a><span class="co"># Daten ab Zeile 5 (+14) mit diesem Header einlesen</span></span>
<span id="cb212-228"><a href="#cb212-228" aria-hidden="true" tabindex="-1"></a>elec_ständerat <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/je-d-17.02.03.01_BUND_STÄNDERAT.xlsx"</span>,</span>
<span id="cb212-229"><a href="#cb212-229" aria-hidden="true" tabindex="-1"></a>                              <span class="at">skip =</span> <span class="dv">4</span>,</span>
<span id="cb212-230"><a href="#cb212-230" aria-hidden="true" tabindex="-1"></a>                              <span class="at">n_max =</span> <span class="dv">14</span>,</span>
<span id="cb212-231"><a href="#cb212-231" aria-hidden="true" tabindex="-1"></a>                              <span class="at">col_names =</span> header)</span>
<span id="cb212-232"><a href="#cb212-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-233"><a href="#cb212-233" aria-hidden="true" tabindex="-1"></a><span class="co"># Refernzen zu Fussnoten aus Parteispalte löschen</span></span>
<span id="cb212-234"><a href="#cb212-234" aria-hidden="true" tabindex="-1"></a>elec_ständerat<span class="sc">$</span>Partei <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s*</span><span class="sc">\\</span><span class="st">d+$"</span>,</span>
<span id="cb212-235"><a href="#cb212-235" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">""</span>,</span>
<span id="cb212-236"><a href="#cb212-236" aria-hidden="true" tabindex="-1"></a>                                   elec_ständerat<span class="sc">$</span>Partei)</span>
<span id="cb212-237"><a href="#cb212-237" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-238"><a href="#cb212-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-239"><a href="#cb212-239" aria-hidden="true" tabindex="-1"></a><span class="fu">#### National- &amp; Ständerat kombinieren</span></span>
<span id="cb212-240"><a href="#cb212-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-243"><a href="#cb212-243" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-244"><a href="#cb212-244" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: combine_parliament</span></span>
<span id="cb212-245"><a href="#cb212-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-246"><a href="#cb212-246" aria-hidden="true" tabindex="-1"></a><span class="co"># Spaltenüberschriften anschauen (unique) &amp; Fussnoten entfernen</span></span>
<span id="cb212-247"><a href="#cb212-247" aria-hidden="true" tabindex="-1"></a><span class="fu">make.unique</span>(<span class="fu">colnames</span>(elec_nationalrat))</span>
<span id="cb212-248"><a href="#cb212-248" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(elec_nationalrat) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">" </span><span class="sc">\\</span><span class="st">d+$"</span>,</span>
<span id="cb212-249"><a href="#cb212-249" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">""</span>,</span>
<span id="cb212-250"><a href="#cb212-250" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">colnames</span>(elec_nationalrat))</span>
<span id="cb212-251"><a href="#cb212-251" aria-hidden="true" tabindex="-1"></a><span class="fu">make.unique</span>(<span class="fu">colnames</span>(elec_nationalrat))</span>
<span id="cb212-252"><a href="#cb212-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-253"><a href="#cb212-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-254"><a href="#cb212-254" aria-hidden="true" tabindex="-1"></a><span class="fu">make.unique</span>(<span class="fu">colnames</span>(elec_ständerat))</span>
<span id="cb212-255"><a href="#cb212-255" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(elec_ständerat) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">" </span><span class="sc">\\</span><span class="st">d+$"</span>,</span>
<span id="cb212-256"><a href="#cb212-256" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">""</span>,</span>
<span id="cb212-257"><a href="#cb212-257" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">colnames</span>(elec_ständerat))</span>
<span id="cb212-258"><a href="#cb212-258" aria-hidden="true" tabindex="-1"></a><span class="fu">make.unique</span>(<span class="fu">colnames</span>(elec_ständerat))</span>
<span id="cb212-259"><a href="#cb212-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-260"><a href="#cb212-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-261"><a href="#cb212-261" aria-hidden="true" tabindex="-1"></a><span class="co"># df zusammenführen (Wide Format)</span></span>
<span id="cb212-262"><a href="#cb212-262" aria-hidden="true" tabindex="-1"></a>elec_nr_sr_combined_wide <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb212-263"><a href="#cb212-263" aria-hidden="true" tabindex="-1"></a>  elec_nationalrat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">role =</span> <span class="st">"Nationalrat"</span>),</span>
<span id="cb212-264"><a href="#cb212-264" aria-hidden="true" tabindex="-1"></a>  elec_ständerat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">role =</span> <span class="st">"Ständerat"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb212-265"><a href="#cb212-265" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(role, <span class="fu">everything</span>())</span>
<span id="cb212-266"><a href="#cb212-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-267"><a href="#cb212-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-268"><a href="#cb212-268" aria-hidden="true" tabindex="-1"></a><span class="co"># df ins Long Format umwandeln</span></span>
<span id="cb212-269"><a href="#cb212-269" aria-hidden="true" tabindex="-1"></a>elec_nr_sr_combined_long <span class="ot">&lt;-</span> elec_nr_sr_combined_wide <span class="sc">%&gt;%</span></span>
<span id="cb212-270"><a href="#cb212-270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">matches</span>(<span class="st">"^</span><span class="sc">\\</span><span class="st">d{4}$"</span>),            <span class="co"># Spalten mit 4 Ziffern</span></span>
<span id="cb212-271"><a href="#cb212-271" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"election_year"</span>,</span>
<span id="cb212-272"><a href="#cb212-272" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"n_seats"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-273"><a href="#cb212-273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">election_year =</span> <span class="fu">as.integer</span>(election_year),   <span class="co"># Jahr als Zahl</span></span>
<span id="cb212-274"><a href="#cb212-274" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_seats =</span> <span class="fu">as.numeric</span>(n_seats))               <span class="co"># Sitze als Zahl oder NA</span></span>
<span id="cb212-275"><a href="#cb212-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-276"><a href="#cb212-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-277"><a href="#cb212-277" aria-hidden="true" tabindex="-1"></a>current_year <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">"%Y"</span>))  <span class="co"># aktuelles Jahr</span></span>
<span id="cb212-278"><a href="#cb212-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-279"><a href="#cb212-279" aria-hidden="true" tabindex="-1"></a><span class="co"># Zeitreihe für jede Partei/role vervollständigen und Werte fortschreiben</span></span>
<span id="cb212-280"><a href="#cb212-280" aria-hidden="true" tabindex="-1"></a>elec_nr_sr_combined <span class="ot">&lt;-</span> elec_nr_sr_combined_long <span class="sc">%&gt;%</span></span>
<span id="cb212-281"><a href="#cb212-281" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">party_orig_value =</span> Partei) <span class="sc">%&gt;%</span></span>
<span id="cb212-282"><a href="#cb212-282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(role, party_orig_value) <span class="sc">%&gt;%</span></span>
<span id="cb212-283"><a href="#cb212-283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">election_year =</span> <span class="fu">as.integer</span>(election_year),   <span class="co"># temporär numerisch</span></span>
<span id="cb212-284"><a href="#cb212-284" aria-hidden="true" tabindex="-1"></a>         <span class="at">year =</span> election_year) <span class="sc">%&gt;%</span> </span>
<span id="cb212-285"><a href="#cb212-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">year =</span> <span class="fu">seq</span>(<span class="fu">min</span>(election_year,              <span class="co"># von min() </span></span>
<span id="cb212-286"><a href="#cb212-286" aria-hidden="true" tabindex="-1"></a>                          <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-287"><a href="#cb212-287" aria-hidden="true" tabindex="-1"></a>                      current_year,<span class="dv">1</span>),                <span class="co"># bis aktuelles Jahr</span></span>
<span id="cb212-288"><a href="#cb212-288" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">n_seats =</span> <span class="cn">NA</span>,</span>
<span id="cb212-289"><a href="#cb212-289" aria-hidden="true" tabindex="-1"></a>                       <span class="at">election_year =</span> <span class="cn">NA</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb212-290"><a href="#cb212-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(role,</span>
<span id="cb212-291"><a href="#cb212-291" aria-hidden="true" tabindex="-1"></a>          party_orig_value,</span>
<span id="cb212-292"><a href="#cb212-292" aria-hidden="true" tabindex="-1"></a>          year) <span class="sc">%&gt;%</span></span>
<span id="cb212-293"><a href="#cb212-293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">block =</span> <span class="fu">cumsum</span>(<span class="sc">!</span><span class="fu">is.na</span>(election_year))) <span class="sc">%&gt;%</span> </span>
<span id="cb212-294"><a href="#cb212-294" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Wahljahr als Block. fill() innerhalb Block, nicht über Wahlperioden hinweg.</span></span>
<span id="cb212-295"><a href="#cb212-295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(role,</span>
<span id="cb212-296"><a href="#cb212-296" aria-hidden="true" tabindex="-1"></a>           party_orig_value,</span>
<span id="cb212-297"><a href="#cb212-297" aria-hidden="true" tabindex="-1"></a>           block) <span class="sc">%&gt;%</span></span>
<span id="cb212-298"><a href="#cb212-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(election_year,</span>
<span id="cb212-299"><a href="#cb212-299" aria-hidden="true" tabindex="-1"></a>       n_seats,</span>
<span id="cb212-300"><a href="#cb212-300" aria-hidden="true" tabindex="-1"></a>       <span class="at">.direction =</span> <span class="st">"down"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-301"><a href="#cb212-301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb212-302"><a href="#cb212-302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb212-303"><a href="#cb212-303" aria-hidden="true" tabindex="-1"></a>    <span class="at">election_year =</span> <span class="fu">as.character</span>(election_year),      <span class="co"># zurück als character</span></span>
<span id="cb212-304"><a href="#cb212-304" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">as.character</span>(year)) <span class="sc">%&gt;%</span>                    <span class="co"># dito</span></span>
<span id="cb212-305"><a href="#cb212-305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>block)</span>
<span id="cb212-306"><a href="#cb212-306" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-307"><a href="#cb212-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-308"><a href="#cb212-308" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Ergebnis National &amp; Ständeratssitze</span></span>
<span id="cb212-309"><a href="#cb212-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-312"><a href="#cb212-312" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-313"><a href="#cb212-313" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: output_parliament</span></span>
<span id="cb212-314"><a href="#cb212-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-315"><a href="#cb212-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-316"><a href="#cb212-316" aria-hidden="true" tabindex="-1"></a><span class="co"># Ratssitze pro Jahr</span></span>
<span id="cb212-317"><a href="#cb212-317" aria-hidden="true" tabindex="-1"></a>elec_nr_sr_combined_sum_check <span class="ot">&lt;-</span> elec_nr_sr_combined <span class="sc">%&gt;%</span></span>
<span id="cb212-318"><a href="#cb212-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, role) <span class="sc">%&gt;%</span></span>
<span id="cb212-319"><a href="#cb212-319" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_n_seats =</span> <span class="fu">sum</span>(n_seats,</span>
<span id="cb212-320"><a href="#cb212-320" aria-hidden="true" tabindex="-1"></a>                                <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-321"><a href="#cb212-321" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-322"><a href="#cb212-322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n=</span><span class="cn">Inf</span>)</span>
<span id="cb212-323"><a href="#cb212-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-324"><a href="#cb212-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-325"><a href="#cb212-325" aria-hidden="true" tabindex="-1"></a><span class="co"># National- und Ständratssitze pro Partei und Jahr</span></span>
<span id="cb212-326"><a href="#cb212-326" aria-hidden="true" tabindex="-1"></a>elec_nr_sr_combined</span>
<span id="cb212-327"><a href="#cb212-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-328"><a href="#cb212-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-329"><a href="#cb212-329" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO: Clean-up evt. einmal nach ganzem load.</span></span>
<span id="cb212-330"><a href="#cb212-330" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean-up: Nicht mehr benötigte "election" Tabellen löschen</span></span>
<span id="cb212-331"><a href="#cb212-331" aria-hidden="true" tabindex="-1"></a> <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"^elec_"</span>)[       <span class="co"># Objekte die mit elec_ starten aber nicht</span></span>
<span id="cb212-332"><a href="#cb212-332" aria-hidden="true" tabindex="-1"></a>   <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"(_combined|_combined_sum_check)$"</span>, <span class="co"># auf all_combined oder all_final enden</span></span>
<span id="cb212-333"><a href="#cb212-333" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"^elec_"</span>))])</span>
<span id="cb212-334"><a href="#cb212-334" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-335"><a href="#cb212-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-336"><a href="#cb212-336" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Parteinamen Bund (für Lookup-Tabelle)</span></span>
<span id="cb212-337"><a href="#cb212-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-340"><a href="#cb212-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-341"><a href="#cb212-341" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: output_parliament_parties</span></span>
<span id="cb212-342"><a href="#cb212-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-343"><a href="#cb212-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-344"><a href="#cb212-344" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(elec_nr_sr_combined<span class="sc">$</span>party_orig_value)</span>
<span id="cb212-345"><a href="#cb212-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-346"><a href="#cb212-346" aria-hidden="true" tabindex="-1"></a><span class="co"># Parteien zwecks Lookup/Vereinheitlichung mit bereinigten Namen in df schreiben</span></span>
<span id="cb212-347"><a href="#cb212-347" aria-hidden="true" tabindex="-1"></a>lookup_input_nr_sr_parties_label  <span class="ot">&lt;-</span> elec_nr_sr_combined <span class="sc">%&gt;%</span></span>
<span id="cb212-348"><a href="#cb212-348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(party_orig_value) <span class="sc">%&gt;%</span></span>
<span id="cb212-349"><a href="#cb212-349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb212-350"><a href="#cb212-350" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">party_orig_value =</span> <span class="fu">toupper</span>(party_orig_value),</span>
<span id="cb212-351"><a href="#cb212-351" aria-hidden="true" tabindex="-1"></a>         <span class="at">short_name =</span> party_orig_value,</span>
<span id="cb212-352"><a href="#cb212-352" aria-hidden="true" tabindex="-1"></a>         <span class="at">short_name =</span> <span class="fu">if_else</span>(short_name <span class="sc">==</span> <span class="st">"DIE MITTE"</span>,      <span class="co"># Umbenennen</span></span>
<span id="cb212-353"><a href="#cb212-353" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"MITTE"</span>,</span>
<span id="cb212-354"><a href="#cb212-354" aria-hidden="true" tabindex="-1"></a>                              short_name),</span>
<span id="cb212-355"><a href="#cb212-355" aria-hidden="true" tabindex="-1"></a>         <span class="at">short_name =</span> <span class="fu">if_else</span>(short_name <span class="sc">==</span> <span class="st">"MCG (MCR)"</span>,      <span class="co"># Umbenennen</span></span>
<span id="cb212-356"><a href="#cb212-356" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"MCG"</span>,</span>
<span id="cb212-357"><a href="#cb212-357" aria-hidden="true" tabindex="-1"></a>                              short_name),</span>
<span id="cb212-358"><a href="#cb212-358" aria-hidden="true" tabindex="-1"></a>         <span class="at">short_name =</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">""</span>, short_name),            <span class="co"># . entfernen</span></span>
<span id="cb212-359"><a href="#cb212-359" aria-hidden="true" tabindex="-1"></a>         <span class="at">long_name =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb212-360"><a href="#cb212-360" aria-hidden="true" tabindex="-1"></a>         <span class="at">prefix =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb212-361"><a href="#cb212-361" aria-hidden="true" tabindex="-1"></a>         <span class="at">add_info =</span> <span class="cn">NA</span>,</span>
<span id="cb212-362"><a href="#cb212-362" aria-hidden="true" tabindex="-1"></a>         <span class="at">level =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb212-363"><a href="#cb212-363" aria-hidden="true" tabindex="-1"></a>         <span class="at">source =</span> <span class="st">"National_und_Ständerat"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-364"><a href="#cb212-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(party_orig_value,</span>
<span id="cb212-365"><a href="#cb212-365" aria-hidden="true" tabindex="-1"></a>         short_name,</span>
<span id="cb212-366"><a href="#cb212-366" aria-hidden="true" tabindex="-1"></a>         long_name,</span>
<span id="cb212-367"><a href="#cb212-367" aria-hidden="true" tabindex="-1"></a>         prefix,</span>
<span id="cb212-368"><a href="#cb212-368" aria-hidden="true" tabindex="-1"></a>         add_info,</span>
<span id="cb212-369"><a href="#cb212-369" aria-hidden="true" tabindex="-1"></a>         level,</span>
<span id="cb212-370"><a href="#cb212-370" aria-hidden="true" tabindex="-1"></a>         source) <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n=</span><span class="cn">Inf</span>)</span>
<span id="cb212-371"><a href="#cb212-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-372"><a href="#cb212-372" aria-hidden="true" tabindex="-1"></a><span class="co"># Output prüfen (unique/distinct)</span></span>
<span id="cb212-373"><a href="#cb212-373" aria-hidden="true" tabindex="-1"></a>lookup_input_nr_sr_parties_label <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span>
<span id="cb212-374"><a href="#cb212-374" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-375"><a href="#cb212-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-376"><a href="#cb212-376" aria-hidden="true" tabindex="-1"></a><span class="fu">### Kantonsebene - Kantonale Regierung (Exekutive)</span></span>
<span id="cb212-377"><a href="#cb212-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-378"><a href="#cb212-378" aria-hidden="true" tabindex="-1"></a>Die Kantonalen Abstimmungen finden nicht in allen kantonen gleichzeitg statt. Deshalb genauer die Räte/Konstellation zum Zeitpunkt der jeweiligen Abstimmung zu prüfen.</span>
<span id="cb212-379"><a href="#cb212-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-380"><a href="#cb212-380" aria-hidden="true" tabindex="-1"></a>Die Struktur der "schön formatierten" Exceldatei lässt keinen "simplen" Import zu.</span>
<span id="cb212-381"><a href="#cb212-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-382"><a href="#cb212-382" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>1 Excelsheet / Jahr</span>
<span id="cb212-383"><a href="#cb212-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-384"><a href="#cb212-384" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Header ist in Zeile 2 und nicht vollständig</span>
<span id="cb212-385"><a href="#cb212-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-386"><a href="#cb212-386" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Daten (für Kantone) starten in Zeile 4 aber enden auf Zeile 29 bevor es mit Kommentaren und Fussnoten weitergeht.</span>
<span id="cb212-387"><a href="#cb212-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-388"><a href="#cb212-388" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Dateipfad und gewünschte Sheets definieren</span></span>
<span id="cb212-389"><a href="#cb212-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-392"><a href="#cb212-392" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-393"><a href="#cb212-393" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: set_function_parameter_canton</span></span>
<span id="cb212-394"><a href="#cb212-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-395"><a href="#cb212-395" aria-hidden="true" tabindex="-1"></a>dateipfad <span class="ot">&lt;-</span> <span class="st">"data/je-d-17.02.06.01_KANTON_Kantonale_Regierungswahlen.xlsx"</span>  </span>
<span id="cb212-396"><a href="#cb212-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-397"><a href="#cb212-397" aria-hidden="true" tabindex="-1"></a><span class="do">##DATUMSFILTER##</span></span>
<span id="cb212-398"><a href="#cb212-398" aria-hidden="true" tabindex="-1"></a>selected_sheets <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"2025"</span>,<span class="st">"2024"</span>, <span class="st">"2023"</span>, <span class="st">"2022"</span>,<span class="st">"2021"</span>,<span class="st">"2020"</span>,<span class="st">"2019"</span>)</span>
<span id="cb212-399"><a href="#cb212-399" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-400"><a href="#cb212-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-401"><a href="#cb212-401" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Function laden</span></span>
<span id="cb212-402"><a href="#cb212-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-405"><a href="#cb212-405" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-406"><a href="#cb212-406" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load_function_canton</span></span>
<span id="cb212-407"><a href="#cb212-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-408"><a href="#cb212-408" aria-hidden="true" tabindex="-1"></a>import_election_data <span class="ot">&lt;-</span> <span class="cf">function</span>(dateipfad, sheetname) {</span>
<span id="cb212-409"><a href="#cb212-409" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-410"><a href="#cb212-410" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Headerzeilen einlesen  </span></span>
<span id="cb212-411"><a href="#cb212-411" aria-hidden="true" tabindex="-1"></a>  header <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(dateipfad,</span>
<span id="cb212-412"><a href="#cb212-412" aria-hidden="true" tabindex="-1"></a>                               <span class="at">sheet =</span> sheetname,</span>
<span id="cb212-413"><a href="#cb212-413" aria-hidden="true" tabindex="-1"></a>                               <span class="at">skip =</span> <span class="dv">1</span>,</span>
<span id="cb212-414"><a href="#cb212-414" aria-hidden="true" tabindex="-1"></a>                               <span class="at">n_max =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-415"><a href="#cb212-415" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>()</span>
<span id="cb212-416"><a href="#cb212-416" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-417"><a href="#cb212-417" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Header anpassen: Wahljahr vereinheitlichen und Kanton hinzufügen</span></span>
<span id="cb212-418"><a href="#cb212-418" aria-hidden="true" tabindex="-1"></a>  header[<span class="fu">grepl</span>(<span class="st">"^Wahljahr"</span>, header)] <span class="ot">&lt;-</span> <span class="st">"Wahljahr"</span> </span>
<span id="cb212-419"><a href="#cb212-419" aria-hidden="true" tabindex="-1"></a>  header <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Kanton"</span>, header)</span>
<span id="cb212-420"><a href="#cb212-420" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb212-421"><a href="#cb212-421" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Daten ab Zeile 4 importieren</span></span>
<span id="cb212-422"><a href="#cb212-422" aria-hidden="true" tabindex="-1"></a>  daten_raw <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(dateipfad,</span>
<span id="cb212-423"><a href="#cb212-423" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sheet =</span> sheetname,</span>
<span id="cb212-424"><a href="#cb212-424" aria-hidden="true" tabindex="-1"></a>                          <span class="at">skip =</span> <span class="dv">3</span>,</span>
<span id="cb212-425"><a href="#cb212-425" aria-hidden="true" tabindex="-1"></a>                          <span class="at">col_names =</span> header)</span>
<span id="cb212-426"><a href="#cb212-426" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-427"><a href="#cb212-427" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Zeilen ohne "Wahljahr" ausschliessen</span></span>
<span id="cb212-428"><a href="#cb212-428" aria-hidden="true" tabindex="-1"></a>  wahljahr_col <span class="ot">&lt;-</span> <span class="fu">names</span>(daten_raw)[<span class="fu">grepl</span>(<span class="st">"^Wahljahr"</span>,</span>
<span id="cb212-429"><a href="#cb212-429" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">names</span>(daten_raw))][<span class="dv">1</span>]</span>
<span id="cb212-430"><a href="#cb212-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(daten_raw)[<span class="fu">names</span>(daten_raw) <span class="sc">==</span> wahljahr_col] <span class="ot">&lt;-</span> <span class="st">"Wahljahr"</span></span>
<span id="cb212-431"><a href="#cb212-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-432"><a href="#cb212-432" aria-hidden="true" tabindex="-1"></a>  daten_wide <span class="ot">&lt;-</span> daten_raw <span class="sc">%&gt;%</span></span>
<span id="cb212-433"><a href="#cb212-433" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">suppressWarnings</span>(<span class="fu">as.numeric</span>(.data[[wahljahr_col]]))))</span>
<span id="cb212-434"><a href="#cb212-434" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-435"><a href="#cb212-435" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Zu pivotierenden Spalten in numeric umwandeln</span></span>
<span id="cb212-436"><a href="#cb212-436" aria-hidden="true" tabindex="-1"></a>  cols_pivot <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(daten_wide),</span>
<span id="cb212-437"><a href="#cb212-437" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">c</span>(<span class="st">"Kanton"</span>, wahljahr_col))</span>
<span id="cb212-438"><a href="#cb212-438" aria-hidden="true" tabindex="-1"></a>  daten_wide <span class="ot">&lt;-</span> daten_wide <span class="sc">%&gt;%</span></span>
<span id="cb212-439"><a href="#cb212-439" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(cols_pivot),</span>
<span id="cb212-440"><a href="#cb212-440" aria-hidden="true" tabindex="-1"></a>                  as.numeric))</span>
<span id="cb212-441"><a href="#cb212-441" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb212-442"><a href="#cb212-442" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pivotieren</span></span>
<span id="cb212-443"><a href="#cb212-443" aria-hidden="true" tabindex="-1"></a>  daten_long <span class="ot">&lt;-</span> daten_wide <span class="sc">%&gt;%</span></span>
<span id="cb212-444"><a href="#cb212-444" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb212-445"><a href="#cb212-445" aria-hidden="true" tabindex="-1"></a>      <span class="at">cols =</span> <span class="fu">all_of</span>(cols_pivot),</span>
<span id="cb212-446"><a href="#cb212-446" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_to =</span> <span class="st">"Partei"</span>,</span>
<span id="cb212-447"><a href="#cb212-447" aria-hidden="true" tabindex="-1"></a>      <span class="at">values_to =</span> <span class="st">"Wert"</span>)</span>
<span id="cb212-448"><a href="#cb212-448" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-449"><a href="#cb212-449" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(daten_long)</span>
<span id="cb212-450"><a href="#cb212-450" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb212-451"><a href="#cb212-451" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-452"><a href="#cb212-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-453"><a href="#cb212-453" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Function ausführen &amp; Konsolidation aus Datenliste</span></span>
<span id="cb212-454"><a href="#cb212-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-457"><a href="#cb212-457" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-458"><a href="#cb212-458" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: run_function_canton</span></span>
<span id="cb212-459"><a href="#cb212-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-460"><a href="#cb212-460" aria-hidden="true" tabindex="-1"></a><span class="co"># Objekt erstellen, mit Sheets als tibble/dataframe</span></span>
<span id="cb212-461"><a href="#cb212-461" aria-hidden="true" tabindex="-1"></a>daten_liste <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">lapply</span>(selected_sheets,</span>
<span id="cb212-462"><a href="#cb212-462" aria-hidden="true" tabindex="-1"></a>                               <span class="cf">function</span>(sheet) <span class="fu">import_election_data</span> (dateipfad,</span>
<span id="cb212-463"><a href="#cb212-463" aria-hidden="true" tabindex="-1"></a>                                                                     sheet)),</span>
<span id="cb212-464"><a href="#cb212-464" aria-hidden="true" tabindex="-1"></a>                        selected_sheets)</span>
<span id="cb212-465"><a href="#cb212-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-466"><a href="#cb212-466" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(daten_liste)</span>
<span id="cb212-467"><a href="#cb212-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-468"><a href="#cb212-468" aria-hidden="true" tabindex="-1"></a><span class="co"># Alle tibbles zu einem Dataframe zusammenfügen</span></span>
<span id="cb212-469"><a href="#cb212-469" aria-hidden="true" tabindex="-1"></a>elec_canton_combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(daten_liste,</span>
<span id="cb212-470"><a href="#cb212-470" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">.id =</span> <span class="st">"year"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-471"><a href="#cb212-471" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">election_year =</span> Wahljahr,</span>
<span id="cb212-472"><a href="#cb212-472" aria-hidden="true" tabindex="-1"></a>         <span class="at">party_orig_value =</span> Partei,</span>
<span id="cb212-473"><a href="#cb212-473" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_seats =</span> Wert) <span class="sc">%&gt;%</span></span>
<span id="cb212-474"><a href="#cb212-474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">role =</span> <span class="st">"Kantonsregierung"</span>,</span>
<span id="cb212-475"><a href="#cb212-475" aria-hidden="true" tabindex="-1"></a>         <span class="at">election_year =</span> <span class="fu">as.character</span>(election_year)) <span class="sc">%&gt;%</span> </span>
<span id="cb212-476"><a href="#cb212-476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(party_orig_value <span class="sc">!=</span> <span class="st">"Total"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-477"><a href="#cb212-477" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lookup_kantone, <span class="at">by =</span> <span class="st">"Kanton"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-478"><a href="#cb212-478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(role,</span>
<span id="cb212-479"><a href="#cb212-479" aria-hidden="true" tabindex="-1"></a>         party_orig_value,</span>
<span id="cb212-480"><a href="#cb212-480" aria-hidden="true" tabindex="-1"></a>         year,</span>
<span id="cb212-481"><a href="#cb212-481" aria-hidden="true" tabindex="-1"></a>         election_year,</span>
<span id="cb212-482"><a href="#cb212-482" aria-hidden="true" tabindex="-1"></a>         n_seats,</span>
<span id="cb212-483"><a href="#cb212-483" aria-hidden="true" tabindex="-1"></a>         Kt,</span>
<span id="cb212-484"><a href="#cb212-484" aria-hidden="true" tabindex="-1"></a>         Kanton,</span>
<span id="cb212-485"><a href="#cb212-485" aria-hidden="true" tabindex="-1"></a>         <span class="fu">everything</span>())</span>
<span id="cb212-486"><a href="#cb212-486" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-487"><a href="#cb212-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-488"><a href="#cb212-488" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Ergebnis Kantonsregierung</span></span>
<span id="cb212-489"><a href="#cb212-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-492"><a href="#cb212-492" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-493"><a href="#cb212-493" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: output_canton</span></span>
<span id="cb212-494"><a href="#cb212-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-495"><a href="#cb212-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-496"><a href="#cb212-496" aria-hidden="true" tabindex="-1"></a><span class="co"># Ratssitze pro Jahr (nach-)prüfen</span></span>
<span id="cb212-497"><a href="#cb212-497" aria-hidden="true" tabindex="-1"></a>elec_canton_combined_sum_check <span class="ot">&lt;-</span> elec_canton_combined <span class="sc">%&gt;%</span></span>
<span id="cb212-498"><a href="#cb212-498" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, role) <span class="sc">%&gt;%</span></span>
<span id="cb212-499"><a href="#cb212-499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_n_seats =</span> <span class="fu">sum</span>(n_seats,</span>
<span id="cb212-500"><a href="#cb212-500" aria-hidden="true" tabindex="-1"></a>                                <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-501"><a href="#cb212-501" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-502"><a href="#cb212-502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n=</span><span class="cn">Inf</span>)</span>
<span id="cb212-503"><a href="#cb212-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-504"><a href="#cb212-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-505"><a href="#cb212-505" aria-hidden="true" tabindex="-1"></a><span class="co"># National- und Ständratssitze pro Partei und Jahr</span></span>
<span id="cb212-506"><a href="#cb212-506" aria-hidden="true" tabindex="-1"></a>elec_canton_combined</span>
<span id="cb212-507"><a href="#cb212-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-508"><a href="#cb212-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-509"><a href="#cb212-509" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO: Clean-up evt. einmal nach ganzem load.</span></span>
<span id="cb212-510"><a href="#cb212-510" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean-up: Nicht mehr benötigte "election" Tabellen löschen</span></span>
<span id="cb212-511"><a href="#cb212-511" aria-hidden="true" tabindex="-1"></a> <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"^elec_"</span>)[       <span class="co"># Objekte die mit elec_ starten aber nicht</span></span>
<span id="cb212-512"><a href="#cb212-512" aria-hidden="true" tabindex="-1"></a>   <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"(_combined|_combined_sum_check)$"</span>, <span class="co"># auf all_combined oder all_final enden</span></span>
<span id="cb212-513"><a href="#cb212-513" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"^elec_"</span>))])</span>
<span id="cb212-514"><a href="#cb212-514" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb212-515"><a href="#cb212-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-516"><a href="#cb212-516" aria-hidden="true" tabindex="-1"></a><span class="co"># datatable(elec_kantonale_regierung_combined,</span></span>
<span id="cb212-517"><a href="#cb212-517" aria-hidden="true" tabindex="-1"></a><span class="co">#           class = 'nowrap',</span></span>
<span id="cb212-518"><a href="#cb212-518" aria-hidden="true" tabindex="-1"></a><span class="co">#           filter = 'top',</span></span>
<span id="cb212-519"><a href="#cb212-519" aria-hidden="true" tabindex="-1"></a><span class="co">#           options = list(pageLength = 7,</span></span>
<span id="cb212-520"><a href="#cb212-520" aria-hidden="true" tabindex="-1"></a><span class="co">#                          scrollX = TRUE,</span></span>
<span id="cb212-521"><a href="#cb212-521" aria-hidden="true" tabindex="-1"></a><span class="co">#                          search = list(regex = TRUE,</span></span>
<span id="cb212-522"><a href="#cb212-522" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        caseInsensitive = TRUE)))</span></span>
<span id="cb212-523"><a href="#cb212-523" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-524"><a href="#cb212-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-525"><a href="#cb212-525" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Parteinamen Kanton (für Lookup-Tabelle)</span></span>
<span id="cb212-526"><a href="#cb212-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-529"><a href="#cb212-529" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-530"><a href="#cb212-530" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: output_canton_parties</span></span>
<span id="cb212-531"><a href="#cb212-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-532"><a href="#cb212-532" aria-hidden="true" tabindex="-1"></a><span class="co"># Parteinamenvarianten</span></span>
<span id="cb212-533"><a href="#cb212-533" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(elec_canton_combined<span class="sc">$</span>party_orig_value)</span>
<span id="cb212-534"><a href="#cb212-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-535"><a href="#cb212-535" aria-hidden="true" tabindex="-1"></a><span class="co"># Parteien zwecks Lookup/Vereinheitlichung mit bereinigten Namen in df schreiben</span></span>
<span id="cb212-536"><a href="#cb212-536" aria-hidden="true" tabindex="-1"></a>lookup_input_canton_parties_label <span class="ot">&lt;-</span> elec_canton_combined <span class="sc">%&gt;%</span></span>
<span id="cb212-537"><a href="#cb212-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">level =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb212-538"><a href="#cb212-538" aria-hidden="true" tabindex="-1"></a>         <span class="at">long_name =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb212-539"><a href="#cb212-539" aria-hidden="true" tabindex="-1"></a>         <span class="at">source =</span> <span class="st">"Kantonale_Regierung"</span>,</span>
<span id="cb212-540"><a href="#cb212-540" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb212-541"><a href="#cb212-541" aria-hidden="true" tabindex="-1"></a>         <span class="at">add_info =</span> <span class="fu">str_extract</span>(party_orig_value,</span>
<span id="cb212-542"><a href="#cb212-542" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"</span><span class="sc">\\</span><span class="st">d+(?=</span><span class="sc">\\</span><span class="st">)?$)"</span>),  <span class="co"># Zahl am Ende/vor Klammer-Ende</span></span>
<span id="cb212-543"><a href="#cb212-543" aria-hidden="true" tabindex="-1"></a>         <span class="at">short_name =</span> <span class="fu">str_remove</span>(party_orig_value,</span>
<span id="cb212-544"><a href="#cb212-544" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"</span><span class="sc">\\</span><span class="st">s*</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">)?$"</span>), <span class="co"># - Leerzeichen/Zahl/Klammer</span></span>
<span id="cb212-545"><a href="#cb212-545" aria-hidden="true" tabindex="-1"></a>         <span class="at">prefix =</span> <span class="cn">NA_character_</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-546"><a href="#cb212-546" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(party_orig_value,</span>
<span id="cb212-547"><a href="#cb212-547" aria-hidden="true" tabindex="-1"></a>         short_name,</span>
<span id="cb212-548"><a href="#cb212-548" aria-hidden="true" tabindex="-1"></a>         long_name,</span>
<span id="cb212-549"><a href="#cb212-549" aria-hidden="true" tabindex="-1"></a>         prefix,</span>
<span id="cb212-550"><a href="#cb212-550" aria-hidden="true" tabindex="-1"></a>         add_info,</span>
<span id="cb212-551"><a href="#cb212-551" aria-hidden="true" tabindex="-1"></a>         level,</span>
<span id="cb212-552"><a href="#cb212-552" aria-hidden="true" tabindex="-1"></a>         source) <span class="sc">%&gt;%</span></span>
<span id="cb212-553"><a href="#cb212-553" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Großschreibung der short_name-Spalte</span></span>
<span id="cb212-554"><a href="#cb212-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">short_name =</span> <span class="fu">toupper</span>(short_name)) </span>
<span id="cb212-555"><a href="#cb212-555" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb212-556"><a href="#cb212-556" aria-hidden="true" tabindex="-1"></a><span class="co"># Output prüfen (unique/distinct)</span></span>
<span id="cb212-557"><a href="#cb212-557" aria-hidden="true" tabindex="-1"></a>lookup_input_canton_parties_label <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span>
<span id="cb212-558"><a href="#cb212-558" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-559"><a href="#cb212-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-560"><a href="#cb212-560" aria-hidden="true" tabindex="-1"></a><span class="fu">### Gemeindeebene - Exekutiven der statistischen Städte</span></span>
<span id="cb212-561"><a href="#cb212-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-562"><a href="#cb212-562" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>1 Excelsheet / Jahr</span>
<span id="cb212-563"><a href="#cb212-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-564"><a href="#cb212-564" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Header zweizeilig mit Start in Zeile –<span class="sc">\&gt;</span> 3 <span class="in">`skip = 2, n_max = 2,`</span></span>
<span id="cb212-565"><a href="#cb212-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-566"><a href="#cb212-566" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Teils verbundene Header-Zeilen (vertikal/horizontal)</span>
<span id="cb212-567"><a href="#cb212-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-568"><a href="#cb212-568" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Cluster Einwohnerzahlen unterteilt Daten</span>
<span id="cb212-569"><a href="#cb212-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-570"><a href="#cb212-570" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Parteinamen uneinheitlich aufgrund von Fussnoten</span>
<span id="cb212-571"><a href="#cb212-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-572"><a href="#cb212-572" aria-hidden="true" tabindex="-1"></a>--<span class="sc">\&gt;</span> Datenformat "wide" zuerst bereinigen und ins "long" Format bringen</span>
<span id="cb212-573"><a href="#cb212-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-574"><a href="#cb212-574" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Dateipfad und gewünschte Sheets festlegen</span></span>
<span id="cb212-575"><a href="#cb212-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-578"><a href="#cb212-578" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-579"><a href="#cb212-579" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: set_function_parameter_gemeinde</span></span>
<span id="cb212-580"><a href="#cb212-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-581"><a href="#cb212-581" aria-hidden="true" tabindex="-1"></a>dateipfad <span class="ot">&lt;-</span> <span class="st">"data/je-d-17.02.07.01_GEMEINDE_Die Exekutiven der statistischen Städte.xlsx"</span></span>
<span id="cb212-582"><a href="#cb212-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-583"><a href="#cb212-583" aria-hidden="true" tabindex="-1"></a><span class="do">##DATUMSFILTER##</span></span>
<span id="cb212-584"><a href="#cb212-584" aria-hidden="true" tabindex="-1"></a>selected_sheets <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"2024"</span>, <span class="st">"2023"</span>, <span class="st">"2022"</span>,<span class="st">"2021"</span>,<span class="st">"2020"</span>,<span class="st">"2019"</span>) </span>
<span id="cb212-585"><a href="#cb212-585" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-586"><a href="#cb212-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-587"><a href="#cb212-587" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Function für den Import der Gemeindedaten</span></span>
<span id="cb212-588"><a href="#cb212-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-591"><a href="#cb212-591" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-592"><a href="#cb212-592" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load_function_Gemeinde</span></span>
<span id="cb212-593"><a href="#cb212-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-594"><a href="#cb212-594" aria-hidden="true" tabindex="-1"></a>importiere_sheet <span class="ot">&lt;-</span> <span class="cf">function</span>(dateipfad, sheetname) {</span>
<span id="cb212-595"><a href="#cb212-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-596"><a href="#cb212-596" aria-hidden="true" tabindex="-1"></a>      <span class="do">########## HEADER ##########################################</span></span>
<span id="cb212-597"><a href="#cb212-597" aria-hidden="true" tabindex="-1"></a>      <span class="do">########## Auslesen/Zusammensetzen ################################</span></span>
<span id="cb212-598"><a href="#cb212-598" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb212-599"><a href="#cb212-599" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Headerzeilen einlesen</span></span>
<span id="cb212-600"><a href="#cb212-600" aria-hidden="true" tabindex="-1"></a>      header <span class="ot">&lt;-</span> <span class="fu">suppressMessages</span>(<span class="fu">read_excel</span>(dateipfad,</span>
<span id="cb212-601"><a href="#cb212-601" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sheet =</span> sheetname,</span>
<span id="cb212-602"><a href="#cb212-602" aria-hidden="true" tabindex="-1"></a>                   <span class="at">skip =</span> <span class="dv">2</span>,</span>
<span id="cb212-603"><a href="#cb212-603" aria-hidden="true" tabindex="-1"></a>                   <span class="at">n_max =</span> <span class="dv">2</span>,</span>
<span id="cb212-604"><a href="#cb212-604" aria-hidden="true" tabindex="-1"></a>                   <span class="at">col_names =</span> <span class="cn">FALSE</span>))</span>
<span id="cb212-605"><a href="#cb212-605" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb212-606"><a href="#cb212-606" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Daten  einlesen</span></span>
<span id="cb212-607"><a href="#cb212-607" aria-hidden="true" tabindex="-1"></a>      daten_raw <span class="ot">&lt;-</span> <span class="fu">suppressMessages</span>(<span class="fu">read_excel</span>(dateipfad,</span>
<span id="cb212-608"><a href="#cb212-608" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sheet =</span> sheetname,</span>
<span id="cb212-609"><a href="#cb212-609" aria-hidden="true" tabindex="-1"></a>                              <span class="at">skip =</span> <span class="dv">5</span>,</span>
<span id="cb212-610"><a href="#cb212-610" aria-hidden="true" tabindex="-1"></a>                              <span class="at">col_names =</span> <span class="cn">FALSE</span>))</span>
<span id="cb212-611"><a href="#cb212-611" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb212-612"><a href="#cb212-612" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Spaltennamen zusammensetzen</span></span>
<span id="cb212-613"><a href="#cb212-613" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Leere Zellen in 1. Headerzeile mit Werten von rechts auffüllen wenn leer/NA</span></span>
<span id="cb212-614"><a href="#cb212-614" aria-hidden="true" tabindex="-1"></a>      header_filled <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(header))   <span class="co"># t() "matrix transpose"</span></span>
<span id="cb212-615"><a href="#cb212-615" aria-hidden="true" tabindex="-1"></a>      header_filled <span class="ot">&lt;-</span> <span class="fu">fill</span>(header_filled,        </span>
<span id="cb212-616"><a href="#cb212-616" aria-hidden="true" tabindex="-1"></a>                            V1,                   <span class="co"># Header Spalte 1 (V1) auffüllen</span></span>
<span id="cb212-617"><a href="#cb212-617" aria-hidden="true" tabindex="-1"></a>                            <span class="at">.direction =</span> <span class="st">"down"</span>)  <span class="co"># Werte nach unten übernehmen</span></span>
<span id="cb212-618"><a href="#cb212-618" aria-hidden="true" tabindex="-1"></a>      header_filled <span class="ot">&lt;-</span> <span class="fu">t</span>(header_filled)           <span class="co"># t() nochmals (zurück)</span></span>
<span id="cb212-619"><a href="#cb212-619" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb212-620"><a href="#cb212-620" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Spaltennamen kombinieren</span></span>
<span id="cb212-621"><a href="#cb212-621" aria-hidden="true" tabindex="-1"></a>      spaltennamen <span class="ot">&lt;-</span> <span class="fu">paste</span>(header_filled[<span class="dv">1</span>, ],</span>
<span id="cb212-622"><a href="#cb212-622" aria-hidden="true" tabindex="-1"></a>                            header_filled[<span class="dv">2</span>, ],</span>
<span id="cb212-623"><a href="#cb212-623" aria-hidden="true" tabindex="-1"></a>                            <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb212-624"><a href="#cb212-624" aria-hidden="true" tabindex="-1"></a>      spaltennamen <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"_NA|NA_"</span>,<span class="st">""</span>, spaltennamen) <span class="co"># Entfernt überflüssige NAs</span></span>
<span id="cb212-625"><a href="#cb212-625" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb212-626"><a href="#cb212-626" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Spaltennamen zuweisen</span></span>
<span id="cb212-627"><a href="#cb212-627" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(daten_raw) <span class="ot">&lt;-</span> spaltennamen</span>
<span id="cb212-628"><a href="#cb212-628" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb212-629"><a href="#cb212-629" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb212-630"><a href="#cb212-630" aria-hidden="true" tabindex="-1"></a>      <span class="do">########## TRANSPONIEREN ##########################################</span></span>
<span id="cb212-631"><a href="#cb212-631" aria-hidden="true" tabindex="-1"></a>      <span class="do">########## Gemeindegrössen Cluster ################################</span></span>
<span id="cb212-632"><a href="#cb212-632" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb212-633"><a href="#cb212-633" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Cluster Einwohnerzahl als Spalte verwenden</span></span>
<span id="cb212-634"><a href="#cb212-634" aria-hidden="true" tabindex="-1"></a>      daten_wide <span class="ot">&lt;-</span> daten_raw <span class="sc">%&gt;%</span></span>
<span id="cb212-635"><a href="#cb212-635" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(Gemeindegrösse<span class="at">_Cluster =</span>             <span class="co"># Name der neuen Spalte</span></span>
<span id="cb212-636"><a href="#cb212-636" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">ifelse</span>(</span>
<span id="cb212-637"><a href="#cb212-637" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">is.na</span>(                           <span class="co"># 4) auf NA prüfen</span></span>
<span id="cb212-638"><a href="#cb212-638" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">suppressWarnings</span>(        <span class="co"># 3) Warnung aus (z.B. "≥ ..Einw..")</span></span>
<span id="cb212-639"><a href="#cb212-639" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">as.numeric</span>(                    <span class="co"># 2) Wert als Zahl </span></span>
<span id="cb212-640"><a href="#cb212-640" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">gsub</span>(<span class="st">"'"</span>, <span class="st">""</span>, <span class="st">`</span><span class="at">Kantons-Nr.</span><span class="st">`</span>)   <span class="co"># 1) Tausender Zeichen (')                                                              entfernen</span></span>
<span id="cb212-641"><a href="#cb212-641" aria-hidden="true" tabindex="-1"></a>                   ))),</span>
<span id="cb212-642"><a href="#cb212-642" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">as.character</span>(<span class="st">`</span><span class="at">Kantons-Nr.</span><span class="st">`</span>),     <span class="co"># 5) Wert von "Kantons-Nr" </span></span>
<span id="cb212-643"><a href="#cb212-643" aria-hidden="true" tabindex="-1"></a>                   <span class="cn">NA_character_</span>                    <span class="co">#    sonst NA   </span></span>
<span id="cb212-644"><a href="#cb212-644" aria-hidden="true" tabindex="-1"></a>                 ))  <span class="sc">%&gt;%</span></span>
<span id="cb212-645"><a href="#cb212-645" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fill</span>(Gemeindegrösse_Cluster,</span>
<span id="cb212-646"><a href="#cb212-646" aria-hidden="true" tabindex="-1"></a>             <span class="at">.direction =</span> <span class="st">"down"</span>) <span class="sc">%&gt;%</span>              <span class="co"># Cluster nach unten auffüllen</span></span>
<span id="cb212-647"><a href="#cb212-647" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">suppressWarnings</span>(</span>
<span id="cb212-648"><a href="#cb212-648" aria-hidden="true" tabindex="-1"></a>          <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"'"</span>, <span class="st">""</span>, <span class="st">`</span><span class="at">Kantons-Nr.</span><span class="st">`</span>))))) <span class="co"># Herausfiltern von Zeilen                                                           mit NICHT-numerischem Wert</span></span>
<span id="cb212-649"><a href="#cb212-649" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb212-650"><a href="#cb212-650" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb212-651"><a href="#cb212-651" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ansicht (Snapshot) nach transponieren</span></span>
<span id="cb212-652"><a href="#cb212-652" aria-hidden="true" tabindex="-1"></a>    daten_wide[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,                    <span class="co"># 10 Zeilen</span></span>
<span id="cb212-653"><a href="#cb212-653" aria-hidden="true" tabindex="-1"></a>               <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,                  <span class="co"># 10 Spalten +</span></span>
<span id="cb212-654"><a href="#cb212-654" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">ncol</span>(daten_wide))]     <span class="co"># Letzte Spalte</span></span>
<span id="cb212-655"><a href="#cb212-655" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># ncol() von df daten_wide --&gt; Anz. Spalten</span></span>
<span id="cb212-656"><a href="#cb212-656" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># Anzahl Spalten = Position letzte Spalte</span></span>
<span id="cb212-657"><a href="#cb212-657" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb212-658"><a href="#cb212-658" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb212-659"><a href="#cb212-659" aria-hidden="true" tabindex="-1"></a>    <span class="do">########## TRANSPONIEREN ##########################################</span></span>
<span id="cb212-660"><a href="#cb212-660" aria-hidden="true" tabindex="-1"></a>    <span class="do">########## Frauen, Männer, Total &amp; Parteien ## ####################</span></span>
<span id="cb212-661"><a href="#cb212-661" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb212-662"><a href="#cb212-662" aria-hidden="true" tabindex="-1"></a>    daten_long <span class="ot">&lt;-</span> daten_wide <span class="sc">%&gt;%</span></span>
<span id="cb212-663"><a href="#cb212-663" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">matches</span>(<span class="st">"(_Frauen|_Männer|_Total)$"</span>),</span>
<span id="cb212-664"><a href="#cb212-664" aria-hidden="true" tabindex="-1"></a>                    <span class="sc">~</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.numeric</span>(.)))) <span class="sc">%&gt;%</span>       <span class="co"># Werte numerisch</span></span>
<span id="cb212-665"><a href="#cb212-665" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">matches</span>(<span class="st">"(_Frauen|_Männer|_Total)$"</span>),   <span class="co"># Spaltenauswahl</span></span>
<span id="cb212-666"><a href="#cb212-666" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"party_orig_value"</span>, <span class="st">"m_w_Total"</span>),  <span class="co"># Label-Spalte</span></span>
<span id="cb212-667"><a href="#cb212-667" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_pattern =</span> <span class="st">"^(.*)_(Frauen|Männer|Total)$"</span>,<span class="co"># RegEx</span></span>
<span id="cb212-668"><a href="#cb212-668" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"Wert"</span>)                            <span class="co"># Wert-Spalte</span></span>
<span id="cb212-669"><a href="#cb212-669" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb212-670"><a href="#cb212-670" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(daten_long)</span>
<span id="cb212-671"><a href="#cb212-671" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb212-672"><a href="#cb212-672" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-673"><a href="#cb212-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-674"><a href="#cb212-674" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Import der Dateien testen (optional)</span></span>
<span id="cb212-675"><a href="#cb212-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-678"><a href="#cb212-678" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-679"><a href="#cb212-679" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: run_test_function_Gemeinde</span></span>
<span id="cb212-680"><a href="#cb212-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-681"><a href="#cb212-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-682"><a href="#cb212-682" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (sheet <span class="cf">in</span> selected_sheets) {</span>
<span id="cb212-683"><a href="#cb212-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">-----------------------------</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb212-684"><a href="#cb212-684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Versuche Sheet:"</span>, sheet, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb212-685"><a href="#cb212-685" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb212-686"><a href="#cb212-686" aria-hidden="true" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> <span class="fu">importiere_sheet</span>(dateipfad, sheet)</span>
<span id="cb212-687"><a href="#cb212-687" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Sheet erfolgreich eingelesen:"</span>, sheet, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb212-688"><a href="#cb212-688" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Zusammenfassung:</span></span>
<span id="cb212-689"><a href="#cb212-689" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Anzahl Zeilen:"</span>, <span class="fu">nrow</span>(dat), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb212-690"><a href="#cb212-690" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Anzahl Spalten:"</span>, <span class="fu">ncol</span>(dat), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb212-691"><a href="#cb212-691" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Spaltennamen (erste 15):"</span>, <span class="fu">paste</span>(<span class="fu">names</span>(dat)[<span class="dv">1</span><span class="sc">:</span><span class="fu">min</span>(<span class="dv">15</span>, <span class="fu">ncol</span>(dat))], <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb212-692"><a href="#cb212-692" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span></span>
<span id="cb212-693"><a href="#cb212-693" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb212-694"><a href="#cb212-694" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Fehler beim Einlesen von Sheet:"</span>, sheet, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb212-695"><a href="#cb212-695" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Fehlermeldung:"</span>, e<span class="sc">$</span>message, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb212-696"><a href="#cb212-696" aria-hidden="true" tabindex="-1"></a>    <span class="cn">FALSE</span></span>
<span id="cb212-697"><a href="#cb212-697" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb212-698"><a href="#cb212-698" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb212-699"><a href="#cb212-699" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-700"><a href="#cb212-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-701"><a href="#cb212-701" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Function ausführen &amp; Konsolidation aus Datenliste</span></span>
<span id="cb212-702"><a href="#cb212-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-705"><a href="#cb212-705" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-706"><a href="#cb212-706" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: run_function_Gemeinde</span></span>
<span id="cb212-707"><a href="#cb212-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-708"><a href="#cb212-708" aria-hidden="true" tabindex="-1"></a><span class="co"># Objekt erstellen, mit Sheets als tibble/dataframe</span></span>
<span id="cb212-709"><a href="#cb212-709" aria-hidden="true" tabindex="-1"></a>daten_liste <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">lapply</span>(selected_sheets,</span>
<span id="cb212-710"><a href="#cb212-710" aria-hidden="true" tabindex="-1"></a>                               <span class="cf">function</span>(sheet) <span class="fu">importiere_sheet</span>(dateipfad, sheet)),</span>
<span id="cb212-711"><a href="#cb212-711" aria-hidden="true" tabindex="-1"></a>                        selected_sheets)</span>
<span id="cb212-712"><a href="#cb212-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-713"><a href="#cb212-713" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(daten_liste)</span>
<span id="cb212-714"><a href="#cb212-714" aria-hidden="true" tabindex="-1"></a><span class="co"># lapply(daten_liste, summary)</span></span>
<span id="cb212-715"><a href="#cb212-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-716"><a href="#cb212-716" aria-hidden="true" tabindex="-1"></a><span class="co"># Alle tibbles zu einem Dataframe zusammenfügen</span></span>
<span id="cb212-717"><a href="#cb212-717" aria-hidden="true" tabindex="-1"></a>elec_gemeinde_combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(daten_liste,</span>
<span id="cb212-718"><a href="#cb212-718" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">.id =</span> <span class="st">"year"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb212-719"><a href="#cb212-719" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(m_w_Total <span class="sc">==</span> <span class="st">"Total"</span>,</span>
<span id="cb212-720"><a href="#cb212-720" aria-hidden="true" tabindex="-1"></a>         party_orig_value <span class="sc">!=</span> <span class="st">"Total"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb212-721"><a href="#cb212-721" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">election_year =</span> Wahljahr,</span>
<span id="cb212-722"><a href="#cb212-722" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_seats =</span> Wert,</span>
<span id="cb212-723"><a href="#cb212-723" aria-hidden="true" tabindex="-1"></a>         <span class="at">Kt =</span> Kanton) <span class="sc">%&gt;%</span> </span>
<span id="cb212-724"><a href="#cb212-724" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">role =</span> <span class="st">"Gemeindeexekutive"</span>,</span>
<span id="cb212-725"><a href="#cb212-725" aria-hidden="true" tabindex="-1"></a>         <span class="at">election_year =</span> <span class="fu">as.character</span>(election_year)) <span class="sc">%&gt;%</span></span>
<span id="cb212-726"><a href="#cb212-726" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">'Grössenklasse-Nr.'</span>,</span>
<span id="cb212-727"><a href="#cb212-727" aria-hidden="true" tabindex="-1"></a>            Grössenklasse,</span>
<span id="cb212-728"><a href="#cb212-728" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">Kantons-Nr.</span><span class="st">`</span>,</span>
<span id="cb212-729"><a href="#cb212-729" aria-hidden="true" tabindex="-1"></a>            m_w_Total)) <span class="sc">%&gt;%</span></span>
<span id="cb212-730"><a href="#cb212-730" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lookup_kantone, <span class="at">by =</span> <span class="st">"Kt"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-731"><a href="#cb212-731" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(role,</span>
<span id="cb212-732"><a href="#cb212-732" aria-hidden="true" tabindex="-1"></a>         party_orig_value,</span>
<span id="cb212-733"><a href="#cb212-733" aria-hidden="true" tabindex="-1"></a>         year,</span>
<span id="cb212-734"><a href="#cb212-734" aria-hidden="true" tabindex="-1"></a>         election_year,</span>
<span id="cb212-735"><a href="#cb212-735" aria-hidden="true" tabindex="-1"></a>         n_seats,</span>
<span id="cb212-736"><a href="#cb212-736" aria-hidden="true" tabindex="-1"></a>         Kt,</span>
<span id="cb212-737"><a href="#cb212-737" aria-hidden="true" tabindex="-1"></a>         Kanton,</span>
<span id="cb212-738"><a href="#cb212-738" aria-hidden="true" tabindex="-1"></a>         <span class="fu">everything</span>())</span>
<span id="cb212-739"><a href="#cb212-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-740"><a href="#cb212-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-741"><a href="#cb212-741" aria-hidden="true" tabindex="-1"></a><span class="co">#  year in integer umwandeln</span></span>
<span id="cb212-742"><a href="#cb212-742" aria-hidden="true" tabindex="-1"></a>elec_gemeinde_combined<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(elec_gemeinde_combined<span class="sc">$</span>year))</span>
<span id="cb212-743"><a href="#cb212-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-744"><a href="#cb212-744" aria-hidden="true" tabindex="-1"></a><span class="co"># Fehlende Jahre ergänzen</span></span>
<span id="cb212-745"><a href="#cb212-745" aria-hidden="true" tabindex="-1"></a>current_year <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">"%Y"</span>))</span>
<span id="cb212-746"><a href="#cb212-746" aria-hidden="true" tabindex="-1"></a>max_year <span class="ot">&lt;-</span> <span class="fu">max</span>(elec_gemeinde_combined<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb212-747"><a href="#cb212-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-748"><a href="#cb212-748" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (max_year <span class="sc">&lt;</span> current_year) {</span>
<span id="cb212-749"><a href="#cb212-749" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Für jedes fehlende Jahr</span></span>
<span id="cb212-750"><a href="#cb212-750" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (y <span class="cf">in</span> (max_year<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>current_year) {</span>
<span id="cb212-751"><a href="#cb212-751" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Letzte Werte kopieren und Jahr anpassen</span></span>
<span id="cb212-752"><a href="#cb212-752" aria-hidden="true" tabindex="-1"></a>    last_year_data <span class="ot">&lt;-</span> elec_gemeinde_combined <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> max_year)</span>
<span id="cb212-753"><a href="#cb212-753" aria-hidden="true" tabindex="-1"></a>    last_year_data<span class="sc">$</span>year <span class="ot">&lt;-</span> y</span>
<span id="cb212-754"><a href="#cb212-754" aria-hidden="true" tabindex="-1"></a>    last_year_data<span class="sc">$</span>election_year <span class="ot">&lt;-</span> <span class="fu">as.character</span>(y)</span>
<span id="cb212-755"><a href="#cb212-755" aria-hidden="true" tabindex="-1"></a>    elec_gemeinde_combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(elec_gemeinde_combined, last_year_data)</span>
<span id="cb212-756"><a href="#cb212-756" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb212-757"><a href="#cb212-757" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb212-758"><a href="#cb212-758" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-759"><a href="#cb212-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-760"><a href="#cb212-760" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Ergebnis Gemeinde bzw. Exekutiven statistischer Städte</span></span>
<span id="cb212-761"><a href="#cb212-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-764"><a href="#cb212-764" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-765"><a href="#cb212-765" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: output_gemeinde</span></span>
<span id="cb212-766"><a href="#cb212-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-767"><a href="#cb212-767" aria-hidden="true" tabindex="-1"></a><span class="co"># Ratssitze pro Jahr (nach-)prüfen</span></span>
<span id="cb212-768"><a href="#cb212-768" aria-hidden="true" tabindex="-1"></a>elec_gemeinde_combined_sum_check <span class="ot">&lt;-</span> elec_gemeinde_combined <span class="sc">%&gt;%</span></span>
<span id="cb212-769"><a href="#cb212-769" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span>                         <span class="co"># Gruppieren nach Jahr</span></span>
<span id="cb212-770"><a href="#cb212-770" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">summe =</span> <span class="fu">sum</span>(n_seats, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="co"># Summe berechnen, NAs ignorieren</span></span>
<span id="cb212-771"><a href="#cb212-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-772"><a href="#cb212-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-773"><a href="#cb212-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-774"><a href="#cb212-774" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO: Clean-up evt. einmal nach ganzem load.</span></span>
<span id="cb212-775"><a href="#cb212-775" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean-up: Nicht mehr benötigte "election" Tabellen löschen</span></span>
<span id="cb212-776"><a href="#cb212-776" aria-hidden="true" tabindex="-1"></a> <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"^elec_"</span>)[       <span class="co"># Objekte die mit elec_ starten aber nicht</span></span>
<span id="cb212-777"><a href="#cb212-777" aria-hidden="true" tabindex="-1"></a>   <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"(_combined|_combined_sum_check)$"</span>, <span class="co"># auf all_combined oder all_final enden</span></span>
<span id="cb212-778"><a href="#cb212-778" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"^elec_"</span>))])</span>
<span id="cb212-779"><a href="#cb212-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-780"><a href="#cb212-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-781"><a href="#cb212-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-782"><a href="#cb212-782" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co"> Grosses Datatable, deshalb auskommentieren oder ander Lösung..</span></span>
<span id="cb212-783"><a href="#cb212-783" aria-hidden="true" tabindex="-1"></a><span class="co"># datatable(elec_gemeinde_exekutiven_combined,</span></span>
<span id="cb212-784"><a href="#cb212-784" aria-hidden="true" tabindex="-1"></a><span class="co">#           class = 'nowrap',</span></span>
<span id="cb212-785"><a href="#cb212-785" aria-hidden="true" tabindex="-1"></a><span class="co">#           filter = 'top',</span></span>
<span id="cb212-786"><a href="#cb212-786" aria-hidden="true" tabindex="-1"></a><span class="co">#           options = list(pageLength = 7,</span></span>
<span id="cb212-787"><a href="#cb212-787" aria-hidden="true" tabindex="-1"></a><span class="co">#                          scrollX = TRUE,</span></span>
<span id="cb212-788"><a href="#cb212-788" aria-hidden="true" tabindex="-1"></a><span class="co">#                          search = list(regex = TRUE,</span></span>
<span id="cb212-789"><a href="#cb212-789" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        caseInsensitive = TRUE)))</span></span>
<span id="cb212-790"><a href="#cb212-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-791"><a href="#cb212-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-792"><a href="#cb212-792" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-793"><a href="#cb212-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-794"><a href="#cb212-794" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Parteinamen Gemeinde (für Lookup-Tabelle)</span></span>
<span id="cb212-795"><a href="#cb212-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-798"><a href="#cb212-798" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-799"><a href="#cb212-799" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: output_gemeinde_parties</span></span>
<span id="cb212-800"><a href="#cb212-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-801"><a href="#cb212-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-802"><a href="#cb212-802" aria-hidden="true" tabindex="-1"></a><span class="co"># Parteinamenvarianten</span></span>
<span id="cb212-803"><a href="#cb212-803" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(elec_gemeinde_combined<span class="sc">$</span>party_orig_value)</span>
<span id="cb212-804"><a href="#cb212-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-805"><a href="#cb212-805" aria-hidden="true" tabindex="-1"></a><span class="co"># Parteien zwecks Lookup/Vereinheitlichung mit bereinigten Namen in df schreiben</span></span>
<span id="cb212-806"><a href="#cb212-806" aria-hidden="true" tabindex="-1"></a>lookup_input_gemeinde_parties_label <span class="ot">&lt;-</span> elec_gemeinde_combined <span class="sc">%&gt;%</span></span>
<span id="cb212-807"><a href="#cb212-807" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">add_info =</span> <span class="fu">str_extract</span>(party_orig_value,</span>
<span id="cb212-808"><a href="#cb212-808" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"</span><span class="sc">\\</span><span class="st">d+(?=</span><span class="sc">\\</span><span class="st">)?$)"</span>),  <span class="co"># Zahl am Ende/vor Klammer-Ende</span></span>
<span id="cb212-809"><a href="#cb212-809" aria-hidden="true" tabindex="-1"></a>         <span class="at">short_name =</span> <span class="fu">str_remove</span>(party_orig_value,</span>
<span id="cb212-810"><a href="#cb212-810" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"</span><span class="sc">\\</span><span class="st">s*</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">)?$"</span>), <span class="co"># - Leerzeichen/Zahl/Klammer</span></span>
<span id="cb212-811"><a href="#cb212-811" aria-hidden="true" tabindex="-1"></a>         <span class="at">long_name =</span> <span class="cn">NA_character_</span>, </span>
<span id="cb212-812"><a href="#cb212-812" aria-hidden="true" tabindex="-1"></a>         <span class="at">prefix =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb212-813"><a href="#cb212-813" aria-hidden="true" tabindex="-1"></a>         <span class="at">level =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb212-814"><a href="#cb212-814" aria-hidden="true" tabindex="-1"></a>         <span class="at">source =</span> <span class="st">"Gemeinde_Exekutiven"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb212-815"><a href="#cb212-815" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Großschreibung der short_name-Spalte</span></span>
<span id="cb212-816"><a href="#cb212-816" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">short_name =</span> <span class="fu">toupper</span>(short_name))<span class="sc">%&gt;%</span> </span>
<span id="cb212-817"><a href="#cb212-817" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(party_orig_value,</span>
<span id="cb212-818"><a href="#cb212-818" aria-hidden="true" tabindex="-1"></a>         short_name,</span>
<span id="cb212-819"><a href="#cb212-819" aria-hidden="true" tabindex="-1"></a>         long_name,</span>
<span id="cb212-820"><a href="#cb212-820" aria-hidden="true" tabindex="-1"></a>         prefix,</span>
<span id="cb212-821"><a href="#cb212-821" aria-hidden="true" tabindex="-1"></a>         add_info,</span>
<span id="cb212-822"><a href="#cb212-822" aria-hidden="true" tabindex="-1"></a>         level,</span>
<span id="cb212-823"><a href="#cb212-823" aria-hidden="true" tabindex="-1"></a>         source)</span>
<span id="cb212-824"><a href="#cb212-824" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-825"><a href="#cb212-825" aria-hidden="true" tabindex="-1"></a><span class="co"># Output prüfen (unique/distinct)</span></span>
<span id="cb212-826"><a href="#cb212-826" aria-hidden="true" tabindex="-1"></a>lookup_input_gemeinde_parties_label <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span>
<span id="cb212-827"><a href="#cb212-827" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-828"><a href="#cb212-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-829"><a href="#cb212-829" aria-hidden="true" tabindex="-1"></a><span class="fu">### Listen aller Staatsebenen konsolidieren &amp; einheitliche Parteinamen joinen</span></span>
<span id="cb212-830"><a href="#cb212-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-833"><a href="#cb212-833" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-834"><a href="#cb212-834" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: consolidation_parties_from_elec</span></span>
<span id="cb212-835"><a href="#cb212-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-836"><a href="#cb212-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-837"><a href="#cb212-837" aria-hidden="true" tabindex="-1"></a><span class="co"># In allen Dataframes die year-Spalte vereinheitlichen</span></span>
<span id="cb212-838"><a href="#cb212-838" aria-hidden="true" tabindex="-1"></a>elec_nr_sr_combined<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(elec_nr_sr_combined<span class="sc">$</span>year))</span>
<span id="cb212-839"><a href="#cb212-839" aria-hidden="true" tabindex="-1"></a>elec_canton_combined<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(elec_canton_combined<span class="sc">$</span>year))</span>
<span id="cb212-840"><a href="#cb212-840" aria-hidden="true" tabindex="-1"></a>elec_gemeinde_combined<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(elec_gemeinde_combined<span class="sc">$</span>year))</span>
<span id="cb212-841"><a href="#cb212-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-842"><a href="#cb212-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-843"><a href="#cb212-843" aria-hidden="true" tabindex="-1"></a>lookup_parties_consolidated <span class="sc">%&gt;%</span></span>
<span id="cb212-844"><a href="#cb212-844" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(party_orig_value) <span class="sc">%&gt;%</span></span>
<span id="cb212-845"><a href="#cb212-845" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb212-846"><a href="#cb212-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-847"><a href="#cb212-847" aria-hidden="true" tabindex="-1"></a>lookup_parties_consolidated <span class="sc">%&gt;%</span></span>
<span id="cb212-848"><a href="#cb212-848" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(party_orig_value, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb212-849"><a href="#cb212-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-850"><a href="#cb212-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-851"><a href="#cb212-851" aria-hidden="true" tabindex="-1"></a><span class="co">#write_xlsx(elec_all_combined,"tmp_elec_all_combined.xlsx")</span></span>
<span id="cb212-852"><a href="#cb212-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-853"><a href="#cb212-853" aria-hidden="true" tabindex="-1"></a><span class="co"># Vereinheitlichte Dataframes (Exekutiven je Staatsebene) konsolidieren</span></span>
<span id="cb212-854"><a href="#cb212-854" aria-hidden="true" tabindex="-1"></a>elec_all_combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(elec_nr_sr_combined,</span>
<span id="cb212-855"><a href="#cb212-855" aria-hidden="true" tabindex="-1"></a>                               elec_canton_combined,</span>
<span id="cb212-856"><a href="#cb212-856" aria-hidden="true" tabindex="-1"></a>                               elec_gemeinde_combined) <span class="sc">%&gt;%</span></span>
<span id="cb212-857"><a href="#cb212-857" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Lookup für einheiltiche Parteinamen anwenden</span></span>
<span id="cb212-858"><a href="#cb212-858" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lookup_parties_consolidated <span class="sc">%&gt;%</span></span>
<span id="cb212-859"><a href="#cb212-859" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(Partei,</span>
<span id="cb212-860"><a href="#cb212-860" aria-hidden="true" tabindex="-1"></a>                     Parteiname,</span>
<span id="cb212-861"><a href="#cb212-861" aria-hidden="true" tabindex="-1"></a>                     party_orig_value),</span>
<span id="cb212-862"><a href="#cb212-862" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">"party_orig_value"</span>,</span>
<span id="cb212-863"><a href="#cb212-863" aria-hidden="true" tabindex="-1"></a>            <span class="at">relationship =</span> <span class="st">"many-to-many"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-864"><a href="#cb212-864" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(Partei,</span>
<span id="cb212-865"><a href="#cb212-865" aria-hidden="true" tabindex="-1"></a>           Parteiname,</span>
<span id="cb212-866"><a href="#cb212-866" aria-hidden="true" tabindex="-1"></a>           <span class="at">.after =</span> party_orig_value)</span>
<span id="cb212-867"><a href="#cb212-867" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-868"><a href="#cb212-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-869"><a href="#cb212-869" aria-hidden="true" tabindex="-1"></a><span class="fu">### Clean-up "Election": Obsolete Objekte (nach Konsolidierung) löschen</span></span>
<span id="cb212-870"><a href="#cb212-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-873"><a href="#cb212-873" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-874"><a href="#cb212-874" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: clean_up_election_df</span></span>
<span id="cb212-875"><a href="#cb212-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-876"><a href="#cb212-876" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean-up entfernt Objekte die mit "elec_" starten, ausser bei Endung auf</span></span>
<span id="cb212-877"><a href="#cb212-877" aria-hidden="true" tabindex="-1"></a><span class="co"># "_all_combined" oder "_all_final"</span></span>
<span id="cb212-878"><a href="#cb212-878" aria-hidden="true" tabindex="-1"></a> <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"^elec_"</span>)[       <span class="co"># Objekte die mit elec_ starten aber nicht</span></span>
<span id="cb212-879"><a href="#cb212-879" aria-hidden="true" tabindex="-1"></a>   <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"(_all_combined|_all_final)$"</span>, <span class="co"># auf all_combined oder all_final enden</span></span>
<span id="cb212-880"><a href="#cb212-880" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"^elec_"</span>))])</span>
<span id="cb212-881"><a href="#cb212-881" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-882"><a href="#cb212-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-883"><a href="#cb212-883" aria-hidden="true" tabindex="-1"></a><span class="fu">### Parteistärken berechnen - Sitze aggregiert auf Staatsebene</span></span>
<span id="cb212-884"><a href="#cb212-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-885"><a href="#cb212-885" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Jahre eingrenzen</span></span>
<span id="cb212-886"><a href="#cb212-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-889"><a href="#cb212-889" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-890"><a href="#cb212-890" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: filter_years_in_office</span></span>
<span id="cb212-891"><a href="#cb212-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-892"><a href="#cb212-892" aria-hidden="true" tabindex="-1"></a><span class="do">##DATUMSFILTER##</span></span>
<span id="cb212-893"><a href="#cb212-893" aria-hidden="true" tabindex="-1"></a><span class="co"># Jahre eingrenzen</span></span>
<span id="cb212-894"><a href="#cb212-894" aria-hidden="true" tabindex="-1"></a>elec_all_combined_input <span class="ot">&lt;-</span>  elec_all_combined <span class="sc">%&gt;%</span> </span>
<span id="cb212-895"><a href="#cb212-895" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="st">"2019"</span>)</span>
<span id="cb212-896"><a href="#cb212-896" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-897"><a href="#cb212-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-898"><a href="#cb212-898" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Dataframes vereinheitlichen und ggfs. aggregieren</span></span>
<span id="cb212-899"><a href="#cb212-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-900"><a href="#cb212-900" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Staatsebene: National- und Ständerat "as is"</span></span>
<span id="cb212-901"><a href="#cb212-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-904"><a href="#cb212-904" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-905"><a href="#cb212-905" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: yio_state</span></span>
<span id="cb212-906"><a href="#cb212-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-907"><a href="#cb212-907" aria-hidden="true" tabindex="-1"></a>elec_nr_sr_lvl_state <span class="ot">&lt;-</span> elec_all_combined_input <span class="sc">%&gt;%</span></span>
<span id="cb212-908"><a href="#cb212-908" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(role <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ständerat"</span>,</span>
<span id="cb212-909"><a href="#cb212-909" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Nationalrat"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb212-910"><a href="#cb212-910" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,</span>
<span id="cb212-911"><a href="#cb212-911" aria-hidden="true" tabindex="-1"></a>           Partei) <span class="sc">%&gt;%</span></span>
<span id="cb212-912"><a href="#cb212-912" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_seats_sum =</span> <span class="fu">sum</span>(n_seats,</span>
<span id="cb212-913"><a href="#cb212-913" aria-hidden="true" tabindex="-1"></a>                              <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-914"><a href="#cb212-914" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-915"><a href="#cb212-915" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb212-916"><a href="#cb212-916" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_seats_pct =</span> <span class="dv">100</span> <span class="sc">*</span> n_seats_sum <span class="sc">/</span> <span class="fu">sum</span>(n_seats_sum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb212-917"><a href="#cb212-917" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb212-918"><a href="#cb212-918" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_seats_sum <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb212-919"><a href="#cb212-919" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-920"><a href="#cb212-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-921"><a href="#cb212-921" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Kantonsebene: Gewichtung nach Stimmberechtigten je Kanton für Aggregation auf Staatsebene</span></span>
<span id="cb212-922"><a href="#cb212-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-925"><a href="#cb212-925" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-926"><a href="#cb212-926" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: yio_canton</span></span>
<span id="cb212-927"><a href="#cb212-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-928"><a href="#cb212-928" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregiert auf Kantonsebene</span></span>
<span id="cb212-929"><a href="#cb212-929" aria-hidden="true" tabindex="-1"></a>elec_kanton_lvl_kt <span class="ot">&lt;-</span> elec_all_combined_input <span class="sc">%&gt;%</span></span>
<span id="cb212-930"><a href="#cb212-930" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(role <span class="sc">==</span> <span class="st">"Kantonsregierung"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-931"><a href="#cb212-931" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,</span>
<span id="cb212-932"><a href="#cb212-932" aria-hidden="true" tabindex="-1"></a>           Kt,</span>
<span id="cb212-933"><a href="#cb212-933" aria-hidden="true" tabindex="-1"></a>           Partei) <span class="sc">%&gt;%</span></span>
<span id="cb212-934"><a href="#cb212-934" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_seats_sum =</span> <span class="fu">sum</span>(n_seats,</span>
<span id="cb212-935"><a href="#cb212-935" aria-hidden="true" tabindex="-1"></a>                              <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-936"><a href="#cb212-936" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-937"><a href="#cb212-937" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,</span>
<span id="cb212-938"><a href="#cb212-938" aria-hidden="true" tabindex="-1"></a>           Kt) <span class="sc">%&gt;%</span></span>
<span id="cb212-939"><a href="#cb212-939" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_seats_pct =</span> <span class="dv">100</span> <span class="sc">*</span> n_seats_sum <span class="sc">/</span> <span class="fu">sum</span>(n_seats_sum,</span>
<span id="cb212-940"><a href="#cb212-940" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb212-941"><a href="#cb212-941" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb212-942"><a href="#cb212-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-943"><a href="#cb212-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-944"><a href="#cb212-944" aria-hidden="true" tabindex="-1"></a><span class="co"># integer vs. character --&gt; anpassen</span></span>
<span id="cb212-945"><a href="#cb212-945" aria-hidden="true" tabindex="-1"></a>Wahlberechtigte_1990_2024 <span class="ot">&lt;-</span> Wahlberechtigte_1990_2024 <span class="sc">%&gt;%</span></span>
<span id="cb212-946"><a href="#cb212-946" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(year)))</span>
<span id="cb212-947"><a href="#cb212-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-948"><a href="#cb212-948" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregiert auf Staatsebene</span></span>
<span id="cb212-949"><a href="#cb212-949" aria-hidden="true" tabindex="-1"></a>elec_kanton_lvl_state <span class="ot">&lt;-</span> elec_all_combined_input <span class="sc">%&gt;%</span></span>
<span id="cb212-950"><a href="#cb212-950" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(role <span class="sc">==</span> <span class="st">"Kantonsregierung"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-951"><a href="#cb212-951" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(Wahlberechtigte_1990_2024 <span class="sc">%&gt;%</span></span>
<span id="cb212-952"><a href="#cb212-952" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb212-953"><a href="#cb212-953" aria-hidden="true" tabindex="-1"></a>              <span class="fu">summarise</span>(<span class="at">stimmberechtigte_avg_state =</span> <span class="fu">sum</span>(stimmberechtigte_avg_kt,</span>
<span id="cb212-954"><a href="#cb212-954" aria-hidden="true" tabindex="-1"></a>                                                         <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb212-955"><a href="#cb212-955" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"year"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-956"><a href="#cb212-956" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_seats_weighted =</span> n_seats <span class="sc">*</span> stimmberechtigte_avg_state) <span class="sc">%&gt;%</span></span>
<span id="cb212-957"><a href="#cb212-957" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,</span>
<span id="cb212-958"><a href="#cb212-958" aria-hidden="true" tabindex="-1"></a>           Partei) <span class="sc">%&gt;%</span></span>
<span id="cb212-959"><a href="#cb212-959" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_seats_sum =</span> <span class="fu">sum</span>(n_seats,</span>
<span id="cb212-960"><a href="#cb212-960" aria-hidden="true" tabindex="-1"></a>                              <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-961"><a href="#cb212-961" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_seats_sum_weighted =</span> <span class="fu">sum</span>(n_seats_weighted,</span>
<span id="cb212-962"><a href="#cb212-962" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-963"><a href="#cb212-963" aria-hidden="true" tabindex="-1"></a>            <span class="at">stimmberechtigte_avg_state =</span> <span class="fu">first</span>(stimmberechtigte_avg_state),</span>
<span id="cb212-964"><a href="#cb212-964" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-965"><a href="#cb212-965" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb212-966"><a href="#cb212-966" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_seats_pct =</span></span>
<span id="cb212-967"><a href="#cb212-967" aria-hidden="true" tabindex="-1"></a>           <span class="dv">100</span> <span class="sc">*</span> n_seats_sum <span class="sc">/</span> <span class="fu">sum</span>(n_seats_sum,</span>
<span id="cb212-968"><a href="#cb212-968" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-969"><a href="#cb212-969" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_seats_pct_weighted =</span></span>
<span id="cb212-970"><a href="#cb212-970" aria-hidden="true" tabindex="-1"></a>           <span class="dv">100</span> <span class="sc">*</span> n_seats_sum_weighted <span class="sc">/</span> <span class="fu">sum</span>(n_seats_sum_weighted,</span>
<span id="cb212-971"><a href="#cb212-971" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb212-972"><a href="#cb212-972" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb212-973"><a href="#cb212-973" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-974"><a href="#cb212-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-975"><a href="#cb212-975" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Gemeindeebene: Gewichtung nach Einwohner je "statistische Stadt" aggregiert auf Kanton- und Staatsebene</span></span>
<span id="cb212-976"><a href="#cb212-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-979"><a href="#cb212-979" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-980"><a href="#cb212-980" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: yio_gemeinde</span></span>
<span id="cb212-981"><a href="#cb212-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-982"><a href="#cb212-982" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregiert auf Gemeindeebene</span></span>
<span id="cb212-983"><a href="#cb212-983" aria-hidden="true" tabindex="-1"></a>elec_gemeinde_lvl_gemeinde  <span class="ot">&lt;-</span> elec_all_combined_input <span class="sc">%&gt;%</span></span>
<span id="cb212-984"><a href="#cb212-984" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(role <span class="sc">==</span> <span class="st">"Gemeindeexekutive"</span>,</span>
<span id="cb212-985"><a href="#cb212-985" aria-hidden="true" tabindex="-1"></a>         n_seats <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-986"><a href="#cb212-986" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,</span>
<span id="cb212-987"><a href="#cb212-987" aria-hidden="true" tabindex="-1"></a>           Gemeinde,</span>
<span id="cb212-988"><a href="#cb212-988" aria-hidden="true" tabindex="-1"></a>           Partei) <span class="sc">%&gt;%</span></span>
<span id="cb212-989"><a href="#cb212-989" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_seats_sum =</span> <span class="fu">sum</span>(n_seats,</span>
<span id="cb212-990"><a href="#cb212-990" aria-hidden="true" tabindex="-1"></a>                              <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-991"><a href="#cb212-991" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-992"><a href="#cb212-992" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,</span>
<span id="cb212-993"><a href="#cb212-993" aria-hidden="true" tabindex="-1"></a>           Gemeinde) <span class="sc">%&gt;%</span></span>
<span id="cb212-994"><a href="#cb212-994" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_seats_pct =</span> <span class="dv">100</span><span class="sc">*</span> n_seats_sum <span class="sc">/</span> <span class="fu">sum</span>(n_seats_sum,</span>
<span id="cb212-995"><a href="#cb212-995" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb212-996"><a href="#cb212-996" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb212-997"><a href="#cb212-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-998"><a href="#cb212-998" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregiert auf Kantonsebene</span></span>
<span id="cb212-999"><a href="#cb212-999" aria-hidden="true" tabindex="-1"></a>elec_gemeinde_lvl_kt <span class="ot">&lt;-</span> elec_all_combined_input <span class="sc">%&gt;%</span></span>
<span id="cb212-1000"><a href="#cb212-1000" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(role <span class="sc">==</span> <span class="st">"Gemeindeexekutive"</span>,</span>
<span id="cb212-1001"><a href="#cb212-1001" aria-hidden="true" tabindex="-1"></a>         n_seats <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-1002"><a href="#cb212-1002" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,</span>
<span id="cb212-1003"><a href="#cb212-1003" aria-hidden="true" tabindex="-1"></a>           Kt,</span>
<span id="cb212-1004"><a href="#cb212-1004" aria-hidden="true" tabindex="-1"></a>           Gemeinde,</span>
<span id="cb212-1005"><a href="#cb212-1005" aria-hidden="true" tabindex="-1"></a>           Partei) <span class="sc">%&gt;%</span></span>
<span id="cb212-1006"><a href="#cb212-1006" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_seats_sum =</span> <span class="fu">sum</span>(n_seats, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-1007"><a href="#cb212-1007" aria-hidden="true" tabindex="-1"></a>            <span class="at">Einwohner =</span> <span class="fu">first</span>(Einwohner),</span>
<span id="cb212-1008"><a href="#cb212-1008" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-1009"><a href="#cb212-1009" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weighted_seats =</span> n_seats_sum <span class="sc">*</span> Einwohner) <span class="sc">%&gt;%</span></span>
<span id="cb212-1010"><a href="#cb212-1010" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,</span>
<span id="cb212-1011"><a href="#cb212-1011" aria-hidden="true" tabindex="-1"></a>           Kt,</span>
<span id="cb212-1012"><a href="#cb212-1012" aria-hidden="true" tabindex="-1"></a>           Partei) <span class="sc">%&gt;%</span></span>
<span id="cb212-1013"><a href="#cb212-1013" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_seats_sum =</span> <span class="fu">sum</span>(n_seats_sum,                  <span class="co"># ungewichtete Sitze</span></span>
<span id="cb212-1014"><a href="#cb212-1014" aria-hidden="true" tabindex="-1"></a>                              <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-1015"><a href="#cb212-1015" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_seats_sum_weighted =</span> <span class="fu">sum</span>(weighted_seats,      <span class="co"># gewichtete Sitze</span></span>
<span id="cb212-1016"><a href="#cb212-1016" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb212-1017"><a href="#cb212-1017" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-1018"><a href="#cb212-1018" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,</span>
<span id="cb212-1019"><a href="#cb212-1019" aria-hidden="true" tabindex="-1"></a>           Kt) <span class="sc">%&gt;%</span></span>
<span id="cb212-1020"><a href="#cb212-1020" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_seats_pct =</span> <span class="dv">100</span> <span class="sc">*</span>                                <span class="co"># ungewichtet %</span></span>
<span id="cb212-1021"><a href="#cb212-1021" aria-hidden="true" tabindex="-1"></a>           n_seats_sum <span class="sc">/</span> <span class="fu">sum</span>(n_seats_sum,</span>
<span id="cb212-1022"><a href="#cb212-1022" aria-hidden="true" tabindex="-1"></a>                             <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-1023"><a href="#cb212-1023" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_seats_pct_weighted =</span> <span class="dv">100</span> <span class="sc">*</span>                       <span class="co"># gewichtet %  </span></span>
<span id="cb212-1024"><a href="#cb212-1024" aria-hidden="true" tabindex="-1"></a>           n_seats_sum_weighted <span class="sc">/</span> <span class="fu">sum</span>(n_seats_sum_weighted,</span>
<span id="cb212-1025"><a href="#cb212-1025" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb212-1026"><a href="#cb212-1026" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb212-1027"><a href="#cb212-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1028"><a href="#cb212-1028" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregiert auf Staatsebene </span></span>
<span id="cb212-1029"><a href="#cb212-1029" aria-hidden="true" tabindex="-1"></a>elec_gemeinde_lvl_state <span class="ot">&lt;-</span> elec_all_combined_input <span class="sc">%&gt;%</span></span>
<span id="cb212-1030"><a href="#cb212-1030" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(role <span class="sc">==</span> <span class="st">"Gemeindeexekutive"</span>,</span>
<span id="cb212-1031"><a href="#cb212-1031" aria-hidden="true" tabindex="-1"></a>         n_seats <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-1032"><a href="#cb212-1032" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,</span>
<span id="cb212-1033"><a href="#cb212-1033" aria-hidden="true" tabindex="-1"></a>           Gemeinde,</span>
<span id="cb212-1034"><a href="#cb212-1034" aria-hidden="true" tabindex="-1"></a>           Partei) <span class="sc">%&gt;%</span></span>
<span id="cb212-1035"><a href="#cb212-1035" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_seats_sum =</span> <span class="fu">sum</span>(n_seats,</span>
<span id="cb212-1036"><a href="#cb212-1036" aria-hidden="true" tabindex="-1"></a>                              <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-1037"><a href="#cb212-1037" aria-hidden="true" tabindex="-1"></a>            <span class="at">Einwohner =</span> <span class="fu">first</span>(Einwohner),</span>
<span id="cb212-1038"><a href="#cb212-1038" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-1039"><a href="#cb212-1039" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weighted_seats =</span> n_seats_sum <span class="sc">*</span> Einwohner) <span class="sc">%&gt;%</span></span>
<span id="cb212-1040"><a href="#cb212-1040" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,</span>
<span id="cb212-1041"><a href="#cb212-1041" aria-hidden="true" tabindex="-1"></a>           Partei) <span class="sc">%&gt;%</span></span>
<span id="cb212-1042"><a href="#cb212-1042" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_seats_sum =</span> <span class="fu">sum</span>(n_seats_sum,                   <span class="co"># ungewichtete Sitze</span></span>
<span id="cb212-1043"><a href="#cb212-1043" aria-hidden="true" tabindex="-1"></a>                              <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-1044"><a href="#cb212-1044" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_seats_sum_weighted =</span> <span class="fu">sum</span>(weighted_seats,       <span class="co"># gewichtete Sitze</span></span>
<span id="cb212-1045"><a href="#cb212-1045" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-1046"><a href="#cb212-1046" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-1047"><a href="#cb212-1047" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb212-1048"><a href="#cb212-1048" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_seats_pct =</span> <span class="dv">100</span> <span class="sc">*</span></span>
<span id="cb212-1049"><a href="#cb212-1049" aria-hidden="true" tabindex="-1"></a>           n_seats_sum <span class="sc">/</span> <span class="fu">sum</span>(n_seats_sum,</span>
<span id="cb212-1050"><a href="#cb212-1050" aria-hidden="true" tabindex="-1"></a>                             <span class="at">na.rm =</span> <span class="cn">TRUE</span>),                  <span class="co"># ungewichtet %</span></span>
<span id="cb212-1051"><a href="#cb212-1051" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_seats_pct_weighted =</span> <span class="dv">100</span> <span class="sc">*</span></span>
<span id="cb212-1052"><a href="#cb212-1052" aria-hidden="true" tabindex="-1"></a>           n_seats_sum_weighted <span class="sc">/</span> <span class="fu">sum</span>(n_seats_sum_weighted,</span>
<span id="cb212-1053"><a href="#cb212-1053" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span>     <span class="co"># gewichtet %</span></span>
<span id="cb212-1054"><a href="#cb212-1054" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb212-1055"><a href="#cb212-1055" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-1056"><a href="#cb212-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1057"><a href="#cb212-1057" aria-hidden="true" tabindex="-1"></a><span class="fu">### Übersicht aller elec\_ dataframes</span></span>
<span id="cb212-1058"><a href="#cb212-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1059"><a href="#cb212-1059" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Function für df() Übersicht</span></span>
<span id="cb212-1060"><a href="#cb212-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1063"><a href="#cb212-1063" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-1064"><a href="#cb212-1064" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load_function_overview</span></span>
<span id="cb212-1065"><a href="#cb212-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1066"><a href="#cb212-1066" aria-hidden="true" tabindex="-1"></a>df_overview <span class="ot">&lt;-</span> <span class="cf">function</span>(df_name) {</span>
<span id="cb212-1067"><a href="#cb212-1067" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">get</span>(df_name)</span>
<span id="cb212-1068"><a href="#cb212-1068" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"===="</span>, df_name, <span class="st">"====</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb212-1069"><a href="#cb212-1069" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Anzahl Zeilen:"</span>, <span class="fu">nrow</span>(df), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb212-1070"><a href="#cb212-1070" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Anzahl Spalten:"</span>, <span class="fu">ncol</span>(df), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb212-1071"><a href="#cb212-1071" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Spaltennamen:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb212-1072"><a href="#cb212-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1073"><a href="#cb212-1073" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">names</span>(df))</span>
<span id="cb212-1074"><a href="#cb212-1074" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-1075"><a href="#cb212-1075" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Dynamische Sortierung: Nur vorhandene Spalten werden verwendet</span></span>
<span id="cb212-1076"><a href="#cb212-1076" aria-hidden="true" tabindex="-1"></a>  sort_cols <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb212-1077"><a href="#cb212-1077" aria-hidden="true" tabindex="-1"></a>  sort_orders <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb212-1078"><a href="#cb212-1078" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-1079"><a href="#cb212-1079" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1) Nach year (aufsteigend)</span></span>
<span id="cb212-1080"><a href="#cb212-1080" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"year"</span> <span class="sc">%in%</span> <span class="fu">names</span>(df)) {</span>
<span id="cb212-1081"><a href="#cb212-1081" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>year)</span>
<span id="cb212-1082"><a href="#cb212-1082" aria-hidden="true" tabindex="-1"></a>    sort_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(sort_cols, <span class="st">"year"</span>)</span>
<span id="cb212-1083"><a href="#cb212-1083" aria-hidden="true" tabindex="-1"></a>    sort_orders <span class="ot">&lt;-</span> <span class="fu">c</span>(sort_orders, <span class="cn">TRUE</span>) <span class="co"># TRUE = aufsteigend</span></span>
<span id="cb212-1084"><a href="#cb212-1084" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb212-1085"><a href="#cb212-1085" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2) Nach Gemeinde (alphabetisch)</span></span>
<span id="cb212-1086"><a href="#cb212-1086" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"Gemeinde"</span> <span class="sc">%in%</span> <span class="fu">names</span>(df)) {</span>
<span id="cb212-1087"><a href="#cb212-1087" aria-hidden="true" tabindex="-1"></a>    sort_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(sort_cols, <span class="st">"Gemeinde"</span>)</span>
<span id="cb212-1088"><a href="#cb212-1088" aria-hidden="true" tabindex="-1"></a>    sort_orders <span class="ot">&lt;-</span> <span class="fu">c</span>(sort_orders, <span class="cn">TRUE</span>)</span>
<span id="cb212-1089"><a href="#cb212-1089" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb212-1090"><a href="#cb212-1090" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3) Kt (alphabetisch)</span></span>
<span id="cb212-1091"><a href="#cb212-1091" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"Kt"</span> <span class="sc">%in%</span> <span class="fu">names</span>(df)) {</span>
<span id="cb212-1092"><a href="#cb212-1092" aria-hidden="true" tabindex="-1"></a>    sort_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(sort_cols, <span class="st">"Kt"</span>)</span>
<span id="cb212-1093"><a href="#cb212-1093" aria-hidden="true" tabindex="-1"></a>    sort_orders <span class="ot">&lt;-</span> <span class="fu">c</span>(sort_orders, <span class="cn">TRUE</span>)</span>
<span id="cb212-1094"><a href="#cb212-1094" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb212-1095"><a href="#cb212-1095" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4) n_seats_sum (absteigend)</span></span>
<span id="cb212-1096"><a href="#cb212-1096" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"n_seats_sum"</span> <span class="sc">%in%</span> <span class="fu">names</span>(df)) {</span>
<span id="cb212-1097"><a href="#cb212-1097" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">$</span>n_seats_sum <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>n_seats_sum)</span>
<span id="cb212-1098"><a href="#cb212-1098" aria-hidden="true" tabindex="-1"></a>    sort_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(sort_cols, <span class="st">"n_seats_sum"</span>)</span>
<span id="cb212-1099"><a href="#cb212-1099" aria-hidden="true" tabindex="-1"></a>    sort_orders <span class="ot">&lt;-</span> <span class="fu">c</span>(sort_orders, <span class="cn">FALSE</span>) <span class="co"># FALSE = absteigend</span></span>
<span id="cb212-1100"><a href="#cb212-1100" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb212-1101"><a href="#cb212-1101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-1102"><a href="#cb212-1102" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sortiere Dataframe, falls mindestens eine Sortierspalte vorhanden ist</span></span>
<span id="cb212-1103"><a href="#cb212-1103" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(sort_cols) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb212-1104"><a href="#cb212-1104" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Erzeuge eine Liste von Spalten für do.call(order, ...)</span></span>
<span id="cb212-1105"><a href="#cb212-1105" aria-hidden="true" tabindex="-1"></a>    order_args <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_along</span>(sort_cols), <span class="cf">function</span>(i) {</span>
<span id="cb212-1106"><a href="#cb212-1106" aria-hidden="true" tabindex="-1"></a>      col <span class="ot">&lt;-</span> df[[sort_cols[i]]]</span>
<span id="cb212-1107"><a href="#cb212-1107" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span>sort_orders[i]) <span class="sc">-</span>col <span class="cf">else</span> col</span>
<span id="cb212-1108"><a href="#cb212-1108" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb212-1109"><a href="#cb212-1109" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> df[<span class="fu">do.call</span>(order, order_args), ]</span>
<span id="cb212-1110"><a href="#cb212-1110" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb212-1111"><a href="#cb212-1111" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-1112"><a href="#cb212-1112" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prüfung auf gültige Zahlen in n_seats_sum</span></span>
<span id="cb212-1113"><a href="#cb212-1113" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"n_seats_sum"</span> <span class="sc">%in%</span> <span class="fu">names</span>(df)) {</span>
<span id="cb212-1114"><a href="#cb212-1114" aria-hidden="true" tabindex="-1"></a>    valid_rows <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>n_seats_sum) <span class="sc">&amp;</span> <span class="fu">is.finite</span>(<span class="fu">as.numeric</span>(df<span class="sc">$</span>n_seats_sum))</span>
<span id="cb212-1115"><a href="#cb212-1115" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">any</span>(<span class="sc">!</span>valid_rows)) {</span>
<span id="cb212-1116"><a href="#cb212-1116" aria-hidden="true" tabindex="-1"></a>      last_valid_row <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span>valid_rows)[<span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb212-1117"><a href="#cb212-1117" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb212-1118"><a href="#cb212-1118" aria-hidden="true" tabindex="-1"></a>      last_valid_row <span class="ot">&lt;-</span> <span class="fu">nrow</span>(df)</span>
<span id="cb212-1119"><a href="#cb212-1119" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb212-1120"><a href="#cb212-1120" aria-hidden="true" tabindex="-1"></a>    rows_to_show <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">max</span>(<span class="dv">1</span>, last_valid_row)</span>
<span id="cb212-1121"><a href="#cb212-1121" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Zeilen mit Zahlen in 'n_seats_sum' (sortiert):</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb212-1122"><a href="#cb212-1122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(df[rows_to_show, , <span class="at">drop =</span> <span class="cn">FALSE</span>])</span>
<span id="cb212-1123"><a href="#cb212-1123" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb212-1124"><a href="#cb212-1124" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Erste 3 Zeilen:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb212-1125"><a href="#cb212-1125" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">head</span>(df, <span class="dv">3</span>))</span>
<span id="cb212-1126"><a href="#cb212-1126" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb212-1127"><a href="#cb212-1127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb212-1128"><a href="#cb212-1128" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb212-1129"><a href="#cb212-1129" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-1130"><a href="#cb212-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1131"><a href="#cb212-1131" aria-hidden="true" tabindex="-1"></a><span class="fu">#### df für Übersicht definieren und Function ausführen</span></span>
<span id="cb212-1132"><a href="#cb212-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1135"><a href="#cb212-1135" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-1136"><a href="#cb212-1136" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: run_funcion_overview</span></span>
<span id="cb212-1137"><a href="#cb212-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1138"><a href="#cb212-1138" aria-hidden="true" tabindex="-1"></a><span class="co"># Liste der Dataframes</span></span>
<span id="cb212-1139"><a href="#cb212-1139" aria-hidden="true" tabindex="-1"></a>df_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"elec_gemeinde_lvl_gemeinde"</span>,</span>
<span id="cb212-1140"><a href="#cb212-1140" aria-hidden="true" tabindex="-1"></a>              <span class="st">"elec_gemeinde_lvl_kt"</span>,</span>
<span id="cb212-1141"><a href="#cb212-1141" aria-hidden="true" tabindex="-1"></a>              <span class="st">"elec_gemeinde_lvl_state"</span>,</span>
<span id="cb212-1142"><a href="#cb212-1142" aria-hidden="true" tabindex="-1"></a>              <span class="st">"elec_kanton_lvl_kt"</span>,</span>
<span id="cb212-1143"><a href="#cb212-1143" aria-hidden="true" tabindex="-1"></a>              <span class="st">"elec_kanton_lvl_state"</span>,</span>
<span id="cb212-1144"><a href="#cb212-1144" aria-hidden="true" tabindex="-1"></a>              <span class="st">"elec_nr_sr_lvl_state"</span>)</span>
<span id="cb212-1145"><a href="#cb212-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1146"><a href="#cb212-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1147"><a href="#cb212-1147" aria-hidden="true" tabindex="-1"></a><span class="co"># Übersicht für alle Dataframes erstellen</span></span>
<span id="cb212-1148"><a href="#cb212-1148" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (name <span class="cf">in</span> df_names) {</span>
<span id="cb212-1149"><a href="#cb212-1149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">df_overview</span>(name)</span>
<span id="cb212-1150"><a href="#cb212-1150" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb212-1151"><a href="#cb212-1151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-1152"><a href="#cb212-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1153"><a href="#cb212-1153" aria-hidden="true" tabindex="-1"></a><span class="fu">### Entwicklung über die Jahre?!</span></span>
<span id="cb212-1154"><a href="#cb212-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1155"><a href="#cb212-1155" aria-hidden="true" tabindex="-1"></a><span class="fu">## Abstimmungen - Daten laden &amp; Umformen</span></span>
<span id="cb212-1156"><a href="#cb212-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1159"><a href="#cb212-1159" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-1160"><a href="#cb212-1160" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO: Wofür?</span></span>
<span id="cb212-1161"><a href="#cb212-1161" aria-hidden="true" tabindex="-1"></a><span class="co">#  </span></span>
<span id="cb212-1162"><a href="#cb212-1162" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb212-1163"><a href="#cb212-1163" aria-hidden="true" tabindex="-1"></a><span class="co"># # Manuell migrierte Lookup Tabellen aus dem PDF-Codebook (swissvotes.ch) laden</span></span>
<span id="cb212-1164"><a href="#cb212-1164" aria-hidden="true" tabindex="-1"></a><span class="co"># # Parteien</span></span>
<span id="cb212-1165"><a href="#cb212-1165" aria-hidden="true" tabindex="-1"></a><span class="co"># lookups_codebook_parties &lt;- read_excel("data/lookup_codebook.xlsx",</span></span>
<span id="cb212-1166"><a href="#cb212-1166" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        sheet = "parties")</span></span>
<span id="cb212-1167"><a href="#cb212-1167" aria-hidden="true" tabindex="-1"></a><span class="co"># # Parteiparolen</span></span>
<span id="cb212-1168"><a href="#cb212-1168" aria-hidden="true" tabindex="-1"></a><span class="co"># lookups_codebook_paroles &lt;- read_excel("data/lookup_codebook.xlsx",</span></span>
<span id="cb212-1169"><a href="#cb212-1169" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        sheet = "paroles")</span></span>
<span id="cb212-1170"><a href="#cb212-1170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1171"><a href="#cb212-1171" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-1172"><a href="#cb212-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1173"><a href="#cb212-1173" aria-hidden="true" tabindex="-1"></a><span class="fu">### Swissvotes-Datensatz mit Abstimmungsdetails laden</span></span>
<span id="cb212-1174"><a href="#cb212-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1177"><a href="#cb212-1177" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-1178"><a href="#cb212-1178" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load_voting</span></span>
<span id="cb212-1179"><a href="#cb212-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1180"><a href="#cb212-1180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1181"><a href="#cb212-1181" aria-hidden="true" tabindex="-1"></a><span class="co"># Ergbenisse der Schweizweite Abstimmungen laden</span></span>
<span id="cb212-1182"><a href="#cb212-1182" aria-hidden="true" tabindex="-1"></a>voting_raw <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"data/abstimmungen_swissvotes_DATASET CSV 09-02-2025.csv"</span>,</span>
<span id="cb212-1183"><a href="#cb212-1183" aria-hidden="true" tabindex="-1"></a>                     <span class="at">delim =</span> <span class="st">";"</span>,</span>
<span id="cb212-1184"><a href="#cb212-1184" aria-hidden="true" tabindex="-1"></a>                     <span class="at">escape_double =</span> <span class="cn">FALSE</span>,</span>
<span id="cb212-1185"><a href="#cb212-1185" aria-hidden="true" tabindex="-1"></a>                     <span class="at">trim_ws =</span> <span class="cn">TRUE</span>,</span>
<span id="cb212-1186"><a href="#cb212-1186" aria-hidden="true" tabindex="-1"></a>                     <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb212-1187"><a href="#cb212-1187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1188"><a href="#cb212-1188" aria-hidden="true" tabindex="-1"></a><span class="co"># Datum formatieren</span></span>
<span id="cb212-1189"><a href="#cb212-1189" aria-hidden="true" tabindex="-1"></a>voting_raw <span class="ot">&lt;-</span> voting_raw <span class="sc">%&gt;%</span> </span>
<span id="cb212-1190"><a href="#cb212-1190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">datum =</span> <span class="fu">dmy</span>(datum))</span>
<span id="cb212-1191"><a href="#cb212-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1192"><a href="#cb212-1192" aria-hidden="true" tabindex="-1"></a><span class="do">##DATUMSFILTER##</span></span>
<span id="cb212-1193"><a href="#cb212-1193" aria-hidden="true" tabindex="-1"></a><span class="co"># Einträge vor 2019 exkludieren</span></span>
<span id="cb212-1194"><a href="#cb212-1194" aria-hidden="true" tabindex="-1"></a>voting_raw_5y <span class="ot">&lt;-</span> voting_raw <span class="sc">%&gt;%</span></span>
<span id="cb212-1195"><a href="#cb212-1195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(datum <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2019-01-01"</span>))</span>
<span id="cb212-1196"><a href="#cb212-1196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1197"><a href="#cb212-1197" aria-hidden="true" tabindex="-1"></a><span class="co"># #TODO: Löschen, nicht benötigt?!</span></span>
<span id="cb212-1198"><a href="#cb212-1198" aria-hidden="true" tabindex="-1"></a><span class="co"># # Abstimmungsdaten der letzten 5 Jahre in Vektor schreiben für spätere Selektion</span></span>
<span id="cb212-1199"><a href="#cb212-1199" aria-hidden="true" tabindex="-1"></a><span class="co"># voting_5y_dates &lt;- voting_5y %&gt;%</span></span>
<span id="cb212-1200"><a href="#cb212-1200" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(datum) %&gt;%</span></span>
<span id="cb212-1201"><a href="#cb212-1201" aria-hidden="true" tabindex="-1"></a><span class="co">#   distinct() %&gt;%</span></span>
<span id="cb212-1202"><a href="#cb212-1202" aria-hidden="true" tabindex="-1"></a><span class="co">#   pull(datum) %&gt;%</span></span>
<span id="cb212-1203"><a href="#cb212-1203" aria-hidden="true" tabindex="-1"></a><span class="co">#   as.character()</span></span>
<span id="cb212-1204"><a href="#cb212-1204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1205"><a href="#cb212-1205" aria-hidden="true" tabindex="-1"></a><span class="co"># Abstimmungen als datatable() anzeigen</span></span>
<span id="cb212-1206"><a href="#cb212-1206" aria-hidden="true" tabindex="-1"></a><span class="co"># datatable(voting_5y,</span></span>
<span id="cb212-1207"><a href="#cb212-1207" aria-hidden="true" tabindex="-1"></a><span class="co">#           class = 'nowrap',</span></span>
<span id="cb212-1208"><a href="#cb212-1208" aria-hidden="true" tabindex="-1"></a><span class="co">#           filter = 'top',</span></span>
<span id="cb212-1209"><a href="#cb212-1209" aria-hidden="true" tabindex="-1"></a><span class="co">#           options = list(pageLength = 7,</span></span>
<span id="cb212-1210"><a href="#cb212-1210" aria-hidden="true" tabindex="-1"></a><span class="co">#                          scrollX = TRUE,</span></span>
<span id="cb212-1211"><a href="#cb212-1211" aria-hidden="true" tabindex="-1"></a><span class="co">#                          search = list(regex = TRUE,</span></span>
<span id="cb212-1212"><a href="#cb212-1212" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        caseInsensitive = TRUE)))</span></span>
<span id="cb212-1213"><a href="#cb212-1213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1214"><a href="#cb212-1214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1215"><a href="#cb212-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1216"><a href="#cb212-1216" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-1217"><a href="#cb212-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1220"><a href="#cb212-1220" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-1221"><a href="#cb212-1221" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: identify_voting_party_headers</span></span>
<span id="cb212-1222"><a href="#cb212-1222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1223"><a href="#cb212-1223" aria-hidden="true" tabindex="-1"></a><span class="co"># Parteien aus Parolen-Spalten (p- &amp; pdev-..-..) identifizieren</span></span>
<span id="cb212-1224"><a href="#cb212-1224" aria-hidden="true" tabindex="-1"></a>lookup_input_party_label_vote <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb212-1225"><a href="#cb212-1225" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Block 1: Staatsebene - Mutterparteien, Verbände &amp; weitere Organisationen</span></span>
<span id="cb212-1226"><a href="#cb212-1226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">party_orig_value =</span> <span class="fu">grep</span>(<span class="st">"^p-"</span>,</span>
<span id="cb212-1227"><a href="#cb212-1227" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">names</span>(voting_raw_5y),</span>
<span id="cb212-1228"><a href="#cb212-1228" aria-hidden="true" tabindex="-1"></a>                               <span class="at">value =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb212-1229"><a href="#cb212-1229" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">level =</span> <span class="st">"state"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-1230"><a href="#cb212-1230" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate</span>(</span>
<span id="cb212-1231"><a href="#cb212-1231" aria-hidden="true" tabindex="-1"></a>      party_orig_value,</span>
<span id="cb212-1232"><a href="#cb212-1232" aria-hidden="true" tabindex="-1"></a>      <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"prefix"</span>, <span class="st">"short_name"</span>, <span class="st">"add_info"</span>),</span>
<span id="cb212-1233"><a href="#cb212-1233" aria-hidden="true" tabindex="-1"></a>      <span class="at">sep =</span> <span class="st">"[-_]"</span>,</span>
<span id="cb212-1234"><a href="#cb212-1234" aria-hidden="true" tabindex="-1"></a>      <span class="at">remove =</span> <span class="cn">FALSE</span>,</span>
<span id="cb212-1235"><a href="#cb212-1235" aria-hidden="true" tabindex="-1"></a>      <span class="at">extra =</span> <span class="st">"merge"</span>,</span>
<span id="cb212-1236"><a href="#cb212-1236" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">"right"</span>),</span>
<span id="cb212-1237"><a href="#cb212-1237" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Block 2: Kantonsebene - Jungparteien, Frauensektionen, etc.</span></span>
<span id="cb212-1238"><a href="#cb212-1238" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">party_orig_value =</span> <span class="fu">grep</span>(<span class="st">"^pdev-"</span>,</span>
<span id="cb212-1239"><a href="#cb212-1239" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">names</span>(voting_raw_5y),</span>
<span id="cb212-1240"><a href="#cb212-1240" aria-hidden="true" tabindex="-1"></a>                               <span class="at">value =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb212-1241"><a href="#cb212-1241" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">level =</span> <span class="st">"canton_fraction"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-1242"><a href="#cb212-1242" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate</span>(</span>
<span id="cb212-1243"><a href="#cb212-1243" aria-hidden="true" tabindex="-1"></a>      party_orig_value,</span>
<span id="cb212-1244"><a href="#cb212-1244" aria-hidden="true" tabindex="-1"></a>      <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"prefix"</span>, <span class="st">"short_name"</span>, <span class="st">"add_info"</span>),</span>
<span id="cb212-1245"><a href="#cb212-1245" aria-hidden="true" tabindex="-1"></a>      <span class="at">sep =</span> <span class="st">"[-_]"</span>,</span>
<span id="cb212-1246"><a href="#cb212-1246" aria-hidden="true" tabindex="-1"></a>      <span class="at">remove =</span> <span class="cn">FALSE</span>,</span>
<span id="cb212-1247"><a href="#cb212-1247" aria-hidden="true" tabindex="-1"></a>      <span class="at">extra =</span> <span class="st">"merge"</span>,</span>
<span id="cb212-1248"><a href="#cb212-1248" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">"right"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb212-1249"><a href="#cb212-1249" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Großschreibung der short_name-Spalte</span></span>
<span id="cb212-1250"><a href="#cb212-1250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">short_name =</span> <span class="fu">toupper</span>(short_name),</span>
<span id="cb212-1251"><a href="#cb212-1251" aria-hidden="true" tabindex="-1"></a>         <span class="at">long_name =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb212-1252"><a href="#cb212-1252" aria-hidden="true" tabindex="-1"></a>         <span class="at">source =</span> <span class="st">"Abstimmungen"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb212-1253"><a href="#cb212-1253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(party_orig_value,</span>
<span id="cb212-1254"><a href="#cb212-1254" aria-hidden="true" tabindex="-1"></a>         short_name,</span>
<span id="cb212-1255"><a href="#cb212-1255" aria-hidden="true" tabindex="-1"></a>         long_name,</span>
<span id="cb212-1256"><a href="#cb212-1256" aria-hidden="true" tabindex="-1"></a>         prefix,</span>
<span id="cb212-1257"><a href="#cb212-1257" aria-hidden="true" tabindex="-1"></a>         add_info,</span>
<span id="cb212-1258"><a href="#cb212-1258" aria-hidden="true" tabindex="-1"></a>         level,</span>
<span id="cb212-1259"><a href="#cb212-1259" aria-hidden="true" tabindex="-1"></a>         source)</span>
<span id="cb212-1260"><a href="#cb212-1260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-1261"><a href="#cb212-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1262"><a href="#cb212-1262" aria-hidden="true" tabindex="-1"></a><span class="fu">### Parteinamen Inputs konsolidieren &amp; auf Vollständigkeit prüfen</span></span>
<span id="cb212-1263"><a href="#cb212-1263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1266"><a href="#cb212-1266" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-1267"><a href="#cb212-1267" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: consolidation_lookup_parties_from_elec</span></span>
<span id="cb212-1268"><a href="#cb212-1268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1269"><a href="#cb212-1269" aria-hidden="true" tabindex="-1"></a><span class="co"># Parteilabel-Varaianten aus den Input Files (Wahlen &amp; Abstimmungen) konsolidieren</span></span>
<span id="cb212-1270"><a href="#cb212-1270" aria-hidden="true" tabindex="-1"></a>lookup_input_party_label_combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb212-1271"><a href="#cb212-1271" aria-hidden="true" tabindex="-1"></a>  lookup_input_canton_parties_label,</span>
<span id="cb212-1272"><a href="#cb212-1272" aria-hidden="true" tabindex="-1"></a>  lookup_input_gemeinde_parties_label,</span>
<span id="cb212-1273"><a href="#cb212-1273" aria-hidden="true" tabindex="-1"></a>  lookup_input_nr_sr_parties_label,</span>
<span id="cb212-1274"><a href="#cb212-1274" aria-hidden="true" tabindex="-1"></a>  lookup_input_party_label_vote) <span class="sc">%&gt;%</span></span>
<span id="cb212-1275"><a href="#cb212-1275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb212-1276"><a href="#cb212-1276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1277"><a href="#cb212-1277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1278"><a href="#cb212-1278" aria-hidden="true" tabindex="-1"></a><span class="co"># Abgleich der Parteinamen mit Lookup-Master</span></span>
<span id="cb212-1279"><a href="#cb212-1279" aria-hidden="true" tabindex="-1"></a><span class="co"># Fehlende Werte mittels Anti-Join in separatem Dataframe speichern</span></span>
<span id="cb212-1280"><a href="#cb212-1280" aria-hidden="true" tabindex="-1"></a>lookup_input_party_label_missing_in_master <span class="ot">&lt;-</span> lookup_input_party_label_combined <span class="sc">%&gt;%</span></span>
<span id="cb212-1281"><a href="#cb212-1281" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(</span>
<span id="cb212-1282"><a href="#cb212-1282" aria-hidden="true" tabindex="-1"></a>    lookup_parties_consolidated <span class="sc">%&gt;%</span> <span class="fu">select</span>(party_orig_value),</span>
<span id="cb212-1283"><a href="#cb212-1283" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"party_orig_value"</span>)</span>
<span id="cb212-1284"><a href="#cb212-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1285"><a href="#cb212-1285" aria-hidden="true" tabindex="-1"></a><span class="co"># Ergebnis anzeigen</span></span>
<span id="cb212-1286"><a href="#cb212-1286" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(lookup_input_party_label_missing_in_master) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb212-1287"><a href="#cb212-1287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(lookup_input_party_label_missing_in_master)</span>
<span id="cb212-1288"><a href="#cb212-1288" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb212-1289"><a href="#cb212-1289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Partei Lookup Master ist vollständig"</span>)</span>
<span id="cb212-1290"><a href="#cb212-1290" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb212-1291"><a href="#cb212-1291" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-1292"><a href="#cb212-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1293"><a href="#cb212-1293" aria-hidden="true" tabindex="-1"></a><span class="fu">### Clean-up "lookup": Obsolete Objekte (nach konsolidierung) löschen</span></span>
<span id="cb212-1294"><a href="#cb212-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1297"><a href="#cb212-1297" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-1298"><a href="#cb212-1298" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: clean_up_lookup_df</span></span>
<span id="cb212-1299"><a href="#cb212-1299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1300"><a href="#cb212-1300" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean-up: Nicht mehr benötigte "lookup" Tabellen löschen</span></span>
<span id="cb212-1301"><a href="#cb212-1301" aria-hidden="true" tabindex="-1"></a> <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"^lookup_input"</span>)[       <span class="co"># mit lookup_input starten aber</span></span>
<span id="cb212-1302"><a href="#cb212-1302" aria-hidden="true" tabindex="-1"></a>   <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"(_combined|_master)$"</span>,   <span class="co"># nicht mit _combined / all_final enden</span></span>
<span id="cb212-1303"><a href="#cb212-1303" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"^lookup_input"</span>))])</span>
<span id="cb212-1304"><a href="#cb212-1304" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-1305"><a href="#cb212-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1306"><a href="#cb212-1306" aria-hidden="true" tabindex="-1"></a><span class="fu">## Abstimmungsergebnisse transformieren &amp; ergänzen</span></span>
<span id="cb212-1307"><a href="#cb212-1307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1308"><a href="#cb212-1308" aria-hidden="true" tabindex="-1"></a><span class="fu">### Transformation: Vom Wide ins Long Format</span></span>
<span id="cb212-1309"><a href="#cb212-1309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1310"><a href="#cb212-1310" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Präfix-Spalten: "p-" / "pdev-" &amp; "-pos" inkl. Parolencluster transformieren</span></span>
<span id="cb212-1311"><a href="#cb212-1311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1314"><a href="#cb212-1314" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-1315"><a href="#cb212-1315" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: wide_to_long_prefix_columns</span></span>
<span id="cb212-1316"><a href="#cb212-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1317"><a href="#cb212-1317" aria-hidden="true" tabindex="-1"></a><span class="co"># Spaltennamen extrahieren, die ins Long Format sollen</span></span>
<span id="cb212-1318"><a href="#cb212-1318" aria-hidden="true" tabindex="-1"></a>sel_cols <span class="ot">&lt;-</span> <span class="fu">names</span>(voting_raw_5y)[</span>
<span id="cb212-1319"><a href="#cb212-1319" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grepl</span>(<span class="st">"^p-|^pdev-|(-pos)"</span>,</span>
<span id="cb212-1320"><a href="#cb212-1320" aria-hidden="true" tabindex="-1"></a>        <span class="fu">names</span>(voting_raw_5y))</span>
<span id="cb212-1321"><a href="#cb212-1321" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb212-1322"><a href="#cb212-1322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1323"><a href="#cb212-1323" aria-hidden="true" tabindex="-1"></a><span class="co"># Spalteninhalte als Charakter definieren</span></span>
<span id="cb212-1324"><a href="#cb212-1324" aria-hidden="true" tabindex="-1"></a>voting_raw_5y[sel_cols] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(voting_raw_5y[sel_cols],</span>
<span id="cb212-1325"><a href="#cb212-1325" aria-hidden="true" tabindex="-1"></a>                                             as.character)</span>
<span id="cb212-1326"><a href="#cb212-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1327"><a href="#cb212-1327" aria-hidden="true" tabindex="-1"></a><span class="co"># Wide in Long Format</span></span>
<span id="cb212-1328"><a href="#cb212-1328" aria-hidden="true" tabindex="-1"></a>tmp_voting_long <span class="ot">&lt;-</span> voting_raw_5y <span class="sc">%&gt;%</span>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">all_of</span>(sel_cols),</span>
<span id="cb212-1329"><a href="#cb212-1329" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">names_to =</span> <span class="st">"variable"</span>,</span>
<span id="cb212-1330"><a href="#cb212-1330" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb212-1331"><a href="#cb212-1331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1332"><a href="#cb212-1332" aria-hidden="true" tabindex="-1"></a><span class="co"># Table: Lookup für p- und pdev-</span></span>
<span id="cb212-1333"><a href="#cb212-1333" aria-hidden="true" tabindex="-1"></a>lookup_parole <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="at">text =</span> <span class="st">'1</span><span class="sc">\t</span><span class="st">parole_Ja</span></span>
<span id="cb212-1334"><a href="#cb212-1334" aria-hidden="true" tabindex="-1"></a><span class="st">                                    2</span><span class="sc">\t</span><span class="st">parole_Nein</span></span>
<span id="cb212-1335"><a href="#cb212-1335" aria-hidden="true" tabindex="-1"></a><span class="st">                                    3</span><span class="sc">\t</span><span class="st">parole_keine</span></span>
<span id="cb212-1336"><a href="#cb212-1336" aria-hidden="true" tabindex="-1"></a><span class="st">                                    4</span><span class="sc">\t</span><span class="st">parole_Enthalten</span></span>
<span id="cb212-1337"><a href="#cb212-1337" aria-hidden="true" tabindex="-1"></a><span class="st">                                    5</span><span class="sc">\t</span><span class="st">parole_keine</span></span>
<span id="cb212-1338"><a href="#cb212-1338" aria-hidden="true" tabindex="-1"></a><span class="st">                                    8</span><span class="sc">\t</span><span class="st">parole_Gegenentwurf (Stichfrage))</span></span>
<span id="cb212-1339"><a href="#cb212-1339" aria-hidden="true" tabindex="-1"></a><span class="st">                                    9</span><span class="sc">\t</span><span class="st">parole_Volksinitiative (Stichfrage)</span></span>
<span id="cb212-1340"><a href="#cb212-1340" aria-hidden="true" tabindex="-1"></a><span class="st">                                    66</span><span class="sc">\t</span><span class="st">parole_keine</span></span>
<span id="cb212-1341"><a href="#cb212-1341" aria-hidden="true" tabindex="-1"></a><span class="st">                                    .</span><span class="sc">\t</span><span class="st">parole_keine</span></span>
<span id="cb212-1342"><a href="#cb212-1342" aria-hidden="true" tabindex="-1"></a><span class="st">                                    9999</span><span class="sc">\t</span><span class="st">parole_keine</span></span>
<span id="cb212-1343"><a href="#cb212-1343" aria-hidden="true" tabindex="-1"></a><span class="st">                                    </span><span class="sc">\t</span><span class="st">parole_keine'</span>,</span>
<span id="cb212-1344"><a href="#cb212-1344" aria-hidden="true" tabindex="-1"></a>                            <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>,</span>
<span id="cb212-1345"><a href="#cb212-1345" aria-hidden="true" tabindex="-1"></a>                            <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"wert"</span>,</span>
<span id="cb212-1346"><a href="#cb212-1346" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"label"</span>),</span>
<span id="cb212-1347"><a href="#cb212-1347" aria-hidden="true" tabindex="-1"></a>                            <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>,</span>
<span id="cb212-1348"><a href="#cb212-1348" aria-hidden="true" tabindex="-1"></a>                            <span class="at">fill =</span> <span class="cn">TRUE</span>,</span>
<span id="cb212-1349"><a href="#cb212-1349" aria-hidden="true" tabindex="-1"></a>                            <span class="at">quote =</span> <span class="st">""</span>)</span>
<span id="cb212-1350"><a href="#cb212-1350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1351"><a href="#cb212-1351" aria-hidden="true" tabindex="-1"></a><span class="co"># Table: Lookup für -pos</span></span>
<span id="cb212-1352"><a href="#cb212-1352" aria-hidden="true" tabindex="-1"></a>lookup_pos <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="at">text =</span> <span class="st">'.</span><span class="sc">\t</span><span class="st">pos_Missing</span></span>
<span id="cb212-1353"><a href="#cb212-1353" aria-hidden="true" tabindex="-1"></a><span class="st">                                  1</span><span class="sc">\t</span><span class="st">pos_Befürwortend</span></span>
<span id="cb212-1354"><a href="#cb212-1354" aria-hidden="true" tabindex="-1"></a><span class="st">                                  2</span><span class="sc">\t</span><span class="st">pos_Ablehnend</span></span>
<span id="cb212-1355"><a href="#cb212-1355" aria-hidden="true" tabindex="-1"></a><span class="st">                                  3</span><span class="sc">\t</span><span class="st">pos_Keine</span></span>
<span id="cb212-1356"><a href="#cb212-1356" aria-hidden="true" tabindex="-1"></a><span class="st">                                  8</span><span class="sc">\t</span><span class="st">pos_Vorzug Gegenentwurf (bei Stichfragen)</span></span>
<span id="cb212-1357"><a href="#cb212-1357" aria-hidden="true" tabindex="-1"></a><span class="st">                                  9</span><span class="sc">\t</span><span class="st">pos_Vorzug Volksinitiative (bei Stichfragen)'</span>,</span>
<span id="cb212-1358"><a href="#cb212-1358" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>,</span>
<span id="cb212-1359"><a href="#cb212-1359" aria-hidden="true" tabindex="-1"></a>                         <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"wert"</span>,</span>
<span id="cb212-1360"><a href="#cb212-1360" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"label"</span>),</span>
<span id="cb212-1361"><a href="#cb212-1361" aria-hidden="true" tabindex="-1"></a>                         <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>,</span>
<span id="cb212-1362"><a href="#cb212-1362" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fill =</span> <span class="cn">TRUE</span>,</span>
<span id="cb212-1363"><a href="#cb212-1363" aria-hidden="true" tabindex="-1"></a>                         <span class="at">quote =</span> <span class="st">""</span>)</span>
<span id="cb212-1364"><a href="#cb212-1364" aria-hidden="true" tabindex="-1"></a>lookup_pos<span class="sc">$</span>wert <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">trimws</span>(lookup_pos<span class="sc">$</span>wert))</span>
<span id="cb212-1365"><a href="#cb212-1365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1366"><a href="#cb212-1366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1367"><a href="#cb212-1367" aria-hidden="true" tabindex="-1"></a><span class="co"># Lookup anwenden (Join)</span></span>
<span id="cb212-1368"><a href="#cb212-1368" aria-hidden="true" tabindex="-1"></a><span class="co"># value als Character</span></span>
<span id="cb212-1369"><a href="#cb212-1369" aria-hidden="true" tabindex="-1"></a>lookup_parole<span class="sc">$</span>wert <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">trimws</span>(lookup_parole<span class="sc">$</span>wert))</span>
<span id="cb212-1370"><a href="#cb212-1370" aria-hidden="true" tabindex="-1"></a>lookup_pos<span class="sc">$</span>wert <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">trimws</span>(lookup_pos<span class="sc">$</span>wert))</span>
<span id="cb212-1371"><a href="#cb212-1371" aria-hidden="true" tabindex="-1"></a>tmp_voting_long<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">trimws</span>(tmp_voting_long<span class="sc">$</span>value))</span>
<span id="cb212-1372"><a href="#cb212-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1373"><a href="#cb212-1373" aria-hidden="true" tabindex="-1"></a><span class="co"># Join je nach variable-Typ</span></span>
<span id="cb212-1374"><a href="#cb212-1374" aria-hidden="true" tabindex="-1"></a>tmp_voting_long <span class="ot">&lt;-</span> tmp_voting_long <span class="sc">%&gt;%</span></span>
<span id="cb212-1375"><a href="#cb212-1375" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">trimws</span>(value))  <span class="sc">%&gt;%</span></span>
<span id="cb212-1376"><a href="#cb212-1376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lookup_type =</span> <span class="fu">case_when</span>(<span class="fu">grepl</span>(<span class="st">"^p-|^pdev-"</span>,</span>
<span id="cb212-1377"><a href="#cb212-1377" aria-hidden="true" tabindex="-1"></a>                                       variable) <span class="sc">~</span> <span class="st">"parole"</span>,</span>
<span id="cb212-1378"><a href="#cb212-1378" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">grepl</span>(<span class="st">"-pos"</span>,</span>
<span id="cb212-1379"><a href="#cb212-1379" aria-hidden="true" tabindex="-1"></a>                                       variable) <span class="sc">~</span> <span class="st">"pos"</span>,</span>
<span id="cb212-1380"><a href="#cb212-1380" aria-hidden="true" tabindex="-1"></a>                                 <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb212-1381"><a href="#cb212-1381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lookup_parole <span class="sc">%&gt;%</span></span>
<span id="cb212-1382"><a href="#cb212-1382" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rename</span>(<span class="at">label_parole =</span> label),</span>
<span id="cb212-1383"><a href="#cb212-1383" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"value"</span> <span class="ot">=</span> <span class="st">"wert"</span>),</span>
<span id="cb212-1384"><a href="#cb212-1384" aria-hidden="true" tabindex="-1"></a>            <span class="at">na_matches =</span> <span class="st">"never"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-1385"><a href="#cb212-1385" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lookup_pos <span class="sc">%&gt;%</span></span>
<span id="cb212-1386"><a href="#cb212-1386" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rename</span>(<span class="at">label_pos =</span> label),</span>
<span id="cb212-1387"><a href="#cb212-1387" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"value"</span> <span class="ot">=</span> <span class="st">"wert"</span>),</span>
<span id="cb212-1388"><a href="#cb212-1388" aria-hidden="true" tabindex="-1"></a>            <span class="at">na_matches =</span> <span class="st">"never"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-1389"><a href="#cb212-1389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">case_when</span>(lookup_type <span class="sc">==</span> <span class="st">"parole"</span> <span class="sc">~</span> label_parole,</span>
<span id="cb212-1390"><a href="#cb212-1390" aria-hidden="true" tabindex="-1"></a>                           lookup_type <span class="sc">==</span> <span class="st">"pos"</span> <span class="sc">~</span> label_pos,</span>
<span id="cb212-1391"><a href="#cb212-1391" aria-hidden="true" tabindex="-1"></a>                           <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb212-1392"><a href="#cb212-1392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>label_parole,</span>
<span id="cb212-1393"><a href="#cb212-1393" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>label_pos,</span>
<span id="cb212-1394"><a href="#cb212-1394" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>lookup_type)</span>
<span id="cb212-1395"><a href="#cb212-1395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1396"><a href="#cb212-1396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1397"><a href="#cb212-1397" aria-hidden="true" tabindex="-1"></a><span class="co"># NA korrigeren (= keine Meinung/Empfehlung)</span></span>
<span id="cb212-1398"><a href="#cb212-1398" aria-hidden="true" tabindex="-1"></a>tmp_voting_long <span class="ot">&lt;-</span> tmp_voting_long <span class="sc">%&gt;%</span></span>
<span id="cb212-1399"><a href="#cb212-1399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">case_when</span>(</span>
<span id="cb212-1400"><a href="#cb212-1400" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(label) <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">"^p-|^pdev-"</span>, variable) <span class="sc">~</span> <span class="st">"parole_keine"</span>,</span>
<span id="cb212-1401"><a href="#cb212-1401" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(label) <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">"-pos"</span>, variable)       <span class="sc">~</span> <span class="st">"pos_keine"</span>,</span>
<span id="cb212-1402"><a href="#cb212-1402" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span>                                         <span class="sc">~</span> label))</span>
<span id="cb212-1403"><a href="#cb212-1403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1404"><a href="#cb212-1404" aria-hidden="true" tabindex="-1"></a><span class="co"># One-Hot-Encoding (Dummy-Codierung)</span></span>
<span id="cb212-1405"><a href="#cb212-1405" aria-hidden="true" tabindex="-1"></a>tmp_voting_long<span class="sc">$</span>dummy <span class="ot">&lt;-</span> <span class="dv">1</span>L</span>
<span id="cb212-1406"><a href="#cb212-1406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1407"><a href="#cb212-1407" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivotieren: Jede label-Ausprägung wird eigene Spalte, 1 falls zutreffend, sonst 0</span></span>
<span id="cb212-1408"><a href="#cb212-1408" aria-hidden="true" tabindex="-1"></a>tmp_voting_wide <span class="ot">&lt;-</span> tmp_voting_long <span class="sc">%&gt;%</span></span>
<span id="cb212-1409"><a href="#cb212-1409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb212-1410"><a href="#cb212-1410" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(tmp_voting_long), <span class="fu">c</span>(<span class="st">"value"</span>, <span class="st">"label"</span>, <span class="st">"dummy"</span>)),</span>
<span id="cb212-1411"><a href="#cb212-1411" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> label,</span>
<span id="cb212-1412"><a href="#cb212-1412" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> dummy,</span>
<span id="cb212-1413"><a href="#cb212-1413" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_fill =</span> <span class="dv">0</span>)</span>
<span id="cb212-1414"><a href="#cb212-1414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1415"><a href="#cb212-1415" aria-hidden="true" tabindex="-1"></a>voting_5y_long <span class="ot">&lt;-</span> tmp_voting_wide</span>
<span id="cb212-1416"><a href="#cb212-1416" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-1417"><a href="#cb212-1417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1418"><a href="#cb212-1418" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Parteinamen ergänzen &amp; Zeilen mit "-pos"-Endung entfernen</span></span>
<span id="cb212-1419"><a href="#cb212-1419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1422"><a href="#cb212-1422" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-1423"><a href="#cb212-1423" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: add_party_names</span></span>
<span id="cb212-1424"><a href="#cb212-1424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1425"><a href="#cb212-1425" aria-hidden="true" tabindex="-1"></a>tmp_voting_5y_long <span class="ot">&lt;-</span> voting_5y_long <span class="sc">%&gt;%</span></span>
<span id="cb212-1426"><a href="#cb212-1426" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Zeilen mit "-pos" in Spalte "variable" herausfiltern </span></span>
<span id="cb212-1427"><a href="#cb212-1427" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(variable, <span class="st">"-pos$"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb212-1428"><a href="#cb212-1428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lookup_parties_consolidated <span class="sc">%&gt;%</span> <span class="fu">select</span>(party_orig_value,</span>
<span id="cb212-1429"><a href="#cb212-1429" aria-hidden="true" tabindex="-1"></a>                                                   Partei),</span>
<span id="cb212-1430"><a href="#cb212-1430" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"variable"</span> <span class="ot">=</span> <span class="st">"party_orig_value"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb212-1431"><a href="#cb212-1431" aria-hidden="true" tabindex="-1"></a>   <span class="fu">relocate</span>(Partei, <span class="at">.after =</span> variable)</span>
<span id="cb212-1432"><a href="#cb212-1432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1433"><a href="#cb212-1433" aria-hidden="true" tabindex="-1"></a>voting_5y_long <span class="ot">&lt;-</span> tmp_voting_5y_long</span>
<span id="cb212-1434"><a href="#cb212-1434" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(tmp_voting_5y_long)</span>
<span id="cb212-1435"><a href="#cb212-1435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-1436"><a href="#cb212-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1437"><a href="#cb212-1437" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Parteistärken ergänzen</span></span>
<span id="cb212-1438"><a href="#cb212-1438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1441"><a href="#cb212-1441" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-1442"><a href="#cb212-1442" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: add_party_strength</span></span>
<span id="cb212-1443"><a href="#cb212-1443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1444"><a href="#cb212-1444" aria-hidden="true" tabindex="-1"></a><span class="co"># "year" in Quellen as.numeric() definieren</span></span>
<span id="cb212-1445"><a href="#cb212-1445" aria-hidden="true" tabindex="-1"></a>elec_nr_sr_lvl_state <span class="ot">&lt;-</span> elec_nr_sr_lvl_state <span class="sc">%&gt;%</span></span>
<span id="cb212-1446"><a href="#cb212-1446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year))</span>
<span id="cb212-1447"><a href="#cb212-1447" aria-hidden="true" tabindex="-1"></a>elec_kanton_lvl_state <span class="ot">&lt;-</span> elec_kanton_lvl_state <span class="sc">%&gt;%</span></span>
<span id="cb212-1448"><a href="#cb212-1448" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year))</span>
<span id="cb212-1449"><a href="#cb212-1449" aria-hidden="true" tabindex="-1"></a>elec_gemeinde_lvl_state <span class="ot">&lt;-</span> elec_gemeinde_lvl_state <span class="sc">%&gt;%</span></span>
<span id="cb212-1450"><a href="#cb212-1450" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year))</span>
<span id="cb212-1451"><a href="#cb212-1451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1452"><a href="#cb212-1452" aria-hidden="true" tabindex="-1"></a><span class="co"># Parteistärken (Staatsebene) dazu laden</span></span>
<span id="cb212-1453"><a href="#cb212-1453" aria-hidden="true" tabindex="-1"></a>voting_5y_long_strength <span class="ot">&lt;-</span> voting_5y_long <span class="sc">%&gt;%</span></span>
<span id="cb212-1454"><a href="#cb212-1454" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"^pdev-"</span>, variable)) <span class="sc">%&gt;%</span>      <span class="co"># pdev- ausschliessen</span></span>
<span id="cb212-1455"><a href="#cb212-1455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">year</span>(datum))) <span class="sc">%&gt;%</span></span>
<span id="cb212-1456"><a href="#cb212-1456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(anr, year, Partei, annahme, parole_Ja, parole_Nein, parole_keine) <span class="sc">%&gt;%</span> </span>
<span id="cb212-1457"><a href="#cb212-1457" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-1458"><a href="#cb212-1458" aria-hidden="true" tabindex="-1"></a>  <span class="co"># National- und Ständerat</span></span>
<span id="cb212-1459"><a href="#cb212-1459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(elec_nr_sr_lvl_state <span class="sc">%&gt;%</span> <span class="fu">select</span>(year,</span>
<span id="cb212-1460"><a href="#cb212-1460" aria-hidden="true" tabindex="-1"></a>                                            Partei,</span>
<span id="cb212-1461"><a href="#cb212-1461" aria-hidden="true" tabindex="-1"></a>                                            n_seats_sum,</span>
<span id="cb212-1462"><a href="#cb212-1462" aria-hidden="true" tabindex="-1"></a>                                            n_seats_pct) <span class="sc">%&gt;%</span></span>
<span id="cb212-1463"><a href="#cb212-1463" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rename</span>(<span class="at">n_seats_state =</span> n_seats_sum,</span>
<span id="cb212-1464"><a href="#cb212-1464" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n_seats_pct_state =</span> n_seats_pct),</span>
<span id="cb212-1465"><a href="#cb212-1465" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>,</span>
<span id="cb212-1466"><a href="#cb212-1466" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Partei"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb212-1467"><a href="#cb212-1467" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Kanton</span></span>
<span id="cb212-1468"><a href="#cb212-1468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(elec_kanton_lvl_state <span class="sc">%&gt;%</span> <span class="fu">select</span>(year,</span>
<span id="cb212-1469"><a href="#cb212-1469" aria-hidden="true" tabindex="-1"></a>                                            Partei,</span>
<span id="cb212-1470"><a href="#cb212-1470" aria-hidden="true" tabindex="-1"></a>                                            n_seats_sum,</span>
<span id="cb212-1471"><a href="#cb212-1471" aria-hidden="true" tabindex="-1"></a>                                            n_seats_pct,</span>
<span id="cb212-1472"><a href="#cb212-1472" aria-hidden="true" tabindex="-1"></a>                                            n_seats_sum_weighted,</span>
<span id="cb212-1473"><a href="#cb212-1473" aria-hidden="true" tabindex="-1"></a>                                            n_seats_pct_weighted) <span class="sc">%&gt;%</span></span>
<span id="cb212-1474"><a href="#cb212-1474" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rename</span>(<span class="at">n_seats_kanton =</span> n_seats_sum,</span>
<span id="cb212-1475"><a href="#cb212-1475" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n_seats_pct_kanton =</span> n_seats_pct,</span>
<span id="cb212-1476"><a href="#cb212-1476" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n_seats_sum_weighted_kt =</span> n_seats_sum_weighted,</span>
<span id="cb212-1477"><a href="#cb212-1477" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n_seats_pct_weighted_kt =</span> n_seats_pct_weighted),</span>
<span id="cb212-1478"><a href="#cb212-1478" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"Partei"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb212-1479"><a href="#cb212-1479" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Gemeinde</span></span>
<span id="cb212-1480"><a href="#cb212-1480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(elec_gemeinde_lvl_state <span class="sc">%&gt;%</span> <span class="fu">select</span>(year,</span>
<span id="cb212-1481"><a href="#cb212-1481" aria-hidden="true" tabindex="-1"></a>                                               Partei,</span>
<span id="cb212-1482"><a href="#cb212-1482" aria-hidden="true" tabindex="-1"></a>                                               n_seats_sum,</span>
<span id="cb212-1483"><a href="#cb212-1483" aria-hidden="true" tabindex="-1"></a>                                               n_seats_pct,</span>
<span id="cb212-1484"><a href="#cb212-1484" aria-hidden="true" tabindex="-1"></a>                                               n_seats_sum_weighted,</span>
<span id="cb212-1485"><a href="#cb212-1485" aria-hidden="true" tabindex="-1"></a>                                               n_seats_pct_weighted) <span class="sc">%&gt;%</span></span>
<span id="cb212-1486"><a href="#cb212-1486" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rename</span>(<span class="at">n_seats_gemeinde =</span> n_seats_sum,</span>
<span id="cb212-1487"><a href="#cb212-1487" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n_seats_pct_gemeinde =</span> n_seats_pct,</span>
<span id="cb212-1488"><a href="#cb212-1488" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n_seats_sum_weighted_gemeinde =</span> n_seats_sum_weighted,</span>
<span id="cb212-1489"><a href="#cb212-1489" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n_seats_pct_weighted_gemeinde =</span> n_seats_pct_weighted),</span>
<span id="cb212-1490"><a href="#cb212-1490" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"Partei"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb212-1491"><a href="#cb212-1491" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Partei)) <span class="sc">%&gt;%</span></span>
<span id="cb212-1492"><a href="#cb212-1492" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prozentwerte pro anr/year normieren (Für noch enthaltene Parteien)</span></span>
<span id="cb212-1493"><a href="#cb212-1493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(anr, year) <span class="sc">%&gt;%</span></span>
<span id="cb212-1494"><a href="#cb212-1494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_seats_pct_state_norm =</span></span>
<span id="cb212-1495"><a href="#cb212-1495" aria-hidden="true" tabindex="-1"></a>           n_seats_pct_state <span class="sc">/</span> <span class="fu">sum</span>(n_seats_pct_state,</span>
<span id="cb212-1496"><a href="#cb212-1496" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-1497"><a href="#cb212-1497" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_seats_pct_weighted_kt_norm =</span></span>
<span id="cb212-1498"><a href="#cb212-1498" aria-hidden="true" tabindex="-1"></a>           n_seats_pct_weighted_kt <span class="sc">/</span> <span class="fu">sum</span>(n_seats_pct_weighted_kt,</span>
<span id="cb212-1499"><a href="#cb212-1499" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-1500"><a href="#cb212-1500" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_seats_pct_weighted_gemeinde_norm =</span></span>
<span id="cb212-1501"><a href="#cb212-1501" aria-hidden="true" tabindex="-1"></a>           n_seats_pct_weighted_gemeinde <span class="sc">/</span> <span class="fu">sum</span>(n_seats_pct_weighted_gemeinde,</span>
<span id="cb212-1502"><a href="#cb212-1502" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb212-1503"><a href="#cb212-1503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb212-1504"><a href="#cb212-1504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1505"><a href="#cb212-1505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1506"><a href="#cb212-1506" aria-hidden="true" tabindex="-1"></a><span class="co"># Parteistärke anwenden und aufsummieren</span></span>
<span id="cb212-1507"><a href="#cb212-1507" aria-hidden="true" tabindex="-1"></a><span class="co"># # tmp</span></span>
<span id="cb212-1508"><a href="#cb212-1508" aria-hidden="true" tabindex="-1"></a><span class="co"># voting_5y_long_strength_with_seats &lt;- voting_5y_long_strength %&gt;% </span></span>
<span id="cb212-1509"><a href="#cb212-1509" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(n_seats_state &gt; 0 |</span></span>
<span id="cb212-1510"><a href="#cb212-1510" aria-hidden="true" tabindex="-1"></a><span class="co">#          n_seats_kanton &gt; 0 |</span></span>
<span id="cb212-1511"><a href="#cb212-1511" aria-hidden="true" tabindex="-1"></a><span class="co">#          n_seats_gemeinde &gt; 0)</span></span>
<span id="cb212-1512"><a href="#cb212-1512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1513"><a href="#cb212-1513" aria-hidden="true" tabindex="-1"></a><span class="co"># Neue Spalten mit den gewichteten Parolen berechnen (mit den normierten Prozentwerten)</span></span>
<span id="cb212-1514"><a href="#cb212-1514" aria-hidden="true" tabindex="-1"></a>voting_5y_long_strength_wtd <span class="ot">&lt;-</span> voting_5y_long_strength <span class="sc">%&gt;%</span></span>
<span id="cb212-1515"><a href="#cb212-1515" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb212-1516"><a href="#cb212-1516" aria-hidden="true" tabindex="-1"></a>    <span class="at">parole_Nein_wtd_state     =</span> parole_Nein   <span class="sc">*</span> n_seats_pct_state_norm,</span>
<span id="cb212-1517"><a href="#cb212-1517" aria-hidden="true" tabindex="-1"></a>    <span class="at">parole_Ja_wtd_state       =</span> parole_Ja     <span class="sc">*</span> n_seats_pct_state_norm,</span>
<span id="cb212-1518"><a href="#cb212-1518" aria-hidden="true" tabindex="-1"></a>    <span class="at">parole_Keine_wtd_state    =</span> parole_keine  <span class="sc">*</span> n_seats_pct_state_norm,</span>
<span id="cb212-1519"><a href="#cb212-1519" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb212-1520"><a href="#cb212-1520" aria-hidden="true" tabindex="-1"></a>    <span class="at">parole_Nein_wtd_kt        =</span> parole_Nein   <span class="sc">*</span> n_seats_pct_weighted_kt_norm,</span>
<span id="cb212-1521"><a href="#cb212-1521" aria-hidden="true" tabindex="-1"></a>    <span class="at">parole_Ja_wtd_kt          =</span> parole_Ja     <span class="sc">*</span> n_seats_pct_weighted_kt_norm,</span>
<span id="cb212-1522"><a href="#cb212-1522" aria-hidden="true" tabindex="-1"></a>    <span class="at">parole_Keine_wtd_kt       =</span> parole_keine  <span class="sc">*</span> n_seats_pct_weighted_kt_norm,</span>
<span id="cb212-1523"><a href="#cb212-1523" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb212-1524"><a href="#cb212-1524" aria-hidden="true" tabindex="-1"></a>    <span class="at">parole_Nein_wtd_gem       =</span> parole_Nein   <span class="sc">*</span> n_seats_pct_weighted_gemeinde_norm,</span>
<span id="cb212-1525"><a href="#cb212-1525" aria-hidden="true" tabindex="-1"></a>    <span class="at">parole_Ja_wtd_gem         =</span> parole_Ja     <span class="sc">*</span> n_seats_pct_weighted_gemeinde_norm,</span>
<span id="cb212-1526"><a href="#cb212-1526" aria-hidden="true" tabindex="-1"></a>    <span class="at">parole_Keine_wtd_gem      =</span> parole_keine  <span class="sc">*</span> n_seats_pct_weighted_gemeinde_norm)</span>
<span id="cb212-1527"><a href="#cb212-1527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1528"><a href="#cb212-1528" aria-hidden="true" tabindex="-1"></a><span class="co"># Gruppieren und aufsummieren nach anr und year</span></span>
<span id="cb212-1529"><a href="#cb212-1529" aria-hidden="true" tabindex="-1"></a>voting_5y_long_strength_wtd_summary <span class="ot">&lt;-</span> voting_5y_long_strength_wtd <span class="sc">%&gt;%</span></span>
<span id="cb212-1530"><a href="#cb212-1530" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(anr, year, annahme) <span class="sc">%&gt;%</span></span>
<span id="cb212-1531"><a href="#cb212-1531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb212-1532"><a href="#cb212-1532" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_parole_Nein       =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(parole_Nein_wtd_state, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-1533"><a href="#cb212-1533" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_parole_Ja         =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(parole_Ja_wtd_state, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-1534"><a href="#cb212-1534" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_parole_Keine      =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(parole_Keine_wtd_state, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-1535"><a href="#cb212-1535" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb212-1536"><a href="#cb212-1536" aria-hidden="true" tabindex="-1"></a>    <span class="at">kt_parole_Nein          =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(parole_Nein_wtd_kt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-1537"><a href="#cb212-1537" aria-hidden="true" tabindex="-1"></a>    <span class="at">kt_parole_Ja            =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(parole_Ja_wtd_kt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-1538"><a href="#cb212-1538" aria-hidden="true" tabindex="-1"></a>    <span class="at">kt_parole_Keine         =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(parole_Keine_wtd_kt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-1539"><a href="#cb212-1539" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb212-1540"><a href="#cb212-1540" aria-hidden="true" tabindex="-1"></a>    <span class="at">gemeinde_parole_Nein    =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(parole_Nein_wtd_gem, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-1541"><a href="#cb212-1541" aria-hidden="true" tabindex="-1"></a>    <span class="at">gemeinde_parole_Ja      =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(parole_Ja_wtd_gem, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-1542"><a href="#cb212-1542" aria-hidden="true" tabindex="-1"></a>    <span class="at">gemeinde_parole_Keine   =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(parole_Keine_wtd_gem, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-1543"><a href="#cb212-1543" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb212-1544"><a href="#cb212-1544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1545"><a href="#cb212-1545" aria-hidden="true" tabindex="-1"></a><span class="co"># Kontrolle:  Summen = 100 ?</span></span>
<span id="cb212-1546"><a href="#cb212-1546" aria-hidden="true" tabindex="-1"></a>voting_5y_long_strength_wtd_summary <span class="sc">%&gt;%</span></span>
<span id="cb212-1547"><a href="#cb212-1547" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parole_sum =</span> </span>
<span id="cb212-1548"><a href="#cb212-1548" aria-hidden="true" tabindex="-1"></a>           state_parole_Nein <span class="sc">+</span> state_parole_Ja <span class="sc">+</span> state_parole_Keine) <span class="sc">%&gt;%</span></span>
<span id="cb212-1549"><a href="#cb212-1549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(anr, year, parole_sum) <span class="sc">%&gt;%</span> </span>
<span id="cb212-1550"><a href="#cb212-1550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(parole_sum))</span>
<span id="cb212-1551"><a href="#cb212-1551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1552"><a href="#cb212-1552" aria-hidden="true" tabindex="-1"></a><span class="co"># write_xlsx(voting_5y_long_strength_wtd_summary, "tmp_voting_5y_long_strength_wtd_summary.xlsx")</span></span>
<span id="cb212-1553"><a href="#cb212-1553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1554"><a href="#cb212-1554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1555"><a href="#cb212-1555" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO: Clean-up "voting" tabellen</span></span>
<span id="cb212-1556"><a href="#cb212-1556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1557"><a href="#cb212-1557" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-1558"><a href="#cb212-1558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1559"><a href="#cb212-1559" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Spalten ergänzen (aus Urprungsfile)</span></span>
<span id="cb212-1560"><a href="#cb212-1560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1563"><a href="#cb212-1563" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-1564"><a href="#cb212-1564" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: add_initial_columns_again</span></span>
<span id="cb212-1565"><a href="#cb212-1565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1566"><a href="#cb212-1566" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(voting_5y_long)</span>
<span id="cb212-1567"><a href="#cb212-1567" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(voting_5y_long)</span>
<span id="cb212-1568"><a href="#cb212-1568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1569"><a href="#cb212-1569" aria-hidden="true" tabindex="-1"></a><span class="co"># Vorerst ignorierte Spalten (partiell) wieder hinzufügen</span></span>
<span id="cb212-1570"><a href="#cb212-1570" aria-hidden="true" tabindex="-1"></a>voting_5y_final <span class="ot">&lt;-</span> voting_5y_long_strength_wtd_summary <span class="sc">%&gt;%</span></span>
<span id="cb212-1571"><a href="#cb212-1571" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(voting_5y_long <span class="sc">%&gt;%</span></span>
<span id="cb212-1572"><a href="#cb212-1572" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(anr,</span>
<span id="cb212-1573"><a href="#cb212-1573" aria-hidden="true" tabindex="-1"></a>                     titel_kurz_d,</span>
<span id="cb212-1574"><a href="#cb212-1574" aria-hidden="true" tabindex="-1"></a>                     dep,              <span class="co"># 1 Eidg. Dep. für ausw. Angel. (EDA)</span></span>
<span id="cb212-1575"><a href="#cb212-1575" aria-hidden="true" tabindex="-1"></a>                                       <span class="co"># 2 Eidg. Dep. des Innern (EDI)2</span></span>
<span id="cb212-1576"><a href="#cb212-1576" aria-hidden="true" tabindex="-1"></a>                                       <span class="co"># 3 Eidg. Justiz- und PolizeiDep. (EJPD)3</span></span>
<span id="cb212-1577"><a href="#cb212-1577" aria-hidden="true" tabindex="-1"></a>                                       <span class="co"># 4 Eidg. Dep. für Verteidigung,                                                      Bevölkerungsschutz und Sport (VBS)4</span></span>
<span id="cb212-1578"><a href="#cb212-1578" aria-hidden="true" tabindex="-1"></a>                                       <span class="co"># 5 Eidg. FinanzDep. (EFD)5</span></span>
<span id="cb212-1579"><a href="#cb212-1579" aria-hidden="true" tabindex="-1"></a>                                       <span class="co"># 6 Eidg. Dep. für Wirtschaft, Bildung und</span></span>
<span id="cb212-1580"><a href="#cb212-1580" aria-hidden="true" tabindex="-1"></a>                                       <span class="co"># Forschung (WBF)6</span></span>
<span id="cb212-1581"><a href="#cb212-1581" aria-hidden="true" tabindex="-1"></a>                                       <span class="co"># 7 Eidg. Dep. für Umwelt, Verkehr, Energie                                            und Kommunikation (UVEK)7</span></span>
<span id="cb212-1582"><a href="#cb212-1582" aria-hidden="true" tabindex="-1"></a>                                       <span class="co"># 8 Schweizerische Bundeskanzlei (BK)</span></span>
<span id="cb212-1583"><a href="#cb212-1583" aria-hidden="true" tabindex="-1"></a>                     rechtsform,       <span class="co">#1 Obligatorisches Referendum</span></span>
<span id="cb212-1584"><a href="#cb212-1584" aria-hidden="true" tabindex="-1"></a>                                       <span class="co">#2 Fakultatives Referendum</span></span>
<span id="cb212-1585"><a href="#cb212-1585" aria-hidden="true" tabindex="-1"></a>                                       <span class="co">#3 Volksinitiative</span></span>
<span id="cb212-1586"><a href="#cb212-1586" aria-hidden="true" tabindex="-1"></a>                                       <span class="co">#4 Direkter Gegenentwurf zu Volksinitiative</span></span>
<span id="cb212-1587"><a href="#cb212-1587" aria-hidden="true" tabindex="-1"></a>                                       <span class="co">#5 Stichfrage</span></span>
<span id="cb212-1588"><a href="#cb212-1588" aria-hidden="true" tabindex="-1"></a>                     <span class="at">inserate_total      =</span> <span class="st">`</span><span class="at">inserate-total</span><span class="st">`</span>,</span>
<span id="cb212-1589"><a href="#cb212-1589" aria-hidden="true" tabindex="-1"></a>                     <span class="at">inserate_je_ausgabe =</span> <span class="st">`</span><span class="at">inserate-je-ausgabe</span><span class="st">`</span>,</span>
<span id="cb212-1590"><a href="#cb212-1590" aria-hidden="true" tabindex="-1"></a>                     <span class="at">inserate_ja         =</span> <span class="st">`</span><span class="at">inserate-ja</span><span class="st">`</span>,</span>
<span id="cb212-1591"><a href="#cb212-1591" aria-hidden="true" tabindex="-1"></a>                     <span class="co">#inserate_jaanteil   = `inserate-jaanteil`,</span></span>
<span id="cb212-1592"><a href="#cb212-1592" aria-hidden="true" tabindex="-1"></a>                     <span class="at">inserate_nein       =</span> <span class="st">`</span><span class="at">inserate-nein</span><span class="st">`</span>,</span>
<span id="cb212-1593"><a href="#cb212-1593" aria-hidden="true" tabindex="-1"></a>                     <span class="at">inserate_neutral    =</span> <span class="st">`</span><span class="at">inserate-neutral</span><span class="st">`</span>,</span>
<span id="cb212-1594"><a href="#cb212-1594" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mediares_tot        =</span> <span class="st">`</span><span class="at">mediares-tot</span><span class="st">`</span>,</span>
<span id="cb212-1595"><a href="#cb212-1595" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mediaton_tot        =</span> <span class="st">`</span><span class="at">mediaton-tot</span><span class="st">`</span>,</span>
<span id="cb212-1596"><a href="#cb212-1596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1597"><a href="#cb212-1597" aria-hidden="true" tabindex="-1"></a>                     nrja,</span>
<span id="cb212-1598"><a href="#cb212-1598" aria-hidden="true" tabindex="-1"></a>                     nrnein,</span>
<span id="cb212-1599"><a href="#cb212-1599" aria-hidden="true" tabindex="-1"></a>                     srja,</span>
<span id="cb212-1600"><a href="#cb212-1600" aria-hidden="true" tabindex="-1"></a>                     srnein,</span>
<span id="cb212-1601"><a href="#cb212-1601" aria-hidden="true" tabindex="-1"></a>                  </span>
<span id="cb212-1602"><a href="#cb212-1602" aria-hidden="true" tabindex="-1"></a>                     bet,</span>
<span id="cb212-1603"><a href="#cb212-1603" aria-hidden="true" tabindex="-1"></a>                     leer,</span>
<span id="cb212-1604"><a href="#cb212-1604" aria-hidden="true" tabindex="-1"></a>                     ungultig,</span>
<span id="cb212-1605"><a href="#cb212-1605" aria-hidden="true" tabindex="-1"></a>                     gultig,</span>
<span id="cb212-1606"><a href="#cb212-1606" aria-hidden="true" tabindex="-1"></a>                     <span class="at">volkja_proz        =</span> <span class="st">`</span><span class="at">volkja-proz</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-1607"><a href="#cb212-1607" aria-hidden="true" tabindex="-1"></a>              <span class="fu">distinct</span>(),</span>
<span id="cb212-1608"><a href="#cb212-1608" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">"anr"</span>)</span>
<span id="cb212-1609"><a href="#cb212-1609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1610"><a href="#cb212-1610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1611"><a href="#cb212-1611" aria-hidden="true" tabindex="-1"></a><span class="co"># Zeilenzahl prüfen</span></span>
<span id="cb212-1612"><a href="#cb212-1612" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(voting_5y_final) <span class="sc">==</span> <span class="fu">nrow</span>(voting_5y_long_strength_wtd_summary)</span>
<span id="cb212-1613"><a href="#cb212-1613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1614"><a href="#cb212-1614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-1615"><a href="#cb212-1615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1616"><a href="#cb212-1616" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Spaltenklassifizierung und Levels</span></span>
<span id="cb212-1617"><a href="#cb212-1617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1620"><a href="#cb212-1620" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-1621"><a href="#cb212-1621" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(voting_5y_final)</span>
<span id="cb212-1622"><a href="#cb212-1622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1623"><a href="#cb212-1623" aria-hidden="true" tabindex="-1"></a>voting_5y_final <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb212-1624"><a href="#cb212-1624" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">annahme                =</span> <span class="fu">as.numeric</span>(annahme),</span>
<span id="cb212-1625"><a href="#cb212-1625" aria-hidden="true" tabindex="-1"></a>         <span class="at">dep                    =</span> <span class="fu">factor</span>(rechtsform,</span>
<span id="cb212-1626"><a href="#cb212-1626" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>,</span>
<span id="cb212-1627"><a href="#cb212-1627" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"5"</span>, <span class="st">"6"</span>, <span class="st">"7"</span>, <span class="st">"8"</span>),</span>
<span id="cb212-1628"><a href="#cb212-1628" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"EDA"</span>, <span class="st">"EDI"</span>, <span class="st">"EJPD"</span>, <span class="st">"VBS"</span>,</span>
<span id="cb212-1629"><a href="#cb212-1629" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"EFD"</span>, <span class="st">"WBF"</span>, <span class="st">"UVEK"</span>, <span class="st">"BK"</span> )),</span>
<span id="cb212-1630"><a href="#cb212-1630" aria-hidden="true" tabindex="-1"></a>         <span class="at">rechtsform             =</span> <span class="fu">factor</span>(rechtsform,</span>
<span id="cb212-1631"><a href="#cb212-1631" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"1"</span>,<span class="st">"2"</span>,<span class="st">"3"</span>,<span class="st">"4"</span>,<span class="st">"5"</span>),</span>
<span id="cb212-1632"><a href="#cb212-1632" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Obligatorisches Referendum"</span>,</span>
<span id="cb212-1633"><a href="#cb212-1633" aria-hidden="true" tabindex="-1"></a>                                                   <span class="st">"Fakultatives Referendum"</span>,</span>
<span id="cb212-1634"><a href="#cb212-1634" aria-hidden="true" tabindex="-1"></a>                                                   <span class="st">"Volksinitiative"</span>,</span>
<span id="cb212-1635"><a href="#cb212-1635" aria-hidden="true" tabindex="-1"></a>                                                   <span class="st">"Direkter Gegenentwurf"</span>,</span>
<span id="cb212-1636"><a href="#cb212-1636" aria-hidden="true" tabindex="-1"></a>                                                   <span class="st">"Stichfrage"</span>)),</span>
<span id="cb212-1637"><a href="#cb212-1637" aria-hidden="true" tabindex="-1"></a>         <span class="at">inserate_total         =</span> <span class="fu">as.numeric</span>(inserate_total),</span>
<span id="cb212-1638"><a href="#cb212-1638" aria-hidden="true" tabindex="-1"></a>         <span class="at">inserate_je_ausgabe    =</span> <span class="fu">as.numeric</span>(inserate_je_ausgabe),</span>
<span id="cb212-1639"><a href="#cb212-1639" aria-hidden="true" tabindex="-1"></a>         <span class="at">inserate_ja            =</span> <span class="fu">as.numeric</span>(inserate_ja),</span>
<span id="cb212-1640"><a href="#cb212-1640" aria-hidden="true" tabindex="-1"></a>         <span class="at">inserate_nein          =</span> <span class="fu">as.numeric</span>(inserate_nein),</span>
<span id="cb212-1641"><a href="#cb212-1641" aria-hidden="true" tabindex="-1"></a>         <span class="at">inserate_neutral       =</span> <span class="fu">as.numeric</span>(inserate_neutral),</span>
<span id="cb212-1642"><a href="#cb212-1642" aria-hidden="true" tabindex="-1"></a>         <span class="co">#inserate_ja_pct        = as.numeric(inserate_ja),</span></span>
<span id="cb212-1643"><a href="#cb212-1643" aria-hidden="true" tabindex="-1"></a>         <span class="co">#inserate_nein_pct      = as.numeric(inserate_nein),</span></span>
<span id="cb212-1644"><a href="#cb212-1644" aria-hidden="true" tabindex="-1"></a>         <span class="co">#inserate_neutral_pct   = as.numeric(inserate_neutral),</span></span>
<span id="cb212-1645"><a href="#cb212-1645" aria-hidden="true" tabindex="-1"></a>         <span class="at">nrja                   =</span> <span class="fu">as.numeric</span>(nrja),</span>
<span id="cb212-1646"><a href="#cb212-1646" aria-hidden="true" tabindex="-1"></a>         <span class="co">#nrja_pct               = as.numeric(nrja_pct),</span></span>
<span id="cb212-1647"><a href="#cb212-1647" aria-hidden="true" tabindex="-1"></a>         <span class="at">nrnein                 =</span> <span class="fu">as.numeric</span>(nrnein),</span>
<span id="cb212-1648"><a href="#cb212-1648" aria-hidden="true" tabindex="-1"></a>         <span class="co">#nrnein_pct             = as.numeric(nrnein_pct),</span></span>
<span id="cb212-1649"><a href="#cb212-1649" aria-hidden="true" tabindex="-1"></a>         <span class="at">srja                   =</span> <span class="fu">as.numeric</span>(srja),</span>
<span id="cb212-1650"><a href="#cb212-1650" aria-hidden="true" tabindex="-1"></a>         <span class="co">#srja_pct               = as.numeric(srja_pct),</span></span>
<span id="cb212-1651"><a href="#cb212-1651" aria-hidden="true" tabindex="-1"></a>         <span class="at">srnein                 =</span> <span class="fu">as.numeric</span>(srnein),</span>
<span id="cb212-1652"><a href="#cb212-1652" aria-hidden="true" tabindex="-1"></a>         <span class="co">#srnein_pct             = as.numeric(srnein_pct),</span></span>
<span id="cb212-1653"><a href="#cb212-1653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1654"><a href="#cb212-1654" aria-hidden="true" tabindex="-1"></a>         <span class="at">mediares_tot           =</span> <span class="fu">as.numeric</span>(mediares_tot),</span>
<span id="cb212-1655"><a href="#cb212-1655" aria-hidden="true" tabindex="-1"></a>         <span class="at">mediaton_tot           =</span> <span class="fu">as.numeric</span>(mediaton_tot),</span>
<span id="cb212-1656"><a href="#cb212-1656" aria-hidden="true" tabindex="-1"></a>         <span class="at">bet                    =</span> <span class="fu">as.numeric</span>(bet),</span>
<span id="cb212-1657"><a href="#cb212-1657" aria-hidden="true" tabindex="-1"></a>         <span class="at">leer                   =</span> <span class="fu">as.numeric</span>(leer),</span>
<span id="cb212-1658"><a href="#cb212-1658" aria-hidden="true" tabindex="-1"></a>         <span class="at">ungultig               =</span> <span class="fu">as.numeric</span>(ungultig),</span>
<span id="cb212-1659"><a href="#cb212-1659" aria-hidden="true" tabindex="-1"></a>         <span class="at">gultig                 =</span> <span class="fu">as.numeric</span>(gultig))</span>
<span id="cb212-1660"><a href="#cb212-1660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1661"><a href="#cb212-1661" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(voting_5y_final)</span>
<span id="cb212-1662"><a href="#cb212-1662" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-1663"><a href="#cb212-1663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1664"><a href="#cb212-1664" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Spalten hinzufügen (berechnet)</span></span>
<span id="cb212-1665"><a href="#cb212-1665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1668"><a href="#cb212-1668" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-1669"><a href="#cb212-1669" aria-hidden="true" tabindex="-1"></a><span class="co"># (Alle) Inserate-Anteile in Prozent</span></span>
<span id="cb212-1670"><a href="#cb212-1670" aria-hidden="true" tabindex="-1"></a>voting_5y_final <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb212-1671"><a href="#cb212-1671" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">inserate_ja_pct =</span> <span class="dv">100</span> <span class="sc">*</span> inserate_ja <span class="sc">/</span> inserate_total,</span>
<span id="cb212-1672"><a href="#cb212-1672" aria-hidden="true" tabindex="-1"></a>         <span class="at">inserate_nein_pct =</span> <span class="dv">100</span> <span class="sc">*</span> inserate_nein <span class="sc">/</span> inserate_total,</span>
<span id="cb212-1673"><a href="#cb212-1673" aria-hidden="true" tabindex="-1"></a>         <span class="at">inserate_neutral_pct =</span> <span class="dv">100</span> <span class="sc">*</span> inserate_neutral <span class="sc">/</span> inserate_total,</span>
<span id="cb212-1674"><a href="#cb212-1674" aria-hidden="true" tabindex="-1"></a>         <span class="at">nrja_pct     =</span> <span class="dv">100</span> <span class="sc">*</span> nrja <span class="sc">/</span> (nrja <span class="sc">+</span> nrnein),</span>
<span id="cb212-1675"><a href="#cb212-1675" aria-hidden="true" tabindex="-1"></a>         <span class="at">nrnein_pct   =</span> <span class="dv">100</span> <span class="sc">*</span> nrnein <span class="sc">/</span> (nrja <span class="sc">+</span> nrnein),</span>
<span id="cb212-1676"><a href="#cb212-1676" aria-hidden="true" tabindex="-1"></a>         <span class="at">srja_pct     =</span> <span class="dv">100</span> <span class="sc">*</span> srja <span class="sc">/</span> (srja <span class="sc">+</span> srnein),</span>
<span id="cb212-1677"><a href="#cb212-1677" aria-hidden="true" tabindex="-1"></a>         <span class="at">srnein_pct   =</span> <span class="dv">100</span> <span class="sc">*</span> srnein <span class="sc">/</span> (srja <span class="sc">+</span> srnein))</span>
<span id="cb212-1678"><a href="#cb212-1678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1679"><a href="#cb212-1679" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-1680"><a href="#cb212-1680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1681"><a href="#cb212-1681" aria-hidden="true" tabindex="-1"></a>Function: "Klassenmutation" Codeblock schreiben</span>
<span id="cb212-1682"><a href="#cb212-1682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1685"><a href="#cb212-1685" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-1686"><a href="#cb212-1686" aria-hidden="true" tabindex="-1"></a><span class="co">#df_name &lt;- "voting_5y_final"</span></span>
<span id="cb212-1687"><a href="#cb212-1687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1688"><a href="#cb212-1688" aria-hidden="true" tabindex="-1"></a><span class="co"># Funktion: Erzeugt den Mutate-Block</span></span>
<span id="cb212-1689"><a href="#cb212-1689" aria-hidden="true" tabindex="-1"></a>generate_codeblock_4_type_conversion <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">df_name =</span> <span class="st">"df"</span>) {</span>
<span id="cb212-1690"><a href="#cb212-1690" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Spaltennamen und deren aktuelle Klassen holen</span></span>
<span id="cb212-1691"><a href="#cb212-1691" aria-hidden="true" tabindex="-1"></a>  col_names <span class="ot">&lt;-</span> <span class="fu">names</span>(df)</span>
<span id="cb212-1692"><a href="#cb212-1692" aria-hidden="true" tabindex="-1"></a>  col_classes <span class="ot">&lt;-</span> <span class="fu">sapply</span>(df, class)</span>
<span id="cb212-1693"><a href="#cb212-1693" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-1694"><a href="#cb212-1694" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Länge des längsten Spaltennamens</span></span>
<span id="cb212-1695"><a href="#cb212-1695" aria-hidden="true" tabindex="-1"></a>  max_len <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">nchar</span>(col_names))</span>
<span id="cb212-1696"><a href="#cb212-1696" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-1697"><a href="#cb212-1697" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Erzeuge ästhetische Codezeilen</span></span>
<span id="cb212-1698"><a href="#cb212-1698" aria-hidden="true" tabindex="-1"></a>  code_lines <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map2_chr</span>(</span>
<span id="cb212-1699"><a href="#cb212-1699" aria-hidden="true" tabindex="-1"></a>    col_names, col_classes,</span>
<span id="cb212-1700"><a href="#cb212-1700" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(col, col_class) {</span>
<span id="cb212-1701"><a href="#cb212-1701" aria-hidden="true" tabindex="-1"></a>      padding <span class="ot">&lt;-</span> <span class="fu">strrep</span>(<span class="st">" "</span>,</span>
<span id="cb212-1702"><a href="#cb212-1702" aria-hidden="true" tabindex="-1"></a>                        max_len <span class="sc">-</span> <span class="fu">nchar</span>(col))</span>
<span id="cb212-1703"><a href="#cb212-1703" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"    "</span>, col, padding, <span class="st">" = as."</span>, col_class, <span class="st">"("</span>, col, <span class="st">")"</span>)</span>
<span id="cb212-1704"><a href="#cb212-1704" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb212-1705"><a href="#cb212-1705" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb212-1706"><a href="#cb212-1706" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-1707"><a href="#cb212-1707" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ganze mutate()-Struktur zusammensetzen</span></span>
<span id="cb212-1708"><a href="#cb212-1708" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste0</span>(</span>
<span id="cb212-1709"><a href="#cb212-1709" aria-hidden="true" tabindex="-1"></a>    df_name, <span class="st">" &lt;- "</span>, df_name, <span class="st">" %&gt;%</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb212-1710"><a href="#cb212-1710" aria-hidden="true" tabindex="-1"></a>    <span class="st">"  mutate(</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb212-1711"><a href="#cb212-1711" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(code_lines, <span class="at">collapse =</span> <span class="st">",</span><span class="sc">\n</span><span class="st">"</span>),</span>
<span id="cb212-1712"><a href="#cb212-1712" aria-hidden="true" tabindex="-1"></a>    <span class="st">"</span><span class="sc">\n</span><span class="st">  )</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb212-1713"><a href="#cb212-1713" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb212-1714"><a href="#cb212-1714" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb212-1715"><a href="#cb212-1715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1716"><a href="#cb212-1716" aria-hidden="true" tabindex="-1"></a><span class="co"># Function ausführen</span></span>
<span id="cb212-1717"><a href="#cb212-1717" aria-hidden="true" tabindex="-1"></a><span class="co"># df-Namen angeben für 1) Spaltenherkunft und 2) neues df im Codeblock</span></span>
<span id="cb212-1718"><a href="#cb212-1718" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_codeblock_4_type_conversion</span>(voting_5y_final,</span>
<span id="cb212-1719"><a href="#cb212-1719" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"voting_5y_final"</span>)</span>
<span id="cb212-1720"><a href="#cb212-1720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1721"><a href="#cb212-1721" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-1722"><a href="#cb212-1722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1723"><a href="#cb212-1723" aria-hidden="true" tabindex="-1"></a><span class="fu">## Analysen</span></span>
<span id="cb212-1724"><a href="#cb212-1724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1725"><a href="#cb212-1725" aria-hidden="true" tabindex="-1"></a><span class="fu">### Abstimmungsergebnisse mit widersprüchlichen Parolen</span></span>
<span id="cb212-1726"><a href="#cb212-1726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1727"><a href="#cb212-1727" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Data</span></span>
<span id="cb212-1728"><a href="#cb212-1728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1731"><a href="#cb212-1731" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-1732"><a href="#cb212-1732" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO: Umwandlung obsolet?!</span></span>
<span id="cb212-1733"><a href="#cb212-1733" aria-hidden="true" tabindex="-1"></a><span class="co">#relevante Spalten in numerisch umwandeln</span></span>
<span id="cb212-1734"><a href="#cb212-1734" aria-hidden="true" tabindex="-1"></a>voting_5y_final <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb212-1735"><a href="#cb212-1735" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">annahme =</span> <span class="fu">as.numeric</span>(annahme),</span>
<span id="cb212-1736"><a href="#cb212-1736" aria-hidden="true" tabindex="-1"></a>         <span class="at">state_parole_Ja =</span> <span class="fu">as.numeric</span>(state_parole_Ja),</span>
<span id="cb212-1737"><a href="#cb212-1737" aria-hidden="true" tabindex="-1"></a>         <span class="at">kt_parole_Ja =</span> <span class="fu">as.numeric</span>(kt_parole_Ja),</span>
<span id="cb212-1738"><a href="#cb212-1738" aria-hidden="true" tabindex="-1"></a>         <span class="at">gemeinde_parole_Ja =</span> <span class="fu">as.numeric</span>(gemeinde_parole_Ja))</span>
<span id="cb212-1739"><a href="#cb212-1739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1740"><a href="#cb212-1740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1741"><a href="#cb212-1741" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb212-1742"><a href="#cb212-1742" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb212-1743"><a href="#cb212-1743" aria-hidden="true" tabindex="-1"></a><span class="do">#### ANGENOMMEN</span></span>
<span id="cb212-1744"><a href="#cb212-1744" aria-hidden="true" tabindex="-1"></a><span class="co"># Angenommene Abstimmungen</span></span>
<span id="cb212-1745"><a href="#cb212-1745" aria-hidden="true" tabindex="-1"></a>angenommen <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb212-1746"><a href="#cb212-1746" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(annahme <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb212-1747"><a href="#cb212-1747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1748"><a href="#cb212-1748" aria-hidden="true" tabindex="-1"></a><span class="co"># Ja-Parole &gt; 50% auf mind. einer Ebene</span></span>
<span id="cb212-1749"><a href="#cb212-1749" aria-hidden="true" tabindex="-1"></a>angenommen <span class="ot">&lt;-</span> angenommen <span class="sc">%&gt;%</span></span>
<span id="cb212-1750"><a href="#cb212-1750" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ja_parole_50 =</span> (state_parole_Ja <span class="sc">&gt;=</span> <span class="dv">50</span>) <span class="sc">|</span></span>
<span id="cb212-1751"><a href="#cb212-1751" aria-hidden="true" tabindex="-1"></a>                        (kt_parole_Ja <span class="sc">&gt;=</span> <span class="dv">50</span>) <span class="sc">|</span></span>
<span id="cb212-1752"><a href="#cb212-1752" aria-hidden="true" tabindex="-1"></a>                        (gemeinde_parole_Ja <span class="sc">&gt;=</span> <span class="dv">50</span>))</span>
<span id="cb212-1753"><a href="#cb212-1753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1754"><a href="#cb212-1754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1755"><a href="#cb212-1755" aria-hidden="true" tabindex="-1"></a><span class="co"># Abstimmungen ANGENOMMEN obwohl Parolen ABLEHNEND waren</span></span>
<span id="cb212-1756"><a href="#cb212-1756" aria-hidden="true" tabindex="-1"></a>angenommen_ohne_ja_parole_50 <span class="ot">&lt;-</span> angenommen <span class="sc">%&gt;%</span></span>
<span id="cb212-1757"><a href="#cb212-1757" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ja_parole_50 <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-1758"><a href="#cb212-1758" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(anr,</span>
<span id="cb212-1759"><a href="#cb212-1759" aria-hidden="true" tabindex="-1"></a>         titel_kurz_d,</span>
<span id="cb212-1760"><a href="#cb212-1760" aria-hidden="true" tabindex="-1"></a>         annahme,</span>
<span id="cb212-1761"><a href="#cb212-1761" aria-hidden="true" tabindex="-1"></a>         volkja_proz,</span>
<span id="cb212-1762"><a href="#cb212-1762" aria-hidden="true" tabindex="-1"></a>         state_parole_Ja,</span>
<span id="cb212-1763"><a href="#cb212-1763" aria-hidden="true" tabindex="-1"></a>         kt_parole_Ja,</span>
<span id="cb212-1764"><a href="#cb212-1764" aria-hidden="true" tabindex="-1"></a>         gemeinde_parole_Ja)</span>
<span id="cb212-1765"><a href="#cb212-1765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1766"><a href="#cb212-1766" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(angenommen_ohne_ja_parole_50)</span>
<span id="cb212-1767"><a href="#cb212-1767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1768"><a href="#cb212-1768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1769"><a href="#cb212-1769" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb212-1770"><a href="#cb212-1770" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb212-1771"><a href="#cb212-1771" aria-hidden="true" tabindex="-1"></a><span class="do">#### ABGELEHNT</span></span>
<span id="cb212-1772"><a href="#cb212-1772" aria-hidden="true" tabindex="-1"></a><span class="co"># Abgelehnte Abstimmungen</span></span>
<span id="cb212-1773"><a href="#cb212-1773" aria-hidden="true" tabindex="-1"></a>abgelehnt <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb212-1774"><a href="#cb212-1774" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(annahme <span class="sc">!=</span> <span class="dv">1</span>)</span>
<span id="cb212-1775"><a href="#cb212-1775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1776"><a href="#cb212-1776" aria-hidden="true" tabindex="-1"></a><span class="co"># Nein-Parole &gt; 50% auf mind. einer Ebene</span></span>
<span id="cb212-1777"><a href="#cb212-1777" aria-hidden="true" tabindex="-1"></a>abgelehnt <span class="ot">&lt;-</span> abgelehnt <span class="sc">%&gt;%</span></span>
<span id="cb212-1778"><a href="#cb212-1778" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nein_parole_50 =</span> (state_parole_Nein <span class="sc">&gt;=</span> <span class="dv">50</span>) <span class="sc">|</span></span>
<span id="cb212-1779"><a href="#cb212-1779" aria-hidden="true" tabindex="-1"></a>                          (kt_parole_Nein <span class="sc">&gt;=</span> <span class="dv">50</span>) <span class="sc">|</span></span>
<span id="cb212-1780"><a href="#cb212-1780" aria-hidden="true" tabindex="-1"></a>                          (gemeinde_parole_Nein <span class="sc">&gt;=</span> <span class="dv">50</span>))</span>
<span id="cb212-1781"><a href="#cb212-1781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1782"><a href="#cb212-1782" aria-hidden="true" tabindex="-1"></a><span class="co"># Abstimmungen ABGELEHNT obwohl Parolen BEFÜRWORTEND waren</span></span>
<span id="cb212-1783"><a href="#cb212-1783" aria-hidden="true" tabindex="-1"></a>abgelehnt_ohne_nein_parole_50 <span class="ot">&lt;-</span> abgelehnt <span class="sc">%&gt;%</span></span>
<span id="cb212-1784"><a href="#cb212-1784" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nein_parole_50 <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-1785"><a href="#cb212-1785" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(anr,</span>
<span id="cb212-1786"><a href="#cb212-1786" aria-hidden="true" tabindex="-1"></a>         titel_kurz_d,</span>
<span id="cb212-1787"><a href="#cb212-1787" aria-hidden="true" tabindex="-1"></a>         annahme,</span>
<span id="cb212-1788"><a href="#cb212-1788" aria-hidden="true" tabindex="-1"></a>         volkja_proz,</span>
<span id="cb212-1789"><a href="#cb212-1789" aria-hidden="true" tabindex="-1"></a>         state_parole_Nein,</span>
<span id="cb212-1790"><a href="#cb212-1790" aria-hidden="true" tabindex="-1"></a>         kt_parole_Nein,</span>
<span id="cb212-1791"><a href="#cb212-1791" aria-hidden="true" tabindex="-1"></a>         gemeinde_parole_Nein)</span>
<span id="cb212-1792"><a href="#cb212-1792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1793"><a href="#cb212-1793" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(abgelehnt_ohne_nein_parole_50)</span>
<span id="cb212-1794"><a href="#cb212-1794" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-1795"><a href="#cb212-1795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1796"><a href="#cb212-1796" aria-hidden="true" tabindex="-1"></a><span class="fu">### Paradoxe Fälle ÜBERARBEITEN</span></span>
<span id="cb212-1797"><a href="#cb212-1797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1798"><a href="#cb212-1798" aria-hidden="true" tabindex="-1"></a>ob und wie stark die Parolen der Parteien (auf Staats-, Kantons- und Gemeindeebene) mit dem Abstimmungsausgang zusammenhängen – insbesondere in Fällen, wo die Ja-Parole unter 50 % liegt, die Vorlage aber trotzdem angenommen wird (und umgekehrt).</span>
<span id="cb212-1799"><a href="#cb212-1799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1802"><a href="#cb212-1802" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-1803"><a href="#cb212-1803" aria-hidden="true" tabindex="-1"></a><span class="co"># Fälle identifizieren: "Paradoxe" Abstimmungen</span></span>
<span id="cb212-1804"><a href="#cb212-1804" aria-hidden="true" tabindex="-1"></a><span class="co"># Annahme == 1, aber state_parole_Ja &lt; 50 (und/oder die anderen Ebenen)</span></span>
<span id="cb212-1805"><a href="#cb212-1805" aria-hidden="true" tabindex="-1"></a><span class="co"># Annahme == 0, aber state_parole_Ja &gt;= 50 (und/oder die anderen Ebenen)</span></span>
<span id="cb212-1806"><a href="#cb212-1806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1807"><a href="#cb212-1807" aria-hidden="true" tabindex="-1"></a><span class="co"># Annahme als numerisch </span></span>
<span id="cb212-1808"><a href="#cb212-1808" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO: OBSOLET?</span></span>
<span id="cb212-1809"><a href="#cb212-1809" aria-hidden="true" tabindex="-1"></a>voting_5y_final<span class="sc">$</span>annahme <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(voting_5y_final<span class="sc">$</span>annahme)</span>
<span id="cb212-1810"><a href="#cb212-1810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1811"><a href="#cb212-1811" aria-hidden="true" tabindex="-1"></a><span class="co"># Fälle identifizieren</span></span>
<span id="cb212-1812"><a href="#cb212-1812" aria-hidden="true" tabindex="-1"></a>paradoxe_faelle <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb212-1813"><a href="#cb212-1813" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((annahme <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> (state_parole_Ja <span class="sc">&lt;</span> <span class="dv">50</span> <span class="sc">|</span></span>
<span id="cb212-1814"><a href="#cb212-1814" aria-hidden="true" tabindex="-1"></a>                            kt_parole_Ja <span class="sc">&lt;</span> <span class="dv">50</span> <span class="sc">|</span></span>
<span id="cb212-1815"><a href="#cb212-1815" aria-hidden="true" tabindex="-1"></a>                            gemeinde_parole_Ja <span class="sc">&lt;</span> <span class="dv">50</span>)) <span class="sc">|</span></span>
<span id="cb212-1816"><a href="#cb212-1816" aria-hidden="true" tabindex="-1"></a>           (annahme <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> (state_parole_Ja <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">|</span></span>
<span id="cb212-1817"><a href="#cb212-1817" aria-hidden="true" tabindex="-1"></a>                              kt_parole_Ja <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">|</span></span>
<span id="cb212-1818"><a href="#cb212-1818" aria-hidden="true" tabindex="-1"></a>                              gemeinde_parole_Ja <span class="sc">&gt;=</span> <span class="dv">50</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb212-1819"><a href="#cb212-1819" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(anr, titel_kurz_d, annahme, state_parole_Ja, kt_parole_Ja, gemeinde_parole_Ja)</span>
<span id="cb212-1820"><a href="#cb212-1820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1821"><a href="#cb212-1821" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-1822"><a href="#cb212-1822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1823"><a href="#cb212-1823" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Varianz</span></span>
<span id="cb212-1824"><a href="#cb212-1824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1827"><a href="#cb212-1827" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-1828"><a href="#cb212-1828" aria-hidden="true" tabindex="-1"></a><span class="co"># Abweichungen berechnen</span></span>
<span id="cb212-1829"><a href="#cb212-1829" aria-hidden="true" tabindex="-1"></a>voting_5y_final <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb212-1830"><a href="#cb212-1830" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_state =</span> state_parole_Ja <span class="sc">-</span> volkja_proz,</span>
<span id="cb212-1831"><a href="#cb212-1831" aria-hidden="true" tabindex="-1"></a>         <span class="at">diff_kanton =</span> kt_parole_Ja <span class="sc">-</span> volkja_proz,</span>
<span id="cb212-1832"><a href="#cb212-1832" aria-hidden="true" tabindex="-1"></a>         <span class="at">diff_gemeinde =</span> gemeinde_parole_Ja <span class="sc">-</span> volkja_proz)</span>
<span id="cb212-1833"><a href="#cb212-1833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1834"><a href="#cb212-1834" aria-hidden="true" tabindex="-1"></a><span class="co"># Mittelwert und Standardabweichung der Abweichungen je Parole berechnen</span></span>
<span id="cb212-1835"><a href="#cb212-1835" aria-hidden="true" tabindex="-1"></a>summary_stats_v1 <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb212-1836"><a href="#cb212-1836" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_state =</span> <span class="fu">mean</span>(diff_state),</span>
<span id="cb212-1837"><a href="#cb212-1837" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_state =</span> <span class="fu">sd</span>(diff_state),</span>
<span id="cb212-1838"><a href="#cb212-1838" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_kanton =</span> <span class="fu">mean</span>(diff_kanton),</span>
<span id="cb212-1839"><a href="#cb212-1839" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_kanton =</span> <span class="fu">sd</span>(diff_kanton),</span>
<span id="cb212-1840"><a href="#cb212-1840" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_gemeinde =</span> <span class="fu">mean</span>(diff_gemeinde),</span>
<span id="cb212-1841"><a href="#cb212-1841" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_gemeinde =</span> <span class="fu">sd</span>(diff_gemeinde)) <span class="sc">%&gt;%</span></span>
<span id="cb212-1842"><a href="#cb212-1842" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb212-1843"><a href="#cb212-1843" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"stat"</span>,</span>
<span id="cb212-1844"><a href="#cb212-1844" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Parole"</span>),</span>
<span id="cb212-1845"><a href="#cb212-1845" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"_"</span>,</span>
<span id="cb212-1846"><a href="#cb212-1846" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-1847"><a href="#cb212-1847" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> stat,</span>
<span id="cb212-1848"><a href="#cb212-1848" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb212-1849"><a href="#cb212-1849" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parole =</span> dplyr<span class="sc">::</span><span class="fu">recode</span>(Parole,</span>
<span id="cb212-1850"><a href="#cb212-1850" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"state"</span> <span class="ot">=</span> <span class="st">"State"</span>,</span>
<span id="cb212-1851"><a href="#cb212-1851" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"kanton"</span> <span class="ot">=</span> <span class="st">"Kanton"</span>,</span>
<span id="cb212-1852"><a href="#cb212-1852" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"gemeinde"</span> <span class="ot">=</span> <span class="st">"Gemeinde"</span>))</span>
<span id="cb212-1853"><a href="#cb212-1853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1854"><a href="#cb212-1854" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualisierung als Balkendiagramm mit Fehlerbalken (±1 SD)</span></span>
<span id="cb212-1855"><a href="#cb212-1855" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(summary_stats_v1,</span>
<span id="cb212-1856"><a href="#cb212-1856" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Parole,</span>
<span id="cb212-1857"><a href="#cb212-1857" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> mean,</span>
<span id="cb212-1858"><a href="#cb212-1858" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> Parole)) <span class="sc">+</span></span>
<span id="cb212-1859"><a href="#cb212-1859" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.6</span>,</span>
<span id="cb212-1860"><a href="#cb212-1860" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb212-1861"><a href="#cb212-1861" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean <span class="sc">-</span> sd,</span>
<span id="cb212-1862"><a href="#cb212-1862" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> mean <span class="sc">+</span> sd),</span>
<span id="cb212-1863"><a href="#cb212-1863" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb212-1864"><a href="#cb212-1864" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb212-1865"><a href="#cb212-1865" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Mittlere Abweichung der Parolen vom Volksentscheid</span><span class="sc">\n</span><span class="st">mit Standardabweichung"</span>,</span>
<span id="cb212-1866"><a href="#cb212-1866" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Parole"</span>,</span>
<span id="cb212-1867"><a href="#cb212-1867" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Mittlere Abweichung (±1 SD, Prozentpunkte)"</span>) <span class="sc">+</span></span>
<span id="cb212-1868"><a href="#cb212-1868" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>)</span>
<span id="cb212-1869"><a href="#cb212-1869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1870"><a href="#cb212-1870" aria-hidden="true" tabindex="-1"></a>summary_stats_v1</span>
<span id="cb212-1871"><a href="#cb212-1871" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-1872"><a href="#cb212-1872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1873"><a href="#cb212-1873" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Varianz gruppiert nach Rechtsform</span></span>
<span id="cb212-1874"><a href="#cb212-1874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1877"><a href="#cb212-1877" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-1878"><a href="#cb212-1878" aria-hidden="true" tabindex="-1"></a><span class="co"># Abweichungen berechnen</span></span>
<span id="cb212-1879"><a href="#cb212-1879" aria-hidden="true" tabindex="-1"></a>voting_5y_final <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb212-1880"><a href="#cb212-1880" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_state =</span> state_parole_Ja <span class="sc">-</span> volkja_proz,</span>
<span id="cb212-1881"><a href="#cb212-1881" aria-hidden="true" tabindex="-1"></a>         <span class="at">diff_kanton =</span> kt_parole_Ja <span class="sc">-</span> volkja_proz,</span>
<span id="cb212-1882"><a href="#cb212-1882" aria-hidden="true" tabindex="-1"></a>         <span class="at">diff_gemeinde =</span> gemeinde_parole_Ja <span class="sc">-</span> volkja_proz)</span>
<span id="cb212-1883"><a href="#cb212-1883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1884"><a href="#cb212-1884" aria-hidden="true" tabindex="-1"></a><span class="co"># Zusammenfassen nach "dep" gruppiert</span></span>
<span id="cb212-1885"><a href="#cb212-1885" aria-hidden="true" tabindex="-1"></a>summary_stats_v2 <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb212-1886"><a href="#cb212-1886" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(rechtsform) <span class="sc">%&gt;%</span></span>
<span id="cb212-1887"><a href="#cb212-1887" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_state =</span> <span class="fu">mean</span>(diff_state),</span>
<span id="cb212-1888"><a href="#cb212-1888" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_state =</span> <span class="fu">sd</span>(diff_state),</span>
<span id="cb212-1889"><a href="#cb212-1889" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_kanton =</span> <span class="fu">mean</span>(diff_kanton),</span>
<span id="cb212-1890"><a href="#cb212-1890" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_kanton =</span> <span class="fu">sd</span>(diff_kanton),</span>
<span id="cb212-1891"><a href="#cb212-1891" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_gemeinde =</span> <span class="fu">mean</span>(diff_gemeinde),</span>
<span id="cb212-1892"><a href="#cb212-1892" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_gemeinde =</span> <span class="fu">sd</span>(diff_gemeinde)) <span class="sc">%&gt;%</span></span>
<span id="cb212-1893"><a href="#cb212-1893" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>rechtsform,</span>
<span id="cb212-1894"><a href="#cb212-1894" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"stat"</span>, <span class="st">"Parole"</span>),</span>
<span id="cb212-1895"><a href="#cb212-1895" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"_"</span>,</span>
<span id="cb212-1896"><a href="#cb212-1896" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-1897"><a href="#cb212-1897" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> stat,</span>
<span id="cb212-1898"><a href="#cb212-1898" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb212-1899"><a href="#cb212-1899" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parole =</span> dplyr<span class="sc">::</span><span class="fu">recode</span>(Parole,</span>
<span id="cb212-1900"><a href="#cb212-1900" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"state"</span> <span class="ot">=</span> <span class="st">"State"</span>,</span>
<span id="cb212-1901"><a href="#cb212-1901" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"kanton"</span> <span class="ot">=</span> <span class="st">"Kanton"</span>,</span>
<span id="cb212-1902"><a href="#cb212-1902" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"gemeinde"</span> <span class="ot">=</span> <span class="st">"Gemeinde"</span>))</span>
<span id="cb212-1903"><a href="#cb212-1903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1904"><a href="#cb212-1904" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualisierung nach "dep"-Gruppe</span></span>
<span id="cb212-1905"><a href="#cb212-1905" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(summary_stats_v2, <span class="fu">aes</span>(<span class="at">x =</span> Parole, <span class="at">y =</span> mean, <span class="at">fill =</span> Parole)) <span class="sc">+</span></span>
<span id="cb212-1906"><a href="#cb212-1906" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb212-1907"><a href="#cb212-1907" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean <span class="sc">-</span> sd, <span class="at">ymax =</span> mean <span class="sc">+</span> sd), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb212-1908"><a href="#cb212-1908" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> rechtsform) <span class="sc">+</span></span>
<span id="cb212-1909"><a href="#cb212-1909" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb212-1910"><a href="#cb212-1910" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Mittlere Abweichung der Parolen vom Volksentscheid</span><span class="sc">\n</span><span class="st">mit Standardabweichung nach Rechtsform"</span>,</span>
<span id="cb212-1911"><a href="#cb212-1911" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Parole"</span>,</span>
<span id="cb212-1912"><a href="#cb212-1912" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Mittlere Abweichung (±1 SD, Prozentpunkte)"</span>) <span class="sc">+</span></span>
<span id="cb212-1913"><a href="#cb212-1913" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>)</span>
<span id="cb212-1914"><a href="#cb212-1914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1915"><a href="#cb212-1915" aria-hidden="true" tabindex="-1"></a>summary_stats_v2</span>
<span id="cb212-1916"><a href="#cb212-1916" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-1917"><a href="#cb212-1917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1918"><a href="#cb212-1918" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Prüfung der Normalverteilung</span></span>
<span id="cb212-1919"><a href="#cb212-1919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1920"><a href="#cb212-1920" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Grafisch</span></span>
<span id="cb212-1921"><a href="#cb212-1921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1924"><a href="#cb212-1924" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-1925"><a href="#cb212-1925" aria-hidden="true" tabindex="-1"></a><span class="co"># Nur die beiden großen Gruppen auswählen</span></span>
<span id="cb212-1926"><a href="#cb212-1926" aria-hidden="true" tabindex="-1"></a>gruppen <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Fakultatives Referendum"</span>, <span class="st">"Volksinitiative"</span>)</span>
<span id="cb212-1927"><a href="#cb212-1927" aria-hidden="true" tabindex="-1"></a>df_sub <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span> <span class="fu">filter</span>(rechtsform <span class="sc">%in%</span> gruppen)</span>
<span id="cb212-1928"><a href="#cb212-1928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1929"><a href="#cb212-1929" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogramm mit Facet für jede Gruppe</span></span>
<span id="cb212-1930"><a href="#cb212-1930" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_sub, <span class="fu">aes</span>(<span class="at">x =</span> diff_state, <span class="at">fill =</span> rechtsform)) <span class="sc">+</span></span>
<span id="cb212-1931"><a href="#cb212-1931" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">bins =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb212-1932"><a href="#cb212-1932" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> rechtsform) <span class="sc">+</span></span>
<span id="cb212-1933"><a href="#cb212-1933" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb212-1934"><a href="#cb212-1934" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogramm der diff_state nach Rechtsform"</span>,</span>
<span id="cb212-1935"><a href="#cb212-1935" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"diff_state"</span>, <span class="at">y =</span> <span class="st">"Anzahl"</span>)</span>
<span id="cb212-1936"><a href="#cb212-1936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1937"><a href="#cb212-1937" aria-hidden="true" tabindex="-1"></a><span class="co"># QQ-Plot für jede Gruppe</span></span>
<span id="cb212-1938"><a href="#cb212-1938" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_sub, <span class="fu">aes</span>(<span class="at">sample =</span> diff_state)) <span class="sc">+</span></span>
<span id="cb212-1939"><a href="#cb212-1939" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq</span>() <span class="sc">+</span></span>
<span id="cb212-1940"><a href="#cb212-1940" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq_line</span>() <span class="sc">+</span></span>
<span id="cb212-1941"><a href="#cb212-1941" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> rechtsform) <span class="sc">+</span></span>
<span id="cb212-1942"><a href="#cb212-1942" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb212-1943"><a href="#cb212-1943" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"QQ-Plot der diff_state nach Rechtsform"</span>)</span>
<span id="cb212-1944"><a href="#cb212-1944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1945"><a href="#cb212-1945" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-1946"><a href="#cb212-1946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1947"><a href="#cb212-1947" aria-hidden="true" tabindex="-1"></a><span class="fu">##### **Formale Prüfung (Shapiro-Wilk-Test)**</span></span>
<span id="cb212-1948"><a href="#cb212-1948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1951"><a href="#cb212-1951" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-1952"><a href="#cb212-1952" aria-hidden="true" tabindex="-1"></a><span class="co"># Shapiro-Wilk-Test für jede Gruppe</span></span>
<span id="cb212-1953"><a href="#cb212-1953" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(df_sub<span class="sc">$</span>diff_state[df_sub<span class="sc">$</span>rechtsform <span class="sc">==</span> <span class="st">"Fakultatives Referendum"</span>])</span>
<span id="cb212-1954"><a href="#cb212-1954" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(df_sub<span class="sc">$</span>diff_state[df_sub<span class="sc">$</span>rechtsform <span class="sc">==</span> <span class="st">"Volksinitiative"</span>])</span>
<span id="cb212-1955"><a href="#cb212-1955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1956"><a href="#cb212-1956" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(df_sub<span class="sc">$</span>diff_kanton[df_sub<span class="sc">$</span>rechtsform <span class="sc">==</span> <span class="st">"Fakultatives Referendum"</span>])</span>
<span id="cb212-1957"><a href="#cb212-1957" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(df_sub<span class="sc">$</span>diff_kanton[df_sub<span class="sc">$</span>rechtsform <span class="sc">==</span> <span class="st">"Volksinitiative"</span>])</span>
<span id="cb212-1958"><a href="#cb212-1958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1959"><a href="#cb212-1959" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(df_sub<span class="sc">$</span>diff_gemeinde[df_sub<span class="sc">$</span>rechtsform <span class="sc">==</span> <span class="st">"Fakultatives Referendum"</span>])</span>
<span id="cb212-1960"><a href="#cb212-1960" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(df_sub<span class="sc">$</span>diff_gemeinde[df_sub<span class="sc">$</span>rechtsform <span class="sc">==</span> <span class="st">"Volksinitiative"</span>])</span>
<span id="cb212-1961"><a href="#cb212-1961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1962"><a href="#cb212-1962" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-1963"><a href="#cb212-1963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1964"><a href="#cb212-1964" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Prüfung der Varianzhomogenität (Levene-Test)</span></span>
<span id="cb212-1965"><a href="#cb212-1965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1968"><a href="#cb212-1968" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-1969"><a href="#cb212-1969" aria-hidden="true" tabindex="-1"></a><span class="fu">leveneTest</span>(diff_state <span class="sc">~</span> rechtsform, <span class="at">data =</span> df_sub)</span>
<span id="cb212-1970"><a href="#cb212-1970" aria-hidden="true" tabindex="-1"></a><span class="fu">leveneTest</span>(diff_kanton <span class="sc">~</span> rechtsform, <span class="at">data =</span> df_sub)</span>
<span id="cb212-1971"><a href="#cb212-1971" aria-hidden="true" tabindex="-1"></a><span class="fu">leveneTest</span>(diff_gemeinde <span class="sc">~</span> rechtsform, <span class="at">data =</span> df_sub)</span>
<span id="cb212-1972"><a href="#cb212-1972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1973"><a href="#cb212-1973" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-1974"><a href="#cb212-1974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1975"><a href="#cb212-1975" aria-hidden="true" tabindex="-1"></a><span class="fu">#### T-Test</span></span>
<span id="cb212-1976"><a href="#cb212-1976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1979"><a href="#cb212-1979" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-1980"><a href="#cb212-1980" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(diff_state <span class="sc">~</span> rechtsform, <span class="at">data =</span> df_sub, <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span>
<span id="cb212-1981"><a href="#cb212-1981" aria-hidden="true" tabindex="-1"></a><span class="co">#t.test(diff_kanton ~ rechtsform, data = df_sub, var.equal = TRUE)</span></span>
<span id="cb212-1982"><a href="#cb212-1982" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(diff_gemeinde <span class="sc">~</span> rechtsform, <span class="at">data =</span> df_sub, <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span>
<span id="cb212-1983"><a href="#cb212-1983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1984"><a href="#cb212-1984" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-1985"><a href="#cb212-1985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1986"><a href="#cb212-1986" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Mann-Whitney-U-Test / Wilcox</span></span>
<span id="cb212-1987"><a href="#cb212-1987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1990"><a href="#cb212-1990" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-1991"><a href="#cb212-1991" aria-hidden="true" tabindex="-1"></a><span class="co"># wilcox.test(diff_state ~ rechtsform, data = df_sub)</span></span>
<span id="cb212-1992"><a href="#cb212-1992" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(diff_kanton <span class="sc">~</span> rechtsform, <span class="at">data =</span> df_sub)</span>
<span id="cb212-1993"><a href="#cb212-1993" aria-hidden="true" tabindex="-1"></a><span class="co"># wilcox.test(diff_gemeinde ~ rechtsform, data = df_sub)</span></span>
<span id="cb212-1994"><a href="#cb212-1994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1995"><a href="#cb212-1995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-1996"><a href="#cb212-1996" aria-hidden="true" tabindex="-1"></a><span class="co"># Mediane</span></span>
<span id="cb212-1997"><a href="#cb212-1997" aria-hidden="true" tabindex="-1"></a>df_sub <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(rechtsform) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">Median =</span> <span class="fu">median</span>(diff_kanton))</span>
<span id="cb212-1998"><a href="#cb212-1998" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-1999"><a href="#cb212-1999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2000"><a href="#cb212-2000" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Tables Annahme &amp; Ablehnung(Word)</span></span>
<span id="cb212-2001"><a href="#cb212-2001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2004"><a href="#cb212-2004" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-2005"><a href="#cb212-2005" aria-hidden="true" tabindex="-1"></a><span class="co"># Funktion für identische Formatierung</span></span>
<span id="cb212-2006"><a href="#cb212-2006" aria-hidden="true" tabindex="-1"></a>format_table <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb212-2007"><a href="#cb212-2007" aria-hidden="true" tabindex="-1"></a>  df[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df[[<span class="dv">1</span>]])</span>
<span id="cb212-2008"><a href="#cb212-2008" aria-hidden="true" tabindex="-1"></a>  df[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df[[<span class="dv">3</span>]])</span>
<span id="cb212-2009"><a href="#cb212-2009" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">flextable</span>(df)</span>
<span id="cb212-2010"><a href="#cb212-2010" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">theme_vanilla</span>(ft)</span>
<span id="cb212-2011"><a href="#cb212-2011" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">font</span>(ft, <span class="at">fontname =</span> <span class="st">"Courier New"</span>, <span class="at">part =</span> <span class="st">"all"</span>)</span>
<span id="cb212-2012"><a href="#cb212-2012" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">fontsize</span>(ft, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">part =</span> <span class="st">"all"</span>)</span>
<span id="cb212-2013"><a href="#cb212-2013" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">colformat_double</span>(ft, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb212-2014"><a href="#cb212-2014" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ft &lt;- colformat_double(ft, digits = 1, suffix = "%")</span></span>
<span id="cb212-2015"><a href="#cb212-2015" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">width</span>(ft, <span class="at">j =</span> <span class="dv">2</span>, <span class="at">width =</span> <span class="dv">2</span>)</span>
<span id="cb212-2016"><a href="#cb212-2016" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ft)</span>
<span id="cb212-2017"><a href="#cb212-2017" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb212-2018"><a href="#cb212-2018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2019"><a href="#cb212-2019" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabelle 1: ANGENOMMEN</span></span>
<span id="cb212-2020"><a href="#cb212-2020" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">head</span>(angenommen_ohne_ja_parole_50)</span>
<span id="cb212-2021"><a href="#cb212-2021" aria-hidden="true" tabindex="-1"></a>ft1 <span class="ot">&lt;-</span> <span class="fu">format_table</span>(df1)</span>
<span id="cb212-2022"><a href="#cb212-2022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2023"><a href="#cb212-2023" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabelle 2: ABGELEHNT</span></span>
<span id="cb212-2024"><a href="#cb212-2024" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">head</span>(abgelehnt_ohne_nein_parole_50)</span>
<span id="cb212-2025"><a href="#cb212-2025" aria-hidden="true" tabindex="-1"></a>ft2 <span class="ot">&lt;-</span> <span class="fu">format_table</span>(df2)</span>
<span id="cb212-2026"><a href="#cb212-2026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2027"><a href="#cb212-2027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2028"><a href="#cb212-2028" aria-hidden="true" tabindex="-1"></a><span class="co"># Word-Dokument erstellen und beide Tabellen einfügen ---</span></span>
<span id="cb212-2029"><a href="#cb212-2029" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">read_docx</span>()</span>
<span id="cb212-2030"><a href="#cb212-2030" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">body_add_par</span>(doc,</span>
<span id="cb212-2031"><a href="#cb212-2031" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Annahme trotz fehlender Unterstützung durch Parolen"</span>,</span>
<span id="cb212-2032"><a href="#cb212-2032" aria-hidden="true" tabindex="-1"></a>                    <span class="at">style =</span> <span class="st">"heading 1"</span>)</span>
<span id="cb212-2033"><a href="#cb212-2033" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">body_add_flextable</span>(doc,</span>
<span id="cb212-2034"><a href="#cb212-2034" aria-hidden="true" tabindex="-1"></a>                          ft1)</span>
<span id="cb212-2035"><a href="#cb212-2035" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">body_add_par</span>(doc, <span class="st">""</span>) <span class="co"># Leerzeile</span></span>
<span id="cb212-2036"><a href="#cb212-2036" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">body_add_par</span>(doc,</span>
<span id="cb212-2037"><a href="#cb212-2037" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Ablehnung trotz fehlender Unterstützung durch Parolen"</span>,</span>
<span id="cb212-2038"><a href="#cb212-2038" aria-hidden="true" tabindex="-1"></a>                    <span class="at">style =</span> <span class="st">"heading 1"</span>)</span>
<span id="cb212-2039"><a href="#cb212-2039" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">body_add_flextable</span>(doc,</span>
<span id="cb212-2040"><a href="#cb212-2040" aria-hidden="true" tabindex="-1"></a>                          ft2)</span>
<span id="cb212-2041"><a href="#cb212-2041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2042"><a href="#cb212-2042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2043"><a href="#cb212-2043" aria-hidden="true" tabindex="-1"></a><span class="co"># Speichern </span></span>
<span id="cb212-2044"><a href="#cb212-2044" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(doc, <span class="at">target =</span> <span class="st">"result/Annahme_Ablehnung.docx"</span>)</span>
<span id="cb212-2045"><a href="#cb212-2045" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-2046"><a href="#cb212-2046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2047"><a href="#cb212-2047" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Tables Varianz (Word)</span></span>
<span id="cb212-2048"><a href="#cb212-2048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2051"><a href="#cb212-2051" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-2052"><a href="#cb212-2052" aria-hidden="true" tabindex="-1"></a><span class="co"># Funktion für identische Formatierung</span></span>
<span id="cb212-2053"><a href="#cb212-2053" aria-hidden="true" tabindex="-1"></a>format_table <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb212-2054"><a href="#cb212-2054" aria-hidden="true" tabindex="-1"></a>  df[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df[[<span class="dv">1</span>]])</span>
<span id="cb212-2055"><a href="#cb212-2055" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">flextable</span>(df)</span>
<span id="cb212-2056"><a href="#cb212-2056" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">theme_vanilla</span>(ft)</span>
<span id="cb212-2057"><a href="#cb212-2057" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">font</span>(ft, <span class="at">fontname =</span> <span class="st">"Courier New"</span>, <span class="at">part =</span> <span class="st">"all"</span>)</span>
<span id="cb212-2058"><a href="#cb212-2058" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">fontsize</span>(ft, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">part =</span> <span class="st">"all"</span>)</span>
<span id="cb212-2059"><a href="#cb212-2059" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">colformat_double</span>(ft, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb212-2060"><a href="#cb212-2060" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ft &lt;- colformat_double(ft, digits = 1, suffix = "%")</span></span>
<span id="cb212-2061"><a href="#cb212-2061" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">width</span>(ft, <span class="at">j =</span> <span class="dv">2</span>, <span class="at">width =</span> <span class="dv">2</span>)</span>
<span id="cb212-2062"><a href="#cb212-2062" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ft)</span>
<span id="cb212-2063"><a href="#cb212-2063" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb212-2064"><a href="#cb212-2064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2065"><a href="#cb212-2065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2066"><a href="#cb212-2066" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabelle 1: VARIANZ</span></span>
<span id="cb212-2067"><a href="#cb212-2067" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">head</span>(summary_stats_v1, <span class="dv">10</span>)</span>
<span id="cb212-2068"><a href="#cb212-2068" aria-hidden="true" tabindex="-1"></a>ft1 <span class="ot">&lt;-</span> <span class="fu">format_table</span>(df1)</span>
<span id="cb212-2069"><a href="#cb212-2069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2070"><a href="#cb212-2070" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabelle 2: VARIANZ Gruppiert nach Rechtsform</span></span>
<span id="cb212-2071"><a href="#cb212-2071" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">head</span>(summary_stats_v2, <span class="dv">10</span>)</span>
<span id="cb212-2072"><a href="#cb212-2072" aria-hidden="true" tabindex="-1"></a>ft2 <span class="ot">&lt;-</span> <span class="fu">format_table</span>(df2)</span>
<span id="cb212-2073"><a href="#cb212-2073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2074"><a href="#cb212-2074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2075"><a href="#cb212-2075" aria-hidden="true" tabindex="-1"></a><span class="co"># Word-Dokument erstellen und beide Tabellen einfügen ---</span></span>
<span id="cb212-2076"><a href="#cb212-2076" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">read_docx</span>()</span>
<span id="cb212-2077"><a href="#cb212-2077" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">body_add_par</span>(doc,</span>
<span id="cb212-2078"><a href="#cb212-2078" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Mittlere Abweichung der Parolen vom Volksentscheid - Mit Standardabweichung"</span>,</span>
<span id="cb212-2079"><a href="#cb212-2079" aria-hidden="true" tabindex="-1"></a>                    <span class="at">style =</span> <span class="st">"heading 1"</span>)</span>
<span id="cb212-2080"><a href="#cb212-2080" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">body_add_flextable</span>(doc,</span>
<span id="cb212-2081"><a href="#cb212-2081" aria-hidden="true" tabindex="-1"></a>                          ft1)</span>
<span id="cb212-2082"><a href="#cb212-2082" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">body_add_par</span>(doc, <span class="st">""</span>) <span class="co"># Leerzeile</span></span>
<span id="cb212-2083"><a href="#cb212-2083" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">body_add_par</span>(doc,</span>
<span id="cb212-2084"><a href="#cb212-2084" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Mittlere Abweichung der Parolen vom Volksentscheid - Mit Standardabweichung. Gruppiert nach Rechtsform"</span>,</span>
<span id="cb212-2085"><a href="#cb212-2085" aria-hidden="true" tabindex="-1"></a>                    <span class="at">style =</span> <span class="st">"heading 1"</span>)</span>
<span id="cb212-2086"><a href="#cb212-2086" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">body_add_flextable</span>(doc,</span>
<span id="cb212-2087"><a href="#cb212-2087" aria-hidden="true" tabindex="-1"></a>                          ft2)</span>
<span id="cb212-2088"><a href="#cb212-2088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2089"><a href="#cb212-2089" aria-hidden="true" tabindex="-1"></a><span class="co"># Speichern </span></span>
<span id="cb212-2090"><a href="#cb212-2090" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(doc, <span class="at">target =</span> <span class="st">"result/Varianz.docx"</span>)</span>
<span id="cb212-2091"><a href="#cb212-2091" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-2092"><a href="#cb212-2092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2093"><a href="#cb212-2093" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Tables vergleichende Gruppenstatistik (Word)</span></span>
<span id="cb212-2094"><a href="#cb212-2094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2097"><a href="#cb212-2097" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-2098"><a href="#cb212-2098" aria-hidden="true" tabindex="-1"></a><span class="co">#Todo</span></span>
<span id="cb212-2099"><a href="#cb212-2099" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-2100"><a href="#cb212-2100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2101"><a href="#cb212-2101" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Plots - ÜBERARBEITEN</span></span>
<span id="cb212-2102"><a href="#cb212-2102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2105"><a href="#cb212-2105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-2106"><a href="#cb212-2106" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO</span></span>
<span id="cb212-2107"><a href="#cb212-2107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2108"><a href="#cb212-2108" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb212-2109"><a href="#cb212-2109" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb212-2110"><a href="#cb212-2110" aria-hidden="true" tabindex="-1"></a><span class="do">#### ANGENOMMEN</span></span>
<span id="cb212-2111"><a href="#cb212-2111" aria-hidden="true" tabindex="-1"></a><span class="co"># Daten filtern und Bedingung setzen</span></span>
<span id="cb212-2112"><a href="#cb212-2112" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb212-2113"><a href="#cb212-2113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">annahme =</span> <span class="fu">as.numeric</span>(annahme),</span>
<span id="cb212-2114"><a href="#cb212-2114" aria-hidden="true" tabindex="-1"></a>         <span class="at">state_parole_Ja =</span> <span class="fu">as.numeric</span>(state_parole_Ja),</span>
<span id="cb212-2115"><a href="#cb212-2115" aria-hidden="true" tabindex="-1"></a>         <span class="at">kt_parole_Ja =</span> <span class="fu">as.numeric</span>(kt_parole_Ja),</span>
<span id="cb212-2116"><a href="#cb212-2116" aria-hidden="true" tabindex="-1"></a>         <span class="at">gemeinde_parole_Ja =</span> <span class="fu">as.numeric</span>(gemeinde_parole_Ja)) <span class="sc">%&gt;%</span></span>
<span id="cb212-2117"><a href="#cb212-2117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(annahme <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-2118"><a href="#cb212-2118" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Nur angenommene Abstimmungen</span></span>
<span id="cb212-2119"><a href="#cb212-2119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">keine_ja_parole_50 =</span> (state_parole_Ja <span class="sc">&lt;=</span> <span class="dv">50</span>) <span class="sc">&amp;</span></span>
<span id="cb212-2120"><a href="#cb212-2120" aria-hidden="true" tabindex="-1"></a>                              (kt_parole_Ja <span class="sc">&lt;=</span> <span class="dv">50</span>) <span class="sc">&amp;</span></span>
<span id="cb212-2121"><a href="#cb212-2121" aria-hidden="true" tabindex="-1"></a>                              (gemeinde_parole_Ja <span class="sc">&lt;=</span> <span class="dv">50</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb212-2122"><a href="#cb212-2122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(anr,</span>
<span id="cb212-2123"><a href="#cb212-2123" aria-hidden="true" tabindex="-1"></a>         titel_kurz_d,</span>
<span id="cb212-2124"><a href="#cb212-2124" aria-hidden="true" tabindex="-1"></a>         state_parole_Ja,</span>
<span id="cb212-2125"><a href="#cb212-2125" aria-hidden="true" tabindex="-1"></a>         kt_parole_Ja,</span>
<span id="cb212-2126"><a href="#cb212-2126" aria-hidden="true" tabindex="-1"></a>         gemeinde_parole_Ja,</span>
<span id="cb212-2127"><a href="#cb212-2127" aria-hidden="true" tabindex="-1"></a>         keine_ja_parole_50)</span>
<span id="cb212-2128"><a href="#cb212-2128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2129"><a href="#cb212-2129" aria-hidden="true" tabindex="-1"></a><span class="co"># Daten ins long format</span></span>
<span id="cb212-2130"><a href="#cb212-2130" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb212-2131"><a href="#cb212-2131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(state_parole_Ja,</span>
<span id="cb212-2132"><a href="#cb212-2132" aria-hidden="true" tabindex="-1"></a>                        kt_parole_Ja,</span>
<span id="cb212-2133"><a href="#cb212-2133" aria-hidden="true" tabindex="-1"></a>                        gemeinde_parole_Ja),</span>
<span id="cb212-2134"><a href="#cb212-2134" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Ebene"</span>,</span>
<span id="cb212-2135"><a href="#cb212-2135" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Ja_Parole"</span>)</span>
<span id="cb212-2136"><a href="#cb212-2136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2137"><a href="#cb212-2137" aria-hidden="true" tabindex="-1"></a><span class="co"># Farbspalte für Hervorhebung</span></span>
<span id="cb212-2138"><a href="#cb212-2138" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> df_long <span class="sc">%&gt;%</span></span>
<span id="cb212-2139"><a href="#cb212-2139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">highlight =</span> <span class="fu">ifelse</span>(keine_ja_parole_50,</span>
<span id="cb212-2140"><a href="#cb212-2140" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"keine Mehrheit"</span>,</span>
<span id="cb212-2141"><a href="#cb212-2141" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"mind. 1 Mehrheit"</span>))</span>
<span id="cb212-2142"><a href="#cb212-2142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2143"><a href="#cb212-2143" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb212-2144"><a href="#cb212-2144" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_long,</span>
<span id="cb212-2145"><a href="#cb212-2145" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(titel_kurz_d,</span>
<span id="cb212-2146"><a href="#cb212-2146" aria-hidden="true" tabindex="-1"></a>                       anr),</span>
<span id="cb212-2147"><a href="#cb212-2147" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> Ja_Parole,</span>
<span id="cb212-2148"><a href="#cb212-2148" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> Ebene,</span>
<span id="cb212-2149"><a href="#cb212-2149" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> highlight)) <span class="sc">+</span></span>
<span id="cb212-2150"><a href="#cb212-2150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>,</span>
<span id="cb212-2151"><a href="#cb212-2151" aria-hidden="true" tabindex="-1"></a>           <span class="at">position =</span> <span class="st">"dodge"</span>,</span>
<span id="cb212-2152"><a href="#cb212-2152" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb212-2153"><a href="#cb212-2153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">50</span>,</span>
<span id="cb212-2154"><a href="#cb212-2154" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb212-2155"><a href="#cb212-2155" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb212-2156"><a href="#cb212-2156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"keine Mehrheit"</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb212-2157"><a href="#cb212-2157" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"mind. 1 Mehrheit"</span> <span class="ot">=</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb212-2158"><a href="#cb212-2158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Abstimmung"</span>,</span>
<span id="cb212-2159"><a href="#cb212-2159" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Ja-Parole (%)"</span>,</span>
<span id="cb212-2160"><a href="#cb212-2160" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Ebene"</span>,</span>
<span id="cb212-2161"><a href="#cb212-2161" aria-hidden="true" tabindex="-1"></a>       <span class="at">alpha =</span> <span class="st">"Hervorhebung"</span>,</span>
<span id="cb212-2162"><a href="#cb212-2162" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Ja-Parole-Anteile bei angenommenen Abstimmungen"</span>) <span class="sc">+</span></span>
<span id="cb212-2163"><a href="#cb212-2163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,</span>
<span id="cb212-2164"><a href="#cb212-2164" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb212-2165"><a href="#cb212-2165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2166"><a href="#cb212-2166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2167"><a href="#cb212-2167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2168"><a href="#cb212-2168" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb212-2169"><a href="#cb212-2169" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb212-2170"><a href="#cb212-2170" aria-hidden="true" tabindex="-1"></a><span class="do">#### ABGELEHNT</span></span>
<span id="cb212-2171"><a href="#cb212-2171" aria-hidden="true" tabindex="-1"></a><span class="co"># Daten filtern und Bedingung setzen</span></span>
<span id="cb212-2172"><a href="#cb212-2172" aria-hidden="true" tabindex="-1"></a>df_negativ <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb212-2173"><a href="#cb212-2173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">annahme =</span> <span class="fu">as.numeric</span>(annahme),</span>
<span id="cb212-2174"><a href="#cb212-2174" aria-hidden="true" tabindex="-1"></a>         <span class="at">state_parole_Ja =</span> <span class="fu">as.numeric</span>(state_parole_Ja),</span>
<span id="cb212-2175"><a href="#cb212-2175" aria-hidden="true" tabindex="-1"></a>         <span class="at">kt_parole_Ja =</span> <span class="fu">as.numeric</span>(kt_parole_Ja),</span>
<span id="cb212-2176"><a href="#cb212-2176" aria-hidden="true" tabindex="-1"></a>         <span class="at">gemeinde_parole_Ja =</span> <span class="fu">as.numeric</span>(gemeinde_parole_Ja)) <span class="sc">%&gt;%</span></span>
<span id="cb212-2177"><a href="#cb212-2177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(annahme <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb212-2178"><a href="#cb212-2178" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Nur abgelehnte Abstimmungen</span></span>
<span id="cb212-2179"><a href="#cb212-2179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ja_parole_mehrheit =</span> (state_parole_Ja <span class="sc">&gt;</span> <span class="dv">50</span>) <span class="sc">|</span></span>
<span id="cb212-2180"><a href="#cb212-2180" aria-hidden="true" tabindex="-1"></a>                              (kt_parole_Ja <span class="sc">&gt;</span> <span class="dv">50</span>) <span class="sc">|</span></span>
<span id="cb212-2181"><a href="#cb212-2181" aria-hidden="true" tabindex="-1"></a>                              (gemeinde_parole_Ja <span class="sc">&gt;</span> <span class="dv">50</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb212-2182"><a href="#cb212-2182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(anr,</span>
<span id="cb212-2183"><a href="#cb212-2183" aria-hidden="true" tabindex="-1"></a>         titel_kurz_d,</span>
<span id="cb212-2184"><a href="#cb212-2184" aria-hidden="true" tabindex="-1"></a>         state_parole_Ja,</span>
<span id="cb212-2185"><a href="#cb212-2185" aria-hidden="true" tabindex="-1"></a>         kt_parole_Ja,</span>
<span id="cb212-2186"><a href="#cb212-2186" aria-hidden="true" tabindex="-1"></a>         gemeinde_parole_Ja,</span>
<span id="cb212-2187"><a href="#cb212-2187" aria-hidden="true" tabindex="-1"></a>         ja_parole_mehrheit)</span>
<span id="cb212-2188"><a href="#cb212-2188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2189"><a href="#cb212-2189" aria-hidden="true" tabindex="-1"></a><span class="co"># Daten ins long format</span></span>
<span id="cb212-2190"><a href="#cb212-2190" aria-hidden="true" tabindex="-1"></a>df_negativ_long <span class="ot">&lt;-</span> df_negativ <span class="sc">%&gt;%</span></span>
<span id="cb212-2191"><a href="#cb212-2191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(state_parole_Ja,</span>
<span id="cb212-2192"><a href="#cb212-2192" aria-hidden="true" tabindex="-1"></a>                        kt_parole_Ja,</span>
<span id="cb212-2193"><a href="#cb212-2193" aria-hidden="true" tabindex="-1"></a>                        gemeinde_parole_Ja),</span>
<span id="cb212-2194"><a href="#cb212-2194" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Ebene"</span>,</span>
<span id="cb212-2195"><a href="#cb212-2195" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Ja_Parole"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-2196"><a href="#cb212-2196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">highlight =</span> <span class="fu">ifelse</span>(ja_parole_mehrheit,</span>
<span id="cb212-2197"><a href="#cb212-2197" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Mehrheit Ja-Parole"</span>,</span>
<span id="cb212-2198"><a href="#cb212-2198" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Keine Mehrheit"</span>))</span>
<span id="cb212-2199"><a href="#cb212-2199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2200"><a href="#cb212-2200" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb212-2201"><a href="#cb212-2201" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_negativ_long,</span>
<span id="cb212-2202"><a href="#cb212-2202" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(titel_kurz_d,</span>
<span id="cb212-2203"><a href="#cb212-2203" aria-hidden="true" tabindex="-1"></a>                       anr),</span>
<span id="cb212-2204"><a href="#cb212-2204" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> Ja_Parole,</span>
<span id="cb212-2205"><a href="#cb212-2205" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> Ebene,</span>
<span id="cb212-2206"><a href="#cb212-2206" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> highlight)) <span class="sc">+</span></span>
<span id="cb212-2207"><a href="#cb212-2207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>,</span>
<span id="cb212-2208"><a href="#cb212-2208" aria-hidden="true" tabindex="-1"></a>           <span class="at">position =</span> <span class="st">"dodge"</span>,</span>
<span id="cb212-2209"><a href="#cb212-2209" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb212-2210"><a href="#cb212-2210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">50</span>,</span>
<span id="cb212-2211"><a href="#cb212-2211" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb212-2212"><a href="#cb212-2212" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb212-2213"><a href="#cb212-2213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Mehrheit Ja-Parole"</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb212-2214"><a href="#cb212-2214" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Keine Mehrheit"</span> <span class="ot">=</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb212-2215"><a href="#cb212-2215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Abstimmung"</span>,</span>
<span id="cb212-2216"><a href="#cb212-2216" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Ja-Parole (%)"</span>,</span>
<span id="cb212-2217"><a href="#cb212-2217" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Ebene"</span>,</span>
<span id="cb212-2218"><a href="#cb212-2218" aria-hidden="true" tabindex="-1"></a>       <span class="at">alpha =</span> <span class="st">"Hervorhebung"</span>,</span>
<span id="cb212-2219"><a href="#cb212-2219" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Abgelehnte Abstimmungen mit Ja-Parolen-Mehrheit"</span>) <span class="sc">+</span></span>
<span id="cb212-2220"><a href="#cb212-2220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,</span>
<span id="cb212-2221"><a href="#cb212-2221" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb212-2222"><a href="#cb212-2222" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-2223"><a href="#cb212-2223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2224"><a href="#cb212-2224" aria-hidden="true" tabindex="-1"></a><span class="fu">### Korrelation</span></span>
<span id="cb212-2225"><a href="#cb212-2225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2228"><a href="#cb212-2228" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-2229"><a href="#cb212-2229" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(voting_5y_final)</span>
<span id="cb212-2230"><a href="#cb212-2230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2231"><a href="#cb212-2231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2232"><a href="#cb212-2232" aria-hidden="true" tabindex="-1"></a><span class="co"># Auswahl relevanter numerischer Variablen</span></span>
<span id="cb212-2233"><a href="#cb212-2233" aria-hidden="true" tabindex="-1"></a>subset_corr <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb212-2234"><a href="#cb212-2234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(annahme,</span>
<span id="cb212-2235"><a href="#cb212-2235" aria-hidden="true" tabindex="-1"></a>         volkja_proz,</span>
<span id="cb212-2236"><a href="#cb212-2236" aria-hidden="true" tabindex="-1"></a>         diff_state,</span>
<span id="cb212-2237"><a href="#cb212-2237" aria-hidden="true" tabindex="-1"></a>         diff_kanton,</span>
<span id="cb212-2238"><a href="#cb212-2238" aria-hidden="true" tabindex="-1"></a>         diff_gemeinde,</span>
<span id="cb212-2239"><a href="#cb212-2239" aria-hidden="true" tabindex="-1"></a>         state_parole_Ja,</span>
<span id="cb212-2240"><a href="#cb212-2240" aria-hidden="true" tabindex="-1"></a>         kt_parole_Ja,</span>
<span id="cb212-2241"><a href="#cb212-2241" aria-hidden="true" tabindex="-1"></a>         gemeinde_parole_Ja,</span>
<span id="cb212-2242"><a href="#cb212-2242" aria-hidden="true" tabindex="-1"></a>         inserate_total,</span>
<span id="cb212-2243"><a href="#cb212-2243" aria-hidden="true" tabindex="-1"></a>         inserate_ja_pct,</span>
<span id="cb212-2244"><a href="#cb212-2244" aria-hidden="true" tabindex="-1"></a>         mediares_tot,</span>
<span id="cb212-2245"><a href="#cb212-2245" aria-hidden="true" tabindex="-1"></a>         mediaton_tot,</span>
<span id="cb212-2246"><a href="#cb212-2246" aria-hidden="true" tabindex="-1"></a>         bet,</span>
<span id="cb212-2247"><a href="#cb212-2247" aria-hidden="true" tabindex="-1"></a>         nrja_pct,</span>
<span id="cb212-2248"><a href="#cb212-2248" aria-hidden="true" tabindex="-1"></a>         srja_pct)</span>
<span id="cb212-2249"><a href="#cb212-2249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2250"><a href="#cb212-2250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2251"><a href="#cb212-2251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2252"><a href="#cb212-2252" aria-hidden="true" tabindex="-1"></a><span class="co"># Erste Visualisierung: Streudiagrammmatrix</span></span>
<span id="cb212-2253"><a href="#cb212-2253" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(subset_corr, <span class="at">main =</span> <span class="st">"Streudiagrammmatrix der ausgewählten Variablen"</span>)</span>
<span id="cb212-2254"><a href="#cb212-2254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2255"><a href="#cb212-2255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2256"><a href="#cb212-2256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2257"><a href="#cb212-2257" aria-hidden="true" tabindex="-1"></a><span class="co"># Prüfung auf Normalverteilung</span></span>
<span id="cb212-2258"><a href="#cb212-2258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2259"><a href="#cb212-2259" aria-hidden="true" tabindex="-1"></a>subset_corr_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(subset_corr, <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"Variable"</span>, <span class="at">values_to =</span> <span class="st">"Wert"</span>)</span>
<span id="cb212-2260"><a href="#cb212-2260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2261"><a href="#cb212-2261" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogramme</span></span>
<span id="cb212-2262"><a href="#cb212-2262" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(subset_corr_long, <span class="fu">aes</span>(<span class="at">x =</span> Wert)) <span class="sc">+</span></span>
<span id="cb212-2263"><a href="#cb212-2263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">10</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb212-2264"><a href="#cb212-2264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Variable, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb212-2265"><a href="#cb212-2265" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb212-2266"><a href="#cb212-2266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogramme der ausgewählten Variablen"</span>)</span>
<span id="cb212-2267"><a href="#cb212-2267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2268"><a href="#cb212-2268" aria-hidden="true" tabindex="-1"></a><span class="co"># QQ-Plots</span></span>
<span id="cb212-2269"><a href="#cb212-2269" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(subset_corr_long, <span class="fu">aes</span>(<span class="at">sample =</span> Wert)) <span class="sc">+</span></span>
<span id="cb212-2270"><a href="#cb212-2270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq</span>() <span class="sc">+</span></span>
<span id="cb212-2271"><a href="#cb212-2271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq_line</span>() <span class="sc">+</span></span>
<span id="cb212-2272"><a href="#cb212-2272" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Variable, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb212-2273"><a href="#cb212-2273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb212-2274"><a href="#cb212-2274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"QQ-Plots der ausgewählten Variablen"</span>)</span>
<span id="cb212-2275"><a href="#cb212-2275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2276"><a href="#cb212-2276" aria-hidden="true" tabindex="-1"></a><span class="co"># Shapiro-Wilk-Test für alle Variablen</span></span>
<span id="cb212-2277"><a href="#cb212-2277" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(subset_corr, <span class="dv">2</span>, shapiro.test)</span>
<span id="cb212-2278"><a href="#cb212-2278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2279"><a href="#cb212-2279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2280"><a href="#cb212-2280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2281"><a href="#cb212-2281" aria-hidden="true" tabindex="-1"></a><span class="co"># # Korrelationsmatrix berechnen</span></span>
<span id="cb212-2282"><a href="#cb212-2282" aria-hidden="true" tabindex="-1"></a><span class="co"># # Pearson-Korrelation (für normalverteilte Variablen)</span></span>
<span id="cb212-2283"><a href="#cb212-2283" aria-hidden="true" tabindex="-1"></a><span class="co"># cor_matrix_pearson &lt;- cor(subset_corr, use = "complete.obs", method = "pearson")</span></span>
<span id="cb212-2284"><a href="#cb212-2284" aria-hidden="true" tabindex="-1"></a><span class="co"># print(round(cor_matrix_pearson, 2))</span></span>
<span id="cb212-2285"><a href="#cb212-2285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2286"><a href="#cb212-2286" aria-hidden="true" tabindex="-1"></a><span class="co"># Spearman-Korrelation (robuster bei Nicht-Normalverteilung)</span></span>
<span id="cb212-2287"><a href="#cb212-2287" aria-hidden="true" tabindex="-1"></a>cor_matrix_spearman <span class="ot">&lt;-</span> <span class="fu">cor</span>(subset_corr, <span class="at">use =</span> <span class="st">"complete.obs"</span>, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb212-2288"><a href="#cb212-2288" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(cor_matrix_spearman, <span class="dv">2</span>))</span>
<span id="cb212-2289"><a href="#cb212-2289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2290"><a href="#cb212-2290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2291"><a href="#cb212-2291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2292"><a href="#cb212-2292" aria-hidden="true" tabindex="-1"></a><span class="co">#Visualisierung der Korrelationsmatrix</span></span>
<span id="cb212-2293"><a href="#cb212-2293" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor_matrix_spearman, <span class="at">method =</span> <span class="st">"color"</span>, <span class="at">addCoef.col =</span> <span class="st">"black"</span>, <span class="at">tl.col =</span> <span class="st">"black"</span>)</span>
<span id="cb212-2294"><a href="#cb212-2294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2295"><a href="#cb212-2295" aria-hidden="true" tabindex="-1"></a><span class="co"># #Visualisierung der Korrelationsmatrix als Heatmap</span></span>
<span id="cb212-2296"><a href="#cb212-2296" aria-hidden="true" tabindex="-1"></a><span class="co"># melted_cor &lt;- melt(round(cor_matrix_spearman, 2))</span></span>
<span id="cb212-2297"><a href="#cb212-2297" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(data = melted_cor,</span></span>
<span id="cb212-2298"><a href="#cb212-2298" aria-hidden="true" tabindex="-1"></a><span class="co">#        aes(x=Var1,</span></span>
<span id="cb212-2299"><a href="#cb212-2299" aria-hidden="true" tabindex="-1"></a><span class="co">#            y=Var2,</span></span>
<span id="cb212-2300"><a href="#cb212-2300" aria-hidden="true" tabindex="-1"></a><span class="co">#            fill=value)) +</span></span>
<span id="cb212-2301"><a href="#cb212-2301" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_tile() +</span></span>
<span id="cb212-2302"><a href="#cb212-2302" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_text(aes(label = value),</span></span>
<span id="cb212-2303"><a href="#cb212-2303" aria-hidden="true" tabindex="-1"></a><span class="co">#             size = 4) +</span></span>
<span id="cb212-2304"><a href="#cb212-2304" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_gradient2(low = "blue",</span></span>
<span id="cb212-2305"><a href="#cb212-2305" aria-hidden="true" tabindex="-1"></a><span class="co">#                        high = "red", </span></span>
<span id="cb212-2306"><a href="#cb212-2306" aria-hidden="true" tabindex="-1"></a><span class="co">#                        limit = c(-1,1),</span></span>
<span id="cb212-2307"><a href="#cb212-2307" aria-hidden="true" tabindex="-1"></a><span class="co">#                        name="Correlation") +</span></span>
<span id="cb212-2308"><a href="#cb212-2308" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.title.x = element_blank(),</span></span>
<span id="cb212-2309"><a href="#cb212-2309" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.title.y = element_blank(),</span></span>
<span id="cb212-2310"><a href="#cb212-2310" aria-hidden="true" tabindex="-1"></a><span class="co">#         panel.background = element_blank())</span></span>
<span id="cb212-2311"><a href="#cb212-2311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2312"><a href="#cb212-2312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2313"><a href="#cb212-2313" aria-hidden="true" tabindex="-1"></a><span class="co"># #Visualisierung der Korrelationsmatrix mit ggcorrplot</span></span>
<span id="cb212-2314"><a href="#cb212-2314" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(cor_matrix_spearman, lab = TRUE)</span></span>
<span id="cb212-2315"><a href="#cb212-2315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2316"><a href="#cb212-2316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2317"><a href="#cb212-2317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2318"><a href="#cb212-2318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2319"><a href="#cb212-2319" aria-hidden="true" tabindex="-1"></a><span class="co">#Hier WEITERARBEITEN </span></span>
<span id="cb212-2320"><a href="#cb212-2320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2321"><a href="#cb212-2321" aria-hidden="true" tabindex="-1"></a><span class="co"># Signifikanz einzelner Korrelationen prüfen</span></span>
<span id="cb212-2322"><a href="#cb212-2322" aria-hidden="true" tabindex="-1"></a><span class="co"># cor.test(voting_5y_final$diff_state, voting_5y_final$volkja_proz, method = "pearson")</span></span>
<span id="cb212-2323"><a href="#cb212-2323" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(voting_5y_final<span class="sc">$</span>diff_kanton, voting_5y_final<span class="sc">$</span>inserate_ja_pct, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb212-2324"><a href="#cb212-2324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2325"><a href="#cb212-2325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2326"><a href="#cb212-2326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2327"><a href="#cb212-2327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2328"><a href="#cb212-2328" aria-hidden="true" tabindex="-1"></a><span class="co"># Zielvariablen</span></span>
<span id="cb212-2329"><a href="#cb212-2329" aria-hidden="true" tabindex="-1"></a>target_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"annahme"</span>,</span>
<span id="cb212-2330"><a href="#cb212-2330" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"volkja_proz"</span>)</span>
<span id="cb212-2331"><a href="#cb212-2331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2332"><a href="#cb212-2332" aria-hidden="true" tabindex="-1"></a><span class="co"># Numerische Variablen im df ohne Zielvariablen</span></span>
<span id="cb212-2333"><a href="#cb212-2333" aria-hidden="true" tabindex="-1"></a>compare_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(subset_corr),</span>
<span id="cb212-2334"><a href="#cb212-2334" aria-hidden="true" tabindex="-1"></a>                        target_vars)</span>
<span id="cb212-2335"><a href="#cb212-2335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2336"><a href="#cb212-2336" aria-hidden="true" tabindex="-1"></a><span class="co"># Kombis von Zielvariable und Vergleichsvariablen testen</span></span>
<span id="cb212-2337"><a href="#cb212-2337" aria-hidden="true" tabindex="-1"></a>cor_test_result <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">target =</span> target_vars,</span>
<span id="cb212-2338"><a href="#cb212-2338" aria-hidden="true" tabindex="-1"></a>                               <span class="at">compare_to =</span> compare_vars) <span class="sc">%&gt;%</span></span>
<span id="cb212-2339"><a href="#cb212-2339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">test =</span> <span class="fu">map2</span>(target,</span>
<span id="cb212-2340"><a href="#cb212-2340" aria-hidden="true" tabindex="-1"></a>                     compare_to,</span>
<span id="cb212-2341"><a href="#cb212-2341" aria-hidden="true" tabindex="-1"></a>                     <span class="sc">~</span> <span class="fu">cor.test</span>(subset_corr[[.x]],</span>
<span id="cb212-2342"><a href="#cb212-2342" aria-hidden="true" tabindex="-1"></a>                                subset_corr[[.y]],</span>
<span id="cb212-2343"><a href="#cb212-2343" aria-hidden="true" tabindex="-1"></a>                                <span class="at">method =</span> <span class="st">"spearman"</span>)),</span>
<span id="cb212-2344"><a href="#cb212-2344" aria-hidden="true" tabindex="-1"></a>         <span class="at">rho =</span> <span class="fu">map_dbl</span>(test, <span class="sc">~</span> .x<span class="sc">$</span>estimate),</span>
<span id="cb212-2345"><a href="#cb212-2345" aria-hidden="true" tabindex="-1"></a>         <span class="at">p_value =</span> <span class="fu">map_dbl</span>(test, <span class="sc">~</span> .x<span class="sc">$</span>p.value)) <span class="sc">%&gt;%</span></span>
<span id="cb212-2346"><a href="#cb212-2346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(target,</span>
<span id="cb212-2347"><a href="#cb212-2347" aria-hidden="true" tabindex="-1"></a>         compare_to,</span>
<span id="cb212-2348"><a href="#cb212-2348" aria-hidden="true" tabindex="-1"></a>         rho,</span>
<span id="cb212-2349"><a href="#cb212-2349" aria-hidden="true" tabindex="-1"></a>         p_value)</span>
<span id="cb212-2350"><a href="#cb212-2350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2351"><a href="#cb212-2351" aria-hidden="true" tabindex="-1"></a><span class="co"># Ergebnis anzeigen</span></span>
<span id="cb212-2352"><a href="#cb212-2352" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cor_test_result) <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n=</span><span class="cn">Inf</span>)</span>
<span id="cb212-2353"><a href="#cb212-2353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2354"><a href="#cb212-2354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2355"><a href="#cb212-2355" aria-hidden="true" tabindex="-1"></a>cor_test_result_filtered <span class="ot">&lt;-</span> cor_test_result <span class="sc">%&gt;%</span> </span>
<span id="cb212-2356"><a href="#cb212-2356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(rho) <span class="sc">&gt;</span> <span class="fl">0.5</span>,</span>
<span id="cb212-2357"><a href="#cb212-2357" aria-hidden="true" tabindex="-1"></a>         p_value <span class="sc">&lt;</span> <span class="fl">0.05</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-2358"><a href="#cb212-2358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(target,</span>
<span id="cb212-2359"><a href="#cb212-2359" aria-hidden="true" tabindex="-1"></a>          <span class="fu">desc</span>(<span class="fu">abs</span>(rho)))</span>
<span id="cb212-2360"><a href="#cb212-2360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2361"><a href="#cb212-2361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2362"><a href="#cb212-2362" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO word print..</span></span>
<span id="cb212-2363"><a href="#cb212-2363" aria-hidden="true" tabindex="-1"></a><span class="co"># Ergebnis anzeigen</span></span>
<span id="cb212-2364"><a href="#cb212-2364" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cor_test_result_filtered)</span>
<span id="cb212-2365"><a href="#cb212-2365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2366"><a href="#cb212-2366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2367"><a href="#cb212-2367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2368"><a href="#cb212-2368" aria-hidden="true" tabindex="-1"></a><span class="co"># VIF mit allen Variablen</span></span>
<span id="cb212-2369"><a href="#cb212-2369" aria-hidden="true" tabindex="-1"></a><span class="co"># mod_vif &lt;- lm(volkja_proz ~ </span></span>
<span id="cb212-2370"><a href="#cb212-2370" aria-hidden="true" tabindex="-1"></a><span class="co">#                 diff_state + diff_kanton + diff_gemeinde +</span></span>
<span id="cb212-2371"><a href="#cb212-2371" aria-hidden="true" tabindex="-1"></a><span class="co">#                 state_parole_Ja + kt_parole_Ja + gemeinde_parole_Ja +</span></span>
<span id="cb212-2372"><a href="#cb212-2372" aria-hidden="true" tabindex="-1"></a><span class="co">#                 inserate_total + inserate_ja_pct + mediares_tot + mediaton_tot +</span></span>
<span id="cb212-2373"><a href="#cb212-2373" aria-hidden="true" tabindex="-1"></a><span class="co">#                 bet + nrja_pct + srja_pct,</span></span>
<span id="cb212-2374"><a href="#cb212-2374" aria-hidden="true" tabindex="-1"></a><span class="co">#               data = voting_5y_final)</span></span>
<span id="cb212-2375"><a href="#cb212-2375" aria-hidden="true" tabindex="-1"></a><span class="co"># vif(mod_vif)</span></span>
<span id="cb212-2376"><a href="#cb212-2376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2377"><a href="#cb212-2377" aria-hidden="true" tabindex="-1"></a><span class="co">#alias(mod_vif)</span></span>
<span id="cb212-2378"><a href="#cb212-2378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2379"><a href="#cb212-2379" aria-hidden="true" tabindex="-1"></a>mod_vif_fixed <span class="ot">&lt;-</span> <span class="fu">lm</span>(volkja_proz <span class="sc">~</span></span>
<span id="cb212-2380"><a href="#cb212-2380" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># diff_state + diff_kanton + diff_gemeinde +</span></span>
<span id="cb212-2381"><a href="#cb212-2381" aria-hidden="true" tabindex="-1"></a>                      state_parole_Ja <span class="sc">+</span> kt_parole_Ja <span class="sc">+</span> gemeinde_parole_Ja <span class="sc">+</span></span>
<span id="cb212-2382"><a href="#cb212-2382" aria-hidden="true" tabindex="-1"></a>                      inserate_total <span class="sc">+</span> inserate_ja_pct <span class="sc">+</span> mediares_tot <span class="sc">+</span></span>
<span id="cb212-2383"><a href="#cb212-2383" aria-hidden="true" tabindex="-1"></a>                      mediaton_tot <span class="sc">+</span> bet <span class="sc">+</span> nrja_pct <span class="sc">+</span> srja_pct,</span>
<span id="cb212-2384"><a href="#cb212-2384" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> voting_5y_final)</span>
<span id="cb212-2385"><a href="#cb212-2385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2386"><a href="#cb212-2386" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(mod_vif_fixed)</span>
<span id="cb212-2387"><a href="#cb212-2387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2388"><a href="#cb212-2388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-2389"><a href="#cb212-2389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2390"><a href="#cb212-2390" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modelllierung</span></span>
<span id="cb212-2391"><a href="#cb212-2391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2392"><a href="#cb212-2392" aria-hidden="true" tabindex="-1"></a><span class="fu">### Lineare Regression</span></span>
<span id="cb212-2393"><a href="#cb212-2393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2394"><a href="#cb212-2394" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Modelle erstellen</span></span>
<span id="cb212-2395"><a href="#cb212-2395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2398"><a href="#cb212-2398" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-2399"><a href="#cb212-2399" aria-hidden="true" tabindex="-1"></a><span class="co">#SR und NR als Parlament zusammenfassen</span></span>
<span id="cb212-2400"><a href="#cb212-2400" aria-hidden="true" tabindex="-1"></a>voting_5y_final <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb212-2401"><a href="#cb212-2401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parliament_ja_avg =</span> (nrja_pct <span class="sc">+</span> srja_pct) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb212-2402"><a href="#cb212-2402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2403"><a href="#cb212-2403" aria-hidden="true" tabindex="-1"></a><span class="co"># Modell state</span></span>
<span id="cb212-2404"><a href="#cb212-2404" aria-hidden="true" tabindex="-1"></a>lm_state <span class="ot">&lt;-</span> <span class="fu">lm</span>(volkja_proz <span class="sc">~</span> state_parole_Ja <span class="sc">+</span></span>
<span id="cb212-2405"><a href="#cb212-2405" aria-hidden="true" tabindex="-1"></a>                 inserate_total <span class="sc">+</span> inserate_ja_pct <span class="sc">+</span></span>
<span id="cb212-2406"><a href="#cb212-2406" aria-hidden="true" tabindex="-1"></a>                 mediares_tot <span class="sc">+</span> mediaton_tot <span class="sc">+</span></span>
<span id="cb212-2407"><a href="#cb212-2407" aria-hidden="true" tabindex="-1"></a>                 bet,</span>
<span id="cb212-2408"><a href="#cb212-2408" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> voting_5y_final)</span>
<span id="cb212-2409"><a href="#cb212-2409" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_state)</span>
<span id="cb212-2410"><a href="#cb212-2410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2411"><a href="#cb212-2411" aria-hidden="true" tabindex="-1"></a><span class="co"># Modell kanton</span></span>
<span id="cb212-2412"><a href="#cb212-2412" aria-hidden="true" tabindex="-1"></a>lm_kanton<span class="ot">&lt;-</span> <span class="fu">lm</span>(volkja_proz <span class="sc">~</span> kt_parole_Ja <span class="sc">+</span></span>
<span id="cb212-2413"><a href="#cb212-2413" aria-hidden="true" tabindex="-1"></a>                 inserate_total <span class="sc">+</span> inserate_ja_pct <span class="sc">+</span></span>
<span id="cb212-2414"><a href="#cb212-2414" aria-hidden="true" tabindex="-1"></a>                 mediares_tot <span class="sc">+</span> mediaton_tot <span class="sc">+</span></span>
<span id="cb212-2415"><a href="#cb212-2415" aria-hidden="true" tabindex="-1"></a>                 bet,</span>
<span id="cb212-2416"><a href="#cb212-2416" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> voting_5y_final)</span>
<span id="cb212-2417"><a href="#cb212-2417" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_kanton)</span>
<span id="cb212-2418"><a href="#cb212-2418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2419"><a href="#cb212-2419" aria-hidden="true" tabindex="-1"></a><span class="co"># Modell gemeinde</span></span>
<span id="cb212-2420"><a href="#cb212-2420" aria-hidden="true" tabindex="-1"></a>lm_gemeinde<span class="ot">&lt;-</span> <span class="fu">lm</span>(volkja_proz <span class="sc">~</span> gemeinde_parole_Ja <span class="sc">+</span></span>
<span id="cb212-2421"><a href="#cb212-2421" aria-hidden="true" tabindex="-1"></a>                   inserate_total <span class="sc">+</span> inserate_ja_pct <span class="sc">+</span></span>
<span id="cb212-2422"><a href="#cb212-2422" aria-hidden="true" tabindex="-1"></a>                   mediares_tot <span class="sc">+</span> mediaton_tot <span class="sc">+</span></span>
<span id="cb212-2423"><a href="#cb212-2423" aria-hidden="true" tabindex="-1"></a>                   bet,</span>
<span id="cb212-2424"><a href="#cb212-2424" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> voting_5y_final)</span>
<span id="cb212-2425"><a href="#cb212-2425" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_gemeinde)</span>
<span id="cb212-2426"><a href="#cb212-2426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2427"><a href="#cb212-2427" aria-hidden="true" tabindex="-1"></a><span class="co"># Modell parliament</span></span>
<span id="cb212-2428"><a href="#cb212-2428" aria-hidden="true" tabindex="-1"></a>lm_parliament<span class="ot">&lt;-</span> <span class="fu">lm</span>(volkja_proz <span class="sc">~</span> parliament_ja_avg <span class="sc">+</span></span>
<span id="cb212-2429"><a href="#cb212-2429" aria-hidden="true" tabindex="-1"></a>                     inserate_total <span class="sc">+</span> inserate_ja_pct <span class="sc">+</span></span>
<span id="cb212-2430"><a href="#cb212-2430" aria-hidden="true" tabindex="-1"></a>                     mediares_tot <span class="sc">+</span> mediaton_tot <span class="sc">+</span></span>
<span id="cb212-2431"><a href="#cb212-2431" aria-hidden="true" tabindex="-1"></a>                     bet,</span>
<span id="cb212-2432"><a href="#cb212-2432" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> voting_5y_final)</span>
<span id="cb212-2433"><a href="#cb212-2433" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_parliament)</span>
<span id="cb212-2434"><a href="#cb212-2434" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-2435"><a href="#cb212-2435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2436"><a href="#cb212-2436" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Kennzahlen extrahieren</span></span>
<span id="cb212-2437"><a href="#cb212-2437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2440"><a href="#cb212-2440" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-2441"><a href="#cb212-2441" aria-hidden="true" tabindex="-1"></a>model_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">State =</span> lm_state,</span>
<span id="cb212-2442"><a href="#cb212-2442" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Kanton =</span> lm_kanton,</span>
<span id="cb212-2443"><a href="#cb212-2443" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Gemeinde =</span> lm_gemeinde,</span>
<span id="cb212-2444"><a href="#cb212-2444" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Parliament =</span> lm_parliament)</span>
<span id="cb212-2445"><a href="#cb212-2445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2446"><a href="#cb212-2446" aria-hidden="true" tabindex="-1"></a><span class="co"># Funktion zum Extrahieren der Werte</span></span>
<span id="cb212-2447"><a href="#cb212-2447" aria-hidden="true" tabindex="-1"></a>model_stats <span class="ot">&lt;-</span> <span class="fu">lapply</span>(model_list, <span class="cf">function</span>(mod) {</span>
<span id="cb212-2448"><a href="#cb212-2448" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">R2 =</span> <span class="fu">summary</span>(mod)<span class="sc">$</span>r.squared,</span>
<span id="cb212-2449"><a href="#cb212-2449" aria-hidden="true" tabindex="-1"></a>    <span class="at">AdjR2 =</span> <span class="fu">summary</span>(mod)<span class="sc">$</span>adj.r.squared,</span>
<span id="cb212-2450"><a href="#cb212-2450" aria-hidden="true" tabindex="-1"></a>    <span class="at">AIC =</span> <span class="fu">AIC</span>(mod),</span>
<span id="cb212-2451"><a href="#cb212-2451" aria-hidden="true" tabindex="-1"></a>    <span class="at">BIC =</span> <span class="fu">BIC</span>(mod))</span>
<span id="cb212-2452"><a href="#cb212-2452" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb212-2453"><a href="#cb212-2453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2454"><a href="#cb212-2454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2455"><a href="#cb212-2455" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO Table Word</span></span>
<span id="cb212-2456"><a href="#cb212-2456" aria-hidden="true" tabindex="-1"></a><span class="co"># In Dataframe umwandeln</span></span>
<span id="cb212-2457"><a href="#cb212-2457" aria-hidden="true" tabindex="-1"></a>model_stats_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, model_stats)</span>
<span id="cb212-2458"><a href="#cb212-2458" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(model_stats_df, <span class="dv">3</span>))</span>
<span id="cb212-2459"><a href="#cb212-2459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2460"><a href="#cb212-2460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-2461"><a href="#cb212-2461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2462"><a href="#cb212-2462" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Visualisierung der Modellgüte</span></span>
<span id="cb212-2463"><a href="#cb212-2463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2466"><a href="#cb212-2466" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-2467"><a href="#cb212-2467" aria-hidden="true" tabindex="-1"></a><span class="co"># Balkendiagramm für R² und Adjusted R²</span></span>
<span id="cb212-2468"><a href="#cb212-2468" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(model_stats_df)</span>
<span id="cb212-2469"><a href="#cb212-2469" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Model <span class="ot">&lt;-</span> <span class="fu">rownames</span>(df)</span>
<span id="cb212-2470"><a href="#cb212-2470" aria-hidden="true" tabindex="-1"></a>df_melt <span class="ot">&lt;-</span> <span class="fu">melt</span>(df, <span class="at">id.vars =</span> <span class="st">"Model"</span>)</span>
<span id="cb212-2471"><a href="#cb212-2471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2472"><a href="#cb212-2472" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_melt[df_melt<span class="sc">$</span>variable <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"R2"</span>,</span>
<span id="cb212-2473"><a href="#cb212-2473" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"AdjR2"</span>), ],</span>
<span id="cb212-2474"><a href="#cb212-2474" aria-hidden="true" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">x =</span> Model,</span>
<span id="cb212-2475"><a href="#cb212-2475" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> value,</span>
<span id="cb212-2476"><a href="#cb212-2476" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> variable)) <span class="sc">+</span></span>
<span id="cb212-2477"><a href="#cb212-2477" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>,</span>
<span id="cb212-2478"><a href="#cb212-2478" aria-hidden="true" tabindex="-1"></a>           <span class="at">position =</span> <span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb212-2479"><a href="#cb212-2479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb212-2480"><a href="#cb212-2480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Vergleich der Modellgüte (R² und Adjusted R²)"</span>,</span>
<span id="cb212-2481"><a href="#cb212-2481" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Wert"</span>,</span>
<span id="cb212-2482"><a href="#cb212-2482" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Modell"</span>) <span class="sc">+</span></span>
<span id="cb212-2483"><a href="#cb212-2483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb212-2484"><a href="#cb212-2484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2485"><a href="#cb212-2485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2486"><a href="#cb212-2486" aria-hidden="true" tabindex="-1"></a><span class="co"># AIC/BIC Vergleich (niedriger = besser)</span></span>
<span id="cb212-2487"><a href="#cb212-2487" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_melt[df_melt<span class="sc">$</span>variable <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"AIC"</span>, <span class="st">"BIC"</span>), ],</span>
<span id="cb212-2488"><a href="#cb212-2488" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Model,</span>
<span id="cb212-2489"><a href="#cb212-2489" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> value,</span>
<span id="cb212-2490"><a href="#cb212-2490" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> variable)) <span class="sc">+</span></span>
<span id="cb212-2491"><a href="#cb212-2491" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>,</span>
<span id="cb212-2492"><a href="#cb212-2492" aria-hidden="true" tabindex="-1"></a>           <span class="at">position =</span> <span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb212-2493"><a href="#cb212-2493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Vergleich von AIC und BIC der Modelle"</span>,</span>
<span id="cb212-2494"><a href="#cb212-2494" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Wert"</span>,</span>
<span id="cb212-2495"><a href="#cb212-2495" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Modell"</span>) <span class="sc">+</span></span>
<span id="cb212-2496"><a href="#cb212-2496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb212-2497"><a href="#cb212-2497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2498"><a href="#cb212-2498" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-2499"><a href="#cb212-2499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2500"><a href="#cb212-2500" aria-hidden="true" tabindex="-1"></a><span class="fu">### Logarithmische Regression</span></span>
<span id="cb212-2501"><a href="#cb212-2501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2502"><a href="#cb212-2502" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Daten log-transformieren und bereinigen</span></span>
<span id="cb212-2503"><a href="#cb212-2503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2506"><a href="#cb212-2506" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-2507"><a href="#cb212-2507" aria-hidden="true" tabindex="-1"></a>voting_5y_final_log <span class="ot">&lt;-</span> voting_5y_final <span class="sc">%&gt;%</span></span>
<span id="cb212-2508"><a href="#cb212-2508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_mediares =</span> <span class="fu">log</span>(mediares_tot <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb212-2509"><a href="#cb212-2509" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_inserate_total =</span> <span class="fu">log</span>(inserate_total <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb212-2510"><a href="#cb212-2510" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_inserate_ja_pct =</span> <span class="fu">log</span>(inserate_ja_pct <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb212-2511"><a href="#cb212-2511" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_inserate_neutral_pct =</span> <span class="fu">log</span>(inserate_neutral_pct <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb212-2512"><a href="#cb212-2512" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_bet =</span> <span class="fu">log</span>(bet <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb212-2513"><a href="#cb212-2513" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_leer =</span> <span class="fu">log</span>(leer <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb212-2514"><a href="#cb212-2514" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_ungultig =</span> <span class="fu">log</span>(ungultig <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb212-2515"><a href="#cb212-2515" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_gultig =</span> <span class="fu">log</span>(gultig <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb212-2516"><a href="#cb212-2516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb212-2517"><a href="#cb212-2517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2518"><a href="#cb212-2518" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-2519"><a href="#cb212-2519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2520"><a href="#cb212-2520" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Multikollinearität via vif() erkennen, bereinigen und Startmodelle erstellen</span></span>
<span id="cb212-2521"><a href="#cb212-2521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2524"><a href="#cb212-2524" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-2525"><a href="#cb212-2525" aria-hidden="true" tabindex="-1"></a>mod_log_state <span class="ot">&lt;-</span> <span class="fu">glm</span>(annahme <span class="sc">~</span> state_parole_Ja <span class="sc">+</span> </span>
<span id="cb212-2526"><a href="#cb212-2526" aria-hidden="true" tabindex="-1"></a>                     <span class="co">#kt_parole_Ja + gemeinde_parole_Ja + parliament_ja_avg +</span></span>
<span id="cb212-2527"><a href="#cb212-2527" aria-hidden="true" tabindex="-1"></a>                     log_mediares <span class="sc">+</span> log_inserate_total <span class="sc">+</span></span>
<span id="cb212-2528"><a href="#cb212-2528" aria-hidden="true" tabindex="-1"></a>                     log_inserate_ja_pct <span class="sc">+</span> log_inserate_neutral_pct <span class="sc">+</span> log_bet <span class="sc">+</span></span>
<span id="cb212-2529"><a href="#cb212-2529" aria-hidden="true" tabindex="-1"></a>                     <span class="co">#log_leer + log_ungultig + log_gultig + </span></span>
<span id="cb212-2530"><a href="#cb212-2530" aria-hidden="true" tabindex="-1"></a>                     <span class="co">#rechtsform + </span></span>
<span id="cb212-2531"><a href="#cb212-2531" aria-hidden="true" tabindex="-1"></a>                     dep,</span>
<span id="cb212-2532"><a href="#cb212-2532" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> voting_5y_final_log,</span>
<span id="cb212-2533"><a href="#cb212-2533" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> binomial)</span>
<span id="cb212-2534"><a href="#cb212-2534" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(mod_log_state)</span>
<span id="cb212-2535"><a href="#cb212-2535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2536"><a href="#cb212-2536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2537"><a href="#cb212-2537" aria-hidden="true" tabindex="-1"></a>mod_log_kanton <span class="ot">&lt;-</span> <span class="fu">glm</span>(annahme <span class="sc">~</span>  kt_parole_Ja <span class="sc">+</span></span>
<span id="cb212-2538"><a href="#cb212-2538" aria-hidden="true" tabindex="-1"></a>                     <span class="co">#state_parole_Ja +gemeinde_parole_Ja + parliament_ja_avg +</span></span>
<span id="cb212-2539"><a href="#cb212-2539" aria-hidden="true" tabindex="-1"></a>                     log_mediares <span class="sc">+</span> log_inserate_total <span class="sc">+</span></span>
<span id="cb212-2540"><a href="#cb212-2540" aria-hidden="true" tabindex="-1"></a>                     log_inserate_ja_pct <span class="sc">+</span> log_inserate_neutral_pct <span class="sc">+</span> log_bet <span class="sc">+</span></span>
<span id="cb212-2541"><a href="#cb212-2541" aria-hidden="true" tabindex="-1"></a>                     <span class="co">#log_leer + log_ungultig + log_gultig + </span></span>
<span id="cb212-2542"><a href="#cb212-2542" aria-hidden="true" tabindex="-1"></a>                     <span class="co">#rechtsform + </span></span>
<span id="cb212-2543"><a href="#cb212-2543" aria-hidden="true" tabindex="-1"></a>                     dep,</span>
<span id="cb212-2544"><a href="#cb212-2544" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> voting_5y_final_log,</span>
<span id="cb212-2545"><a href="#cb212-2545" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> binomial)</span>
<span id="cb212-2546"><a href="#cb212-2546" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(mod_log_kanton)</span>
<span id="cb212-2547"><a href="#cb212-2547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2548"><a href="#cb212-2548" aria-hidden="true" tabindex="-1"></a>mod_log_gemeinde <span class="ot">&lt;-</span> <span class="fu">glm</span>(annahme <span class="sc">~</span> gemeinde_parole_Ja <span class="sc">+</span> </span>
<span id="cb212-2549"><a href="#cb212-2549" aria-hidden="true" tabindex="-1"></a>                            <span class="co">#state_parole_Ja + #kt_parole_Ja + parliament_ja_avg +</span></span>
<span id="cb212-2550"><a href="#cb212-2550" aria-hidden="true" tabindex="-1"></a>                            log_mediares <span class="sc">+</span> log_inserate_total <span class="sc">+</span></span>
<span id="cb212-2551"><a href="#cb212-2551" aria-hidden="true" tabindex="-1"></a>                            log_inserate_ja_pct <span class="sc">+</span> log_inserate_neutral_pct <span class="sc">+</span></span>
<span id="cb212-2552"><a href="#cb212-2552" aria-hidden="true" tabindex="-1"></a>                            <span class="co">#log_bet + log_leer + log_ungultig + log_gultig + </span></span>
<span id="cb212-2553"><a href="#cb212-2553" aria-hidden="true" tabindex="-1"></a>                            <span class="co">#rechtsform +</span></span>
<span id="cb212-2554"><a href="#cb212-2554" aria-hidden="true" tabindex="-1"></a>                            dep,</span>
<span id="cb212-2555"><a href="#cb212-2555" aria-hidden="true" tabindex="-1"></a>                            <span class="at">data =</span> voting_5y_final_log,</span>
<span id="cb212-2556"><a href="#cb212-2556" aria-hidden="true" tabindex="-1"></a>                            <span class="at">family =</span> binomial)</span>
<span id="cb212-2557"><a href="#cb212-2557" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(mod_log_gemeinde)</span>
<span id="cb212-2558"><a href="#cb212-2558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2559"><a href="#cb212-2559" aria-hidden="true" tabindex="-1"></a>mod_log_parliament <span class="ot">&lt;-</span> <span class="fu">glm</span>(annahme <span class="sc">~</span> parliament_ja_avg <span class="sc">+</span></span>
<span id="cb212-2560"><a href="#cb212-2560" aria-hidden="true" tabindex="-1"></a>                            <span class="co">#state_parole_Ja + #kt_parole_Ja + gemeinde_parole_Ja +</span></span>
<span id="cb212-2561"><a href="#cb212-2561" aria-hidden="true" tabindex="-1"></a>                            log_mediares <span class="sc">+</span> log_inserate_total <span class="sc">+</span></span>
<span id="cb212-2562"><a href="#cb212-2562" aria-hidden="true" tabindex="-1"></a>                            log_inserate_ja_pct <span class="sc">+</span> log_inserate_neutral_pct <span class="sc">+</span></span>
<span id="cb212-2563"><a href="#cb212-2563" aria-hidden="true" tabindex="-1"></a>                            <span class="co">#log_bet + log_leer + log_ungultig + log_gultig + </span></span>
<span id="cb212-2564"><a href="#cb212-2564" aria-hidden="true" tabindex="-1"></a>                            <span class="co">#rechtsform +</span></span>
<span id="cb212-2565"><a href="#cb212-2565" aria-hidden="true" tabindex="-1"></a>                            dep,</span>
<span id="cb212-2566"><a href="#cb212-2566" aria-hidden="true" tabindex="-1"></a>                            <span class="at">data =</span> voting_5y_final_log,</span>
<span id="cb212-2567"><a href="#cb212-2567" aria-hidden="true" tabindex="-1"></a>                            <span class="at">family =</span> binomial)</span>
<span id="cb212-2568"><a href="#cb212-2568" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(mod_log_parliament)</span>
<span id="cb212-2569"><a href="#cb212-2569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2570"><a href="#cb212-2570" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-2571"><a href="#cb212-2571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2572"><a href="#cb212-2572" aria-hidden="true" tabindex="-1"></a><span class="fu">#### stepAIC für Modellauswahl</span></span>
<span id="cb212-2573"><a href="#cb212-2573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2576"><a href="#cb212-2576" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-2577"><a href="#cb212-2577" aria-hidden="true" tabindex="-1"></a>step_state <span class="ot">&lt;-</span> <span class="fu">stepAIC</span>(mod_log_state, <span class="at">direction =</span> <span class="st">"both"</span>,</span>
<span id="cb212-2578"><a href="#cb212-2578" aria-hidden="true" tabindex="-1"></a>                      <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb212-2579"><a href="#cb212-2579" aria-hidden="true" tabindex="-1"></a>step_kanton <span class="ot">&lt;-</span> <span class="fu">stepAIC</span>(mod_log_kanton, <span class="at">direction =</span> <span class="st">"both"</span>,</span>
<span id="cb212-2580"><a href="#cb212-2580" aria-hidden="true" tabindex="-1"></a>                       <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb212-2581"><a href="#cb212-2581" aria-hidden="true" tabindex="-1"></a>step_gemeinde <span class="ot">&lt;-</span> <span class="fu">stepAIC</span>(mod_log_gemeinde, <span class="at">direction =</span> <span class="st">"both"</span>,</span>
<span id="cb212-2582"><a href="#cb212-2582" aria-hidden="true" tabindex="-1"></a>                         <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb212-2583"><a href="#cb212-2583" aria-hidden="true" tabindex="-1"></a>step_parliament <span class="ot">&lt;-</span> <span class="fu">stepAIC</span>(mod_log_parliament, <span class="at">direction =</span> <span class="st">"both"</span>,</span>
<span id="cb212-2584"><a href="#cb212-2584" aria-hidden="true" tabindex="-1"></a>                           <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb212-2585"><a href="#cb212-2585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2586"><a href="#cb212-2586" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-2587"><a href="#cb212-2587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2588"><a href="#cb212-2588" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Modelle vergleichen</span></span>
<span id="cb212-2589"><a href="#cb212-2589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2590"><a href="#cb212-2590" aria-hidden="true" tabindex="-1"></a><span class="fu">##### GVIF-Werte</span></span>
<span id="cb212-2591"><a href="#cb212-2591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2594"><a href="#cb212-2594" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-2595"><a href="#cb212-2595" aria-hidden="true" tabindex="-1"></a><span class="co"># GVIF-Werte</span></span>
<span id="cb212-2596"><a href="#cb212-2596" aria-hidden="true" tabindex="-1"></a><span class="co"># Liste aller Modelle</span></span>
<span id="cb212-2597"><a href="#cb212-2597" aria-hidden="true" tabindex="-1"></a>model_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">mod_log_state      =</span> mod_log_state,</span>
<span id="cb212-2598"><a href="#cb212-2598" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mod_log_kanton     =</span> mod_log_kanton,</span>
<span id="cb212-2599"><a href="#cb212-2599" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mod_log_gemeinde   =</span> mod_log_gemeinde,</span>
<span id="cb212-2600"><a href="#cb212-2600" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mod_log_parliament =</span> mod_log_parliament)</span>
<span id="cb212-2601"><a href="#cb212-2601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2602"><a href="#cb212-2602" aria-hidden="true" tabindex="-1"></a><span class="co"># Funktion zur Berechnung und Ausgabe</span></span>
<span id="cb212-2603"><a href="#cb212-2603" aria-hidden="true" tabindex="-1"></a>vif_bandbreite_max <span class="ot">&lt;-</span> <span class="cf">function</span>(model, model_name) {</span>
<span id="cb212-2604"><a href="#cb212-2604" aria-hidden="true" tabindex="-1"></a>  vif_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">vif</span>(model))</span>
<span id="cb212-2605"><a href="#cb212-2605" aria-hidden="true" tabindex="-1"></a>  range_gvif <span class="ot">&lt;-</span> <span class="fu">range</span>(vif_df<span class="sc">$</span><span class="st">`</span><span class="at">GVIF^(1/(2*Df))</span><span class="st">`</span>)</span>
<span id="cb212-2606"><a href="#cb212-2606" aria-hidden="true" tabindex="-1"></a>  bandbreite_gvif <span class="ot">&lt;-</span> <span class="fu">diff</span>(range_gvif)</span>
<span id="cb212-2607"><a href="#cb212-2607" aria-hidden="true" tabindex="-1"></a>  max_gvif <span class="ot">&lt;-</span> <span class="fu">max</span>(vif_df<span class="sc">$</span><span class="st">`</span><span class="at">GVIF^(1/(2*Df))</span><span class="st">`</span>)</span>
<span id="cb212-2608"><a href="#cb212-2608" aria-hidden="true" tabindex="-1"></a>  max_gvif_var <span class="ot">&lt;-</span> <span class="fu">rownames</span>(vif_df)[<span class="fu">which.max</span>(vif_df<span class="sc">$</span><span class="st">`</span><span class="at">GVIF^(1/(2*Df))</span><span class="st">`</span>)]</span>
<span id="cb212-2609"><a href="#cb212-2609" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"------"</span>, model_name, <span class="st">"------</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb212-2610"><a href="#cb212-2610" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Bandbreite (Range):"</span>,</span>
<span id="cb212-2611"><a href="#cb212-2611" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(range_gvif[<span class="dv">1</span>], <span class="dv">3</span>), <span class="st">"-"</span>, <span class="fu">round</span>(range_gvif[<span class="dv">2</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb212-2612"><a href="#cb212-2612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Bandbreite (Differenz):"</span>,</span>
<span id="cb212-2613"><a href="#cb212-2613" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(bandbreite_gvif, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb212-2614"><a href="#cb212-2614" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Höchster GVIF^(1/(2Df)) Wert:"</span>,</span>
<span id="cb212-2615"><a href="#cb212-2615" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(max_gvif, <span class="dv">3</span>), <span class="st">"("</span>, max_gvif_var, <span class="st">")</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb212-2616"><a href="#cb212-2616" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb212-2617"><a href="#cb212-2617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2618"><a href="#cb212-2618" aria-hidden="true" tabindex="-1"></a><span class="co"># Schleife über alle Modelle</span></span>
<span id="cb212-2619"><a href="#cb212-2619" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (name <span class="cf">in</span> <span class="fu">names</span>(model_list)) {</span>
<span id="cb212-2620"><a href="#cb212-2620" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vif_bandbreite_max</span>(model_list[[name]], name)</span>
<span id="cb212-2621"><a href="#cb212-2621" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb212-2622"><a href="#cb212-2622" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-2623"><a href="#cb212-2623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2624"><a href="#cb212-2624" aria-hidden="true" tabindex="-1"></a><span class="fu">##### AIC, Pseudo-R² (McFadden) &amp; AUC</span></span>
<span id="cb212-2625"><a href="#cb212-2625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2628"><a href="#cb212-2628" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-2629"><a href="#cb212-2629" aria-hidden="true" tabindex="-1"></a><span class="co"># stepAIC() zu kombinieren</span></span>
<span id="cb212-2630"><a href="#cb212-2630" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">State =</span> step_state,</span>
<span id="cb212-2631"><a href="#cb212-2631" aria-hidden="true" tabindex="-1"></a>               <span class="at">Kanton =</span> step_kanton,</span>
<span id="cb212-2632"><a href="#cb212-2632" aria-hidden="true" tabindex="-1"></a>               <span class="at">Gemeinde =</span> step_gemeinde,</span>
<span id="cb212-2633"><a href="#cb212-2633" aria-hidden="true" tabindex="-1"></a>               <span class="at">Parlament =</span> step_parliament)</span>
<span id="cb212-2634"><a href="#cb212-2634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2635"><a href="#cb212-2635" aria-hidden="true" tabindex="-1"></a><span class="co"># # AIC</span></span>
<span id="cb212-2636"><a href="#cb212-2636" aria-hidden="true" tabindex="-1"></a><span class="co"># sapply(models, AIC)</span></span>
<span id="cb212-2637"><a href="#cb212-2637" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb212-2638"><a href="#cb212-2638" aria-hidden="true" tabindex="-1"></a><span class="co"># # Pseudo-R² (McFadden)</span></span>
<span id="cb212-2639"><a href="#cb212-2639" aria-hidden="true" tabindex="-1"></a><span class="co"># sapply(models, function(m) round(pR2(m)["McFadden"], 3))</span></span>
<span id="cb212-2640"><a href="#cb212-2640" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb212-2641"><a href="#cb212-2641" aria-hidden="true" tabindex="-1"></a><span class="co"># # AUC</span></span>
<span id="cb212-2642"><a href="#cb212-2642" aria-hidden="true" tabindex="-1"></a><span class="co"># sapply(models, function(m) {</span></span>
<span id="cb212-2643"><a href="#cb212-2643" aria-hidden="true" tabindex="-1"></a><span class="co">#   prob &lt;- predict(m, type = "response")</span></span>
<span id="cb212-2644"><a href="#cb212-2644" aria-hidden="true" tabindex="-1"></a><span class="co">#   roc_obj &lt;- roc(voting_5y_final_log$annahme, prob)</span></span>
<span id="cb212-2645"><a href="#cb212-2645" aria-hidden="true" tabindex="-1"></a><span class="co">#   round(auc(roc_obj), 3)</span></span>
<span id="cb212-2646"><a href="#cb212-2646" aria-hidden="true" tabindex="-1"></a><span class="co"># })</span></span>
<span id="cb212-2647"><a href="#cb212-2647" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb212-2648"><a href="#cb212-2648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2649"><a href="#cb212-2649" aria-hidden="true" tabindex="-1"></a><span class="co">#  Ergebnisse</span></span>
<span id="cb212-2650"><a href="#cb212-2650" aria-hidden="true" tabindex="-1"></a>AICs <span class="ot">&lt;-</span> <span class="fu">sapply</span>(models, AIC)</span>
<span id="cb212-2651"><a href="#cb212-2651" aria-hidden="true" tabindex="-1"></a>McFadden <span class="ot">&lt;-</span> <span class="fu">sapply</span>(models, <span class="cf">function</span>(m) <span class="fu">round</span>(<span class="fu">pR2</span>(m)[<span class="st">"McFadden"</span>], <span class="dv">3</span>))</span>
<span id="cb212-2652"><a href="#cb212-2652" aria-hidden="true" tabindex="-1"></a>AUCs <span class="ot">&lt;-</span> <span class="fu">sapply</span>(models, <span class="cf">function</span>(m) {</span>
<span id="cb212-2653"><a href="#cb212-2653" aria-hidden="true" tabindex="-1"></a>  prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(m, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb212-2654"><a href="#cb212-2654" aria-hidden="true" tabindex="-1"></a>  roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(voting_5y_final_log<span class="sc">$</span>annahme, prob)</span>
<span id="cb212-2655"><a href="#cb212-2655" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">auc</span>(roc_obj), <span class="dv">3</span>)</span>
<span id="cb212-2656"><a href="#cb212-2656" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb212-2657"><a href="#cb212-2657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2658"><a href="#cb212-2658" aria-hidden="true" tabindex="-1"></a><span class="co"># Zusammenfassung als Dataframe</span></span>
<span id="cb212-2659"><a href="#cb212-2659" aria-hidden="true" tabindex="-1"></a>summary_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb212-2660"><a href="#cb212-2660" aria-hidden="true" tabindex="-1"></a>  <span class="at">Modell =</span> <span class="fu">names</span>(models),</span>
<span id="cb212-2661"><a href="#cb212-2661" aria-hidden="true" tabindex="-1"></a>  <span class="at">AIC =</span> <span class="fu">round</span>(AICs, <span class="dv">2</span>),</span>
<span id="cb212-2662"><a href="#cb212-2662" aria-hidden="true" tabindex="-1"></a>  <span class="at">McFadden_R2 =</span> <span class="fu">as.numeric</span>(McFadden),</span>
<span id="cb212-2663"><a href="#cb212-2663" aria-hidden="true" tabindex="-1"></a>  <span class="at">AUC =</span> <span class="fu">as.numeric</span>(AUCs),</span>
<span id="cb212-2664"><a href="#cb212-2664" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb212-2665"><a href="#cb212-2665" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb212-2666"><a href="#cb212-2666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2667"><a href="#cb212-2667" aria-hidden="true" tabindex="-1"></a><span class="co"># Ausgabe</span></span>
<span id="cb212-2668"><a href="#cb212-2668" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(summary_df)</span>
<span id="cb212-2669"><a href="#cb212-2669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2670"><a href="#cb212-2670" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-2671"><a href="#cb212-2671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2672"><a href="#cb212-2672" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Odds-ratios und p-Werte interpretieren</span></span>
<span id="cb212-2673"><a href="#cb212-2673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2676"><a href="#cb212-2676" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-2677"><a href="#cb212-2677" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(step_state))  <span class="co"># Odds Ratios</span></span>
<span id="cb212-2678"><a href="#cb212-2678" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(step_state)    <span class="co"># p-Werte und Interpretation</span></span>
<span id="cb212-2679"><a href="#cb212-2679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2680"><a href="#cb212-2680" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(step_kanton))  <span class="co"># Odds Ratios</span></span>
<span id="cb212-2681"><a href="#cb212-2681" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(step_kanton)    <span class="co"># p-Werte und Interpretation</span></span>
<span id="cb212-2682"><a href="#cb212-2682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2683"><a href="#cb212-2683" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(step_gemeinde))  <span class="co"># Odds Ratios</span></span>
<span id="cb212-2684"><a href="#cb212-2684" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(step_gemeinde)    <span class="co"># p-Werte und Interpretation</span></span>
<span id="cb212-2685"><a href="#cb212-2685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2686"><a href="#cb212-2686" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(step_parliament))  <span class="co"># Odds Ratios</span></span>
<span id="cb212-2687"><a href="#cb212-2687" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(step_parliament)    <span class="co"># p-Werte und Interpretation</span></span>
<span id="cb212-2688"><a href="#cb212-2688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2689"><a href="#cb212-2689" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-2690"><a href="#cb212-2690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2691"><a href="#cb212-2691" aria-hidden="true" tabindex="-1"></a><span class="fu">## Parteilandschaft Schweiz</span></span>
<span id="cb212-2692"><a href="#cb212-2692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2693"><a href="#cb212-2693" aria-hidden="true" tabindex="-1"></a><span class="fu">### Multi-Dimensions-Model</span></span>
<span id="cb212-2694"><a href="#cb212-2694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2695"><a href="#cb212-2695" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Minimalwerte</span></span>
<span id="cb212-2696"><a href="#cb212-2696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2697"><a href="#cb212-2697" aria-hidden="true" tabindex="-1"></a>Für jede Partei den Minimalwert des Abstimmungsverhaltens zu verwenden, basiert auf der Zielsetzung, die klarste politische Position einer Partei in einem bestimmten Themenbereich zu identifizieren. Diese Methodik stellt sicher, dass auch bei wenigen Abweichungen von der Mehrheitslinie die tatsächliche Haltung der Partei deutlich erkennbar bleibt.</span>
<span id="cb212-2698"><a href="#cb212-2698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2701"><a href="#cb212-2701" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-2702"><a href="#cb212-2702" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot_parties_avg</span></span>
<span id="cb212-2703"><a href="#cb212-2703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2704"><a href="#cb212-2704" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(parties_rating,</span>
<span id="cb212-2705"><a href="#cb212-2705" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> eco_pct_min_x,</span>
<span id="cb212-2706"><a href="#cb212-2706" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> socio_pct_min_y,</span>
<span id="cb212-2707"><a href="#cb212-2707" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> Partei)) <span class="sc">+</span></span>
<span id="cb212-2708"><a href="#cb212-2708" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb212-2709"><a href="#cb212-2709" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb212-2710"><a href="#cb212-2710" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">50</span>, <span class="at">xend =</span> <span class="dv">50</span>,</span>
<span id="cb212-2711"><a href="#cb212-2711" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">100</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb212-2712"><a href="#cb212-2712" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">xend =</span> <span class="dv">100</span>,</span>
<span id="cb212-2713"><a href="#cb212-2713" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="dv">50</span>, <span class="at">yend =</span> <span class="dv">50</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb212-2714"><a href="#cb212-2714" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-2715"><a href="#cb212-2715" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb212-2716"><a href="#cb212-2716" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">0</span>,</span>
<span id="cb212-2717"><a href="#cb212-2717" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(parties_rating<span class="sc">$</span>socio_pct_min_y) <span class="sc">+</span> <span class="dv">55</span>,</span>
<span id="cb212-2718"><a href="#cb212-2718" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Links/staatsgläubig"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb212-2719"><a href="#cb212-2719" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb212-2720"><a href="#cb212-2720" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">100</span>,</span>
<span id="cb212-2721"><a href="#cb212-2721" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(parties_rating<span class="sc">$</span>socio_pct_min_y) <span class="sc">+</span> <span class="dv">55</span>,</span>
<span id="cb212-2722"><a href="#cb212-2722" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Rechts/marktwirtschaftlich"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb212-2723"><a href="#cb212-2723" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb212-2724"><a href="#cb212-2724" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">50</span>,</span>
<span id="cb212-2725"><a href="#cb212-2725" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(parties_rating<span class="sc">$</span>socio_pct_min_y) <span class="sc">-</span> <span class="dv">3</span>,</span>
<span id="cb212-2726"><a href="#cb212-2726" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Autoritär/Konservativ"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb212-2727"><a href="#cb212-2727" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb212-2728"><a href="#cb212-2728" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">50</span>,</span>
<span id="cb212-2729"><a href="#cb212-2729" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(parties_rating<span class="sc">$</span>socio_pct_min_y) <span class="sc">+</span> <span class="dv">103</span>,</span>
<span id="cb212-2730"><a href="#cb212-2730" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Libertär/Progressiv"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb212-2731"><a href="#cb212-2731" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb212-2732"><a href="#cb212-2732" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Wirtschaftspolitisch"</span>,</span>
<span id="cb212-2733"><a href="#cb212-2733" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Gesellschaftspolitisch"</span>,</span>
<span id="cb212-2734"><a href="#cb212-2734" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Politische Positionierung im Zwei-Achsen-Modell"</span>,</span>
<span id="cb212-2735"><a href="#cb212-2735" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Grundlage: Minimalwerte des Abstimmungsverhaltens"</span>) <span class="sc">+</span></span>
<span id="cb212-2736"><a href="#cb212-2736" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb212-2737"><a href="#cb212-2737" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>,</span>
<span id="cb212-2738"><a href="#cb212-2738" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">30</span>)),</span>
<span id="cb212-2739"><a href="#cb212-2739" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>,</span>
<span id="cb212-2740"><a href="#cb212-2740" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">5</span>)),</span>
<span id="cb212-2741"><a href="#cb212-2741" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>,</span>
<span id="cb212-2742"><a href="#cb212-2742" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">5</span>))) <span class="sc">+</span></span>
<span id="cb212-2743"><a href="#cb212-2743" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">105</span>),</span>
<span id="cb212-2744"><a href="#cb212-2744" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">105</span>),</span>
<span id="cb212-2745"><a href="#cb212-2745" aria-hidden="true" tabindex="-1"></a>                  <span class="at">clip =</span> <span class="st">"off"</span>)</span>
<span id="cb212-2746"><a href="#cb212-2746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2747"><a href="#cb212-2747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2748"><a href="#cb212-2748" aria-hidden="true" tabindex="-1"></a><span class="co"># Alle "problematischen" Zeilen (NA oder out-of-bounds)</span></span>
<span id="cb212-2749"><a href="#cb212-2749" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; Keine Inputwerte bzw. nur Durschnitte (in separater Spalte)</span></span>
<span id="cb212-2750"><a href="#cb212-2750" aria-hidden="true" tabindex="-1"></a>tmp_removed_rows <span class="ot">&lt;-</span> parties_rating <span class="sc">%&gt;%</span></span>
<span id="cb212-2751"><a href="#cb212-2751" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb212-2752"><a href="#cb212-2752" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(eco_pct_min_x) <span class="sc">|</span> <span class="fu">is.na</span>(socio_pct_min_y) <span class="sc">|</span></span>
<span id="cb212-2753"><a href="#cb212-2753" aria-hidden="true" tabindex="-1"></a>    eco_pct_min_x <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> eco_pct_min_x <span class="sc">&gt;</span> <span class="dv">100</span> <span class="sc">|</span></span>
<span id="cb212-2754"><a href="#cb212-2754" aria-hidden="true" tabindex="-1"></a>    socio_pct_min_y <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> socio_pct_min_y <span class="sc">&gt;</span> <span class="dv">100</span>)</span>
<span id="cb212-2755"><a href="#cb212-2755" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-2756"><a href="#cb212-2756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2757"><a href="#cb212-2757" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Durchschnittswerte als Zentrum und Min/Max als Ellipse</span></span>
<span id="cb212-2758"><a href="#cb212-2758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2761"><a href="#cb212-2761" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-2762"><a href="#cb212-2762" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot_parties_avg_min_max</span></span>
<span id="cb212-2763"><a href="#cb212-2763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2764"><a href="#cb212-2764" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(parties_rating,</span>
<span id="cb212-2765"><a href="#cb212-2765" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> eco_pct_avg_x,</span>
<span id="cb212-2766"><a href="#cb212-2766" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> socio_pct_avg_y,</span>
<span id="cb212-2767"><a href="#cb212-2767" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> Partei)) <span class="sc">+</span></span>
<span id="cb212-2768"><a href="#cb212-2768" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ellipse</span>(</span>
<span id="cb212-2769"><a href="#cb212-2769" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x0 =</span> eco_pct_avg_x,</span>
<span id="cb212-2770"><a href="#cb212-2770" aria-hidden="true" tabindex="-1"></a>        <span class="at">y0 =</span> socio_pct_avg_y,</span>
<span id="cb212-2771"><a href="#cb212-2771" aria-hidden="true" tabindex="-1"></a>        <span class="at">a =</span> (eco_pct_max_x <span class="sc">-</span> eco_pct_min_x) <span class="sc">/</span> <span class="dv">2</span>, <span class="co"># Halbachse x</span></span>
<span id="cb212-2772"><a href="#cb212-2772" aria-hidden="true" tabindex="-1"></a>        <span class="at">b =</span> (socio_pct_max_y <span class="sc">-</span> socio_pct_min_y) <span class="sc">/</span> <span class="dv">2</span>, <span class="co"># Halbachse y</span></span>
<span id="cb212-2773"><a href="#cb212-2773" aria-hidden="true" tabindex="-1"></a>        <span class="at">angle =</span> <span class="dv">0</span>),</span>
<span id="cb212-2774"><a href="#cb212-2774" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"gray80"</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb212-2775"><a href="#cb212-2775" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb212-2776"><a href="#cb212-2776" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb212-2777"><a href="#cb212-2777" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">50</span>, <span class="at">xend =</span> <span class="dv">50</span>,</span>
<span id="cb212-2778"><a href="#cb212-2778" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">100</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb212-2779"><a href="#cb212-2779" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">xend =</span> <span class="dv">100</span>,</span>
<span id="cb212-2780"><a href="#cb212-2780" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="dv">50</span>, <span class="at">yend =</span> <span class="dv">50</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb212-2781"><a href="#cb212-2781" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb212-2782"><a href="#cb212-2782" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">0</span>,</span>
<span id="cb212-2783"><a href="#cb212-2783" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(parties_rating<span class="sc">$</span>socio_pct_min_y) <span class="sc">+</span> <span class="dv">55</span>,</span>
<span id="cb212-2784"><a href="#cb212-2784" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Links/staatsgläubig"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb212-2785"><a href="#cb212-2785" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb212-2786"><a href="#cb212-2786" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">100</span>,</span>
<span id="cb212-2787"><a href="#cb212-2787" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(parties_rating<span class="sc">$</span>socio_pct_min_y) <span class="sc">+</span> <span class="dv">55</span>,</span>
<span id="cb212-2788"><a href="#cb212-2788" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Rechts/marktwirtschaftlich"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb212-2789"><a href="#cb212-2789" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb212-2790"><a href="#cb212-2790" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">50</span>,</span>
<span id="cb212-2791"><a href="#cb212-2791" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(parties_rating<span class="sc">$</span>socio_pct_min_y) <span class="sc">-</span> <span class="dv">3</span>,</span>
<span id="cb212-2792"><a href="#cb212-2792" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Autoritär/Konservativ"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb212-2793"><a href="#cb212-2793" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb212-2794"><a href="#cb212-2794" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">50</span>,</span>
<span id="cb212-2795"><a href="#cb212-2795" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(parties_rating<span class="sc">$</span>socio_pct_min_y) <span class="sc">+</span> <span class="dv">103</span>,</span>
<span id="cb212-2796"><a href="#cb212-2796" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Libertär/Progressiv"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb212-2797"><a href="#cb212-2797" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="sc">+</span><span class="dv">110</span>)) <span class="sc">+</span></span>
<span id="cb212-2798"><a href="#cb212-2798" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Wirtschaftspolitisch"</span>,</span>
<span id="cb212-2799"><a href="#cb212-2799" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Gesellschaftspolitisch"</span>,</span>
<span id="cb212-2800"><a href="#cb212-2800" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Politische Positionierung im Zwei-Achsen-Modell"</span>,</span>
<span id="cb212-2801"><a href="#cb212-2801" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Grundlage: Durchschnitt des Abstimmungsverhaltens als Zentrum, Min-/Max als Ellipse"</span>) <span class="sc">+</span></span>
<span id="cb212-2802"><a href="#cb212-2802" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb212-2803"><a href="#cb212-2803" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>,</span>
<span id="cb212-2804"><a href="#cb212-2804" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">30</span>)),</span>
<span id="cb212-2805"><a href="#cb212-2805" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>,</span>
<span id="cb212-2806"><a href="#cb212-2806" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">5</span>)),</span>
<span id="cb212-2807"><a href="#cb212-2807" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>,</span>
<span id="cb212-2808"><a href="#cb212-2808" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">5</span>))) <span class="sc">+</span></span>
<span id="cb212-2809"><a href="#cb212-2809" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb212-2810"><a href="#cb212-2810" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb212-2811"><a href="#cb212-2811" aria-hidden="true" tabindex="-1"></a>                  <span class="at">clip =</span> <span class="st">"off"</span>)</span>
<span id="cb212-2812"><a href="#cb212-2812" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-2813"><a href="#cb212-2813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2814"><a href="#cb212-2814" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Hauptparteien: Durchschnittswerte als Zentrum und Min/Max als Ellipse / Klein- und Regionalparteien nur mit ihrem Durchschnittswert</span></span>
<span id="cb212-2815"><a href="#cb212-2815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2818"><a href="#cb212-2818" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-2819"><a href="#cb212-2819" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot_parties_avg_min_max_incl_minor</span></span>
<span id="cb212-2820"><a href="#cb212-2820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2821"><a href="#cb212-2821" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(parties_rating,</span>
<span id="cb212-2822"><a href="#cb212-2822" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> eco_pct_avg_x,</span>
<span id="cb212-2823"><a href="#cb212-2823" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> socio_pct_avg_y,</span>
<span id="cb212-2824"><a href="#cb212-2824" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> Partei)) <span class="sc">+</span></span>
<span id="cb212-2825"><a href="#cb212-2825" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ellipse</span>(<span class="fu">aes</span>(<span class="at">x0 =</span> eco_pct_avg_x,</span>
<span id="cb212-2826"><a href="#cb212-2826" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y0 =</span> socio_pct_avg_y,</span>
<span id="cb212-2827"><a href="#cb212-2827" aria-hidden="true" tabindex="-1"></a>                   <span class="at">a =</span> (eco_pct_max_x <span class="sc">-</span> eco_pct_min_x) <span class="sc">/</span> <span class="dv">2</span>, <span class="co"># Halbachse x</span></span>
<span id="cb212-2828"><a href="#cb212-2828" aria-hidden="true" tabindex="-1"></a>                   <span class="at">b =</span> (socio_pct_max_y <span class="sc">-</span> socio_pct_min_y) <span class="sc">/</span> <span class="dv">2</span>, <span class="co"># Halbachse y</span></span>
<span id="cb212-2829"><a href="#cb212-2829" aria-hidden="true" tabindex="-1"></a>                   <span class="at">angle =</span> <span class="dv">0</span>),</span>
<span id="cb212-2830"><a href="#cb212-2830" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">"gray80"</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb212-2831"><a href="#cb212-2831" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb212-2832"><a href="#cb212-2832" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-2833"><a href="#cb212-2833" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Kleinere Parteien</span></span>
<span id="cb212-2834"><a href="#cb212-2834" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(parties_rating,</span>
<span id="cb212-2835"><a href="#cb212-2835" aria-hidden="true" tabindex="-1"></a>                           <span class="st">`</span><span class="at">Grosse Partei</span><span class="st">`</span> <span class="sc">==</span> <span class="st">"n"</span> <span class="sc">&amp;</span></span>
<span id="cb212-2836"><a href="#cb212-2836" aria-hidden="true" tabindex="-1"></a>                             Relevanz_nationale_Abstimmungen <span class="sc">!=</span> <span class="st">"-"</span>),</span>
<span id="cb212-2837"><a href="#cb212-2837" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> eco_x,</span>
<span id="cb212-2838"><a href="#cb212-2838" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> socio_y),</span>
<span id="cb212-2839"><a href="#cb212-2839" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"grey"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">stroke =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb212-2840"><a href="#cb212-2840" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-2841"><a href="#cb212-2841" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Labels der kleineren Partein</span></span>
<span id="cb212-2842"><a href="#cb212-2842" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">subset</span>(parties_rating,</span>
<span id="cb212-2843"><a href="#cb212-2843" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">Grosse Partei</span><span class="st">`</span> <span class="sc">==</span> <span class="st">"n"</span> <span class="sc">&amp;</span></span>
<span id="cb212-2844"><a href="#cb212-2844" aria-hidden="true" tabindex="-1"></a>                            Relevanz_nationale_Abstimmungen <span class="sc">!=</span> <span class="st">"-"</span>),</span>
<span id="cb212-2845"><a href="#cb212-2845" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> eco_x,</span>
<span id="cb212-2846"><a href="#cb212-2846" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> socio_y,</span>
<span id="cb212-2847"><a href="#cb212-2847" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> Partei),</span>
<span id="cb212-2848"><a href="#cb212-2848" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">fontface =</span> <span class="st">"plain"</span>, <span class="at">color =</span> <span class="st">"darkgrey"</span>) <span class="sc">+</span></span>
<span id="cb212-2849"><a href="#cb212-2849" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb212-2850"><a href="#cb212-2850" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">50</span>, <span class="at">xend =</span> <span class="dv">50</span>,</span>
<span id="cb212-2851"><a href="#cb212-2851" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">100</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb212-2852"><a href="#cb212-2852" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">xend =</span> <span class="dv">100</span>,</span>
<span id="cb212-2853"><a href="#cb212-2853" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="dv">50</span>, <span class="at">yend =</span> <span class="dv">50</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb212-2854"><a href="#cb212-2854" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb212-2855"><a href="#cb212-2855" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">0</span>,</span>
<span id="cb212-2856"><a href="#cb212-2856" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(parties_rating<span class="sc">$</span>socio_pct_min_y) <span class="sc">+</span> <span class="dv">55</span>,</span>
<span id="cb212-2857"><a href="#cb212-2857" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Links/staatsgläubig"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb212-2858"><a href="#cb212-2858" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb212-2859"><a href="#cb212-2859" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">100</span>,</span>
<span id="cb212-2860"><a href="#cb212-2860" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(parties_rating<span class="sc">$</span>socio_pct_min_y) <span class="sc">+</span> <span class="dv">55</span>,</span>
<span id="cb212-2861"><a href="#cb212-2861" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Rechts/marktwirtschaftlich"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb212-2862"><a href="#cb212-2862" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb212-2863"><a href="#cb212-2863" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">50</span>,</span>
<span id="cb212-2864"><a href="#cb212-2864" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(parties_rating<span class="sc">$</span>socio_pct_min_y) <span class="sc">-</span> <span class="dv">3</span>,</span>
<span id="cb212-2865"><a href="#cb212-2865" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Autoritär/Konservativ"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb212-2866"><a href="#cb212-2866" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb212-2867"><a href="#cb212-2867" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">50</span>,</span>
<span id="cb212-2868"><a href="#cb212-2868" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(parties_rating<span class="sc">$</span>socio_pct_min_y) <span class="sc">+</span> <span class="dv">103</span>,</span>
<span id="cb212-2869"><a href="#cb212-2869" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Libertär/Progressiv"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb212-2870"><a href="#cb212-2870" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="sc">+</span><span class="dv">110</span>)) <span class="sc">+</span></span>
<span id="cb212-2871"><a href="#cb212-2871" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Wirtschaftspolitisch"</span>,</span>
<span id="cb212-2872"><a href="#cb212-2872" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Gesellschaftspolitisch"</span>,</span>
<span id="cb212-2873"><a href="#cb212-2873" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Politische Positionierung im Zwei-Achsen-Modell"</span>,</span>
<span id="cb212-2874"><a href="#cb212-2874" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Durchschnitt des Abstimmungsverhaltens als Zentrum, Min-/Max als Ellipse"</span>) <span class="sc">+</span></span>
<span id="cb212-2875"><a href="#cb212-2875" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb212-2876"><a href="#cb212-2876" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>,</span>
<span id="cb212-2877"><a href="#cb212-2877" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">30</span>)),</span>
<span id="cb212-2878"><a href="#cb212-2878" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>,</span>
<span id="cb212-2879"><a href="#cb212-2879" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">5</span>)),</span>
<span id="cb212-2880"><a href="#cb212-2880" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>,</span>
<span id="cb212-2881"><a href="#cb212-2881" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">5</span>))) <span class="sc">+</span></span>
<span id="cb212-2882"><a href="#cb212-2882" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb212-2883"><a href="#cb212-2883" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb212-2884"><a href="#cb212-2884" aria-hidden="true" tabindex="-1"></a>                  <span class="at">clip =</span> <span class="st">"off"</span>)</span>
<span id="cb212-2885"><a href="#cb212-2885" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-2886"><a href="#cb212-2886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2887"><a href="#cb212-2887" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3D-Koordinatensystem (Testweise)</span></span>
<span id="cb212-2888"><a href="#cb212-2888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2891"><a href="#cb212-2891" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-2892"><a href="#cb212-2892" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot_parties_3d</span></span>
<span id="cb212-2893"><a href="#cb212-2893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2894"><a href="#cb212-2894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2895"><a href="#cb212-2895" aria-hidden="true" tabindex="-1"></a><span class="co"># Datenframe erstellen</span></span>
<span id="cb212-2896"><a href="#cb212-2896" aria-hidden="true" tabindex="-1"></a>parties <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb212-2897"><a href="#cb212-2897" aria-hidden="true" tabindex="-1"></a>  <span class="at">Partei =</span> <span class="fu">c</span>(<span class="st">"SP"</span>, <span class="st">"SVP"</span>, <span class="st">"FDP"</span>, <span class="st">"GPS"</span>, <span class="st">"GLP"</span>, <span class="st">"Mitte"</span>, <span class="st">"EVP"</span>, <span class="st">"EDU"</span>),</span>
<span id="cb212-2898"><a href="#cb212-2898" aria-hidden="true" tabindex="-1"></a>  <span class="at">Wirtschaft =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">85</span>, <span class="dv">80</span>, <span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">60</span>, <span class="dv">40</span>, <span class="dv">90</span>),      <span class="co"># Links = niedrig, Rechts = hoch</span></span>
<span id="cb212-2899"><a href="#cb212-2899" aria-hidden="true" tabindex="-1"></a>  <span class="at">Gesellschaft =</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">20</span>, <span class="dv">55</span>, <span class="dv">90</span>, <span class="dv">75</span>, <span class="dv">45</span>, <span class="dv">50</span>, <span class="dv">20</span>),    <span class="co"># Libertär = hoch, Autoritär = niedrig</span></span>
<span id="cb212-2900"><a href="#cb212-2900" aria-hidden="true" tabindex="-1"></a>  <span class="at">Kosmopolitismus =</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">15</span>, <span class="dv">60</span>, <span class="dv">95</span>, <span class="dv">85</span>, <span class="dv">50</span>, <span class="dv">55</span>, <span class="dv">20</span>)  <span class="co"># Kosmopolitisch = hoch, Nationalistisch = niedrig</span></span>
<span id="cb212-2901"><a href="#cb212-2901" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb212-2902"><a href="#cb212-2902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2903"><a href="#cb212-2903" aria-hidden="true" tabindex="-1"></a><span class="co"># Interaktives 3D-Scatterplot mit Plotly</span></span>
<span id="cb212-2904"><a href="#cb212-2904" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(</span>
<span id="cb212-2905"><a href="#cb212-2905" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> parties,</span>
<span id="cb212-2906"><a href="#cb212-2906" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="sc">~</span>Wirtschaft,</span>
<span id="cb212-2907"><a href="#cb212-2907" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="sc">~</span>Gesellschaft,</span>
<span id="cb212-2908"><a href="#cb212-2908" aria-hidden="true" tabindex="-1"></a>  <span class="at">z =</span> <span class="sc">~</span>Kosmopolitismus,</span>
<span id="cb212-2909"><a href="#cb212-2909" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> <span class="sc">~</span>Partei,</span>
<span id="cb212-2910"><a href="#cb212-2910" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">'scatter3d'</span>,</span>
<span id="cb212-2911"><a href="#cb212-2911" aria-hidden="true" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">'markers+text'</span>,</span>
<span id="cb212-2912"><a href="#cb212-2912" aria-hidden="true" tabindex="-1"></a>  <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">5</span>),</span>
<span id="cb212-2913"><a href="#cb212-2913" aria-hidden="true" tabindex="-1"></a>  <span class="at">textposition =</span> <span class="st">'top center'</span></span>
<span id="cb212-2914"><a href="#cb212-2914" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb212-2915"><a href="#cb212-2915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2916"><a href="#cb212-2916" aria-hidden="true" tabindex="-1"></a><span class="co"># Achsen benennen und Layout anpassen</span></span>
<span id="cb212-2917"><a href="#cb212-2917" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span> <span class="fu">layout</span>(</span>
<span id="cb212-2918"><a href="#cb212-2918" aria-hidden="true" tabindex="-1"></a>  <span class="at">scene =</span> <span class="fu">list</span>(</span>
<span id="cb212-2919"><a href="#cb212-2919" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Wirtschaftspolitik (links – rechts)"</span>),</span>
<span id="cb212-2920"><a href="#cb212-2920" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Gesellschaftspolitik (autoritär – libertär)"</span>),</span>
<span id="cb212-2921"><a href="#cb212-2921" aria-hidden="true" tabindex="-1"></a>    <span class="at">zaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Kosmopolitismus – Nationalismus"</span>)</span>
<span id="cb212-2922"><a href="#cb212-2922" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb212-2923"><a href="#cb212-2923" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Schweizer Parteien im 3D-Koordinatensystem nach Kitschelt"</span></span>
<span id="cb212-2924"><a href="#cb212-2924" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb212-2925"><a href="#cb212-2925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2926"><a href="#cb212-2926" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot anzeigen</span></span>
<span id="cb212-2927"><a href="#cb212-2927" aria-hidden="true" tabindex="-1"></a>fig</span>
<span id="cb212-2928"><a href="#cb212-2928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2929"><a href="#cb212-2929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2930"><a href="#cb212-2930" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-2931"><a href="#cb212-2931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2932"><a href="#cb212-2932" aria-hidden="true" tabindex="-1"></a><span class="fu">### Tables Parties Rating</span></span>
<span id="cb212-2933"><a href="#cb212-2933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2936"><a href="#cb212-2936" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-2937"><a href="#cb212-2937" aria-hidden="true" tabindex="-1"></a><span class="co"># Funktion für identische Formatierung</span></span>
<span id="cb212-2938"><a href="#cb212-2938" aria-hidden="true" tabindex="-1"></a>format_table <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb212-2939"><a href="#cb212-2939" aria-hidden="true" tabindex="-1"></a>  <span class="co"># df[[1]] &lt;- as.character(df[[1]])</span></span>
<span id="cb212-2940"><a href="#cb212-2940" aria-hidden="true" tabindex="-1"></a>  <span class="co"># df[[3]] &lt;- as.character(df[[3]])</span></span>
<span id="cb212-2941"><a href="#cb212-2941" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">flextable</span>(df)</span>
<span id="cb212-2942"><a href="#cb212-2942" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">theme_vanilla</span>(ft)</span>
<span id="cb212-2943"><a href="#cb212-2943" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">font</span>(ft, <span class="at">fontname =</span> <span class="st">"Courier New"</span>, <span class="at">part =</span> <span class="st">"all"</span>)</span>
<span id="cb212-2944"><a href="#cb212-2944" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">fontsize</span>(ft, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">part =</span> <span class="st">"all"</span>)</span>
<span id="cb212-2945"><a href="#cb212-2945" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">colformat_double</span>(ft, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb212-2946"><a href="#cb212-2946" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ft &lt;- colformat_double(ft, digits = 1, suffix = "%")</span></span>
<span id="cb212-2947"><a href="#cb212-2947" aria-hidden="true" tabindex="-1"></a>  ft <span class="ot">&lt;-</span> <span class="fu">width</span>(ft, <span class="at">j =</span> <span class="dv">2</span>, <span class="at">width =</span> <span class="dv">2</span>)</span>
<span id="cb212-2948"><a href="#cb212-2948" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ft)</span>
<span id="cb212-2949"><a href="#cb212-2949" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb212-2950"><a href="#cb212-2950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2951"><a href="#cb212-2951" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabelle 1: Parties Rating</span></span>
<span id="cb212-2952"><a href="#cb212-2952" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">head</span>(parties_rating, <span class="dv">8</span>)</span>
<span id="cb212-2953"><a href="#cb212-2953" aria-hidden="true" tabindex="-1"></a>ft1 <span class="ot">&lt;-</span> <span class="fu">format_table</span>(df1)</span>
<span id="cb212-2954"><a href="#cb212-2954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2955"><a href="#cb212-2955" aria-hidden="true" tabindex="-1"></a><span class="co"># # Tabelle 2: ABGELEHNT</span></span>
<span id="cb212-2956"><a href="#cb212-2956" aria-hidden="true" tabindex="-1"></a><span class="co"># df2 &lt;- head(parties_rating)</span></span>
<span id="cb212-2957"><a href="#cb212-2957" aria-hidden="true" tabindex="-1"></a><span class="co"># ft2 &lt;- format_table(df2)</span></span>
<span id="cb212-2958"><a href="#cb212-2958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2959"><a href="#cb212-2959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2960"><a href="#cb212-2960" aria-hidden="true" tabindex="-1"></a><span class="co"># Word-Dokument erstellen und beide Tabellen einfügen ---</span></span>
<span id="cb212-2961"><a href="#cb212-2961" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">read_docx</span>()</span>
<span id="cb212-2962"><a href="#cb212-2962" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">body_add_par</span>(doc,</span>
<span id="cb212-2963"><a href="#cb212-2963" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Rating der Parteien"</span>,</span>
<span id="cb212-2964"><a href="#cb212-2964" aria-hidden="true" tabindex="-1"></a>                    <span class="at">style =</span> <span class="st">"heading 1"</span>)</span>
<span id="cb212-2965"><a href="#cb212-2965" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">body_add_flextable</span>(doc,</span>
<span id="cb212-2966"><a href="#cb212-2966" aria-hidden="true" tabindex="-1"></a>                          ft1)</span>
<span id="cb212-2967"><a href="#cb212-2967" aria-hidden="true" tabindex="-1"></a><span class="co"># doc &lt;- body_add_par(doc, "") # Leerzeile</span></span>
<span id="cb212-2968"><a href="#cb212-2968" aria-hidden="true" tabindex="-1"></a><span class="co"># doc &lt;- body_add_par(doc,</span></span>
<span id="cb212-2969"><a href="#cb212-2969" aria-hidden="true" tabindex="-1"></a><span class="co">#                     "Ablehnung trotz fehlender Unterstützung durch Parolen",</span></span>
<span id="cb212-2970"><a href="#cb212-2970" aria-hidden="true" tabindex="-1"></a><span class="co">#                     style = "heading 1")</span></span>
<span id="cb212-2971"><a href="#cb212-2971" aria-hidden="true" tabindex="-1"></a><span class="co"># doc &lt;- body_add_flextable(doc,</span></span>
<span id="cb212-2972"><a href="#cb212-2972" aria-hidden="true" tabindex="-1"></a><span class="co">#                           ft2)</span></span>
<span id="cb212-2973"><a href="#cb212-2973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2974"><a href="#cb212-2974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2975"><a href="#cb212-2975" aria-hidden="true" tabindex="-1"></a><span class="co"># Speichern </span></span>
<span id="cb212-2976"><a href="#cb212-2976" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(doc, <span class="at">target =</span> <span class="st">"result/Parties_Rating.docx"</span>)</span>
<span id="cb212-2977"><a href="#cb212-2977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2978"><a href="#cb212-2978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2979"><a href="#cb212-2979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2980"><a href="#cb212-2980" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(parties_rating)</span>
<span id="cb212-2981"><a href="#cb212-2981" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-2982"><a href="#cb212-2982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2983"><a href="#cb212-2983" aria-hidden="true" tabindex="-1"></a><span class="fu"># BACKUP?!</span></span>
<span id="cb212-2984"><a href="#cb212-2984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2985"><a href="#cb212-2985" aria-hidden="true" tabindex="-1"></a><span class="fu"># Visualization</span></span>
<span id="cb212-2986"><a href="#cb212-2986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2989"><a href="#cb212-2989" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-2990"><a href="#cb212-2990" aria-hidden="true" tabindex="-1"></a>voting_5y_plot_data <span class="ot">&lt;-</span> voting_5y_long <span class="sc">%&gt;%</span> </span>
<span id="cb212-2991"><a href="#cb212-2991" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(datum,</span>
<span id="cb212-2992"><a href="#cb212-2992" aria-hidden="true" tabindex="-1"></a>         titel_kurz_d,</span>
<span id="cb212-2993"><a href="#cb212-2993" aria-hidden="true" tabindex="-1"></a>         rechtsform,</span>
<span id="cb212-2994"><a href="#cb212-2994" aria-hidden="true" tabindex="-1"></a>         annahme)</span>
<span id="cb212-2995"><a href="#cb212-2995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2996"><a href="#cb212-2996" aria-hidden="true" tabindex="-1"></a>split_list <span class="ot">&lt;-</span> voting_5y_plot_data <span class="sc">%&gt;%</span></span>
<span id="cb212-2997"><a href="#cb212-2997" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(rechtsform) <span class="sc">%&gt;%</span></span>
<span id="cb212-2998"><a href="#cb212-2998" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_split</span>()      </span>
<span id="cb212-2999"><a href="#cb212-2999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3000"><a href="#cb212-3000" aria-hidden="true" tabindex="-1"></a>voting_obli_referendum <span class="ot">&lt;-</span> split_list[[<span class="dv">1</span>]]</span>
<span id="cb212-3001"><a href="#cb212-3001" aria-hidden="true" tabindex="-1"></a>voting_faku_referendum <span class="ot">&lt;-</span> split_list[[<span class="dv">2</span>]]</span>
<span id="cb212-3002"><a href="#cb212-3002" aria-hidden="true" tabindex="-1"></a>voting_volksinitiative <span class="ot">&lt;-</span> split_list[[<span class="dv">3</span>]]</span>
<span id="cb212-3003"><a href="#cb212-3003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3004"><a href="#cb212-3004" aria-hidden="true" tabindex="-1"></a><span class="co"># Heatmap erstellen</span></span>
<span id="cb212-3005"><a href="#cb212-3005" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> voting_5y_plot_data <span class="sc">%&gt;%</span></span>
<span id="cb212-3006"><a href="#cb212-3006" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">annahme =</span> <span class="fu">factor</span>(annahme, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Nein"</span>, <span class="st">"Ja"</span>)))</span>
<span id="cb212-3007"><a href="#cb212-3007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3008"><a href="#cb212-3008" aria-hidden="true" tabindex="-1"></a><span class="co"># Heatmap</span></span>
<span id="cb212-3009"><a href="#cb212-3009" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data,</span>
<span id="cb212-3010"><a href="#cb212-3010" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> annahme,</span>
<span id="cb212-3011"><a href="#cb212-3011" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> titel_kurz_d,</span>
<span id="cb212-3012"><a href="#cb212-3012" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> annahme)) <span class="sc">+</span></span>
<span id="cb212-3013"><a href="#cb212-3013" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb212-3014"><a href="#cb212-3014" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Nein"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Ja"</span> <span class="ot">=</span> <span class="st">"green"</span>)) <span class="sc">+</span></span>
<span id="cb212-3015"><a href="#cb212-3015" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb212-3016"><a href="#cb212-3016" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Heatmap der Abstimmungsergebnisse"</span>,</span>
<span id="cb212-3017"><a href="#cb212-3017" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Ergebnis"</span>,</span>
<span id="cb212-3018"><a href="#cb212-3018" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Vorlage"</span>,</span>
<span id="cb212-3019"><a href="#cb212-3019" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Annahme"</span></span>
<span id="cb212-3020"><a href="#cb212-3020" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb212-3021"><a href="#cb212-3021" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb212-3022"><a href="#cb212-3022" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb212-3023"><a href="#cb212-3023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3024"><a href="#cb212-3024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3025"><a href="#cb212-3025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3026"><a href="#cb212-3026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3027"><a href="#cb212-3027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3028"><a href="#cb212-3028" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> voting_5y_plot_data <span class="sc">%&gt;%</span></span>
<span id="cb212-3029"><a href="#cb212-3029" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">annahme =</span> <span class="fu">factor</span>(annahme, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"0"</span>,<span class="st">"1"</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Nein"</span>, <span class="st">"Ja"</span>)))</span>
<span id="cb212-3030"><a href="#cb212-3030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3031"><a href="#cb212-3031" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(plot_data<span class="sc">$</span>annahme)</span>
<span id="cb212-3032"><a href="#cb212-3032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3033"><a href="#cb212-3033" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data,</span>
<span id="cb212-3034"><a href="#cb212-3034" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> annahme,</span>
<span id="cb212-3035"><a href="#cb212-3035" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> titel_kurz_d,</span>
<span id="cb212-3036"><a href="#cb212-3036" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> annahme)) <span class="sc">+</span></span>
<span id="cb212-3037"><a href="#cb212-3037" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb212-3038"><a href="#cb212-3038" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Nein"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Ja"</span> <span class="ot">=</span> <span class="st">"green"</span>)) <span class="sc">+</span></span>
<span id="cb212-3039"><a href="#cb212-3039" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb212-3040"><a href="#cb212-3040" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Heatmap der Abstimmungsergebnisse"</span>,</span>
<span id="cb212-3041"><a href="#cb212-3041" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Ergebnis"</span>,</span>
<span id="cb212-3042"><a href="#cb212-3042" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Vorlage"</span>,</span>
<span id="cb212-3043"><a href="#cb212-3043" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Annahme"</span></span>
<span id="cb212-3044"><a href="#cb212-3044" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb212-3045"><a href="#cb212-3045" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb212-3046"><a href="#cb212-3046" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb212-3047"><a href="#cb212-3047" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> rechtsform, <span class="at">scales =</span> <span class="st">"free_y"</span>)</span>
<span id="cb212-3048"><a href="#cb212-3048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3049"><a href="#cb212-3049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3050"><a href="#cb212-3050" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-3051"><a href="#cb212-3051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3052"><a href="#cb212-3052" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Tatsächliches Ergebnis und Verteilung der Parolen (Ja-Nein-Keine)</span></span>
<span id="cb212-3053"><a href="#cb212-3053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3056"><a href="#cb212-3056" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-3057"><a href="#cb212-3057" aria-hidden="true" tabindex="-1"></a><span class="co"># Verteilung Ja/Nein/Keine pro Abstimmung - State - 2020</span></span>
<span id="cb212-3058"><a href="#cb212-3058" aria-hidden="true" tabindex="-1"></a><span class="co"># Tatsächliches Abstiummungsergebnis (annahme) auch abbilden</span></span>
<span id="cb212-3059"><a href="#cb212-3059" aria-hidden="true" tabindex="-1"></a><span class="co"># Split nach Staatsebene</span></span>
<span id="cb212-3060"><a href="#cb212-3060" aria-hidden="true" tabindex="-1"></a><span class="co"># tatsächliches Abstiummungsergebnis bei 0 (0) oder 100% (1) als PUnkt darstellen.</span></span>
<span id="cb212-3061"><a href="#cb212-3061" aria-hidden="true" tabindex="-1"></a><span class="co"># nicht nur state_parole_ sondern auch kt_parole_ und gemeinde_parole_ anzeigen.</span></span>
<span id="cb212-3062"><a href="#cb212-3062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3063"><a href="#cb212-3063" aria-hidden="true" tabindex="-1"></a><span class="do">##DATUMSFILTER##</span></span>
<span id="cb212-3064"><a href="#cb212-3064" aria-hidden="true" tabindex="-1"></a>jahr <span class="ot">&lt;-</span> <span class="dv">2020</span></span>
<span id="cb212-3065"><a href="#cb212-3065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3066"><a href="#cb212-3066" aria-hidden="true" tabindex="-1"></a><span class="co"># Daten für den Balkenplot vorbereiten (alle parole-Spalten, Quelle extrahieren)</span></span>
<span id="cb212-3067"><a href="#cb212-3067" aria-hidden="true" tabindex="-1"></a>df_plot <span class="ot">&lt;-</span> voting_5y_long_strength_wtd_summary <span class="sc">%&gt;%</span></span>
<span id="cb212-3068"><a href="#cb212-3068" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> jahr) <span class="sc">%&gt;%</span></span>
<span id="cb212-3069"><a href="#cb212-3069" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(anr, <span class="fu">matches</span>(<span class="st">"^(state|kt|gemeinde)_parole_"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb212-3070"><a href="#cb212-3070" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb212-3071"><a href="#cb212-3071" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">matches</span>(<span class="st">"^(state|kt|gemeinde)_parole_"</span>),</span>
<span id="cb212-3072"><a href="#cb212-3072" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"parole_typ"</span>,</span>
<span id="cb212-3073"><a href="#cb212-3073" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"wert"</span></span>
<span id="cb212-3074"><a href="#cb212-3074" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb212-3075"><a href="#cb212-3075" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb212-3076"><a href="#cb212-3076" aria-hidden="true" tabindex="-1"></a>    <span class="at">parole_quelle =</span> <span class="fu">case_when</span>(</span>
<span id="cb212-3077"><a href="#cb212-3077" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"^state_parole_"</span>, parole_typ) <span class="sc">~</span> <span class="st">"National- &amp; Ständerat"</span>,</span>
<span id="cb212-3078"><a href="#cb212-3078" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"^kt_parole_"</span>, parole_typ) <span class="sc">~</span> <span class="st">"Kantonsregierung*"</span>,</span>
<span id="cb212-3079"><a href="#cb212-3079" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"^gemeinde_parole_"</span>, parole_typ) <span class="sc">~</span> <span class="st">"Gemeinde*"</span></span>
<span id="cb212-3080"><a href="#cb212-3080" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb212-3081"><a href="#cb212-3081" aria-hidden="true" tabindex="-1"></a>    <span class="at">parole_typ =</span> <span class="fu">case_when</span>(</span>
<span id="cb212-3082"><a href="#cb212-3082" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"_Nein$"</span>, parole_typ) <span class="sc">~</span> <span class="st">"Nein"</span>,</span>
<span id="cb212-3083"><a href="#cb212-3083" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"_Ja$"</span>, parole_typ) <span class="sc">~</span> <span class="st">"Ja"</span>,</span>
<span id="cb212-3084"><a href="#cb212-3084" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"_Keine$"</span>, parole_typ) <span class="sc">~</span> <span class="st">"Keine"</span></span>
<span id="cb212-3085"><a href="#cb212-3085" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb212-3086"><a href="#cb212-3086" aria-hidden="true" tabindex="-1"></a>    <span class="at">anr =</span> <span class="fu">factor</span>(anr, <span class="at">levels =</span> <span class="fu">unique</span>(anr)),</span>
<span id="cb212-3087"><a href="#cb212-3087" aria-hidden="true" tabindex="-1"></a>    <span class="at">parole_quelle =</span> <span class="fu">factor</span>(parole_quelle, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"National- &amp; Ständerat"</span>,</span>
<span id="cb212-3088"><a href="#cb212-3088" aria-hidden="true" tabindex="-1"></a>                                                     <span class="st">"Kantonsregierung*"</span>,</span>
<span id="cb212-3089"><a href="#cb212-3089" aria-hidden="true" tabindex="-1"></a>                                                     <span class="st">"Gemeinde*"</span>)))</span>
<span id="cb212-3090"><a href="#cb212-3090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3091"><a href="#cb212-3091" aria-hidden="true" tabindex="-1"></a><span class="co"># Annahme-Daten für die Punkte vorbereiten</span></span>
<span id="cb212-3092"><a href="#cb212-3092" aria-hidden="true" tabindex="-1"></a>df_annahme <span class="ot">&lt;-</span> voting_5y_long_strength_wtd_summary <span class="sc">%&gt;%</span></span>
<span id="cb212-3093"><a href="#cb212-3093" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> jahr) <span class="sc">%&gt;%</span></span>
<span id="cb212-3094"><a href="#cb212-3094" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(anr, annahme) <span class="sc">%&gt;%</span></span>
<span id="cb212-3095"><a href="#cb212-3095" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb212-3096"><a href="#cb212-3096" aria-hidden="true" tabindex="-1"></a>    <span class="at">anr =</span> <span class="fu">factor</span>(anr, <span class="at">levels =</span> <span class="fu">unique</span>(df_plot<span class="sc">$</span>anr)),</span>
<span id="cb212-3097"><a href="#cb212-3097" aria-hidden="true" tabindex="-1"></a>    <span class="at">annahme =</span> <span class="fu">as.numeric</span>(annahme) <span class="co"># Annahme: 0 oder 1</span></span>
<span id="cb212-3098"><a href="#cb212-3098" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb212-3099"><a href="#cb212-3099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3100"><a href="#cb212-3100" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot mit Balken und Annahme-Punkt, getrennt nach parole_quelle</span></span>
<span id="cb212-3101"><a href="#cb212-3101" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb212-3102"><a href="#cb212-3102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb212-3103"><a href="#cb212-3103" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_plot,</span>
<span id="cb212-3104"><a href="#cb212-3104" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> anr, <span class="at">y =</span> wert, <span class="at">fill =</span> parole_typ),</span>
<span id="cb212-3105"><a href="#cb212-3105" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">"identity"</span>,</span>
<span id="cb212-3106"><a href="#cb212-3106" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"fill"</span>,</span>
<span id="cb212-3107"><a href="#cb212-3107" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb212-3108"><a href="#cb212-3108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb212-3109"><a href="#cb212-3109" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_annahme,</span>
<span id="cb212-3110"><a href="#cb212-3110" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> anr, <span class="at">y =</span> annahme),</span>
<span id="cb212-3111"><a href="#cb212-3111" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb212-3112"><a href="#cb212-3112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb212-3113"><a href="#cb212-3113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb212-3114"><a href="#cb212-3114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> parole_quelle, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb212-3115"><a href="#cb212-3115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb212-3116"><a href="#cb212-3116" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Abstimmung (anr)"</span>,</span>
<span id="cb212-3117"><a href="#cb212-3117" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Anteil"</span>,</span>
<span id="cb212-3118"><a href="#cb212-3118" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Parole"</span>,</span>
<span id="cb212-3119"><a href="#cb212-3119" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Verteilung Ja/Nein/Keine pro Abstimmung –"</span>, jahr),</span>
<span id="cb212-3120"><a href="#cb212-3120" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"* aggregiert, gewichtet nach Stimmberechtigten/Einwohner"</span>),</span>
<span id="cb212-3121"><a href="#cb212-3121" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Quelle: Eigene Berechnung"</span>)) <span class="sc">+</span></span>
<span id="cb212-3122"><a href="#cb212-3122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb212-3123"><a href="#cb212-3123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Ja"</span> <span class="ot">=</span> <span class="st">"#66A61E"</span>,</span>
<span id="cb212-3124"><a href="#cb212-3124" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Keine"</span> <span class="ot">=</span> <span class="st">"#BDBDBD"</span>,</span>
<span id="cb212-3125"><a href="#cb212-3125" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Nein"</span> <span class="ot">=</span> <span class="st">"#D95F02"</span>))</span>
<span id="cb212-3126"><a href="#cb212-3126" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_fill_brewer(palette = "Dark2")</span></span>
<span id="cb212-3127"><a href="#cb212-3127" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-3128"><a href="#cb212-3128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3131"><a href="#cb212-3131" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-3132"><a href="#cb212-3132" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: Nicht nur pro Jahr sondern auch Departement? Tatsächliche ja/nein/enthalten hinzufügen.</span></span>
<span id="cb212-3133"><a href="#cb212-3133" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb212-3134"><a href="#cb212-3134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3137"><a href="#cb212-3137" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb212-3138"><a href="#cb212-3138" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb212-3139"><a href="#cb212-3139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb212-3140"><a href="#cb212-3140" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_plot,</span>
<span id="cb212-3141"><a href="#cb212-3141" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> anr, <span class="at">y =</span> wert, <span class="at">fill =</span> parole_typ),</span>
<span id="cb212-3142"><a href="#cb212-3142" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">"identity"</span>,</span>
<span id="cb212-3143"><a href="#cb212-3143" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"fill"</span>,</span>
<span id="cb212-3144"><a href="#cb212-3144" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">1</span></span>
<span id="cb212-3145"><a href="#cb212-3145" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb212-3146"><a href="#cb212-3146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb212-3147"><a href="#cb212-3147" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_annahme,</span>
<span id="cb212-3148"><a href="#cb212-3148" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> anr, <span class="at">y =</span> annahme, <span class="at">shape =</span> <span class="st">"Abstimmungsergebnis"</span>),</span>
<span id="cb212-3149"><a href="#cb212-3149" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb212-3150"><a href="#cb212-3150" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb212-3151"><a href="#cb212-3151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(</span>
<span id="cb212-3152"><a href="#cb212-3152" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">""</span>, <span class="co">#Abstimmungsergebnis</span></span>
<span id="cb212-3153"><a href="#cb212-3153" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Abstimmungsergebnis"</span> <span class="ot">=</span> <span class="dv">16</span>)</span>
<span id="cb212-3154"><a href="#cb212-3154" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb212-3155"><a href="#cb212-3155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb212-3156"><a href="#cb212-3156" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Parolen:"</span>,</span>
<span id="cb212-3157"><a href="#cb212-3157" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Ja"</span> <span class="ot">=</span> <span class="st">"#66A61E"</span>, <span class="st">"Keine"</span> <span class="ot">=</span> <span class="st">"#BDBDBD"</span>, <span class="st">"Nein"</span> <span class="ot">=</span> <span class="st">"#D95F02"</span>)</span>
<span id="cb212-3158"><a href="#cb212-3158" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb212-3159"><a href="#cb212-3159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb212-3160"><a href="#cb212-3160" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">1</span>),</span>
<span id="cb212-3161"><a href="#cb212-3161" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill  =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">2</span>)</span>
<span id="cb212-3162"><a href="#cb212-3162" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb212-3163"><a href="#cb212-3163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb212-3164"><a href="#cb212-3164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> parole_quelle, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb212-3165"><a href="#cb212-3165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb212-3166"><a href="#cb212-3166" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Abstimmung (anr)"</span>,</span>
<span id="cb212-3167"><a href="#cb212-3167" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Anteil"</span>,</span>
<span id="cb212-3168"><a href="#cb212-3168" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Verteilung Ja/Nein/Keine pro Abstimmung –"</span>, jahr),</span>
<span id="cb212-3169"><a href="#cb212-3169" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"* aggregiert, gewichtet nach Stimmberechtigten/Einwohner"</span>,</span>
<span id="cb212-3170"><a href="#cb212-3170" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Quelle: Eigene Berechnung"</span></span>
<span id="cb212-3171"><a href="#cb212-3171" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb212-3172"><a href="#cb212-3172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb212-3173"><a href="#cb212-3173" aria-hidden="true" tabindex="-1"></a>                          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb212-3174"><a href="#cb212-3174" aria-hidden="true" tabindex="-1"></a>                          <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span>
<span id="cb212-3175"><a href="#cb212-3175" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>